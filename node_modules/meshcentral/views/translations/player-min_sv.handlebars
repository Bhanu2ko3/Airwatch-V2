<!doctypehtml><html lang=sv dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="text/html;charset=utf-8"http-equiv=Content-Type><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link type=text/css href=styles/style.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/custom.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{min}}.js></script><script src=scripts/agent-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-desktop-0.0.2{{min}}.js></script><script src=scripts/amt-terminal-0.0.2{{min}}.js></script><script src=scripts/zlib{{min}}.js></script><script src=scripts/zlib-inflate{{min}}.js></script><script src=scripts/zlib-adler32{{min}}.js></script><script src=scripts/zlib-crc32{{min}}.js></script><script src=scripts/xterm-min.js></script><script src=scripts/xterm-addon-fit-min.js></script><script keeplink=1 src=scripts/webm-writer.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><body style=overflow:hidden;background-color:#000><div id=p11 class=noselect style=overflow:hidden><div id=deskarea0><div id=deskarea1 class=areaHead><div class=toright2><div class=deskareaicon title="Växla visningsläge"onclick=toggleAspectRatio(1)>⇲</div>&nbsp; <input id=ConvertAsWebM style=display:none type=button value="Konvertera till WebM"onclick=saveAsWebMfile()>&nbsp;</div><div><input id=OpenFileButton type=button value="Öppna fil..."onclick=openfile() style=display:none> <span id=deskstatus style=line-height:22px;overflow:hidden;max-height:22px></span></div></div><div id=deskarea3x style="max-height:calc(100vh - 58px);height:calc(100vh - 58px)"onclick=togglePause()><div id=bigok style="display:none;left:calc((100vh / 2))"><b>✓</b></div><div id=bigfail style="display:none;left:calc((100vh / 2))"><b>✗</b></div><div id=metadatadiv style=padding:20px;color:#d3d3d3;text-align:left;display:none></div><div id=DeskParent><canvas id=Desk width=640 height=480></canvas></div><div id=TermParent style=display:none><pre id=Term></pre></div><div id=XTermParent style="display:none;overflow:scroll;max-height:calc(100vh - 58px);height:calc(100vh - 58px);text-align:left"></div><div id=p11DeskConsoleMsg style=display:none;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=clearConsoleMsg()></div></div><div id=deskarea2><div class=areaProgress style=cursor:pointer onclick=progressBarSeek(event)><div id=progressbar style=height:6px;cursor:pointer></div></div></div><div id=deskarea4 class=areaFoot><div class=toright2><div id=timespan style=padding-top:4px;padding-right:4px>00:00:00</div></div><div>&nbsp; <input id=PlayButton type=button value=Spela disabled onclick=play()> <input id=PauseButton type=button value=Paus disabled onclick=pause()> <input id=RestartButton type=button value=Omstart disabled onclick=restart()> <select id=PlaySpeed onchange=this.blur()><option value=4>1/4 hastighet<option value=2>1/2 hastighet<option value=1 selected>Normal hastighet<option value=0.5>2x hastighet<option value=0.25>4x hastighet<option value=0.1>10x hastighet</select> <input id=SeekBackwardButton type=button value="<<"disabled onclick=seekBackward()> <input id=SeekForwardButton type=button value=">>"disabled onclick=seekForward()></div></div></div><div id=dialog class=noselect style=display:none><div id=dialogHeader><div tabindex=0 id=id_dialogclose onclick=setDialogMode() onkeypress='"Enter"==event.key&&setDialogMode()'>✖</div><div id=id_dialogtitle></div></div><div id=dialogBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div></div><div id=idx_dlgButtonBar><input id=idx_dlgCancelButton type=button value=Avbryt onclick=dialogclose(0)> <input id=idx_dlgOkButton type=button value=OK onclick=dialogclose(1)><div><input id=idx_dlgDeleteButton type=button value=Radera style=display:none onclick=dialogclose(2)></div></div></div></div><script>var urlargs,random="{{{randomlength}}}",recFile=null,recFilePtr=0,recFileStartTime=0,recFileLastTime=0,recFileEndTime=0,recFileMetadata=null,recFileProtocol=0,recFileIndexBasePtr=null,recFileExtras=null,agentDesktop=null,amtDesktop=null,playing=!1,readState=0,waitTimer=null,waitTimerArgs=null,deskAspectRatio=0,currentDeltaTimeTotalSec=0,videoWriter=null,videoWriterLastFrame=null,videoWriterCurrentFrame=null,videoFrameDuration=100,browser=null,domainUrl="{{{domainurl}}}",term=null,ws=null,streamingBlockSize=102400,streamingBlockCache={};function start(){browser=function(e){switch(!0){case e.indexOf("kant")>-1:return"MS Edge (EdgeHtml)";case e.indexOf("kant")>-1:return"MS Edge Chromium";case e.indexOf("opr")>-1&&!!window.opr:return"opera";case e.indexOf("Chrome")>-1&&!!window.chrome:return"Chrome";case e.indexOf("treudd")>-1:return"Internet Explorer";case e.indexOf("firefox")>-1:return"firefox";case e.indexOf("safari")>-1:return"safari";default:return"Övrig"}}(window.navigator.userAgent.toLowerCase()),urlargs=parseUriArgs(!0),window.onresize=deskAdjust,document.ondrop=ondrop,document.ondragover=ondragover,document.ondragleave=ondragleave,document.onkeypress=onkeypress,Q("PlaySpeed").value=1,cleanup(),dialogBoxDrag(),null!=urlargs.stream?(QV("metadatadiv",!0),QH("metadatadiv","Ansluta till servern..."),(ws=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+domainUrl+"recordings.ashx?file="+urlargs.stream+(urlargs.key?"&key="+urlargs.key:""))).binaryType="arraybuffer",ws.onopen=function(e){console.log("Session Streaming - Connected")},ws.onmessage=function(e){if("string"==typeof e.data){var t=null;try{t=JSON.parse(e.data)}catch(e){return void console.log(e)}if(null!=t&&"string"==typeof t.action)switch(t.action){case"info":if(console.log("Session Streaming - Session file size: "+t.size),"string"!=typeof t.name||"number"!=typeof t.size)break;recFile={name:t.name,size:t.size,streaming:!0},readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0})}}else{var a=new Uint8Array(e.data),r=((a[4]<<24)+(a[5]<<16)+(a[6]<<8)+a[7])/streamingBlockSize;streamingBlockCache[r]=e.data;var i=[],n=[];for(var l in pendingFetchStreamingData){pendingFetchStreamingData[l].missingBlocks.indexOf(r)>=0&&pendingFetchStreamingData[l].missingBlocks.splice(l,1),0==pendingFetchStreamingData[l].missingBlocks.length?n.push(pendingFetchStreamingData[l]):i.push(pendingFetchStreamingData[l])}for(var l in pendingFetchStreamingData=i,n)fetchStreamingData(n[l].fr,n[l].start,n[l].end)}},ws.onclose=function(e){console.log("Session Streaming - Disconnected"),ws=null,urlargs.stream=null,QV("OpenFileButton",!0),cleanup()}):QV("OpenFileButton",!0)}var pendingFetchStreamingData=[];function fetchStreamingData(e,t,a){for(var r=Math.floor(t/streamingBlockSize),i=Math.floor(a/streamingBlockSize),n=[],l=r;l<=i;l++)null!=streamingBlockCache[l]&&1!==streamingBlockCache[l]||(n.push(l),fetchStreamingBlock(l)),fetchStreamingBlock(l+1),fetchStreamingBlock(l+2);if(0==n.length){var o=0,s=new ArrayBuffer(a-t),c=new Uint8Array(s);for(l=r;l<=i;l++){var d=streamingBlockCache[l],u=l*streamingBlockSize,p=u+(d.byteLength-8),m=Math.max(t,u),g=m-u,f=Math.min(a,p)-m,k=d.slice(8+g,8+g+f);c.set(new Uint8Array(k),o),o+=f}e.onload({target:{result:ArrayBufferToString(s)}})}else pendingFetchStreamingData.push({fr:e,start:t,end:a,missingBlocks:n})}function fetchStreamingBlock(e){if(null==streamingBlockCache[e]&&(streamingBlockCache[e]=1,!(e*streamingBlockSize>=recFile.size))){var t=streamingBlockSize;(e+1)*streamingBlockSize>=recFile.size&&(t=recFile.size-e*streamingBlockSize),ws.send('{"action":"get","ptr":'+e*streamingBlockSize+',"size":'+t+"}")}}function readNextBlock(e){if(recFilePtr+16>recFile.size)QS("progressbar").width="100%",e(-1);else{var t=new FileReader;t.onload=function(t){var a=t.target.result,r=ReadShort(a,0),i=ReadShort(a,2),n=ReadInt(a,4),l=(ReadInt(a,8)<<32)+ReadInt(a,12);if(recFilePtr+16+n>recFile.size)QS("progressbar").width="100%",e(-1);else{var o=new FileReader;o.onload=function(t){var a=t.target.result;recFilePtr+=16+n,QS("progressbar").width=0==recFileEndTime?Math.floor(recFilePtr/recFile.size*100)+"%":Math.floor((recFileLastTime-recFileStartTime)/(recFileEndTime-recFileStartTime)*100)+"%",e(r,i,l,a)},null==ws?o.readAsBinaryString(recFile.slice(recFilePtr+16,recFilePtr+16+n)):fetchStreamingData(o,recFilePtr+16,recFilePtr+16+n)}},null==ws?t.readAsBinaryString(recFile.slice(recFilePtr,recFilePtr+16)):fetchStreamingData(t,recFilePtr,recFilePtr+16)}}function readBlockAt(e,t){var a=new FileReader;a.onload=function(a){var r=a.target.result,i=ReadShort(r,0),n=ReadShort(r,2),l=ReadInt(r,4),o=(ReadInt(r,8)<<32)+ReadInt(r,12);if(e+16+l>recFile.size)t(-1);else{var s=new FileReader;s.onload=function(e){var a=e.target.result;t(i,n,o,a)},null==ws?s.readAsBinaryString(recFile.slice(e+16,e+16+l)):fetchStreamingData(s,e+16,e+16+l)}},null==ws?a.readAsBinaryString(recFile.slice(e,e+16)):fetchStreamingData(a,e,e+16)}function readLastBlock(e){if(recFile.size<32)e(-1);else{var t=new FileReader;t.onload=function(t){var a=t.target.result,r=ReadShort(a,0),i=ReadShort(a,2),n=ReadInt(a,4),l=(ReadInt(a,8)<<32)+ReadInt(a,12),o=a.substring(16,32);if(3==r&&16==n&&"MeshCentralMCNDX"==o){var s=new FileReader;s.onload=function(t){var a=t.target.result,n=(ReadShort(a,0),ReadShort(a,2),ReadInt(a,4),(ReadInt(a,8)<<32)+ReadInt(a,12)),l=JSON.parse(a.substring(16));e(r,i,n,l)},null==ws?s.readAsBinaryString(recFile.slice(l,recFile.size-32)):fetchStreamingData(s,l,recFile.size-32)}else 3==r&&16==n&&"MeshCentralMCREC"==o?e(r,i,l):e(-1)},null==ws?t.readAsBinaryString(recFile.slice(recFile.size-32,recFile.size)):fetchStreamingData(t,recFile.size-32,recFile.size)}}function addInfo(e,t){return null==t?"":addInfoNoEsc(e,EscapeHtml(t))}function addInfoNoEsc(e,t){return null==t?"":"<span style=color:gray>"+EscapeHtml(e)+"</span>:&nbsp;<span style=font-size:20px>"+t+"</span><br/>"}function processFirstBlock(e,t,a,r){if(recFileProtocol=0,1!=e||t>2)cleanup();else{try{recFileMetadata=JSON.parse(r)}catch(e){return void cleanup()}if(null!=recFileMetadata&&"MeshCentralRelaySession"==recFileMetadata.magic&&1==recFileMetadata.ver){if(recFileExtras)for(var i in recFileExtras)recFileMetadata[i]=recFileExtras[i];var n="";if(n+=addInfo("Tid",recFileMetadata.time),0!=recFileEndTime){var l=Math.floor((recFileEndTime-a)/1e3);n+=addInfo("Varaktighet",format("{0} sekund {1}",l,l>1?"s":""))}if(n+=addInfo("Användarnamn",recFileMetadata.username),n+=addInfo("Användar ID",recFileMetadata.userid),n+=addInfo("SessionID",recFileMetadata.sessionid),recFileMetadata.ipaddr1&&recFileMetadata.ipaddr2&&(n+=addInfo("Adresser",format("{0} till {1}",recFileMetadata.ipaddr1,recFileMetadata.ipaddr2))),recFileMetadata.devicename&&(n+=addInfo("Enhetsnamn",recFileMetadata.devicename)),n+=addInfo("NodeID",recFileMetadata.nodeid),recFileMetadata.protocol){var o=recFileMetadata.protocol;1==o?o="MeshCentral Terminal":2==o?o="MeshCentral Desktop":6==o?o="Admin PowerShell":8==o?o="Användarskal":9==o?o="Användare PowerShell":100==o?o="Intel&reg; AMT WSMAN":101==o?o="Intel&reg; AMT-omdirigering":102==o||200==o&&null!=recFileMetadata.bpp?o="Intel&reg; AMT KVM":200==o&&(o="MeshMessenger"),n+=addInfoNoEsc("Protokoll",o)}var s="2 byte per pixel";1==recFileMetadata.bpp&&(s="1 byte per pixel"),recFileMetadata.graymode&&(recFileMetadata.lowcolor?s+=", 16 gråa":s+=", 256 grå"),n+=addInfoNoEsc("Kodningskvalitet",s),recFileMetadata.indexInterval?(recFileIndexBasePtr=recFilePtr,n+=addInfoNoEsc("Sökande",format("Indexeras var {0} sekund",recFileMetadata.indexInterval)),QV("SeekBackwardButton",!0),QV("SeekForwardButton",!0),QE("SeekBackwardButton",!0),QE("SeekForwardButton",!0)):(QV("SeekBackwardButton",!1),QV("SeekForwardButton",!1)),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1),QV("ConvertAsWebM",!1),1==recFileMetadata.protocol||6==recFileMetadata.protocol||8==recFileMetadata.protocol||9==recFileMetadata.protocol?(recFileProtocol=1,n+="<br /><br /><span style=color:gray>Tryck på [mellanslag] för att spela / pausa.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a):2==recFileMetadata.protocol?(recFileProtocol=2,n+="<br /><br /><span style=color:gray>Tryck på [mellanslag] för att spela / pausa.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(agentDesktop=CreateAgentRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,agentDesktop.onPreDrawImage=preCanvasDraw,agentDesktop.State=3,deskAdjust(),QV("ConvertAsWebM",!0)):101==recFileMetadata.protocol?(recFileProtocol=101,n+="<br /><br /><span style=color:gray>Tryck på [mellanslag] för att spela / pausa.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.onPreDrawImage=preCanvasDraw,recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.State=3,amtDesktop.Start(),deskAdjust()):(102==recFileMetadata.protocol||200==recFileMetadata.protocol&&null!=recFileMetadata.bpp)&&(recFileProtocol=102,n+="<br /><br /><span style=color:gray>Tryck på [mellanslag] för att spela / pausa.</span>",QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),recFileStartTime=recFileLastTime=a,(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.onPreDrawImage=preCanvasDraw,amtDesktop.State=3,amtDesktop.Start(),recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.state=3,deskAdjust(),QV("ConvertAsWebM",!0)),QV("metadatadiv",!0),QH("metadatadiv",n),QH("deskstatus",recFile.name),QS("progressbar").width="0px"}else cleanup()}}function processBlock(e,t,a,r){if(e<0)pause();else{var i=Math.round((a-recFileLastTime)*parseFloat(Q("PlaySpeed").value));i<5||null!=videoWriter?processBlockEx(e,t,a,r):(waitTimerArgs=[e,t,a,r],waitTimer=setTimeout(function(){waitTimer=null,waitTimerArgs&&processBlockEx(waitTimerArgs[0],waitTimerArgs[1],waitTimerArgs[2],waitTimerArgs[3])},i))}}function processBlockEx(e,t,a,r,i){if(0!=playing||!0===i){var n=!!(1&t),l=!!(2&t);if(3==e&&null!=videoWriter&&(preCanvasDraw(),videoWriter.complete().then(function(e){saveAs(e,recFile.name.replace(".mcrec",".webm")),videoWriter=null,QE("PlaySpeed",!0),QE("SeekBackwardButton",!0),QE("SeekForwardButton",!0),QE("ConvertAsWebM",!0),QE("OpenFileButton",!0)})),2==e){recFileLastTime=a;var o=Math.floor((a-recFileStartTime)/1e3);if(currentDeltaTimeTotalSec!=o){currentDeltaTimeTotalSec=o;var s=Math.floor(o/3600),c=Math.floor(o%3600/60),d=Math.floor(o%60);QH("timespan",pad2(s)+":"+pad2(c)+":"+pad2(d))}null==videoWriterLastFrame&&(videoWriterLastFrame=a),videoWriterCurrentFrame=a}if(2==e&&!n&&l&&r.length>2&&"{"==r[0]){var u=null;try{u=JSON.parse(r)}catch(e){}null==u||"options"!=u.type&&"termsize"!=u.type||"number"!=typeof u.cols||"number"!=typeof u.rows||term.resize(u.cols,u.rows)}if(2==e&&n&&!l){if(1==recFileProtocol)writeXTerm(r);else if(2==recFileProtocol){for(var p=new Uint8Array(r.length),m=0;m<r.length;m++)p[m]=r.charCodeAt(m);var g=(p[0]<<8)+p[1],f=(p[2]<<8)+p[3];27==g&&8==f&&(g=(p[8]<<8)+p[9],f=(p[5]<<16)+(p[6]<<8)+p[7],p=p.slice(8)),f!=p.byteLength?console.log("Bad command size",g,f,p.byteLength):agentDesktop.ProcessBinaryCommand(g,f,p.slice(0,f))}else if(101==recFileProtocol){for(p=new Uint8Array(r.length),m=0;m<r.length;m++)p[m]=r.charCodeAt(m);0==readState&&rstr2hex(r).startsWith("4100000000000000")?(readState=1,r.length>8&&amtDesktop.ProcessBinaryData(p.slice(8).buffer)):1==readState&&amtDesktop.ProcessBinaryData(p.buffer)}else if(102==recFileProtocol){for(p=new Uint8Array(r.length),m=0;m<r.length;m++)p[m]=r.charCodeAt(m);amtDesktop.ProcessBinaryData(p.buffer)}}else 2==e&&n&&l&&101==recFileProtocol&&("0000000008080001000700070003050200000000"==rstr2hex(r)&&(console.log("RGB8"),amtDesktop.bpp=1),"000000000808000100FF00000000000000000000"==rstr2hex(r)&&(console.log("GRAY8"),amtDesktop.bpp=1,obj.graymode=!0),"0000000008040001000F00000000000000000000"==rstr2hex(r)&&(console.log("GRAY4"),amtDesktop.bpp=1,obj.graymode=!0,obj.lowcolor=!0));if(3==e&&102==recFileProtocol){var k=new Image;k.src="data: image / png; base64,"+btoa(r),k.onload=function(){amtDesktop.canvas.drawImage(k,0,0)},k.error=function(){}}playing&&readNextBlock(processBlock)}}function cleanup(){clearXTerm(),recFile=null,recFilePtr=0,recFileMetadata=null,playing=!1,null!=agentDesktop&&(agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height),agentDesktop=null),null!=amtDesktop&&(amtDesktop.canvas.clearRect(0,0,amtDesktop.CanvasId.width,amtDesktop.CanvasId.height),amtDesktop=null),readState=0,waitTimerArgs=null,currentDeltaTimeTotalSec=0,recFileEndTime=0,agentTerminal=null,null!=waitTimer&&(clearTimeout(waitTimer),waitTimer=null),QH("deskstatus",""),QE("PlayButton",!1),QE("PauseButton",!1),QE("RestartButton",!1),QE("SeekBackwardButton",!1),QE("SeekForwardButton",!1),QS("progressbar").width="0px",QH("timespan","00:00:00"),QV("metadatadiv",!0),null==urlargs.stream?QH("metadatadiv",'<span style="font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:28px">MeshCentral Session Player</span><br /><br /><span style=color:gray>Dra och släpp en .mcrec-fil eller klicka på "Öppna fil ... "</span>'):QH("metadatadiv",""),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1)}function ondrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(var a in e.dataTransfer.files)null!=e.dataTransfer.files[a].type&&null!=e.dataTransfer.files[a].size&&0!=e.dataTransfer.files[a].size&&e.dataTransfer.files[a].name.endsWith(".mcrec")&&t.push(e.dataTransfer.files[a]);0!=t.length&&(cleanup(),recFile=t[0],recFilePtr=0,readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0}))}}var SeekIndex,SeekIndexPtr,SeekIndexTime,SeekPlayState,dragtimer=null;function ondragover(e){if(!xxdialogMode){haltEvent(e),null!=dragtimer&&(clearTimeout(dragtimer),dragtimer=null);var t=!0;QV("bigok",t),QV("bigfail",!1)}}function ondragleave(e){xxdialogMode||(haltEvent(e),dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),dragtimer=null},10))}function onkeypress(e){xxdialogMode||(" "==e.key&&(togglePause(),haltEvent(e)),"1"==e.key&&(Q("PlaySpeed").value=4,haltEvent(e)),"2"==e.key&&(Q("PlaySpeed").value=2,haltEvent(e)),"3"==e.key&&(Q("PlaySpeed").value=1,haltEvent(e)),"4"==e.key&&(Q("PlaySpeed").value=.5,haltEvent(e)),"5"==e.key&&(Q("PlaySpeed").value=.25,haltEvent(e)),"6"==e.key&&(Q("PlaySpeed").value=.1,haltEvent(e)),"0"==e.key&&(pause(),restart(),haltEvent(e)))}function saveAsWebMfile(){var e="";e+=addHtmlValue4("Bildhastighet","<select id=webmframerate style=width:200px><option value=100 selected>10 bilder/sek</option><option value=50>20 bilder/sek</option></select>"),setDialogMode(2,"Konvertera till WebM",3,saveAsWebMfileEx,e+=addHtmlValue4("Kvalitet","<select id=webmquality style=width:200px><option value=90>90%</option><option value=80>80%</option><option value=60 selected>60%</option><option value=40>40%</option><option value=20>20%</option><option value=10>10%</option></select>"))}function saveAsWebMfileEx(){videoFrameDuration=parseInt(Q("webmframerate").value);var e=parseInt(Q("webmquality").value)/100;videoWriterLastFrame=null,videoWriter=new WebMWriter({quality:e,frameDuration:100,transparent:!1}),restart(),play(),QE("PlayButton",!1),QE("PauseButton",!1),QE("RestartButton",!1),QE("PlaySpeed",!1),QE("SeekBackwardButton",!1),QE("SeekForwardButton",!1),QE("ConvertAsWebM",!1),QE("OpenFileButton",!1)}function preCanvasDraw(){if(videoWriter){var e=videoWriterCurrentFrame-videoWriterLastFrame;e>=videoFrameDuration&&(videoWriter.addFrame(Q("Desk"),e),videoWriterLastFrame=videoWriterCurrentFrame)}}function openfile(){if(!xxdialogMode){setDialogMode(2,"Öppna fil...",3,openfileEx,'<input type=file name=files id=p2fileinput style=width:100% accept=".mcrec" onchange="openfileChanged()" />'),QE("idx_dlgOkButton",!1)}}function openfileEx(){var e=Q("p2fileinput").files;if(null!=e){var t=[];for(var a in e)null!=e[a].type&&null!=e[a].size&&0!=e[a].size&&e[a].name.endsWith(".mcrec")&&t.push(e[a])}0!=t.length&&(cleanup(),recFile=t[0],recFilePtr=0,readLastBlock(function(e,t,a,r){3==e?(recFileEndTime=a,recFileExtras=r,readNextBlock(processFirstBlock)):recFileEndTime=0}),Q("OpenFileButton").blur())}function openfileChanged(){var e=Q("p2fileinput").files;if(null!=e){var t=[];for(var a in e)null!=e[a].type&&null!=e[a].size&&0!=e[a].size&&e[a].name.endsWith(".mcrec")&&t.push(e[a])}QE("idx_dlgOkButton",1==t.length)}function togglePause(){if(!xxdialogMode&&null==term)return null!=recFile&&(1==playing?pause():recFilePtr!=recFile.size&&play()),!1}function play(){xxdialogMode||(Q("PlayButton").blur(),1!=playing&&0!=recFileProtocol&&(playing=!0,QV("metadatadiv",!1),QE("PlayButton",!1),QE("PauseButton",!0),QE("RestartButton",!1),1==recFileProtocol&&null==term&&(QV("DeskParent",!1),QV("TermParent",!1),QV("XTermParent",!0),setupXTerm()),readNextBlock(processBlock)))}function pause(){xxdialogMode||(Q("PauseButton").blur(),0!=playing&&(playing=!1,QE("PlayButton",recFilePtr!=recFile.size),QE("PauseButton",!1),QE("RestartButton",0!=recFilePtr),null!=waitTimer&&(clearTimeout(waitTimer),waitTimer=null,processBlockEx(waitTimerArgs[0],waitTimerArgs[1],waitTimerArgs[2],waitTimerArgs[3]),waitTimerArgs=null)))}function restart(){xxdialogMode||(Q("RestartButton").blur(),1!=playing&&(recFilePtr=0,readState=0,currentDeltaTimeTotalSec=0,QV("metadatadiv",!0),QE("PlayButton",!0),QE("PauseButton",!1),QE("RestartButton",!1),QS("progressbar").width="0px",QH("timespan","00:00:00"),QV("DeskParent",!0),QV("TermParent",!1),QV("XTermParent",!1),clearXTerm(),agentDesktop?agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height):amtDesktop?(amtDesktop.canvas.clearRect(0,0,amtDesktop.CanvasId.width,amtDesktop.CanvasId.height),(amtDesktop=CreateAmtRemoteDesktop("Desk")).onScreenSizeChange=deskAdjust,amtDesktop.State=3,amtDesktop.Start(),102==recFileMetadata.protocol&&(recFileMetadata.screenSize&&(amtDesktop.width=recFileMetadata.screenSize[0],amtDesktop.height=recFileMetadata.screenSize[1]),recFileMetadata.bpp&&(amtDesktop.bpp=recFileMetadata.bpp),recFileMetadata.graymode&&(amtDesktop.graymode=recFileMetadata.graymode),recFileMetadata.lowcolor&&(amtDesktop.lowcolor=recFileMetadata.lowcolor),amtDesktop.state=3)):agentTerminal&&(agentTerminal=null)))}function clearConsoleMsg(){QH("p11DeskConsoleMsg","")}function toggleAspectRatio(e){1===e&&(deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,a=Q("Desk").height,r=Q("Desk").width;if(2==deskAspectRatio)QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden";else if(1==deskAspectRatio)QS("Desk")["margin-top"]="0px",QS("Desk").height=a+"px",QS("Desk").width=r+"px",QS("DeskParent").overflow="scroll";else{if(e/t>a/r){var i=a*t/r+"px";QS("Desk").height=i,QS("Desk").width="100%"}else{var n=r*e/a+"px";QS("Desk").height="100%",QS("Desk").width=n}QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden"}}function seekBackward(){if(!xxdialogMode){var e=Math.round(currentDeltaTimeTotalSec/recFileMetadata.indexInterval);e<2?(pause(),restart()):null!=recFileMetadata.indexes[e-2]&&seek(e-2)}}function seekForward(){if(!xxdialogMode){var e=Math.round(currentDeltaTimeTotalSec/recFileMetadata.indexInterval);null!=recFileMetadata.indexes[e]&&seek(e)}}function progressBarSeek(e){var t=Math.round(e.clientX/document.body.offsetWidth*(recFileMetadata.indexes.length+1))-1;-1==t?(pause(),restart()):seek(t)}function seek(e){if(!xxdialogMode){if(null==recFileMetadata.indexes||null==recFileMetadata.indexes[e])return null;SeekPlayState=playing,pause(),restart(),SeekIndex=recFileMetadata.indexes[e],SeekIndexPtr=3,recFileLastTime=SeekIndexTime=recFileStartTime+(1+e)*recFileMetadata.indexInterval*1e3,recFilePtr=recFileIndexBasePtr+SeekIndex[0];var t=SeekIndex[1],a=SeekIndex[2];QS("progressbar").width=0==recFileEndTime?Math.floor(recFilePtr/recFile.size*100)+"%":Math.floor((recFileLastTime-recFileStartTime)/(recFileEndTime-recFileStartTime)*100)+"%",agentDesktop&&(agentDesktop.Canvas.clearRect(0,0,agentDesktop.CanvasId.width,agentDesktop.CanvasId.height),agentDesktop.ProcessScreenMsg(t,a)),QV("metadatadiv",!1),QV("Desk",!1),seekFetchNext(function(){QV("Desk",!0),SeekPlayState&&play()})}}function seekFetchNext(e){null!=SeekIndex[SeekIndexPtr]?readBlockAt(recFileIndexBasePtr+SeekIndex[SeekIndexPtr],function(t,a,r,i){SeekIndexPtr++,processBlockEx(t,a,SeekIndexTime,i,!0),seekFetchNext(e)}):e()}var xxdialogFunc,xxdialogButtons,xxdialogTag,xxdialogMode=0,xxcurrentView=-1;function setDialogMode(e,t,a,r,i,n){xxdialogMode=e,xxdialogFunc=r,xxdialogButtons=a,xxdialogTag=n,QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",1&a),QV("idx_dlgCancelButton",2&a),QV("id_dialogclose",2&a||8&a),QV("idx_dlgDeleteButton",4&a),QV("idx_dlgButtonBar",7&a),t&&QH("id_dialogtitle",t);for(var l=1;l<3;l++)QV("dialog"+l,l==e);QV("dialog",e),i&&(2==e?QH("id_dialogOptions",i):QH("id_dialogMessage",i))}function dialogclose(e){var t=xxdialogFunc,a=xxdialogButtons,r=xxdialogTag;setDialogMode(),(8&a||e)&&t&&t(e,r)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function pad2(e){var t="00"+e;return t.substr(t.length-2)}function format(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,a){return void 0!==t[a]?t[a]:e})}function addHtmlValue(e,t){return"<table><td style=width:120px>"+e+"<td><b>"+t+"</b></table>"}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function dialogBoxDrag(){var e=Q("dialog"),t=0,a=0,r=0,i=0;function n(n){(n=n||window.event).preventDefault(),t=r-n.clientX,a=i-n.clientY,r=n.clientX,i=n.clientY,e.style.top=e.offsetTop-a+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=n}}function ArrayBufferToString(e){try{return BinaryToString(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}catch(e){}console.log("ArrayBufferToString - Unable to convert "+e.byteLength+" bytes.");for(var t="",a=new Uint8Array(e),r=0;r<e.byteLength;r++)t+=String.fromCharCode(a[r]);return t}function StringToArrayBuffer(e){return StringToUint8Array(e).buffer}function BinaryToString(e){var t;try{return decodeURIComponent(escape(e))}catch(a){if((t=a)instanceof URIError)return e;throw t}}function StringToBinary(e){var t,a,r,i,n,l;for(n=e.length,t=[],i=!1,r=l=0;0<=n?l<n:l>n;r=0<=n?++l:--l){if((a=String.prototype.charCodeAt.call(e,r))>255){i=!0,t=null;break}t.push(a)}return!0===i?unescape(encodeURIComponent(e)):String.fromCharCode.apply(null,Array.prototype.slice.apply(t))}function StringToUint8Array(e){var t,a,r,i,n,l;for(a=(t=StringToBinary(e)).length,r=new ArrayBuffer(a),i=new Uint8Array(r),n=l=0;0<=a?l<a:l>a;n=0<=a?++l:--l)i[n]=String.prototype.charCodeAt.call(t,n);return i}function setupXTerm(){null!=term&&term.dispose(),(term=new Terminal).open(Q("XTermParent")),term.resize(80,25)}function clearXTerm(){null!=term&&(term.dispose(),term=null)}function writeXTerm(e){null!=term&&(term.writeUtf8?"string"==typeof e?term.writeUtf8(e):term.writeUtf8(new Uint8Array(e)):"string"==typeof e?term.write(e):term.write(new Uint8Array(e)))}start()</script>