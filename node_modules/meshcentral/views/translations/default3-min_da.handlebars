<!doctypehtml><html lang=da dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link type=text/css href=styles/custom.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Information</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Skrivebord</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminal</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Filer</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Hændelser</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Detaljer</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Konsol</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Plugins</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Skift stjerne</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi-Desktop</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Vælg alle</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Vælg Ingen</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Alternativ port</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Alternativ port</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Alternativ port</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Alternativ port</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Alternativ port</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Omdøb</div><div class=cmtext onclick=cmfilesaction(2,event)>Rediger</div><div class=cmtext onclick=cmfilesaction(3,event)>Slet</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Udvid alle</div><div class=cmtext onclick=cmexpandaction(2,event)>Skjul alle</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Åbn afspiller...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Tilpasse...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Tilpasse...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Klik for at se aktuelle meddelelser">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Prøv den nye Meshcentral UI</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Valg af brugergrænseflade"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Venstre bjælke grænseflade"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Top bar interface"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Fast bredde interface"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Personlige noter"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Skift nattilstand"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Skift sidefodslinje"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Mine enheder<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Min konto<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Mine hændelser<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Mine filer<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Mine brugere<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Min server<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Generel<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Skrivebord<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminal<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Filer<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Hændelser<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Detaljer<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Konsol<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Generel<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Oversigt<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Hændelser</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Rapporter</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Generel<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Hændelser<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Brugere<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Grupper<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Optagelser<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Generel<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Statistik<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Konsol<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Spor<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Server afbrudt</span>,<href onclick=reload() style=cursor:pointer><u>klik for at genoprette forbindelsen</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>Mine enheder</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Go to first page"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Go to previous page"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Go to next page"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Go to last page"style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Kolonner><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Liste><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title="Stationære PCer"><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title="Stationære PCer"><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Kort style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Skjul alle"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Udvid alle"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Vælg alle"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value=Gruppehandling onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll To Top"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Filtrer onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filter: bruger:xxx eller u:xxx ip:xxx group:xxx eller g:xxx tag:xxx eller t: xxx atag:xxx eller a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: nuupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title=Enhedsfilter><option value=0 selected>Alle<option value=1>Online<option value=5>Offline<option value=2>Sessioner<option value=3>Stjernemarkeret<option value=4>Intel® AMT<option value=6>Hjælp<option value=7>Tagged<option value=8>Ikke tagget</select><div class=form-check title="Vis enhedens operativsystemnavn"><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>OS-navn</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Vis kun enheder, der er online">Online</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Skjul alle"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Udvid alle"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Forbind alle"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Afbryd alle"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll To Top"><div class="form-check me-1"title="Automatisk tilslutning"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Auto</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=Indstillinger> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Filtrer onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filter: bruger:xxx eller u:xxx ip:xxx group:xxx eller g:xxx tag:xxx eller t: xxx atag:xxx eller a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: nuupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Søg placering"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Søg title="Søg efter placering"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Nulstil kortvisning"value=Nulstil onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Se <select id=viewselect onchange=onDeviceViewChange()><option value=1>Kolonner<option value=2>Liste<option value=3>Skrivebord fast bredde<option id=viewselectmapoption value=4 style=display:none>Kort<option value=5>Stationære PCer</select></div><div style=display:none id=devListToolbarSize>Størrelse <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Små<option value=1>Medium<option value=2>Stor</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Sortér <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Gruppe<option>Tændt<option>Enhed<option>Tags<option>Gruppe-Tags<option>Sidst sete</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>For at komme i gang, <a href=# onclick="return account_createMesh()"><strong>klik her for at oprette en enhedsgruppe</strong></a>.</div><div id=getStarted2>Ingen enhedsgrupper.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Lokationsresultater</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Min konto</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Skift foto</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Konto sikkerhed</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Administrer telefonnummer</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Administrer e-mail-godkendelse</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Administrer autentificeringsapp</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Administrer sikkerhedsnøgler</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Administrer push-godkendelse</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Administrer backup-koder</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Se tidligere logins</a><br></span></div></div><div id=p2AccountActions><p><strong>Kontohandlinger</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Administrer telefonnummer</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Bekræft e-mail</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Aktivér webmeddelelser</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Lokaliseringsindstillinger</a><br><a href=# onclick="return account_showAccountNotifySettings()">Beskedindstillinger</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Skift email adresse</a><br></span><a href=# onclick="return account_showChangePassword()">Skift kodeord</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Slet konto</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Opret login token</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Skift tema</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Enhedsgrupper</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Ny</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Ingen enhedsgrupper.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>Kom i gang her!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Mine hændelser</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Filtrer</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p3limitdropdown class=me-1>Vis</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Seneste 60<option notransval=1 value=120>Seneste 120<option notransval=1 value=250>Seneste 250<option notransval=1 value=500>Seneste 500<option notransval=1 value=1000>Seneste 1000<option notransval=1 value="">Ingen grænse</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Download hændelser"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Mine brugere</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Vælg alle"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Gruppehandling onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Ny konto..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Filtrer onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value=Meddelelse> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Download brugeroplysninger"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Batch opret mange bruger konti"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=Indstillinger onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Mine filer</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Op> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Vælg alle"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value=Omdøb onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Slet onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=Rediger onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Ny mappe"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value=Upload onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Download onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Klip onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Kopier onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value="Sæt ind"onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Sortér efter navn<option value=2>Sortér efter størrelse<option value=3>Sortér efter dato<option value=4>Vis efter sidste navn<option value=5>Vis efter største<option value=6>Vis efter seneste dato</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Disse filer deles offentligt, klik på "link" for at få offentlig url.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Min server</h1></div><div id=p2ServerActions><p><strong>Serverhandlinger</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Download server backup</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Gendan server med backup</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Google Drive Backup</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Kontroller serverversionen</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Vis serverfejllog</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Serverstatistik</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Serveradvarsler</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generel - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Noter<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title=Stjernemarkeret role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Liste over fjern-sessioner, der er aktive på denne computer."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Der er anmodet om hjælp"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Skrivebord - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Fuld skærm. Hold Skift nede til browser i fuld skærm."></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Omdirigeringsport eller KVM-funktion er deaktiveret<span id=p11warninga>, klik her for at aktivere det.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Fjerncomputeren er ikke tændt. Klik her for at sende en tænd/sluk-kommando.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>KASKETTER</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>RUL</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUM</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value="Auto tilslut"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Forbind</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Spørg om samtykke + bar</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Spørg om samtykke</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Privacy Bar</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Forbind ved hjælp af RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>RDP Connect</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Alternativ port</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Tilslut ved hjælp af hardware KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW forbindelse</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Afbryd</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Afbryd og lås</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Afbryd</a></ul></div><span id=deskstatus style=line-height:22px>Afbrudt</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Skift strømstatus for fjern-PC"onkeypress=return!1 onkeydown=return!1 value=Strømhandlinger... onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Udfør strømhandlinger på enheden"onkeypress=return!1 onkeydown=return!1 value=Handlinger onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=Indstillinger title="Rediger indstillinger for fjernskrivebord"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Skift fokustilstand, når aktiv er kun området omkring musen opdateret"onkeypress=return!1 onkeydown=return!1 value="Fokuser alle"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="Serveren optager denne session"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Roter højre"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Roter venstre"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Skift visningstilstand"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>Opdater</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Processes</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Services</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Sortér efter proces-id"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Sortér efter navn"onclick=sortProcess(1)>Navn</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Sortér efter tilstand"onclick=sortService(0)>Tilstand</a> <a class=colmn2 title="Sortér efter navn"onclick=sortService(1)>Navn</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Send onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value=Udklipsholder onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Type onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Skift mus og tastatur input"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Input</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Forsinkelse på skrivebordssession"></span> <span id=DeskTimer style=width:70px class=text-center title=Sessionstid></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Værktøj title="Skift værktøjsvisning"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Del enheden med en gæst"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="Fjernindtastning er låst op"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="Fjernindtastning er låst"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Opdater skrivebordet"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Upload lokal udklipsholder til fjernenhed"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Download fjernudklipsholder til lokal udklipsholder"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Optag fjernskrivebordssession til fil"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Gem et skærmbillede af fjernskrivebordet"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Skift fjernskrivebordsbaggrund"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Åbn en webadresse på fjerncomputeren"role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Lås fjerncomputeren"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Vis en meddelelse på fjerncomputeren"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Åbn chatvinduet til denne computer"role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Run a script on this computer"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Terminal - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Fuld skærm. Hold Skift nede til browser i fuld skærm."></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Omdirigeringsport eller KVM-funktion er deaktiveret<span id=p12warninga>, klik her for at aktivere det.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Fjerncomputeren er ikke tændt. Klik her for at sende en tænd/sluk-kommando.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> Auto tilslut</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Forbind</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Admin Shell</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Admin PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Bruger Shell</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>Bruger PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Spørg Admin Shell</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Spørg Admin PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Spørg User Shell</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Spørg bruger PowerShell</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Bruger Shell</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>Bruger PowerShell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Root Shell</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Bruger Shell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Login Shell</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>SSH Connect</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternativ port</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Forbind med Intel® AMT hardware KVM"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW forbindelse</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Afbryd</button></span> <span id=termstatus style=line-height:22px>Afbrudt</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="Serveren optager denne session"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Udfør strømhandlinger på enheden"onkeypress=return!1 onkeydown=return!1 value=Handlinger class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value=Backspace onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value="Sæt ind"title="Indsæt tekst i terminalen"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title=Sessionstid></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="CR + LF"title="Skift, hvad returtasten vil sende"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC + [OM)"title="Skift F1 til F10 nøgleemuleringstype"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Udvidet Ascii"title="Skift terminalemuleringstype"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Send title="Send den valgte specialnøgle"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Filer - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> Auto tilslut</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Forbind</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Spørg om samtykke</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Afbryd</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Tilslut ved hjælp af MeshAgent fjernskrivebord"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>SFTP-forbindelse</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternativ port</a></ul></div><span id=p13Status>Afbrudt</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Udfør strømhandlinger på enheden"value=Handlinger onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="Serveren optager denne session"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Op onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Vælg alle"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value=Omdøb onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Slet onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=Rediger onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Ny mappe"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value=Upload onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Download onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Klip onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Kopier onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value="Sæt ind"onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value=Zip onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Unzip onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=Opdater onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=Søg onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabyte<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Sortér efter navn<option value=2>Sortér efter størrelse<option value=3>Sortér efter dato<option value=4>Vis efter sidste navn<option value=5>Vis efter største<option value=6>Vis efter seneste dato</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Fuld skærm. Hold Skift nede til browser i fuld skærm."></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Oplysninger om den aktuelle core, der kører på denne agent"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Agent handling"onclick=p15uploadCore(event) title="Skift agentens Java Script kode modul"> <i onclick=p15downloadConsoleText() title="Download konsol tekst"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agent<option id=p15outputselect3 value=3>Push<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Fjern onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Hændelser - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Filtrer</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label class=me-1 for=p16limitdropdown>Vis</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Seneste 60<option notransval=1 value=120>Seneste 120<option notransval=1 value=250>Seneste 250<option notransval=1 value=500>Seneste 500<option notransval=1 value=1000>Seneste 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Download hændelser"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Detaljer - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Vis enheds CPU og hukommelsesforbrug."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Live Diagram</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Plugins - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generel - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Oversigt - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Driftstatus</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Agent typer</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Forbindelse</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Sikkerhed</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generel - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Hændelser - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Filtrer</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p31limitdropdown class=me-1>Vis</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Seneste 60<option notransval=1 value=120>Seneste 120<option notransval=1 value=250>Seneste 250<option notransval=1 value=500>Seneste 500<option notransval=1 value=1000>Seneste 1000<option notransval=1 value="">Ingen grænse</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Download hændelser"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Min Serverstatistik</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Opdater type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Log-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Forbindelser<option value=1>Memory<option value=5>CPU<option value=3>Indgående trafik<option value=4>Udgående trafik</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Seneste 3 timer<option value=8>Seneste 8 timer<option value=24>Seneste dag<option value=168>Seneste uge<option value=720>Seneste 30 dage</select> <i class="fa-solid fa-download"title="Download datapunkter (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Min server sporing</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Sporing type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Ingen</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Vis</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Seneste 100<option value=250>Seneste 250<option value=500>Seneste 500<option value=1000>Seneste 1000</select> <input value=Fjern type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Download trace (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Mine Server Plugins</h1><div class=areaHead><div class=toright2></div><div><input value="Download Plugin"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Opdater agentkerner"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Varsel:</b> Plugins er blevet ændret, dette kan kræve agentkerneopdatering.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Navn<th class=chDescription>Beskrivelse<th class=chSite style=text-align:center>Link<th class=chVersion style=text-align:center>Version<th class=chUpgradeAvail style=text-align:center>Seneste<th class=chStatus style=text-align:center>Status<th class=chAction style=text-align:center>Handling<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Ingen plugins på serveren.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Tilbage onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Mine Server Plugins - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Mine brugergrupper</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Vælg alle"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Gruppehandling onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Ny gruppe..."> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value=Dubbletgruppe...></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Tilbage onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Brugergruppe - <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Mine brugeroptagelser</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=Opdater></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Åbn afspiller..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Mine rapporter</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Download Rapport"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Generer rapport...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Bekræft e-mail</a> &nbsp;<a id=termsLinkFooter href=terms>Vilkår og privatliv</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Filvalg</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Lokal fil upload<option value=2>Valg af serverfil</select></div><div id=d3localmode style=display:none><div>Upload Fil</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Op>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value="Wrap On"onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Små onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Rå onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agent</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Kvalitet</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Skalering</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87,5%<option value=768>75%<option value=640>62,5%<option value=512>50%<option value=384>37,5%<option value=256>25%<option value=128>12,5%</select></div><div><div>Billedhastighed</div><select id=d7framelimiter dir=rtl><option selected value=50>Hurtig<option value=100>Medium<option value=400>Langsom<option value=1000>Meget langsom</select></div><div><div>Kodning</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Andre indstillinger</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Byt museknapper</label> <label style=display:block><input type=checkbox id=d7deskrmw>Omvendt musehjul</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Brug fjerntastatur mapning</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Automatisk Udklipsholder</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Lås ved afbrydelse</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Billedkodning</div><select id=d7desktopmode><option value=1>RLE8, hurtigst<option value=2>RLE16, anbefales<option value=3>RAW8, Langsom<option value=4>RAW16, Meget langsom</select></div><div><div>Andre indstillinger</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Vis fokusværktøj</label> <label style=display:block><input type=checkbox id=d7showcursor>Vis lokal musemarkør</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Lokal tastatur Map</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Omvendt musehjul</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Skærmstørrelse</div><select id=d7rdpsize><option notransval=1 value=canvas>Lærred størrelse<option notransval=1 value=browser>Browser størrelse<option notransval=1 value=screen>Skærmstørrelse<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Muligheder</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Deaktiver tapet</label> <label style=display:block><input type=checkbox id=d7rdp2>Deaktiver træk i hele vinduet</label> <label style=display:block><input type=checkbox id=d7rdp3>Deaktiver menuanimationer</label> <label style=display:block><input type=checkbox id=d7rdp4>Deaktiver temaer</label> <label style=display:block><input type=checkbox id=d7rdp6>Deaktiver markørskygge</label> <label style=display:block><input type=checkbox id=d7rdp7>Deaktiver markørindstillinger</label> <label style=display:block><input type=checkbox id=d7rdp8>Aktiver Font Smoothing</label> <label style=display:block><input type=checkbox id=d7rdp9>Aktiver skrivebordssammensætning</label> <label style=display:block><input type=checkbox id=d7rdpclip>Automatisk Udklipsholder</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Byt museknapper</label> <label style=display:block><input type=checkbox id=d7rdprmw>Omvendt musehjul</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Annuller</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Slet</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Mine enheder</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Min konto</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>Mine hændelser</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>Mine filer</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>Mine brugere</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Min server</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Logout</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>"use strict";var args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(var i in""!=webState&&(webState=JSON.parse(decodeURIComponent(webState))),null!=webState&&"object"==typeof webState||(webState={}),webState)if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Tændt","Slumretilstand","Slumretilstand","Slumretilstand","Dvaletilstand","Sluk","Findes"],StatusStrs=["Afbrudt","Forbinder...","Opsætning...","Forbundet","Intel&reg; AMT forbundet"],agentsStr=["Ukendt","Windows 32bit console","Windows 64bit console","Windows 32bit service","Windows 64bit service","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore console","Windows MinCore service","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Ukendt","Linux ARM 64 bit (glibc / 2,24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Assistent (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Ukendt","Ukendt","MIPSEL24KC (OpenWRT)","ARMADA / CORTEX-A53 / MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service","ARMVIRT32 (OpenWRT)","RISC-V 64bit"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Æble"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=!!(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui="{{{customui}}}";customui=""!=customui?JSON.parse(decodeURIComponent(customui)):null;var deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null;null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder);var installedPluginList=null,goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(!(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}(null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodevicername,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale)||null!=(a=getstore("loctag",0))&&"*"!=a&&(args.locale=a);debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var t=0,n=parseInt("{{{hide}}}");(n||args.hide)&&(args.hide&&(t=parseInt(args.hide)),n&&(t|=n)),args.hide=t,QV("uiViewButton5",!(4&args.hide)),adjustPanels();var o="";logoutControls&&(null!=logoutControls.name&&(o='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Velkommen {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl&&(o+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Logout</a>'))),1&args.hide?QH("logoutControlSpan2",o):QH("logoutControlSpan",o),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",!!(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",!(2097152&features)),mainUpdate(3);for(var i=1;i<5;i++)Q("devViewButton"+i).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);var s=null;try{s=localStorage.getItem("desktopsettings")}catch(e){}null!=s&&(desktopsettings=JSON.parse(s)),s=null;try{s=localStorage.getItem("multidesktopsettings")}catch(e){}null!=s&&(multidesktopsettings=JSON.parse(s)),applyDesktopSettings();for(var a="",r=1;r<27;r++)a+="<option value='"+r+"'>Ctrl-"+String.fromCharCode(64+r)+" ("+r+")</option>";QH("specialkeylist",a),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",!(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var l=document.getElementsByClassName("topbar_td");for(var d in l)l[d].innerHTML&&(l[d].innerHTML=l[d].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){a="";for(var d in customui.devicesbarbuttons){var c="one"==customui.devicesbarbuttons[d].selection||"many"==customui.devicesbarbuttons[d].selection?"disabled":"";a+='<input id="cui:'+d+'" type="button" value="'+customui.devicesbarbuttons[d].name+'" '+c+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",a)}if(customui.desktopbuttons){a="";for(var d in customui.desktopbuttons)a+='<input id="cui:'+d+'" type="button" value="'+customui.desktopbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",a)}if(customui.terminalbuttons){a="";for(var d in customui.terminalbuttons)a+='<input id="cui:'+d+'" type="button" value="'+customui.terminalbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",a)}if(customui.filesbuttons){a="";for(var d in customui.filesbuttons)a+='<input id="cui:'+d+'" type="button" value="'+customui.filesbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",a)}}sessionTime>=10&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var u=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var d in u)""!=u[d]&&deskKeyboardShortcuts.push(parseInt(u[d]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",!(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Type"),QV("ScrollToTopButton",!!(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){var n=e.srcElement.id;if(0!=n.startsWith("cui:")){var o=customui[t][n.substring(4)];if(null!=o){if("devicesbarbuttons"==t){for(var i=document.getElementsByClassName("DeviceCheckbox"),s=[],a=0;a<i.length;a++)!0===i[a].checked&&s.push(i[a].defaultValue.substring(6));if("string"==typeof o.action&&("event"==o.action&&meshserver.send({action:"uicustomevent",section:t,element:n.substring(4),selectedDevices:s,logmsg:o.logmsg}),o.action.startsWith("dialog:")&&showCustomUiDialog(o.action.substring(7),{section:t,element:n.substring(4),selectedDevices:s}),o.deselectdevices)){for(a=0;a<i.length;a++)i[a].checked=!1;checkedNodeids={},p1updateInfo()}}if("devicebuttons"==t||"desktopbuttons"==t||"terminalbuttons"==t||"filesbuttons"==t){s=[currentNode._id];"string"==typeof o.action&&("event"==o.action&&meshserver.send({action:"uicustomevent",section:t,element:n.substring(4),selectedDevices:s,logmsg:o.logmsg}),o.action.startsWith("dialog:")&&showCustomUiDialog(o.action.substring(7),{section:t,element:n.substring(4),selectedDevices:s}))}}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var n="",o=customui.dialogs[e];if("string"==typeof o.text&&(n+="<div style=margin-bottom:8px>"+o.text+"</div>"),"number"==typeof o.buttons&&o.buttons,"object"==typeof o.elements)for(var i in o.elements){var s=o.elements[i];if("text"==s.type&&(n+=addHtmlFormFloating(s.name,"<input id=cui:"+i+" class=form-control autocomplete=off />")),"textarea"==s.type&&(null==s.name?n+="<textarea id=cui:"+i+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":n+=addHtmlFormFloating(s.name,"<textarea id=cui:"+i+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==s.type){var a="";for(var r in s.options)a+='<option value="'+r+'">'+EscapeHtml(s.options[r])+"</option>";n+=addHtmlFormFloating(s.name,'<select id="cui:'+i+'" class=form-select autocomplete=off />'+a+"</select>")}}setModalContent("xxAddAgent",o.title,n),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:o.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var n=customui.dialogs[t.element];if("object"==typeof n.elements)for(var o in n.elements){var i=n.elements[o];"droplist"!=i.type&&"textarea"!=i.type&&"text"!=i.type||(t.values[o]=Q("cui:"+o).value)}if(meshserver.send(t),n.deselectdevices){var s=document.getElementsByClassName("DeviceCheckbox");for(o=0;o<s.length;o++)s[o].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide;0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px"));var t=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),n=uiMode>1?24:0;QS("p2info").height="calc(100vh - "+(20+t+n)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p3events").height="calc(100vh - "+(50+t)+"px)",QS("p5filetable").height="calc(100vh - "+(99+t)+"px)",QS("p13filetable").height="calc(100vh - "+(127+t+n)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+t+n)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+t+n)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+t+n)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+t+n)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+t+n)+"px)";var o=!(0===args.xterm||null!=terminal&&null==xterm);fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,o&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+t+n)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+t+n)+"px)",QS("p14iframe").height="calc(100vh - "+(23+t+n)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+t+n)+"px)",o&&(QS("termarea3x").height="calc(100vh - "+(74+t+n)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+t+n)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+t)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+t)+"px)",QS("p6info").height="calc(100vh - "+(-50+t+n)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(-50+t+n)+"px)",QS("p10info").height="calc(100vh - "+(20+t+n)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p17info").height="calc(100vh - "+(20+t+n)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p20main").height="calc(100vh - "+(-50+t+n)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(-50+t+n)+"px)",QS("p21main").height="calc(100vh - "+(20+t+n)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p30info").height="calc(100vh - "+(20+t+n)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p51info").height="calc(100vh - "+(20+t+n)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p16events").height="calc(100vh - "+(50+t+n)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("p31events").height="calc(100vh - "+(50+t+n)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("p41events").height="calc(100vh - "+(48+t+n)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+t+n)+"px)",QS("p52recordings").height="calc(100vh - "+(48+t+n)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+t+n)+"px)",QS("p60report").height="calc(100vh - "+(48+t+n)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+t+n)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),xxcurrentView>=10&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=uiMode>1,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&xxcurrentView>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){if(!xxdialogMode){var e=getstore("nightMode","0"),t="<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Browser standard</label><br>";t+="<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Lys tilstand</label><br>",xxdialogButtons=3,setModalContent("xxAddAgent","Night Mode",t+="<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Dark mode</label><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1)}}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),Q("night2").checked&&(e="2"),putstore("nightMode",e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,1048576&features2&&(e="1"),2097152&features2&&(e="2"),"1"==e?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){const t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),xxcurrentView>=10&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),xxcurrentView>=10&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;if(Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e){putstore("uiViewMode",e);var t=new URL(window.location.href);t.searchParams.has("sitestyle")&&(t.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,t.toString())),reload()}}function toggleBootstrapUIMode(){if(!xxdialogMode){var e=getstore("uiViewMode",3),t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==e?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>";setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1)}}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;e.endsWith("/#")&&(e=e.substring(0,e.length-2)),e.endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,n,o){if(0==t){if(setDialogMode(0),go(0),powerTimeline=null,powerTimelineReq=null,powerTimelineNode=null,powerTimelineUpdate=null,deviceShares=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==o)return void QH("p0span","Kan ikke udføre godkendelse");if("invalidorigin"==o)return void QH("p0span","Invalid origin in HTTP request");2==n?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Kan ikke forbinde web-socket"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null)}else 2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView&&refreshServerTimelineStats())}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return e.indexOf("WINDOWS")>=0||e.indexOf("WIN32")>=0||e.indexOf("WIN64")>=0}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,n=4294967295!=t&&!!(1024&t)||!!(256&features2);QV("p2AccountSecurity",!(4&features||0!=serverinfo.domainauth||!(4096&features)||0!=n)),QV("p2AccountActions",!n),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",!(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!n),QV("p2ServerActions",21&t&&!!(143&e)),QV("LeftMenuMyServer",21&t&&!!(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&!!(1&e)),QV("p2ServerActionsRestore",4&t&&!!(2&e)),QV("p2ServerActionsVersion",16&t&&!!(4&e)),QV("p2ServerActionsErrors",16&t&&!!(8&e)),QV("p2ServerActionsConfig",16&t&&!!(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),8&t||5!=xxcurrentView||(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",2&userinfo.siteadmin?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(users=null,wssessions=null,mainUpdate(16384),(4==xxcurrentView||xxcurrentView>=30&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&!!(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&!!(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6!=xxcurrentView||21&userinfo.siteadmin||go(1),21&t&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){webpSupport=t,t||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView&&p21updateMesh()),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){if(null==userinfo)return-1;var e=0;return 1==userinfo.otpsecret&&e++,1==userinfo.otpduo&&e++,1==userinfo.otpdev&&e++,userinfo.otphkeys>0&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,e>0&&userinfo.otpkeys>0&&!(262144&features2)&&e++,e}var backupCodesWarningDone=!1;function updateSelf(){var e=count2factoraAuths(),t=4294967295!=userinfo.siteadmin&&!!(1024&userinfo.siteadmin);QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==t),QV("manageOtp",1!=serverinfo.lock2factor&&e>0&&!(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&!!(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",!(1==serverinfo.lock2factor||1!=userinfo.otpsecret&&131072&features2)),QV("manageDuoApp",1!=serverinfo.lock2factor&&!!(536870912&features2)),QV("authKeySetupCheck",userinfo.otphkeys>0),QV("authPushAuthDevCheck",userinfo.otpdev>0&&!!(64&features2)),QV("authCodesSetupCheck",userinfo.otpkeys>0),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&e>0),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0!=backupCodesWarningDone||1!=e||524288&features2||(addNotification({text:"Tilføj to-faktor backup-koder. Hvis den aktuelle faktor går tabt, er der ingen måde at gendanne denne konto på.",title:"2-faktor godkendelse",tag:"backupcodes"}),backupCodesWarningDone=!0);var n=4294967295==userinfo.siteadmin||!(64&userinfo.siteadmin);if(QV("p2createMeshLink1",n),QV("p2createMeshLink2",n),QV("getStarted1",n),QV("getStarted2",!n),"number"==typeof userinfo.passchange)if(-1==userinfo.passchange)QH("p2nextPasswordUpdateTime"," - Nulstil ved næste logon.");else if(null!=passRequirements&&"number"==typeof passRequirements.reset){var o=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3);if(o<0)QH("p2nextPasswordUpdateTime"," - Nulstil ved næste logon.");else if(o<3600){var i=Math.floor(o/60);QH("p2nextPasswordUpdateTime",format(1==i?" - Nulstil om 1 minut.":" - Nulstil om {0} minutter.",i))}else if(o<86400){var s=Math.floor(o/3600);QH("p2nextPasswordUpdateTime",format(1==s?" - Nulstil om 1 time.":" - Nulstil om {0} timer.",s))}else{var a=Math.floor(o/86400);QH("p2nextPasswordUpdateTime",format(1==s?" - Nulstil om 1 dag.":" - Nulstil om {0} dage.",a))}}QV("MainMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("LeftMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("UsersGeneral",null!=users&&!(4&features)),QV("UsersGroups",null!=users&&!(4&features)),QV("UsersRecordings",!!(512&userinfo.siteadmin)&&!!(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;if(e>serverinfo.timeout)null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutonidlesessiontimeout&&(window.location.href="logout");else{var t=Math.round((serverinfo.timeout-e)/1e3),n=null!=desktop||null!=terminal||null!=files,o=serverinfo.logoutonidlesessiontimeout||n,i=serverinfo.logoutonidlesessiontimeout,s="";t<=60?s=i?1==t?"1 sekund indtil logout":"{0} sekunder indtil logout":1==t?"1 sekund til frakobling":"{0} sekunder, indtil forbindelsen afbrydes":(t=Math.round(t/60))<=5&&(s=i?1==t?"1 minut indtil logout":"{0} minutter indtil logout":1==t?"1 minut til frakobling":"{0} minutter, indtil forbindelsen afbrydes"),QH("idleTimeoutNotify",o&&s?"<br />"+format(s,t):"")}}function onMessage(e,t){switch(t.action){case"trace":serverTrace.unshift(t),displayServerTrace();break;case"intersession":"removeNotify"==t.subaction&&notificationDelete(t.id);break;case"traceinfo":"object"==typeof t.traceSources&&(null!=t.traceSources&&t.traceSources.length>0?(serverTraceSources=t.traceSources,QH("p41traceStatus",EscapeHtml(t.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ingen")));break;case"serverstats":updateGeneralServerStats(t);break;case"serverwarnings":if(null!=t.warnings&&t.warnings.length>0){var n={1:"",2:"Manglende WebDAV-parametre.",3:'Ikke genkendt konfigurationsmulighed "{0}".',4:"WebSocket-komprimering er deaktiveret. Denne funktion er ødelagt i NodeJS v11.11 til v12.15 og v13.2",5:"Kan ikke indlæse Intel AMT TLS-rodcertifikat for standarddomæne.",6:"Kan ikke indlæse Intel AMT TLS-rodcertifikat for domænet {0}.",7:"Lokale CIRA FQDN'er ignoreres, når serveren er i LAN-only eller WAN-only tilstand.",8:"Kan ikke have mere end 4 lokale CIRA FQDN'er. Ignorerer værdi.",9:"Agent-hash-tjek springes over, dette er usikkert.",10:"Mangler Let's Encrypt email-adresse.",11:"Ugyldig Let's Encrypt host navne.",12:"Ugyldige Let's Encrypt-navne, kan ikke indeholde en *.",13:"Kan ikke konfigurere Let's Encrypt-modulet.",14:"Ugyldige Let's Encrypt-navne, ude af stand til at løse: {0}",15:"Ugyldig Let's Encrypt-e-mailadresse, kan ikke løse: {0}",16:"Kan ikke indlæse CloudFlare-betroede proxy IPv6-adresseliste.",17:"SendGrid-serveren har begrænset brug i LAN mode.",18:"SMTP-serveren har begrænset brug i LAN-tilstand.",19:"SMS-gateway har begrænset brug i LAN-tilstand.",20:'Ugyldig "LoginCookieEncryptionKey" i config.json.',21:"Sikkerhedskopieringsstien kan ikke indstilles i mappen meshcentral-data, sikkerhedskopieringsindstillinger ignoreres.",22:"Kunne ikke underskrive agent {0}: {1}",23:"Unable to load agent icon file: {0}.",24:"Unable to load agent logo file: {0}.",25:"This NodeJS version does not support OpenID.",26:"This NodeJS version does not support Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},o="";for(var i in t.warnings){if("string"==typeof(a=t.warnings[i]))o+="<div style=color:red;padding-bottom:6px><b>ADVARSEL:"+a+"</b></div>";else null==(l=n[a.id])?l=a.msg:null!=a.args&&(l=format(l,...a.args)),o+="<div style=color:red;padding-bottom:6px><b>ADVARSEL:"+l+"</b></div>"}QH("serverWarnings",o),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(t.events);break;case"authcookie":authCookie=t.cookie,authRelayCookie=t.rcookie;break;case"serverinfo":if((serverinfo=t.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire){var s=Math.floor((serverinfo.certExpire-Date.now())/864e5);s>=0&&s<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>ADVARSEL:"+format("Certifikatet udløber om {0} dag(e)",s)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("Certifikatet udløber om {0} dag(e)",s)}))}if(serverinfo.preConfiguredRemoteInput){o="";for(var i in serverinfo.preConfiguredRemoteInput)o+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+i+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[i].name)+"</div>";""!=o&&(o+="<hr />"),QH("deskPreConfigShortcutContextMenu1",o)}if(serverinfo.preConfiguredScripts){o="";var a="";for(var i in serverinfo.preConfiguredScripts){var r=serverinfo.preConfiguredScripts[i],l='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+i+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[i].name)+"</div>";3!=r.type&&(o+=l),r.type>=3&&(a+=l)}QH("deskPreConfigScriptContextMenu1",o),QH("deskPreConfigScriptContextMenu2",a)}break;case"userinfo":userinfo=t.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var d in users={},t.users)users[t.users[d]._id]=t.users[d];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=t.wssessions,mainUpdate(16384);break;case"meshes":for(var d in meshes={},t.meshes)meshes[t.meshes[d]._id]=t.meshes[d];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var c=0;if(Array.isArray(t.ugroups)){for(var i in usergroups={},t.ugroups)c++,usergroups[t.ugroups[i]._id]=t.ugroups[i];0==c&&(usergroups=null)}else{for(var i in usergroups=t.ugroups,t.ugroups)c++,t.ugroups[i]._id=i;0==c&&(usergroups=null)}mainUpdate(8192);break;case"files":filetree=setupBackPointers(t.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var d in nodes=[],t.nodes)for(var u in t.nodes[d])null!=t.nodes[d][u]._id?(null==t.nodes[d][u].name&&(t.nodes[d][u].name="???"),t.nodes[d][u].namel=t.nodes[d][u].name.toLowerCase(),t.nodes[d][u].rname?t.nodes[d][u].rnamel=t.nodes[d][u].rname.toLowerCase():t.nodes[d][u].rnamel=t.nodes[d][u].namel,t.nodes[d][u].meshnamel=meshes[d]?meshes[d].name.toLowerCase():"*",t.nodes[d][u].meshid=d,t.nodes[d][u].state=t.nodes[d][u].state?t.nodes[d][u].state:0,t.nodes[d][u].icon||(t.nodes[d][u].icon=1),t.nodes[d][u].ident=++nodeShortIdent,nodes.push(t.nodes[d][u])):console.log("Invalid node ("+u+"): "+JSON.stringify(t.nodes));for(var i in stars)null==getNodeFromId(i)&&delete stars[i];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==t.totalcount?null:{total:t.totalcount,skip:t.skip,limit:t.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(t.nodeid!=powerTimelineReq)break;for(var i in powerTimelineNode=t.nodeid,powerTimeline=t.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)i%2==1&&(powerTimeline[i]=1e3*powerTimeline[i]);currentNode._id==t.nodeid&&mainUpdate(256);break;case"deviceShares":if(t.nodeid!=deviceSharesReq)break;deviceSharesNode=t.nodeid,deviceShares=t.deviceShares,null!=currentNode&&currentNode._id==t.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":if(t.meshid!=deviceSharesReq)break;deviceSharesNode=t.meshid,deviceShares=t.deviceShares,null!=currentMesh&&currentMesh._id==t.meshid&&p20updateMesh();break;case"getsysinfo":if(t.nodeid!=powerTimelineReq)break;!0===t.noinfo?updateDeviceDetails(getNodeFromId(t.nodeid)):updateDeviceDetails(getNodeFromId(t.nodeid),t.hardware);break;case"lastconnect":null!=(ie=getNodeFromId(t.nodeid))&&(ie.lastconnect=t.time,ie.lastaddr=t.addr,currentNode._id==ie._id&&""==Q("MainComputerState").innerHTML&&null!=ie.lastconnect&&QH("MainComputerState","<span>Sidst sete:<br />"+printDateTime(new Date(ie.lastconnect))+"</span>"));break;case"lastconnects":var p=Object.keys(t.lastconnects);for(var i in p){var m=p[i];null!=(ie=getNodeFromId(m))&&(ie.lastconnect=t.lastconnects[m])}mainUpdate(4);case"msg":if(null!=t.nodeid){var g=-1;if(null!=nodes)for(var i in nodes)if(nodes[i]._id==t.nodeid){g=i;break}if(-1!=g)if("cpuinfo"===t.type&&null!=currentNode&&currentNode._id==t.nodeid){var v=Date.now()/1e3,h=0,f=0;"number"==typeof t.cpu.total&&(h=t.cpu.total),"number"==typeof t.memory.percentConsumed&&(f=t.memory.percentConsumed),deviceDetailsStatsData.push([v,h,f]),deviceDetailsStatsDraw(t)}else if("console"===t.type)p15consoleReceive(nodes[g],t.value,t.source);else if("notify"===t.type){if(!(8&(u=getstore("notifications",0)))&&null!=t.amtMessage)break;u={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.nodeid&&(u.nodeid=t.nodeid),null!=t.tag&&(u.tag=t.tag),null!=t.url&&(u.url=t.url),null!=t.username&&(u.username=t.username),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u)}else if("ps"===t.type)showDeskToolsProcesses(t);else if("services"===t.type)showDeskToolsServices(t);else if("service"===t.type)showServiceDetailsDialog(t);else if("getclip"===t.type&&null!=currentNode&&currentNode._id==t.nodeid)1==t.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=t.data:2===t.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(t.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===t.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==t.nodeid)QH("dlgClipStatus",t.success?"<span style=color:green>Succes</span>":"<span style=color:red>Mislykkedes</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===t.type&&null!=currentNode&&currentNode._id===t.nodeid&&null==desktop){var k=[];if(null!=t.data)for(var i in t.data)"Active"!=t.data[i].State&&"Connected"!=t.data[i].State&&"Console"!=t.data[i].StationName&&3!=debugmode||k.push(t.data[i]);if(0===k.length)connectDesktop(null,1,null,t.tag);else if(1===k.length)connectDesktop(null,1,k[0].SessionId,t.tag);else{o="";var x="{{{userSessionsSort}}}";for(var i in k.sort(function(e,t){return e[x]?t[x]?e[x]<t[x]?-1:e[x]>t[x]?1:0:1:-1}),k)o+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+k[i].SessionId+","+t.tag+")>"+k[i].State+(k[i].StationName?", "+k[i].StationName:""),k[i].Username&&(k[i].Domain?o+=" - "+k[i].Domain+"/"+k[i].Username:o+=" - "+k[i].Username),o+="</div>";QH("p11DeskSessionSelector",o),QV("p11DeskSessionSelector",!0)}}else if("psinfo"===t.type){if(xxdialogTag==="ps|"+t.nodeid+"|"+t.pid){o="<div style=max-height:200px;overflow-y:auto>";"object"==typeof t.value&&Object.keys(t.value).length>0?(t.value=jsonToCamel(t.value),!t.value.cmd&&t.value.path&&(t.value.cmd=t.value.path),!t.value.processUser&&t.value.userName&&(t.value.processUser=t.value.userName.split("\\")[1]),!t.value.processDomain&&t.value.userName&&(t.value.processDomain=t.value.userName.split("\\")[0]),t.value.processName&&(o+="<div style=padding:4px><div style=padding-bottom:4px>Process Name</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.processName+"</b></div></div>"),t.value.machineName&&(o+=addHtmlValue5("Maskinnavn",t.value.machineName)),t.value.cmd&&(o+="<div style=padding:4px><div style=padding-bottom:4px>Kommando linje</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.cmd+"</b></div></div>"),t.value.mainWindowTitle&&(o+="<div style=padding:4px><div style=padding-bottom:4px>Vinduestitel</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.mainWindowTitle+"</b></div></div>"),t.value.processUser&&(o+=addHtmlValue5("Bruger",t.value.processUser)),t.value.processDomain&&(o+=addHtmlValue5("Domæne",t.value.processDomain)),t.value.startTime&&(o+=addHtmlValue5("Starttid",t.value.startTime)),o+="<hr />",t.value.PriorityBoostEnabled&&(o+=addHtmlValue5("Priority Boost",t.value.PriorityBoostEnabled?"Aktiveret":"Deaktiveret")),t.value.sessionId&&(o+=addHtmlValue5("Session Id",t.value.sessionId)),t.value.handleCount&&(o+=addHtmlValue5("Handle Count",t.value.handleCount)),t.value.privilegedProcessorTime&&(o+=addHtmlValue5("Privileged Processor Time",format("{0} sekunder",t.value.privilegedProcessorTime))),t.value.totalProcessorTime&&(o+=addHtmlValue5("Total processortid",format("{0} sekunder",t.value.totalProcessorTime))),t.value.userProcessorTime&&(o+=addHtmlValue5("Brugerprocessortid",format("{0} sekunder",t.value.userProcessorTime))),t.value.nonpagedSystemMemorySize&&(o+=addHtmlValue5("Non Paged Memory",getNiceSize2(t.value.nonpagedSystemMemorySize))),t.value.pagedMemorySize&&(o+=addHtmlValue5("Paged Memory",getNiceSize2(t.value.pagedMemorySize))),t.value.privateMemorySize&&(o+=addHtmlValue5("Private Memory",getNiceSize2(t.value.privateMemorySize))),t.value.virtualMemorySize&&(o+=addHtmlValue5("Virtuel Memory",getNiceSize2(t.value.virtualMemorySize))),t.value.workingSet&&(o+=addHtmlValue5("Arbejdssæt",getNiceSize2(t.value.workingSet))),t.value.peakWorkingSet&&(o+=addHtmlValue5("Peak Working Set",getNiceSize2(t.value.peakWorkingSet))),t.value.peakPagedMemorySize&&(o+=addHtmlValue5("Peak Paged Memory",getNiceSize2(t.value.peakPagedMemorySize))),t.value.peakVirtualMemorySize&&(o+=addHtmlValue5("Peak Virtual Memory",getNiceSize2(t.value.peakVirtualMemorySize)))):o+="Ingen oplysninger angivet",o+="</div>",QH("id_dialogOptions",o)}}else"deskBackground"===t.type&&(""!=t.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else if("notify"===t.type){u={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.tag&&(u.tag=t.tag),null!=t.url&&(u.url=t.url),null!=t.username&&(u.username=t.username),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u)}break;case"getnetworkinfo":if(currentNode._id!=t.nodeid)return;if(updateDeviceDetails(getNodeFromId(t.nodeid),null,t),2==xxdialogMode&&xxdialogTag=="if"+t.nodeid){o="<div class=dialogText>";if(currentNode.lastconnect&&(o+=addHtmlValue2("Seneste agentforbindelse",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr){var b=currentNode.lastaddr.split(":");b.length>2?o+=addHtmlValue2("Seneste agent adresse",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?o+=addHtmlValue2("Seneste agent adresse",b[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(b[0])+'")></i>'):o+=addHtmlValue2("Seneste agent adresse",'<a href="https://iplocation.com/?ip='+b[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+b[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(b[0])+'")></i>')}if(null!=t.updateTime&&(o+=addHtmlValue2("Seneste grænsefladeopdatering",printDateTime(new Date(t.updateTime)))),null!=t.netif)for(var i in t.netif){o+="<hr />",(y=t.netif[i]).name&&(o+=addHtmlValue2("Navn","<b>"+EscapeHtml(y.name)+"</b>")),y.desc&&(o+=addHtmlValue2("Beskrivelse",EscapeHtml(y.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),y.dnssuffix&&(o+=addHtmlValue2("DNS-suffix",EscapeHtml(y.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopiér navn til udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(y.dnssuffix)+'")></i>')),y.mac&&(o+=addHtmlValue2("MAC-adresse",'<a href="https://maclookup.app/search/result?mac='+y.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier MAC-adressen til udklipsholderen" onclick=copyTextToClip2("'+encodeURIComponentEx(y.mac.toLowerCase())+'")></i>')),y.v4addr&&(o+=addHtmlValue2("IPv4-adresse",EscapeHtml(y.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4addr)+'")></i>')),y.v4mask&&(o+=addHtmlValue2("IPv4-mask",EscapeHtml(y.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4mask)+'")></i>')),y.v4gateway&&(o+=addHtmlValue2("IPv4-gateway",EscapeHtml(y.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4gateway)+'")></i>')),y.gatewaymac&&(o+=addHtmlValue2("Gateway MAC",'<a href="https://maclookup.app/search/result?mac='+y.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier MAC-adressen til udklipsholderen" onclick=copyTextToClip2("'+encodeURIComponentEx(y.gatewaymac.toLowerCase())+'")></i>'))}else if(null!=t.netif2)for(var i in t.netif2){var y=t.netif2[i];if(!(0==Array.isArray(y)||y.length<1||null==y[0]||"string"==typeof y[0].mac&&y[0].mac.startsWith("00:00:00:00"))){o+="<hr />",o+=addHtmlValue2("Navn","<b>"+EscapeHtml(i)+"</b>"),"string"==typeof y[0].mac&&(o+=addHtmlValue2("MAC-adresse",'<a href="https://maclookup.app/search/result?mac='+y[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier MAC-adressen til udklipsholderen" onclick=copyTextToClip2("'+encodeURIComponentEx(y[0].mac.toLowerCase())+'")></i>')),y[0].fqdn&&(o+=addHtmlValue2("FQDN",y[0].fqdn));for(var w=0;w<y.length;w++){var S=y[w];"IPv6"==S.family?(S.address&&(o+=addHtmlValue2("IPv6-adresse",EscapeHtml(S.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.address)+'")></i>')),S.netmask&&(o+=addHtmlValue2("IPv6-mask",EscapeHtml(S.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.netmask)+'")></i>')),S.gateway&&(o+=addHtmlValue2("IPv6-gateway",EscapeHtml(S.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.gateway)+'")></i>'))):"IPv4"==S.family&&(S.address&&(o+=addHtmlValue2("IPv4-adresse",EscapeHtml(S.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.address)+'")></i>')),S.netmask&&(o+=addHtmlValue2("IPv4-mask",EscapeHtml(S.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.netmask)+'")></i>')),S.gateway&&(o+=addHtmlValue2("IPv4-gateway",EscapeHtml(S.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopier adressen til Udklipsholder" onclick=copyTextToClip2("'+encodeURIComponentEx(S.gateway)+'")></i>')))}}}else o+="<hr />",o+="Der er ingen tilgængelige oplysninger om netværksinterfacet for denne enhed.";o+="</div>",QH("d2netinfo",o)}break;case"serverversion":if(2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag){o="<div class=dialogText>";t.tags.current||(t.tags.current="Ukendt"),t.tags.stable||(t.tags.stable="Ukendt"),t.tags.latest||(t.tags.latest="Ukendt"),o+=addHtmlValue2("Aktuel version","<b>"+EscapeHtml(t.tags.current)+"</b>"),o+="<hr />",o+=addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Ukendt"!=t.tags.stable&&t.tags.current!=t.tags.stable&&2048&features?"":" disabled")+" /> Stabil version</label>","<b>"+EscapeHtml(t.tags.stable)+"</b>"),o+=addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Ukendt"!=t.tags.latest&&t.tags.current!=t.tags.latest&&2048&features?"":" disabled")+" /> Seneste version</label>","<b>"+EscapeHtml(t.tags.latest)+"</b>"),o+="</div>",(t.tags.current!=t.tags.latest||t.tags.current!=t.tags.stable)&&2048&features?(o+="<hr />Marker og klik på OK for at starte serverselvopdatering.",xxdialogTag=t.tags,setModalContent("xxAddAgent","MeshCentral-version",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,t.tags)}),server_showVersionDlgUpdate()):(setModalContent("xxAddAgent","MeshCentral-version",o),showModal("xxAddAgentModal","idx_dlgOkButton"))}break;case"servererrors":if(2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag)if(null==t.data)setModalContent("xxAddAgent","Server Errors","Serveren har ingen fejllog."),showModal("xxAddAgentModal","idx_dlgOkButton");else{o='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(t.data)+"</pre></div>";o+='<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Download fejllog" onclick=d2CopyServerErrorsToClip()></i></div>',setModalContent("xxAddAgent","MeshCentral Server Fejl",o+='<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Marker og klik på OK for at rydde fejlloggen.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()}break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==t.data?setModalContent("xxAddAgent","Server Configuration","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuration",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=t.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",t.value);break;case"events":null!=t.nodeid&&null!=currentNode&&t.nodeid==currentNode._id?(currentDeviceEvents=t.events,mainUpdate(1024)):null!=t.userid&&null!=currentUser&&t.userid==currentUser._id?(currentUserEvents=t.events,mainUpdate(2048)):(events=t.events,mainUpdate(32));break;case"recordings":p52recordings=t.events,null!=t.error&&(p52recordings=t.error),updateRecordings();break;case"getcookie":if("MCRouter"==t.tag){(-1==(ue=serverinfo.name).indexOf(".")||2&features)&&(ue=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var M="mcrouter://"+ue+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:"");null!=t.nodeid&&(M+="&nodeid="+t.nodeid),null!=t.tcpport&&(M+="&protocol=1&remoteport="+t.tcpport),t.localRelay&&(M+="&local=1"),t.localport&&(M+="&localport="+t.localport),null!=t.name&&(M+="&name="+encodeURIComponentEx(t.name)),null!=t.ip&&(M+="&remoteip="+t.ip),downloadFile(M+="&appid="+t.protocol+"&autoexit=1","")}else if("novnc"==t.tag){var C=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(t.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+t.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}";null!=(ie=getNodeFromId(t.nodeid))&&(C+="&name="+encodeURIComponentEx(ie.name)),safeNewWindow(C,"mcnovnc/"+t.nodeid)}else if("mstsc"==t.tag){var A=window.location.origin+domainUrl+"mstsc.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ie=getNodeFromId(t.nodeid))&&(A+="&name="+encodeURIComponentEx(ie.name)),t.localRelay&&(A+="&local=1"),safeNewWindow(A,"mcmstsc/"+t.nodeid)}else if("ssh"==t.tag){var D=window.location.origin+domainUrl+"ssh.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ie=getNodeFromId(t.nodeid))&&(D+="&name="+encodeURIComponentEx(ie.name)),t.localRelay&&(D+="&local=1"),safeNewWindow(D,"mcssh/"+t.nodeid)}break;case"getNotes":if((u=Q("d2devNotes"))&&t.id==decodeURIComponent(u.attributes.noteid.value))t.notes?QH("d2devNotes",decodeURIComponent(t.notes)):QH("d2devNotes",""),0==("true"==u.attributes.ro.value)&&(u.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"));else Q("notesPanelArea").innerHTML=t.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(t.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&t.notes?QV("notesPanel",!0):QV("notesPanel",!1);break;case"otpauth-request":if(2==xxdialogMode&&"otpauth-request"==xxdialogTag)if(null!=t.err){var T=["","2FA er låst","Backup-koder er låst","Login-token i brug","OTP 2FA ikke tilladt","Kontoen er spærret","Kan ikke indlæse OTPLIB"];t.err>0&&t.err<T.length?QH("d2optinfo",T[t.err]):QH("d2optinfo",format("Fejl #{0}",t.err))}else{var E=t.secret;52==E.length?E=E.split(/(.............)/).filter(Boolean).join(" "):32==E.length&&(E=(E=E.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+E.substring(20)),QH("d2optinfo","<table><tr><td style=vertical-align:top>"+format('Installér <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> eller en kompatibel applikation og scan stregkoden, brug <a href="{0}" rel="noreferrer noopener" target=_blank>dette link</a> eller indtast hemmeligheden. Indtast derefter det aktuelle 6-cifrede token nedenfor for at aktivere 2-trins login.',t.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+t.secret+'" style=font-size:12px>'+E+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+t.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Indtast token her for 2-faktor login: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:t.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()}break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","Godkender App",t.success?"<b style=color:green>Aktivering af godkender-appen lykkedes.</b> Du skal nu bruge et gyldigt token for at logge på igen.":"<b style=color:red>2-faktor login aktivering mislykkedes.</b> Ryd den hemmelige kode fra applikationen, og prøv igen. Du har kun få minutter til at indtaste den rigtige kode."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","Godkender App",t.success?"<b>Godkender-applikationen er fjernet.</b> Du kan til enhver tid genaktivere denne funktion.":"<b style=color:red>Deaktivering af 2-faktor login mislykkedes.</b> Prøv igen."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(2==xxdialogMode&&"otpauth-manage"!=xxdialogTag)return;o="Engangs-tokens kan bruges som sekundær godkendelse. Generer et sæt, udskriv dem og opbevar dem et sikkert sted.";if(o+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',t.passwords){w=0;var I="";for(var i in t.passwords){++w%2&&(o+="<tr>");for(var N=""+t.passwords[i].p;N.length<8;)N="0"+N;!0===t.passwords[i].u?(o+="<td>"+N.substring(0,4)+"&nbsp;"+N.substring(4),""!=I&&(I+=" "),I+=N):o+="<td><strike style=color:#BBB>"+N.substring(0,4)+"&nbsp;"+N.substring(4)}}else o+="<tr><td>Ingen aktive Tokens";o+="</table></div></div><br />",o+='<div class="btn-group">',o+='<button type=button class="btn btn-warning" onclick="account_manageOtp(1);">Generer nye tokens</input>',null!=t.passwords?(o+='<button type=button class="btn btn-danger" onclick="account_manageOtp(2);">Fjern Tokens</button></div>',o+='&nbsp;<i class="fa-regular fa-clipboard" title="Kopier gyldige koder til udklipsholder" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(I)+'")></i>'):o+="</div>",xxdialogTag="otpauth-manage",setModalContent("xxAddAgent","Administrer sikkerhedskopieringskoder",o),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var _='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',V="</table></div></div>";o='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">Hardwarenøgler</a> bruges som sekundær login-godkendelse.';if(o+='<div class="backgroundContainer" style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',t.keys&&t.keys.length>0)for(var i in t.keys){var U=t.keys[i];o+=_+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(me=2==U.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+U.name+'<td style=text-align:right><button type=button class="btn btn-danger" onclick=account_removehkey('+U.i+")>Fjern</button>"+V}else o+=_+"<tr style=text-align:center><td>Ingen taster konfigureret"+V;o+="</div>",o+="<div>";var F="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>F?(131072&features&&(o+='<button class="btn btn-primary" id=d2addkey3 type=button onclick="account_addhkey(3);">Tilføj nøgle</input>'),16384&features&&(o+='<button class="btn btn-primary" id=d2addkey2 type=button onclick="account_addhkey(2);">Tilføj YubiKey&reg; OTP</input>')):o+="Det maksimale antal nøgler er nået.",xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Administrer sikkerhedsnøgler",o+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle","<br />Fejl, kan ikke tilføje nøgle.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle","<br />Fejl, kan ikke tilføje nøgle.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle",o='Tryk på nøgleknappen nu.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+t.name+" />");var R=t.request;t.request.challenge=Uint8Array.from(atob(t.request.challenge),function(e){return e.charCodeAt(0)}),t.request.user.id=Uint8Array.from(atob(t.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:R}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}})},function(e){console.log("FEJL: "+e),setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle","FEJL: "+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;o='<table><tr><td><img src="images/phone80.png" style=padding:8px>';o+="<td>Tjek din telefon, og indtast bekræftelseskoden.",setModalContent("xxAddAgent","Telefonmeddelelser",o+='<br /><br /><div style=width:100%;text-align:center>Verifikationskode: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;o='<table><tr><td><img src="images/messaging40.png" style=padding:8px>';o+="<td>Check your messaging application and enter the verification code.",setModalContent("xxAddAgent","Messaging Notifications",o+='<br /><br /><div style=width:100%;text-align:center>Verifikationskode: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(t.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){var n,o=Q("d4editorarea").value;o=0===d4EditLineBreakVal?o.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?o.replace(/\r\n|\n/g,"\r"):o.replace(/\r\n|\r/g,"\n"),n=1==d4EditEncodingVal?encode_utf8(o):o,meshserver.send({action:"fileoperation",fileop:"set",path:t.path,file:t.file,data:btoa(n)})}(0,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(t.data)):atob(t.data);break;case"event":if(!t.event.nolog){if(currentNode&&t.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(t.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(t.event);for(var B=parseInt(p16limitdropdown.value);currentDeviceEvents.length>B;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&t.event.userid==currentUser._id&&(t.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(t.event);for(B=parseInt(p31limitdropdown.value);currentUserEvents.length>B;)currentUserEvents.pop()}mainUpdate(2048)}if(t.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(t.event);for(B=parseInt(p3limitdropdown.value);events.length>B;)events.pop()}mainUpdate(32)}}if(t.event.noact)break;switch(t.event.action){case"serverinfochange":null!=t.event.lock2factor&&(serverinfo.lock2factor=t.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":if(t.event.nodeid!=deviceSharesReq)break;deviceSharesNode=t.event.nodeid,deviceShares=t.event.deviceShares,currentNode._id==deviceSharesNode&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":if(98==t.event.msgid&&GetNodeRights(t.event.nodeid)>0){u=getNodeFromId(t.event.nodeid);addNotification({text:format("Hjælp anmodet fra {0}: {1}",t.event.msgArgs[0],t.event.msgArgs[1]),title:u.name,icon:u.icon,nodeid:t.event.nodeid})}break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(t.event),t.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var H=localStorage.getItem("showRealNames"),O=localStorage.getItem("uiMode"),P=localStorage.getItem("sort"),L=localStorage.getItem("loctag"),j=localStorage.getItem("nightMode"),K=localStorage.getItem("footerBar"),G=JSON.parse(t.event.state);for(var i in G)localStorage.setItem(i,G[i]);if(null!=G.showRealNames&&G.showRealNames!=H&&(showRealNames=Q("RealNameCheckBox").checked="1"==G.showRealNames,mainUpdate(6)),null!=G.uiMode&&G.uiMode!=O&&userInterfaceSelectMenu(parseInt(G.uiMode)),null!=G.sort&&G.sort!=P&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(G.sort),mainUpdate(6)),null!=G.loctag&&G.loctag!=L&&(null!=G.loctag?args.locale=G.loctag:delete args.locale,mainUpdate(4294967295)),null!=G.nightMode&&G.nightMode!=j&&(putstore("nightMode",G.nightMode),setNightMode()),null!=G.footerBar&&G.footerBar!=K&&(footerBar="1"==G.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=G.stars&&G.stars!=JSON.stringify(stars)&&(stars=JSON.parse(G.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode&&refreshDevice(currentNode._id)),null!=G.deskKeyShortcuts){deskKeyboardShortcuts=[];var z=G.deskKeyShortcuts.split(",");for(var i in z)""!=z[i]&&deskKeyboardShortcuts.push(parseInt(z[i]));updateDeskShortcutKeys()}if(null!=G.deskStrings){r=null;try{r=JSON.parse(G.deskStrings)}catch(e){}Array.isArray(r)&&(deskKeyboardStrings=r,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(t.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof t.event.account||null==t.event.account)return void console.log(t.event);if(userinfo._id==t.event.account._id){var W=t.event.account.siteadmin?t.event.account.siteadmin:0,q=userinfo.siteadmin?userinfo.siteadmin:0,J=t.event.account.removeRights?t.event.account.removeRights:0,$=userinfo.removeRights?userinfo.removeRights:0;(t.event.account.quota!=userinfo.quota||!(8&userinfo.siteadmin)&&8&t.event.account.siteadmin)&&meshserver.send({action:"files"});var X=userinfo.groups;if(userinfo=t.event.account,q==W&&$==J&&1!=t.event.accountImageChange||(1==t.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),2&userinfo.siteadmin){var Z=X||[],Y=userinfo.groups?userinfo.groups:[];Z.join(",")!=Y.join(",")&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"}))}t.event.nodeListChange==userinfo._id&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip})}if(currentNode&&refreshDevice(currentNode._id),null==users)break;null==userinfo.groups||0==userinfo.groups.length||1==findOne(t.event.account.groups,userinfo.groups)?users[t.event.account._id]=t.event.account:delete users[t.event.account._id],mainUpdate(16388);break;case"accountremove":if(null==users)break;delete users[t.event.userid],mainUpdate(16384);break;case"createusergroup":case"usergroupchange":null==usergroups&&(usergroups={});var ee=usergroups[t.event.ugrpid];null==ee?usergroups[t.event.ugrpid]={_id:t.event.ugrpid,name:t.event.name,desc:t.event.desc,domain:t.event.domain,links:t.event.links}:(ee.name=t.event.name,t.event.desc?ee.desc=t.event.desc:delete ee.desc,t.event.links?ee.links=t.event.links:delete ee.links,t.event.flags?ee.flags=t.event.flags:delete ee.flags,"number"==typeof t.event.consent&&(ee.consent=t.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[t.event.ugrpid]){delete usergroups[t.event.ugrpid];var te=0;for(var i in usergroups)te++;0==te&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[t.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==t.event.mesh.links[userinfo._id]||(meshes[t.event.meshid]=t.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[t.event.meshid]){var ne=!1;for(var i in null!=t.event.links[userinfo._id]&&(ne=!0),null!=userinfo.links[t.event.meshid]&&(ne=!0),userinfo.links)i.startsWith("ugrp/")&&null!=t.event.links[i]&&(ne=!0);ne&&(meshes[t.event.meshid]={_id:t.event.meshid,name:t.event.name,mtype:t.event.mtype,desc:t.event.desc,links:t.event.links,amt:t.event.amt,invite:t.event.invite,expireDevs:t.event.expireDevs,relayid:t.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=t.event.name)for(var i in meshes[t.event.meshid].name=t.event.name,nodes)nodes[i].meshid==t.event.meshid&&(nodes[i].meshnamel=t.event.name.toLowerCase());if(null!=t.event.desc&&(meshes[t.event.meshid].desc=t.event.desc),null!=t.event.flags&&(meshes[t.event.meshid].flags=t.event.flags),null!=t.event.consent&&(meshes[t.event.meshid].consent=t.event.consent),t.event.links&&(meshes[t.event.meshid].links=t.event.links),t.event.amt&&(meshes[t.event.meshid].amt=t.event.amt),null!=t.event.invite?meshes[t.event.meshid].invite=t.event.invite:delete meshes[t.event.meshid].invite,null!=t.event.expireDevs&&(t.event.expireDevs>0?meshes[t.event.meshid].expireDevs=t.event.expireDevs:delete meshes[t.event.meshid].expireDevs),null!=t.event.relayid&&(meshes[t.event.meshid].relayid=t.event.relayid),0==IsMeshViewable(t.event.meshid)){20==xxcurrentView&&currentMesh==meshes[t.event.meshid]&&go(2),delete meshes[t.event.meshid];var oe=[];for(var i in nodes)(nodes[i].meshid!=t.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[i]._id])&&oe.push(nodes[i]);nodes=oe,xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,xxcurrentView>=10&&xxcurrentView<20&&go(1)),20==xxcurrentView&&currentMesh._id==t.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[t.event.meshid]&&(delete meshes[t.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));oe=[];if(null!=nodes)for(var i in nodes)nodes[i].meshid!=t.event.meshid&&oe.push(nodes[i]);nodes=oe,mainUpdate(24580),xxcurrentView>=20&&xxcurrentView<30&&currentMesh._id==t.event.meshid&&(setDialogMode(0),go(2)),xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var ie=t.event.node;if(!meshes[ie.meshid])break;if(null!=getNodeFromId(ie._id))break;ie.namel=ie.name.toLowerCase(),ie.rname?ie.rnamel=ie.rname.toLowerCase():ie.rnamel=ie.namel,ie.meshnamel=meshes[ie.meshid]?meshes[ie.meshid].name.toLowerCase():"*",ie.state=0,ie.icon||(ie.icon=1),ie.ident=++nodeShortIdent,nodes.push(ie),mainUpdate(23),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ie.meshid&&mainUpdate(4096);break;case"removenode":g=-1;for(var i in nodes)if(nodes[i]._id==t.event.nodeid){g=i;break}if(-1!=g){ie=nodes[g];currentNode==ie&&(xxcurrentView>=10&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(g,1),mainUpdate(20),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ie.meshid&&mainUpdate(4096)}break;case"changenode":g=-1;for(var i in nodes)if(nodes[i]._id==t.event.nodeid){g=i;break}if(-1!=g){if((ie=nodes[g]).name=t.event.node.name,ie.rname=t.event.node.rname,ie.lusers=t.event.node.lusers,ie.users=t.event.node.users,ie.host=t.event.node.host,ie.desc=t.event.node.desc,ie.ip=t.event.node.ip,ie.osdesc=t.event.node.osdesc,ie.publicip=t.event.node.publicip,ie.iploc=t.event.node.iploc,ie.wifiloc=t.event.node.wifiloc,ie.gpsloc=t.event.node.gpsloc,ie.tags=t.event.node.tags,ie.ssh=t.event.node.ssh,ie.rdp=t.event.node.rdp,ie.userloc=t.event.node.userloc,ie.rdpport=t.event.node.rdpport,ie.rfbport=t.event.node.rfbport,ie.sshport=t.event.node.sshport,ie.httpport=t.event.node.httpport,ie.httpsport=t.event.node.httpsport,ie.consent=t.event.node.consent,ie.pmt=t.event.node.pmt,null!=t.event.node.links?ie.links=t.event.node.links:delete ie.links,null!=t.event.node.agent&&(null==ie.agent&&(ie.agent={}),null!=t.event.node.agent.ver&&(ie.agent.ver=t.event.node.agent.ver),null!=t.event.node.agent.id&&(ie.agent.id=t.event.node.agent.id),null!=t.event.node.agent.caps&&(ie.agent.caps=t.event.node.agent.caps),null!=t.event.node.agent.root&&(ie.agent.root=t.event.node.agent.root),null!=t.event.node.agent.core?ie.agent.core=t.event.node.agent.core:ie.agent.core&&delete ie.agent.core,ie.agent.tag=t.event.node.agent.tag),null!=t.event.node.intelamt&&(null==ie.intelamt&&(ie.intelamt={}),null!=t.event.node.intelamt.state&&(ie.intelamt.state=t.event.node.intelamt.state),null!=t.event.node.intelamt.host&&(ie.intelamt.user=t.event.node.intelamt.host),null!=t.event.node.intelamt.user?ie.intelamt.user=t.event.node.intelamt.user:delete ie.intelamt.user,null!=t.event.node.intelamt.tls&&(ie.intelamt.tls=t.event.node.intelamt.tls),null!=t.event.node.intelamt.ver&&(ie.intelamt.ver=t.event.node.intelamt.ver),null!=t.event.node.intelamt.tag&&(ie.intelamt.tag=t.event.node.intelamt.tag),null!=t.event.node.intelamt.uuid&&(ie.intelamt.uuid=t.event.node.intelamt.uuid),null!=t.event.node.intelamt.realm&&(ie.intelamt.realm=t.event.node.intelamt.realm),null!=t.event.node.intelamt.flags&&(ie.intelamt.flags=t.event.node.intelamt.flags),null!=t.event.node.intelamt.warn?ie.intelamt.warn=t.event.node.intelamt.warn:delete ie.intelamt.warn),null!=t.event.node.av&&(ie.av=t.event.node.av),null!=t.event.node.wsc&&(ie.wsc=t.event.node.wsc),null!=t.event.node.volumes&&(ie.volumes=t.event.node.volumes),ie.namel=ie.name.toLowerCase(),ie.rname?ie.rnamel=ie.rname.toLowerCase():ie.rnamel=ie.namel,t.event.node.icon&&(ie.icon=t.event.node.icon),null!=t.event.node.lastbootuptime&&(ie.lastbootuptime=t.event.node.lastbootuptime),t.event.node.meshid!=ie.meshid)if(null!=meshes[t.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[ie._id])ie.meshid=t.event.node.meshid,ie.meshnamel=meshes[t.event.node.meshid]?meshes[t.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==ie._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));g=-1;for(var i in nodes)if(nodes[i]._id==t.event.nodeid){g=i;break}nodes.splice(g,1),mainUpdate(20)}updateDeviceViewDevice(ie),mainUpdate(26),refreshDevice(ie._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ie.meshid&&mainUpdate(4096),currentNode==ie&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":g=-1;for(var i in nodes)if(nodes[i]._id==t.event.nodeid){g=i;break}if(-1!=g){ie=nodes[g];null!=meshes[t.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[ie._id]?(ie.meshid=t.event.newMeshId,ie.meshnamel=meshes[t.event.newMeshId]?meshes[t.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==ie._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(g,1),mainUpdate(20)),refreshDevice(t.event.nodeid)}else{ie=t.event.node;if(!meshes[ie.meshid])break;ie.namel=ie.name.toLowerCase(),ie.rname?ie.rnamel=ie.rname.toLowerCase():ie.rnamel=ie.namel,ie.meshnamel=meshes[ie.meshid]?meshes[ie.meshid].name.toLowerCase():"*",ie.state=0,ie.icon||(ie.icon=1),ie.ident=++nodeShortIdent,nodes.push(ie),mainUpdate(23)}break;case"nodeconnect":g=-1;for(var i in nodes)if(nodes[i]._id==t.event.nodeid){g=i;break}if(-1!=g){ie=nodes[g],u=getstore("notifications",0);if(t.event.meshid&&userinfo.links&&userinfo.links[t.event.meshid]&&userinfo.links[t.event.meshid].notify&&(u|=userinfo.links[t.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[t.event.meshid]&&(u|=userinfo.notify[t.event.meshid]),null!=userinfo.notify[t.event.nodeid]&&(u|=userinfo.notify[t.event.nodeid])),2&u){var se="Agent tilsluttet";null!=ie.agent&&!1===ie.agent.root&&(se="Agent tilsluttet med begrænsede rettigheder");var ae={title:ie.name,icon:ie.icon,nodeid:ie._id,id:t.event.id};!(1&ie.conn)&&1&t.event.conn&&(ae.text=se,addNotification(ae)),!(2&ie.conn)&&2&t.event.conn&&(ae.text="Intel AMT CIRA forbundet",addNotification(ae)),!(4&ie.conn)&&4&t.event.conn&&(ae.text="Intel AMT forbundet",addNotification(ae)),!(16&ie.conn)&&16&t.event.conn&&(ae.text="MQTT forbundet",addNotification(ae))}if(4&u){ae={title:ie.name,icon:ie.icon,nodeid:ie._id,id:t.event.id};1&ie.conn&&!(1&t.event.conn)&&(ae.text="Agent afbrudt",addNotification(ae)),2&ie.conn&&!(2&t.event.conn)&&(ae.text="Intel AMT CIRA afbrudt",addNotification(ae)),4&ie.conn&&!(4&t.event.conn)&&(ae.text="Intel AMT afbrudt",addNotification(ae)),16&ie.conn&&!(16&t.event.conn)&&(ae.text="MQTT afbrudt",addNotification(ae))}ie.conn=t.event.conn,ie.pwr=t.event.pwr,ie.lastconnect=Date.now(),1&ie.conn||delete ie.sessions;var re=Q("DevFilterSelect").value;1==re||5==re?mainUpdate(21):(updateDeviceViewDevice(ie),mainUpdate(17)),refreshDevice(ie._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ie.meshid&&mainUpdate(4096)}break;case"wssessioncount":null!=wssessions&&(0==t.event.count&&wssessions[t.event.userid]?delete wssessions[t.event.userid]:wssessions[t.event.userid]=t.event.count,mainUpdate(16384));break;case"login":null!=users&&users[t.event.userid]&&(users[t.event.userid].login=Math.floor(new Date(t.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+t.event.range)return;o="";if(null==t.event.results)o="<div style=width:100%;text-align:center;margin-top:12px>Kan ikke scanne dette adresseinterval.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Eksempel på IP-intervalværdier<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var i in amtScanResults=t.event.results,t.event.results){var le=t.event.results[i],de=le.hostname;"host"==le.hosttype&&(de=capitalizeFirstLetter(de.split(".")[0])),de.length>20&&(de=de.substring(0,20)+"...");var ce='<b title="'+EscapeHtml(le.hostname)+'">'+EscapeHtml(de)+"</b> - v"+le.ver;2==le.state?1==le.tls?ce+=" med TLS.":ce+=" uden TLS.":ce+=" not activated.",o+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(i)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+ce+"</div></div></div>"}""==o&&(o="<div style=width:100%;text-align:center;margin-top:12px>Scanningen gav ingen resultater.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Eksempel på IP-intervalværdier<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",o),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":u={text:t.event.value,title:t.event.title,icon:t.event.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.event.tag&&(u.tag=t.event.tag),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u);break;case"traceinfo":"object"==typeof t.event.traceSources&&(null!=t.event.traceSources&&t.event.traceSources.length>0?(serverTraceSources=t.event.traceSources,QH("p41traceStatus",EscapeHtml(t.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ingen")));break;case"sysinfohash":null!=currentNode&&t.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:t.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==t.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null==(ie=getNodeFromId(t.event.nodeid)))break;if(ie.sessions=t.event.sessions,null!=ie.sessions){for(var i in ie.sessions)0==Object.keys(ie.sessions[i]).length&&delete ie.sessions[i];0==Object.keys(ie.sessions).length&&delete ie.sessions}updateDeviceViewDevice(ie),null!=currentNode&&currentNode._id==t.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+t.event.nodeid&&showDeviceSessions(t.event.nodeid,!0),xxdialogTag=="MESSAGES-"+t.event.nodeid&&showDeviceMessages(t.event.nodeid,!0),xxdialogTag=="HELPREQ-"+t.event.nodeid&&showDeviceHelpRequests(t.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1);break;case"loginTokenChanged":if(t.event.userid!=userinfo._id)return;loginTokens=t.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(t.event.userid!=userinfo._id)return;null==loginTokens&&(loginTokens=[]),loginTokens.push(t.event.newToken),mainUpdate(65536);break;case"stopped":default:break;case"updatePluginList":installedPluginList=t.event.list,updatePluginList();break;case"pluginStateChange":if(null==pluginHandler)break;pluginHandler.refreshPluginHandler();break;case"plugin":if(null==pluginHandler)break;try{pluginHandler[t.event.plugin][t.event.pluginaction](t)}catch(e){console.log("PluginHandler kunne ikke sende hændelsesmeddelelse:",e)}}break;case"createInviteLink":if(xxdialogTag!=t.meshid)break;var ue;(-1==(ue=serverinfo.name).indexOf(".")||2&features)&&(ue=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);if(1==serverinfo.https)M="https://"+ue+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");else M="http://"+ue+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");Q("agentInvitationLink").href=M;var pe=format(1==t.expire?"1 time":"{0} timer",t.expire);24==t.expire&&(pe="1 dag"),168==t.expire&&(pe="1 uge"),5040==t.expire&&(pe="1 måned"),0==t.expire&&(pe="Ubegrænset"),QH("agentInvitationLink",format("Invitationslink ({0})",pe)),QV("agentInvitationLinkDiv",!0);break;case"createDeviceShareLink":if(xxdialogTag)break;o="";if(null==(ie=getNodeFromId(t.nodeid)))break;o+=addHtmlValue("Enhed",ie.name),o+=addHtmlValue("Gæstenavn",t.guestname),o+=addHtmlValue("Bruger Input",t.viewOnly?"Ikke tilladt, kun visning":"Tilladt"),t.start&&t.expire&&(t.recurring?(o+=addHtmlValue("Starttid",printDateTime(new Date(t.start))),t.expire<2?o+=addHtmlValue("Varighed",format("{0} minut",t.expire)):o+=addHtmlValue("Varighed",format("{0} minutter",t.expire))):(o+=addHtmlValue("Starttid",printDateTime(new Date(t.start))),o+=addHtmlValue("Udløbstid",printDateTime(new Date(t.expire))))),1==t.recurring&&(o+=addHtmlValue("Tilbagevendende","Daglige")),2==t.recurring&&(o+=addHtmlValue("Tilbagevendende","Ugentlig"));a=[];7&t.consent&&a.push("Giv besked"),56&t.consent&&a.push("Prompt"),64&t.consent&&a.push("Privacy bar"),0==a.length&&a.push("Ingen"),o+=addHtmlValue("Brugersamtykke",a.join(", "));var me="";t.p<=7?me=["","Fjernterminal Link","Link til fjernskrivebord","Fjernskrivebord + Terminal Link","Link til fjernfiler","Fjernterminal + Filer Link","Fjernskrivebord + Filer Link","Fjernskrivebord + Terminal + Filer Link"][t.p]:8==t.p?me=format("HTTP/{0} link",t.port):16==t.p&&(me=format("HTTPS/{0}",t.port)),setModalContent("xxAddAgent","Del enhed",o+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+t.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+me+'</a> <i class="fa-regular fa-copy" title="Kopier link til udklipsholder" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getmqttlogin":if(null==currentNode||currentNode._id!=t.nodeid||null!=xxdialogMode)return;o="Disse indstillinger kan bruges til at tilslutte MQTT til denne enhed.<br /><br />";delete t.action,delete t.nodeid,setModalContent("xxAddAgent","MQTT legitimationsoplysninger",o+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(t)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",t.msg);break;case"updatePluginList":installedPluginList=t.list,updatePluginList();break;case"pluginVersionsAvailable":if(null==pluginHandler)break;updatePluginList(t.list);break;case"downgradePluginVersions":var ge='<select id="lastPluginVersion">';t.info.versionList.forEach(function(e){ge+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),ge+="</select>",setModalContent("xxAddAgent","Plugin handling",format("Select the version to downgrade the plugin: {0}",t.info.name)+"<hr />"+ge+"<hr />Vær opmærksom på, at nedgradering ikke anbefales. Gør det kun i tilfælde af, at en nylig opgradering har ødelagt noget.NaN"+t.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":if("googleDrive"==t.service&&(QV("p2ServerActionsGoogleBackup",t.state>0),QV("p2ServerActionsGoogleBackupCheck",t.state>2),miscState.googleDrive={state:t.state},2==t.state)){o='<img style=float:right src="images/googledrive-48.png" /><div>Naviger til URL\'en nedenfor, giv adgang og kopier tokenkoden tilbage.</div><br />';o+=addHtmlValue("Aktivering",'<a href="'+t.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'),setModalContent("xxAddAgent","Google Drive Backup",o+=addHtmlFormFloating("Kode","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1)}break;case"pluginError":setModalContent("xxAddAgent","Plugin fejl",t.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null==pluginHandler||"string"!=typeof t.plugin)break;try{pluginHandler[t.plugin][t.method](e,t)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(t.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=t.userid&&":"+t.userid;o="",te="BBB";var ve="";if(0==t.events.length)o+="No previous login.";else{for(var i in o+='<div class="backgroundContainer" style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>',t.events){107==(d=t.events[i].m)?(d="Gyldigt login",te="BBD1BB",ve="",null!=t.events[i].tn&&(d=format("Token: {0}",t.events[i].tn),te="88D188")):108==d?(d="Ugyldig 2FA",te="DD9DC3",ve="x"):109==d?(d="Låst konto",te="E1BBBB",ve="x"):110==d&&(d="Ugyldigt kodeord",te="E1BBBB",ve="x"),o+="<tr><td><img src=images/user-32"+ve+'.png height=32 width=32 style=float:left srcset="images/user-64'+ve+'.png 2x"><td><div style=width:350px;background-color:#'+te+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(t.events[i].t))+", <b>"+EscapeHtml(d)+"</b></div><div style=font-size:x-small>"+EscapeHtml(t.events[i].a.join(", "))+"</div></div></tr>"}o+="</table></div>"}setModalContent("xxAddAgent","Tidligere logins",o),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([t.data],{type:"application/octet-stream"}),"Enhedsliste."+t.type);break;case"createLoginToken":if(xxdialogMode)return;o="Notér dette brugernavn og adgangskode, adgangskoden kan ikke vises igen.<br /><br />";o+=addHtmlValue("Navn",EscapeHtml(t.name)),0!=t.expire&&(o+=addHtmlValue("Udløbe",EscapeHtml(printDateTime(new Date(t.expire))))),o+=addHtmlValue("Brugernavn",'<i class="fa-regular fa-copy" title="Kopier link til udklipsholder" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenUser)+"</div>"),setModalContent("xxAddAgent","Opret Login Token",o+=addHtmlValue("Kodeord",'<i class="fa-regular fa-copy" title="Kopier link til udklipsholder" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=t.loginTokens,mainUpdate(65536);break;case"report":renderReport(t.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var n in nodes)nodes[n].name==args.gotodevicename&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodevicername){t=null;if(null!=nodes)for(var n in nodes)nodes[n].rname==args.gotodevicername&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var n in nodes)nodes[n].ip==args.gotodeviceip&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var o=args.gotouser;if(args.gotouser.indexOf("/")<0&&(o="user/"+domain+"/"+args.gotouser),null==users||null==users[o])return;gotoUser(encodeURIComponentEx(o)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){var i=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(i="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[i])return;gotoUserGroup(i),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){if(null==devicePagingState||devicePagingState.total<=devicePagingState.limit)QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1);else{var e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit);QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t)}}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),n=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:t>1&&meshserver.send({action:"nodes",skip:0});break;case 2:t>1&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<n&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<n&&meshserver.send({action:"nodes",skip:(n-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){if(!xxdialogMode){null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]);var e="";e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agtype")>=0?" checked":"")+">Agent type</label><br />",e+='<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agver")>=0?" checked":"")+">Agent version</label><br />",e+='<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("desc")>=0?" checked":"")+">Enhedsbeskrivelse</label><br />",e+='<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("os")>=0?" checked":"")+">Operativ system</label><br />",e+='<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("tags")>=0?" checked":"")+">Tags</label><br />",e+='<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsav")>=0?" checked":"")+">Windows AV</label><br />",e+='<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsupdate")>=0?" checked":"")+">Windows Update</label><br />",e+='<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0?" checked":"")+">Windows Firewall</label><br />",e+='<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0?" checked":"")+">Last Boot Up Time</label><br />",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("links")>=0?" checked":"")+">MeshCentral Router Links</label><br />",e+='<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("user")>=0?" checked":"")+">Brugere der er logget ind</label><br />",e+='<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("ip")>=0?" checked":"")+">Agentens IP-adresse</label><br />",e+='<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("conn")>=0?" checked":"")+">Serverforbindelse</label><br />",e+='<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amthost")>=0?" checked":"")+">Intel&reg; AMT hostname</label><br />",e+='<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amtstate")>=0?" checked":"")+">Intel&reg; AMT state</label><br />",setModalContent("xxAddAgent","Enhedsvisningskolonner",e+='<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastseen")>=0?" checked":"")+">Sidst sete</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx())}}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var n=0;if(e.key){if(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,n=1),8==e.keyCode&&0==userSearchFocus){var o=Q("UserSearchInput").value;Q("UserSearchInput").value=o.substring(0,o.length-1),n=1}27==e.keyCode&&(Q("UserSearchInput").value="",n=1)}else 0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),n=1);if(n>0)return 1==n&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView){if(1==e.ctrlKey&&96==e.charCode)return showRealNames=!showRealNames,Q("RealNameCheckBox").value=showRealNames,putstore("showRealNames",showRealNames?1:0),void mainUpdate(6);if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){n=0;if(e.key){if(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,n=1),8==e.keyCode&&0==searchFocus){o=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),n=1}27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1)}else 0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),n=1);if(n>0)return 1==n&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,n=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),n=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode),n=1))}}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),e.keyCode>=37&&e.keyCode<=40&&haltEvent(e)),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(8===e.keyCode&&0==userSearchFocus){var n=Q("UserSearchInput").value;Q("UserSearchInput").value=n.substring(0,n.length-1),o=1}if(27===e.keyCode&&(Q("UserSearchInput").value="",o=1),o>0)return 1==o&&mainUpdate(5),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var o=0;if(Q("viewselect").value<4){if(8===e.keyCode&&0==searchFocus){n=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),o=1}if(27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1),o>0)return 1==o&&mainUpdate(5),haltEvent(e)}if(4==Q("viewselect").value){if(8===e.keyCode&&0==mapSearchFocus){n=Q("mapSearchLocation").value;Q("mapSearchLocation").value=n.substring(0,n.length-1),o=1}27===e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),o=1)}}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1==e.shiftKey&&27==e.keyCode?(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1)):xxdialogMode||0!=xxcurrentView||1==e.ctrlKey||1==e.altKey||1==e.metaKey?void 0:Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode)?haltEvent(e):void 0):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;var n=e.children[1].children[1];n.children[0].classList.remove("g1s"),n.children[1].classList.remove("e2s"),n.children[2].classList.remove("g2s"),1==t&&(n.children[0].classList.add("g1s"),n.children[1].classList.add("e2s"),n.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var n=Q("viewselect").value;if(1==n)(o=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),o.children[2].classList.remove("e2s"),o.children[3].classList.remove("g2s"),1==t&&(o.children[1].classList.add("g1s"),o.children[2].classList.add("e2s"),o.children[3].classList.add("g2s"));else if(2==n){var o;(o=e).children[2].classList.remove("g1s"),o.children[4].classList.remove("e2s"),o.children[3].classList.remove("g2s"),1==t&&(o.children[2].classList.add("g1s"),o.children[4].classList.add("e2s"),o.children[3].classList.add("g2s"))}}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,n=null,o={},i=Q("viewselect").value,s={},a={};if(QV("xdevices",4!=i),QV("xdevicesmap",4==i),QVH("devListToolbar",i<3),QVH("kvmListToolbar",3==i||5==i),QVH("devMapToolbar",4==i),QV("devListToolbarSize",3==i||5==i),QV("devListToolbarSettings",2==i),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",nodes.length>0),QV("devListToolbarSort",nodes.length>0&&4!=i),0==nodes.length&&(i=1,sort=0),4==i)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderId=0,deviceHeaderCount={},deviceHeaderTotal=0,deviceHeaders={},deviceHeadersTitles={};var r=[];0==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&deviceViewSettings.devsCols.indexOf("lastseen")>=0||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort));var l=Q("column_l").clientWidth-60,d=Math.floor(l/301);d=301+Math.floor((l-301*d)/d);var c=4;for(var u in deviceViewSettings&&deviceViewSettings.devsCols&&(c=deviceViewSettings.devsCols.length+1,deviceViewSettings.devsCols.indexOf("desc")>=0&&c--),nodes){if(0!=(R=nodes[u]).v){var p=meshes[R.meshid],m=GetNodeRights(R);if(0==sort){if((meshes[R.meshid]?R.meshid:"*")!=n){1!=i&&3!=i&&5!=i||null==n||(e+="</div>"),deviceHeaderSet();var g="";if(2==i&&(e+="<tr><td colspan="+c+">"),meshes[R.meshid]&&1==meshes[R.meshid].mtype&&(g="<span class=devHeaderx>, Kun Intel&reg; AMT</span>"),meshes[R.meshid]&&3==meshes[R.meshid].mtype&&(g=meshes[R.meshid].relayid?"<span class=devHeaderx>, Relæ-enheder</span>":"<span class=devHeaderx>, Lokale enheder</span>"),1==i&&null!=n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==i&&(e+="<div>"),e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>",e+="<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+g,e+="</span>",1==i||2==i||3==i||5==i){var v=CollapsedGroups[R.meshid];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+R.meshid+'",'+i+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}meshes[R.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+R.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+R.meshid+"')\">"+EscapeHtml(meshes[R.meshid].name)+"</span>"+getMeshActions(p,m)+"</div>",n=R.meshid):(e+="<span id=MxMESH><i>Individuelle enheder</i></span></div>",n="*"),2==i&&(e+="</div>"),o[n]=1,t=0,1!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else if(1==sort){var h=R.pwr?R.pwr:0;if(h!==n){if(1!=i&&3!=i&&5!=i||null==n||(e+="</div>"),deviceHeaderSet(),1==i&&null!==n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==i&&(e+="<tr><td colspan="+c+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1==i||2==i||3==i||5==i){v=CollapsedGroups["pwr:"+h];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+h+'",'+i+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}e+="<span>"+PowerStateStr2(R.pwr)+"</span></div>",n=h,t=0,1!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else 2!=sort&&5!=sort||null==n&&(n="1");if(1==i)e+="<div name=xxdevice1 id=xv1"+R._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>";else if(2==i){var f=R.meshid;1==sort?f="pwr:"+(R.pwr?R.pwr:0):3!=sort&&4!=sort||(f="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+f+" style=height:20px"+((v=3!=sort&4!=sort&CollapsedGroups[f])?";display:none":"")+" id=xv2"+R._id+"></tr>"}else(3==i||5==i)&&1&R.conn&&0!=(8&m||256&m)&&R.agent&&1&R.agent.caps&&(0==Object.keys(checkedNodeids).length||checkedNodeids[R._id])&&(e+=updateDeviceViewHtml(i,null,R),r.push(R._id));if((3==sort||4==sort)&&""!=e){if(R.tags)for(var k in R.tags){var x=R.tags[k];4==sort&&(x=p?p.name+" - "+R.tags[k]:"**INDV*~*DEVS** - "+R.tags[k]);v=CollapsedGroups["tag:"+encodeURIComponentEx(x)];var b=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(x)+(v?" style=display:none":""));if(null==s[x]?(s[x]=b,a[x]=1):(s[x]+=b,a[x]+=1),3==i||5==i)break}else if(4==sort&&null!=p&&(null==R.tags||0==R.tags.length)){x=p.name,v=CollapsedGroups["tag:"+encodeURIComponentEx(x)],b=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(x)+(v?" style=display:none":""));null==s[x]?(s[x]=b,a[x]=1):(s[x]+=b,a[x]+=1)}e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[R.state]?deviceHeaderCount[R.state]=1:deviceHeaderCount[R.state]++}}if(1==i&&null!=n&&(e+="</div>"),r.length>=32&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var y=[],w=0;for(var u in s)y.push(u);for(var k in y.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),y){u=y[k];if(2==i){e+="<tr><td colspan="+c+"><div class=DevSt style=width:100%;padding-top:4px>";v=CollapsedGroups["tag:"+encodeURIComponentEx(u)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(u)+'",2) class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span class=devHeaderx style=float:right>"+a[u]+" node"+(a[u]>1?"s":"")+"</span><span>"+EscapeHtml(u).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Individuelle enheder</i>")+"</span></div>"+s[u]}else{e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(a[u]>1?"{0} nodes":"{0} node",a[u])+"</span>";v=CollapsedGroups["tag:"+encodeURIComponentEx(u)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(u)+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span>"+EscapeHtml(u).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Individuelle enheder</i>")+"</span></div>",e+="<div id=DevxCol"+w+(!0===v?" style=display:none":"")+">"+s[u]+"</div>"}w++}}var S=!1;if(""==e&&nodes.length>0&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(S=!0,e=3==sort?'<div style="margin:30px">Ingen enheder er inkluderet i nogen grupper. Klik på en enheds "Grupper" for at føje til en gruppe.</div>':'<div style="margin:30px">Ingen enheder matcher denne søgning. <a onclick=clearDeviceSearch()>Ryd søge-filter</a></div>'),1==i&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&i<3){var M=deviceHeaderId,C=[];for(var u in meshes)C.push(meshes[u]);for(var u in C.sort(nameSort),C){var A=C[u];m=GetMeshRights(A);if(null==o[A._id]){""!=n&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",M++;v=CollapsedGroups[A._id];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+M+'","'+A._id+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+M+'"></i>',e+='<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>",e+=getMeshActions(A,m),e+="</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>Ingen Intel&reg; AMT-enheder i denne enhedsgruppe",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>Tilføj en</a>")):2==A.mtype?(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Ingen enheder i denne enhedsgruppe",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>Tilføj en</a>")):3==A.mtype?(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Ingen lokale enheder i denne enhedsgruppe",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>Tilføj en</a>")):4==A.mtype&&(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Ingen enheder i denne enhedsgruppe"),e+=".</i></div></td>",e+="</div>",n=A._id}}}if(""!=e&&0==S){if(e+="</table>",2==i){var D="";null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(D+="<th style=width:100px>Agent type"),deviceViewSettings.devsCols.indexOf("agver")>=0&&(D+="<th style=width:100px>Agent version"),deviceViewSettings.devsCols.indexOf("os")>=0&&(D+="<th style=width:160px>OS"),deviceViewSettings.devsCols.indexOf("tags")>=0&&(D+="<th style=width:120px>Tags"),deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(D+="<th style=width:100px>Windows AV"),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(D+="<th style=width:120px>Windows Update"),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(D+="<th style=width:120px>Windows Firewall"),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(D+="<th style=width:120px>Last Boot Up Time"),deviceViewSettings.devsCols.indexOf("links")>=0&&(D+="<th style=width:120px>Links"),deviceViewSettings.devsCols.indexOf("user")>=0&&(D+="<th style=width:120px>Bruger"),deviceViewSettings.devsCols.indexOf("ip")>=0&&(D+="<th style=width:120px>Adresse"),deviceViewSettings.devsCols.indexOf("conn")>=0&&(D+="<th style=width:100px>Forbindelse"),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(D+="<th style=width:100px>AMT Host"),deviceViewSettings.devsCols.indexOf("amtstate")>=0&&(D+="<th style=width:100px>AMT State"),deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(D+="<th style=width:120px>Sidst sete",0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"}))),e="<table style=width:100%;margin-top:4px;table-layout:fixed cellpadding=0 cellspacing=0><th>"+D+e+"</tr></table><div style=height:1px></div>"}}else e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Der blev ikke fundet nogen enheder med tags.</i></div>');for(var u in e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",!(i<3&&0==sort&&Object.keys(meshes).length>0)||4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin||(e+='<a href=# onclick="return account_createMesh()" title="Opret en ny gruppe af enheder." style=cursor:pointer>Tilføj enhedsgruppe</a>&nbsp'),4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Download MeshCmd, et kommandolinjeværktøj, der udfører mange funktioner.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Download MeshCentral Router, et TCP port mapping tool.\">Router</a>&nbsp")),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(u,deviceHeaders[u]);for(var u in deviceHeadersTitles)Q(u).title=deviceHeadersTitles[u];if(p1updateInfo(),3!=i&&5!=i||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var T=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];if(3==i){var E=T.x+2,I=l-5,N=Math.floor(I/E);N=E+Math.floor((I-N*E)/N),T.y=T.y*(N/T.x),T.x=N}for(var u in multiDesktop)multiDesktop[u].xxdelete=!0;for(var u in r){var _=r[u],V=_.split("/")[2],U=multiDesktop[_];if(null!=U){var F=5==i?U.m.width*T.y/U.m.height:T.x;U.m.CanvasId.setAttribute("style","background-color:black;width:"+F+"px;height:"+T.y+"px"),Q("xkvmid_"+V).appendChild(U.m.CanvasId),delete U.xxdelete,QH("skvmid_"+V,["Afbrudt","Forbinder...","Opsætning...","",""][null==U.m.State?U.m.state:U.m.State])}else{var R=getNodeFromId(_);if(desktopNode==R&&null!=desktop){t=desktop.m.CanvasId,F=5==i?desktop.m.width*T.y/desktop.m.height:T.x;t.setAttribute("id","kvmid_"+V),t.setAttribute("style","background-color:black;width:"+F+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+_+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+V).appendChild(t),QH("skvmid_"+V,["Afbrudt","Forbinder...","Opsætning...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=V,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[_]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+V),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+T.x+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+_+"')");try{Q("xkvmid_"+V).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(R,1)},100)}}}for(var u in multiDesktop)1==multiDesktop[u].xxdelete?(multiDesktop[u].Stop(),delete multiDesktop[u]):debugmode&&multiDesktop[u].m&&multiDesktop[u].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[u].m,multiDesktop[u].m.ScreenWidth,multiDesktop[u].m.ScreenHeight,multiDesktop[u].m.CanvasId);deskAdjust()}}oldviewmode=i,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){void 0===e&&(e=!1),e&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&(onDevicesTouchActive=e,0==e&&onDevicesScrollEx())}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e=Q("xdevices").scrollTop-200,t=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,n=Q("viewselect").value,o=document.getElementsByName("xxdevice"+n),i=0;i<o.length;i++)if(o[i].offsetTop>=e&&o[i].offsetTop<t){var s=getNodeFromId(o[i].id.substring(3));null!=s?updateDeviceViewHtml(n,o[i],s):o[i].innerHTML=""}else o[i].innerHTML=""}function updateDeviceViewDevice(e){var t=Q("viewselect").value;if(1==t||2==t){if("string"==typeof e&&(e=getNodeFromId(e)),null!=e){var n=Q("xv"+t+e._id);null!=n&&""!=n.innerHTML&&updateDeviceViewHtml(t,n,e)}}else mainUpdate(4)}function updateDeviceViewHtml(e,t,n){var o=EscapeHtml(n.name);0==o.length&&(o="<i>Ingen</i>"),null!=n.rname&&n.rname.length>0&&(o+=" / "+EscapeHtml(n.rname));var i=EscapeHtml(n.name);if(1==showRealNames&&null!=n.rname&&(i=EscapeHtml(n.rname)),0==i.length&&(i="<i>Ingen</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var s="",a="";if(1==stars[n._id]&&(a+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=n.sessions&&(null!=n.sessions.msg&&(a+=2==e?"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(n.sessions.msg).length+"</div>"),null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp||(a+=2==e?"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=n.sessions.help&&(a+=2==e?"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=n.sessions.battery&&1==e)){var r=n.sessions.battery,l="";"ac"==r.state&&(l="Enheden er sat i"),"dc"==r.state&&(l="Enheden er batteridrevet");var d="",c=-1;"number"==typeof r.level&&r.level>=0&&r.level<=100&&(d=r.level+"%",(c=Math.floor((r.level+10)/25)+1)>5&&(lvl=5),"ac"==r.state&&(100==r.level?c=11:c+=5)),c>0&&(s+='<div class="deviceBatterySmall deviceBatterySmall'+c+'" title="'+(null!=l?l+", "+d:d)+'"></div>')}""!=a&&(s+=2==e?"<div class=deviceNotifySmallDot>"+a+"</div>":"<div class=deviceNotifyDot>"+a+"</div>");var u=n.icon;if(n.conn&&0!=n.conn||3==n.mtype||(u+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+n._id+" type=checkbox "+(checkedNodeids[n._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+n._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+'\',null,null,event)"><div class="i'+u+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+o+'">'+i+"</div><div>"+NodeStateStr(n)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+s;else if(2==e){var p=[];if(n.conn&&(1&n.conn&&(4==n.mtype?"PDU"==n.porttype?p.push('<span title="Switch port er klar til brug.">Switch</span>'):p.push('<span title="IP-KVM-porten er tilsluttet og klar til brug.">IP-KVM</span>'):p.push('<span title="Mesh agent er tilsluttet og klar til brug.">Agent</span>')),2&n.conn?p.push('<span title="Intel&reg; AMT CIRA forbundet og klar til brug">CIRA</span>'):4&n.conn&&p.push('<span title="Intel&reg; AMT er routbar.">AMT</span>'),8&n.conn&&p.push('<span title="Mesh-agent kan nås ved at bruge en anden agent som relæ.">Relay</span>'),16&n.conn&&p.push('<span title="MQTT forbindelsen til enheden er aktiv.">MQTT</span>')),3==n.mtype){var m=meshes[n.meshid];m&&m.relayid?p.push('<span title="Lokal netværksforbindelse gennem en relæagent.">Relay</span>'):p.push('<span title="Lokal netværksforbindelse.">Lokal</span>')}n.desc&&deviceViewSettings.devsCols.indexOf("desc")>=0&&(i='<div class="flex-grow-1">'+i+"</div><div style=float:right"+(1==stars[n._id]?";padding-right:15px":"")+">"+EscapeHtml(n.desc)+"</div>");var g=n.meshid;1==sort?g="pwr:"+(n.pwr?n.pwr:0):3!=sort&&4!=sort||(g="tag:**xx**xx*TaG*xx**xx**");CollapsedGroups[g];var v="<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',null,null,event)\">";if(v+='<div class=deviceBarCheckbox><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+n._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[n._id]?" checked":"")+"></div>",v+="<div class=deviceBarIcon onmouseup=gotoDevice('"+n._id+"',null,null,event)><div class=\"j"+u+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>',v+="<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>",v+='<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+o+"\" onmouseup=gotoDevice('"+n._id+"',null,null,event)>"+i+"</div></div>"+s+"</td>",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"")+'">'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("agver")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"")+'">'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("os")>=0)if(3==n.mtype){var h="";4==n.agent.id&&(h="Windows"),6==n.agent.id&&(h="Linux"),29==n.agent.id&&(h="MacOS"),v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(h)+'">'+EscapeHtml(h)}else v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(n.osdesc?n.osdesc:"")+'">'+EscapeHtml(n.osdesc?n.osdesc:"");if(deviceViewSettings.devsCols.indexOf("tags")>=0){v+="<td style=text-align:center;font-size:x-small>";var f="";if(null!=n.tags)for(var k in n.tags)f+="<span class=tagSpan>"+EscapeHtml(n.tags[k])+"</span> ";v+="<span style=line-height:20px>"+f+"</span>"}if(deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.antiVirus?"OK"==n.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>Ugyldig</span>":"")),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.autoUpdate?"OK"==n.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>Ugyldig</span>":"")),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.firewall?"OK"==n.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>Ugyldig</span>":"")),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+(null!=n.lastbootuptime?printDateTime(new Date(n.lastbootuptime)):"")),deviceViewSettings.devsCols.indexOf("links")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(n)),deviceViewSettings.devsCols.indexOf("user")>=0&&(v+="<td style=text-align:center>"+getUserShortStr(n)),deviceViewSettings.devsCols.indexOf("ip")>=0){var x="";3==n.mtype?x=n.host:n.ip&&(x=n.ip),v+='<td style=text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis title="'+EscapeHtml(x)+'">'+EscapeHtml(x)}if(deviceViewSettings.devsCols.indexOf("conn")>=0&&(v+="<td style=text-align:center>"+p.join("&nbsp;+&nbsp;")),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(v+="<td style=text-align:center>"+(null==n.intelamt||null==n.intelamt.host?"":EscapeHtml(n.intelamt.host))),deviceViewSettings.devsCols.indexOf("amtstate")>=0){var b="";n.intelamt&&(0==n.intelamt.state&&(b=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==n.intelamt.state&&(b=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==n.intelamt.state&&n.intelamt.flags&&(2&n.intelamt.flags?b=' <span title="Intel&reg; AMT er aktiveret i Client Control Mode">CCM</span>':4&n.intelamt.flags&&(b+=' <span title="Intel&reg; AMT er aktiveret i Admin Control Mode">ACM</span>'))),v+="<td style=text-align:center>"+b}deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(v+="<td style=text-align:center;font-size:x-small>",n.conn>0?v+="Forbundet":null!=n.lastconnect&&(v+=printDateTime(new Date(n.lastconnect)))),t.innerHTML=v}else if(3==e||5==e){v="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+n._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',11,null,event)\">"+s;return v+='<div class="j'+u+'" style=width:16px;float:left></div>&nbsp;'+i+"</div>",v+="<span onmouseup=gotoDevice('"+n._id+"',null,null,event)></span><div id=xkvmid_"+n._id.split("/")[2]+"><div id=skvmid_"+n._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+n._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+n._id+"')\">Afbrudt</div></div>",v+="</div>"}}}function getShortRouterLinks(e){var t="",n=GetNodeRights(e);if((1&e.conn||3==e.mtype)&&e.agent&&8&n&&14!=e.agent.id&&(0!=webRelayPort&&(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport?e.httpport:80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;",t+='<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport?e.httpsport:443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),e.agent.id>0&&e.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),e.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport?e.sshport:22)+")>SSH</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport?e.sshport:22)+")>SCP</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var o in serverinfo.devicemeshrouterlinks.extralinks){var i=serverinfo.devicemeshrouterlinks.extralinks[o],s='"'+i.protocol+'"';if(doesDeviceMatchFilterTags(e,i.filter)){if(3==e.mtype&&("mcrdesktop"==i.protocol||"mcrfiles"==i.protocol))continue;"number"==typeof i.protocol?s=i.protocol:"http"==i.protocol?s=1:"https"==i.protocol?s=2:"rdp"==i.protocol?s=3:"ssh"==i.protocol?s=4:"scp"==i.protocol?s=5:"mcrdesktop"==i.protocol?s=6:"mcrfiles"==i.protocol&&(s=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+s+","+i.port+(i.ip?',"'+i.ip+'"':",null")+","+(i.localport?i.localport:0)+")>"+i.name+"</a>&nbsp;"}}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(!Array.isArray(t))return!1;if(t.indexOf(e.meshid)>=0)return!0;if(t.indexOf(e._id)>=0)return!0;if(Array.isArray(e.tags))for(var n in e.tags)if(t.indexOf("tag:"+e.tags[n])>=0)return!0;return!1}function showDeviceHelpRequests(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var o=null,i="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)return setDialogMode(0),!1;if(null!=o.sessions.help)for(var s in o.sessions.help)i+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(s)+'","'+encodeURIComponentEx(o._id)+'")>Afvis</a><div style=margin-bottom:6px><b>'+EscapeHtml(s)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(o.sessions.help[s])+"</div></div>";return""!=i&&(xxdialogTag="HELPREQ-"+o._id,setModalContent("xxAddAgent","Hjælpeanmodninger - "+EscapeHtml(o.name),i),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var o=null,i="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)return setDialogMode(0),!1;for(var s in o.sessions)if("kvm"==s&&null==o.sessions.multidesk)for(var a in i+="<u>Fjernskrivebord</u>",o.sessions.kvm)if(a.startsWith("user/")){var r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger" ></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.kvm[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.kvm[a])))+r)}else"busy"==a&&(i+=addHtmlValue2("Enheden er optaget",1==o.sessions.kvm[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.kvm[a]))));else if("multidesk"==s)for(var a in i+="<u>Fjernskrivebord</u>",o.sessions.multidesk){r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.multidesk[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.multidesk[a])))+r)}else if("terminal"==s)for(var a in i+="<u>Terminal</u>",o.sessions.terminal){r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.terminal[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.terminal[a])))+r)}else if("files"==s)for(var a in i+="<u>Filer</u>",o.sessions.files){r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.files[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.files[a])))+r)}else if("tcp"==s)for(var a in i+="<u>TCP Routing</u>",o.sessions.tcp){r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.tcp[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.tcp[a])))+r)}else if("udp"==s)for(var a in i+="<u>UDP-routing</u>",o.sessions.udp){r="";a!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(a)+'")\' title="Afbryd denne session" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(a),(1==o.sessions.udp[a]?"1 session":nobreak(format("{0} sessioner",o.sessions.udp[a])))+r)}return""!=i?(xxdialogTag="SESSIONS-"+o._id,setModalContent("xxAddAgent","Sessioner - "+EscapeHtml(o.name),i),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0),!1}function endDeviceSession(e,t,n){var o=decodeURIComponent(n).split("/"),i=o[0]+"/"+o[1]+"/"+o[2],s=null;4==o.length&&o[3].startsWith("guest:")&&(s=atob(o[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:i,guestname:s,guestname:s}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:i,guestname:s,guestname:s,protocol:e})}function showDeviceMessages(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var o=null,i="<div style=max-height:200px;overflow-y:auto>",s=0;if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions||null==o.sessions.msg)return setDialogMode(0),!1;for(var a in o.sessions.msg){var r=a,l=5;"string"==typeof o.sessions.msg[a].msg&&(r=o.sessions.msg[a].msg),"number"==typeof o.sessions.msg[a].msgid&&null!=eventsMessageId[o.sessions.msg[a].msgid]&&(r=eventsMessageId[o.sessions.msg[a].msgid]),"number"==typeof o.sessions.msg[a].icon&&(l=o.sessions.msg[a].icon),(l<1||l>9)&&(l=5),i+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+l+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",s++}return i+="</div>",s>0&&(xxdialogTag="MESSAGES-"+o._id,setModalContent("xxAddAgent","Agent beskeder - "+EscapeHtml(o.name),i),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function toggleCollapseGroup(e,t,n){if(2==n){var o,i=document.getElementsByName("xxdevice2");if(0==i.length)return;for(var s=[],a=0;a<i.length;a++)i[a].attributes.colname.value.substring(7)==t&&s.push(i[a]);(o="none"==s[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(a=0;a<s.length;a++)s[a].style.display=o?"":"none"}else(o="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,o);o?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){"string"==typeof e&&(e=getNodeFromId(e));var t=GetNodeRights(e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){if(null==e||null==e.users||!Array.isArray(e.users)||0==e.users.length)return"";if(e.users.length>1)return'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} brugere",e.users.length))+"</span>";var t=e.users[0],n=t,o=t.indexOf("\\");return o>0&&(n=t.substring(o+1)),(n=EscapeHtml(n)).length>15&&(n=n.substring(0,14)+"&#8230;"),e.lusers&&e.lusers.length>0?addKeyLinkConditional(n,EscapeHtml(t)+" (Låst)",e.lusers&&e.lusers.indexOf(t)>=0):'<span title="'+EscapeHtml(t)+'">'+n+"</span>"}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var t=0;for(var n in nodes){var o=nodes[n],i=nodes[n]._id;if(null==multiDesktop[i]&&(0==Object.keys(checkedNodeids).length||checkedNodeids[i])){var s=GetNodeRights(o);(8&s||256&s)&&1&o.conn&&1==o.v&&t++}}if(t>8){setModalContent("xxAddAgent","Forbind alle",format("Er du sikker på at du vil forbinde til {0} enheder?",t));var a=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",a),Q("autoConnectDesktopCheckbox").checked=!1};return document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",a),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",a),connectAllKvmFunction(!0)})}}for(var n in nodes)1!=nodes[n].v||null!=multiDesktop[nodes[n]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[n]._id]||toggleKvmDevice(nodes[n]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Afbrudt","Forbinder...","Opsætning...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),!(268435456&features)&&xxcurrentView>0)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Indstillinger for fjernskrivebord",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var n=e._id,o=n.split("/")[2],i=multiDesktop[n];if(null==i){if(null==Q("kvmid_"+o))return;if(2==t){if(null==e.intelamt.user||""==e.intelamt.user)return;(i=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+o),authCookie)).shortid=o,i.onStateChanged=onMultiDesktopStateChange,i.m.bpp=1,i.m.useZRLE=!0,i.m.showmouse=!0,i.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},i.m.onScreenSizeChange=mdeskAdjust,i.Start(n,16994,"*","*",0),i.contype=2,multiDesktop[n]=i}else 1==t&&((i=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,i.m.mouseCursorActive(11==xxcurrentView),i.shortid=o,i.attemptWebRTC=attemptWebRTC,i.webrtcconfig=webrtcconfiguration,i.onStateChanged=onMultiDesktopStateChange,i.m.ImageType=multidesktopsettings.agentencoding,i.m.CompressionLevel=multidesktopsettings.quality,i.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(i.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(i.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(i.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(i.m.remoteKeyMap=multidesktopsettings.remotekeymap),i.m.onScreenSizeChange=mdeskAdjust,i.Start(n),i.contype=1,multiDesktop[n]=i)}else i.Stop(),delete multiDesktop[n]}function getMeshActions(e,t){if(!(4&t))return"";var n="";return 1==e.mtype&&(1&features||(n+=' <a href=# role="button" title="Tilføj en ny Intel&reg; AMT-computer, der er placeret på det lokale netværk." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Tilføj lokal</a>",n+=' <a href=# role="button" title="Tilføj en ny Intel&reg; AMT-computer ved at scanne det lokale netværk." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Scan netværk</a>"),e.amt&&e.amt.type>0&&(n+=' <a href=# role="button" title="Udfør Intel&reg; AMT-aktivering og konfiguration." onclick=\'return showAmtSetup("'+e._id+"\")'>Opsætning</a>")),2!=e.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(n+=' <a href=# role="button" title="Tilføj en ny computer til denne enhedsgruppe ved at installere mesh-agenten." onclick=\'return addAgentToMesh("'+e._id+"\")'>Tilføj agent</a>",2&features||(n+=' <a href=# role="button" title="Inviter nogen til at installere mesh-agenten på denne enhedsgruppe." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Invitere</a>")),3==e.mtype&&(n+=' <a href=# role="button" title="Tilføj enhed placeret på det lokale netværk." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Tilføj en enhed</a>"),n}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n=format('Tilføj en lokal enhed til enhedsgruppen "{0}".',EscapeHtml(t.name))+"<br /><br />";n+=addHtmlFormFloating("Enhedsnavn","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"),n+=addHtmlFormFloating("Hostnavn",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Samme som enhedsnavn" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />'),setModalContent("xxAddAgent","Tilføj lokal enhed",n+=addHtmlFormFloating("Type","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH / SCP / VNC)</option><option value=29>macOS (SSH / SCP / VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0)}function addLocalDeviceToMeshEx(e,t){var n=Q("dp1hostname").value;""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n=format('Tilføj en ny Intel&reg; AMT-enhed til enhedsgruppen "{0}".',EscapeHtml(t.name))+"<br /><br />";return n+=addHtmlFormFloating("Enhedsnavn",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Hostnavn",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Samme som enhedsnavn" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Brugernavn",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="admin" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Kodeord",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),setModalContent("xxAddAgent","Tilføj Intel&reg; AMT enhed",n+=addHtmlFormFloating("Sikkerhed",'<select id=dp1tls class="form-select"><option value=0>Ingen TLS-sikkerhed</option><option value=1>TLS-sikkerhed påkrævet</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus(),!1}function showAmtImport(e){if(!xxdialogMode){setModalContent("xxAddAgent","Intel&reg; AMT Device Import",'Create many Intel&reg; AMT device at once by importing a JSON file with the following format:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1)}}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,t){var n=new FileReader;n.onload=function(e){var n=null;try{n=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Intel&reg; AMT Device Import",format("Ugyldig JSON-fil: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=n?meshserver.send({action:"importamtdevices",meshid:t,amtdevices:n}):(setModalContent("xxAddAgent","Intel&reg; AMT Device Import","Ugyldigt JSON-filformat."),showModal("xxAddAgentModal","idx_dlgOkButton"))},n.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){if(xxdialogMode)return!1;var t=serverinfo.name,n=meshes[e];(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);var o;domainUrl.substring(0,domainUrl.length-1);1==serverinfo.https?o="wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:o="ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl;var i=format('Tilføj, aktiver og konfigurer Intel&reg; AMT til at gruppen "{0}" ved jævnligt at køre MeshCmd som administrator på fjernenheden.',EscapeHtml(n.name))+"<br /><br />";return i+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+o+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(i+="<div style=margin-top:8px>For ACM-aktivering skal Intel&reg; AMT indstilles til følgende betroede FQDN: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Intel&reg; AMT setup",i),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus(),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Aktiver Intel&reg; AMT i Admin Control Mode (ACM) ved hjælp af en FAT-formateret USB-nøgle. Placer setup.bin på den og start en eller flere computere med denne nøgle.</div><div style=margin-top:6px>Start med at indtaste den gamle og nye MBEx-adgangskode.</div></table>";e+=addHtmlFormFloating("Gammelt kodeord",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Nyt Kodeord*",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Nyt Kodeord*",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Bruges til bare-metal LAN-aktivering.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 tegn, 1 STORT, 1 lille, 1 numerisk, 1 ikke-alfanumerisk.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,n=Q("dp1password2").value,o=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(o=!1),t==n&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(o=!1),QE("idx_dlgOkButton",o)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){if(xxdialogMode)return!1;var t="Indtast en række IP-adresser for at scanne efter Intel&reg; AMT-enheder.<br /><br />";return t+=addHtmlValue("IP-interval",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Scan" onclick=addAmtScanToMeshButton()></input></tr></table>'),t+='<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>',t+='<input type=hidden id=amtScanMeshId value="'+e+'" />',xxdialogTag=e,setModalContent("xxAddAgent","Scan efter Intel&reg; AMT-enheder",t+='<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Annuller" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Vælg alle" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Eksempel på IP-intervalværdier<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp(),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",Q("dp1range").value.split(".").length>3),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t=document.getElementsByClassName("DevScanCheckbox"),n=0;n<t.length;n++)if(t[n].checked){var o=t[n].getAttribute("tag"),i=amtScanResults[o],s=i.hostname;"host"==i.hosttype&&(s=capitalizeFirstLetter(s.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:s,hostname:i.hostname,amtusername:"",amtpassword:"",amttls:i.tls})}}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");t.length>1&&(e=t[t.length-1]),""!=(e=e.trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Scanner...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,n=0;n<e.length;n++)e[n].checked&&t++;QE("idx_dlgOkButton2",t>0)}function checkEmail(e){var t=e.split("@"),n=2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2;if(1==n){var o=t[1].split(".");for(var i in o)0==o[i].length&&(n=!1)}return n}function inviteAgentToMesh(e){if(xxdialogMode)return!1;var t="",n=meshes[e];return 64&features&&(t+=addHtmlFormFloating("Invitationstype","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Link invitation</option><option value=1>E-mail invitation</option></select>")+"<hr />",t+="<div id=emailInviteDiv style=display:none>"+format('Inviter nogen til at installere mesh-agenten. Der sendes en e-mail med linket til mesh-agent-installationen for enhedsgruppen "{0}".',EscapeHtml(n.name))+"<br /><br />",t+=addHtmlFormFloating("Navn (valgfrit)",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'),t+=addHtmlFormFloating("E-mail",'<input id=agentInviteEmail placeholder="example@email.com" class="form-control" onkeyup=validateAgentInvite() />'),t+=addHtmlFormFloating("Operativ system","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Send installationslink</option><option value=0 selected>Alle understøttede</option><option value=1>Kun Windows</option><option value=3>Kun Apple macOS</option><option value=2>Kun Linux</option><option value=5>MeshCentral Assistant</option></select>"),t+="<div id=d2agentexpirediv>",t+=addHtmlFormFloating("Link udløb","<select id=agentInviteExpire class=form-select><option value=1>1 time</option><option value=8>8 timer</option><option value=24>1 dag</option><option value=168>1 uge</option><option value=5040>1 måned</option><option value=0>Ubegrænset</option></select>"),t+="</div>",t+="<div id=d2agentInstallTypeDiv2>",t+=addHtmlFormFloating("Installationstype","<select id=agentInviteType class=form-select><option value=0>Baggrund og interaktive</option><option value=2>Kun baggrund</option><option value=1>Kun interaktiv</option></select>"),t+="</div>",t+=addHtmlFormFloating("Meddelelse (frivillig)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>'),t+="</div>"),t+="<div id=urlInviteDiv>"+format('Inviter nogen til at installere mesh-agenten ved at dele et invitationslink. Dette link henviser brugeren til installationsinstruktioner for enhedsgruppen "{0}". Linket er offentligt, og der kræves ingen konto til denne server.',EscapeHtml(n.name))+"<br /><br />",t+=addHtmlFormFloating("Link udløb","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 time</option><option value=8>8 timer</option><option value=24>1 dag</option><option value=168>1 uge</option><option value=5040>1 måned</option><option value=0>Ubegrænset</option></select>"),t+=addHtmlFormFloating("Agenter","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Alle tilgængelige agenter</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option><option value=16>Android MeshAgent</option></select>"),t+="<div id=d2agentInstallTypeDiv>",t+=addHtmlFormFloating("Installationstype","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Baggrund og interaktive</option><option value=2>Kun baggrund</option><option value=1>Kun interaktiv</option></select>"),t+="</div>",xxdialogTag=e,setModalContent("xxAddAgent","Invitere",t+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Kopier link til udklipsholder" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),64&features?(Q("d2InviteType").focus(),d2ChangedInviteType()):(Q("d2inviteExpire").focus(),validateAgentInvite()),d2RequestInvitationLink(),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n="",o="",i="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Linux / BSD / macOS Binary Installer</option><option value=2>Apple macOS</option>";2&features||(i+="<option value=6>Mobil enhed</option>"),i+="<option value=7>MeshCentral Assistant</option>",n+=addHtmlFormFloating("Operativ system",i+="<option value=3>Windows (UnInstall)</option><option value=4>Linux / BSD (Afinstallér)</option><option value=8>Apple macOS (UnInstall)</option></select>");var s=serverinfo.name;(-1==s.indexOf(".")||2&features)&&(s=window.location.hostname);var a=domainUrl.substring(0,domainUrl.length-1),r="";r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port;var l=[6,5,10005,25,26,28,30,32,36,37,40,41,45,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",45:"RISC-V 64bit",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(var c in l)o+='<option value="'+l[c]+'">'+d[l[c]]+"</option>";n+='<div id="aginsSysTypeDiv">',n+=addHtmlFormFloating("Systemtype",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+o+"</select>"),n+="</div>",n+='<div id="aginsTypeDiv">',n+=addHtmlFormFloating("Installationstype",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Baggrund & interaktive</option><option value="2">Kun baggrund</option><option value="1">Kun interaktiv</option></select>'),n+='</div><div id="asinsTypeDiv">',n+=addHtmlFormFloating("Installationstype",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Applikation, Opret forbindelse på brugerens anmodning</option><option value="3">Applikation, altid tilsluttet</option><option value="0">Systembakke, Tilslut på brugerens anmodning</option><option value="1">Systembakke, altid tilsluttet</option><option value="4">Systembakke, kun skærm</option></select>'),n+="</div><hr>";var u=t.name;return u=u.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join(""),n+="<div id=agins_windows>"+format('For at tilføje en ny computer til enhedsgruppen "{0}", skal du downloade mesh-agenten og installere den på den computer, der skal administreres. Denne agent har server- og enhedsgruppeoplysninger indlejret i sig.',EscapeHtml(t.name))+"<br /><br />",n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),debugmode>0&&(n+=addHtmlValue("Indstillingsfil",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} indstillinger (.msh)",EscapeHtml(t.name))+"</a>")),n+="</div>",n+="<div id=agins_linux style=display:none>"+format('For at tilføje en computer til "{0}" skal du køre følgende kommando. Root-legitimationsoplysninger vil være nødvendige.',EscapeHtml(t.name))+"<br />",n+="<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>",n+='<div style=font-size:x-small;float:right>* For BSD, kør "pkg install wget sudo bash" først.</div><a style=text-decoration:none title="Kopier til udklipsholder" onclick=copyAgentIdValue("agins_linux_area")>Kopier <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',n+="<div id=agins_osx style=display:none>"+format('For at tilføje en ny computer til enhedsgruppen "{0}", skal du downloade mesh-agenten og installere den på den computer, der skal administreres. Dette agentinstallationsprogram har server- og enhedsgruppeoplysninger indlejret i sig.',EscapeHtml(t.name))+"<br /><br />",n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64bit</a> <i class="fa-regular fa-clipboard" title="Kopier macOS-agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64bit)</a> <i class="fa-regular fa-clipboard" title="Kopier macOS-agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <i class="fa-regular fa-clipboard" title="Kopier macOS-agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+="</div>",n+='<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('For at tilføje en mobilenhed til gruppen "{0}", download MeshAgent-applikationen og scan denne QR-kode.',EscapeHtml(t.name))+"</div>",n+="<table style=width:180px>",n+='<tr><td style=text-align:center><a title="Google Play Butik"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>',n+='<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>',n+="</table>",n+=addHtmlValue("Android APK",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Kopier URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'),n+="</div>",n+="<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('MeshCentral Assistant er et Windows-værktøj, som brugere kan bruge til at bede om hjælp. Brug linket nedenfor til at downloade en version, der vil oprette forbindelse til enhedsgruppen "{0}".',EscapeHtml(t.name))+"</div><div></div><br />",n+='<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant for Windows">Assistent for Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopier URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',n+='</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>',n+="<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>MeshCentral Assistant er et Windows-værktøj, som brugere kan bruge til at bede om hjælp. Brug linket nedenfor for at downloade en version, der overvåger baggrundsagenten.</div><div></div><br />",n+='<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant for Windows">Assistent for Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopier URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',n+='</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>',n+='<div id=agins_windows_un style=display:none>For at fjerne en mesh-agent skal du downloade filen nedenfor, køre den og klikke på "afinstaller".<br /><br />',n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+="</div>",n+="<div id=agins_linux_un style=display:none>For at fjerne en mesh-agent skal du køre følgende kommando. Root-legitimationsoplysninger vil være nødvendige.<br />",n+="<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>",n+='<a style=text-decoration:none title="Kopier til udklipsholder" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',n+='<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />',n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Kopier macOS-agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+="</div>",n+="<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />",n+=addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">meshagent</a> <i class="fa-regular fa-clipboard" title="Kopiér agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue('Kommando&nbsp;<i class="fa-regular fa-clipboard" title="Kopiér agent-URL til udklipsholder" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(2147483648&features?" --no-check-certificate":"")+' "https://'+s+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"]),setModalContent("xxAddAgent","Tilføj Mesh Agent",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),8192&features?(Q("agins_linux_area").value='wget "https://'+s+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+s+r+a+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+s+r+a+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+s+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+s+r+a+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+s+r+a+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='(wget "https://'+s+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+s+r+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+s+r+a+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+s+r+a+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+s+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+s+r+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+s+r+a+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+s+r+a+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick(),!1}function setModalContent(e,t,n,o=null){var i=document.getElementById("xxAddAgentModalConf"),s=document.getElementById(e+"Title");if(i&&s){if(s.innerHTML=t,"number"==typeof n){for(var a=1;a<24;a++)QV("dialog"+a,a==n);xxdialogMode=a}else if("string"==typeof n){Q("dialog2").innerHTML=n;for(a=1;a<24;a++)QV("dialog"+a,2==a);xxdialogMode=2}if(o)switch(i.classList.remove("modal-sm","modal-lg","modal-xl"),o){case"small":i.classList.add("modal-sm");break;case"large":i.classList.add("modal-lg");break;case"extra-large":i.classList.add("modal-xl")}else i.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(e,t,n,o=null,i=null){if(null==xxModal){["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(e));var s=function(t){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(e).removeEventListener("hidden.bs.modal",s)};document.getElementById(e).addEventListener("hidden.bs.modal",s)}xxModal.show(),document.getElementById(t).onclick=function(){"function"==typeof n&&n?(xxdialogMode=0,!1!==n(o,i)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,n,o,i,s,a,r){Swal.fire({position:e,title:t,text:n,icon:o,confirmButtonText:i,timer:s,width:a,showConfirmButton:null!==i})}function copyAgentUrl(e,t){var n=serverinfo.name;(-1==n.indexOf(".")||2&features)&&(n=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var o="https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e;1==t&&(o+=Q("aginsType").value),o+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(o+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(o+="&ac="+Q("asinsType").value),copyTextToClip(o)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},debugmode>0&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",Q("asinsType").value>=2))}function validateDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var n=Q("dp1username").value;""==n&&(n="admin");var o=Q("dp1hostname").value;""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,amtusername:n,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0!=deviceHeaderId?(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 node":format("{0} noder",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0):deviceHeaderId=1}var powerStateStrings=["",'<span title="Enheden er tændt.">Tændt</span>','<span title="Enheden er i slumre tilstand (S1)">I slumretilstand</span>','<span title="Enheden er i slumre tilstand (S2)">I slumretilstand</span>','<span title="Enheden er i dyb dvale (S3)">Deep Sleep</span>','<span title="Enheden er i dvale tilstand (S4).">Dvaletilstand</span>','<span title="Enheden er slukket (S5).">Soft-Off</span>','<span title="Enheden er registreret, men strømtilstanden kunne ikke hentes.">Findes</span>','<span title="Enheden er slukket">slukket</span>'],powerStateStrings2=["","Enheden får strøm","Enheden er i slumre tilstand (S1)","Enheden er i slumre tilstand (S2)","Enheden er i dyb dvale (S3)","Enheden er i dvale (S4)","Enheden er i soft-off tilstand (S5)","Enheden er til stede, men strømtilstanden kan ikke bestemmes","Enheden er slukket"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return e.state>0&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(1&e.conn&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="Power knap er klar til brug.">Switch</span>'):t.push('<span title="IP-KVM-porten er oppe og klar til brug.">IP-KVM</span>'):t.push('<span title="Mesh agent er tilsluttet og klar til brug.">Agent</span>')),2&e.conn?t.push('<span title="Intel&reg; AMT CIRA forbundet og klar til brug">CIRA</span>'):4&e.conn&&t.push('<span title="Intel&reg; AMT er routbar.">AMT</span>'),8&e.conn&&t.push('<span title="Mesh-agent kan nås ved at bruge en anden agent som relæ.">Relay</span>'),16&e.conn&&t.push('<span title="MQTT forbindelsen til enheden er aktiv.">MQTT</span>')),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Ukendt"}function updateCollapseAllButton(){var e=Object.keys(CollapsedGroups).length>0;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,n=0;n<e.length;n++)e[n].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};var o=document.getElementsByName("xxdevice"+Q("viewselect").value);for(n=0;n<o.length;n++)(null==o[n].parentElement.attributes.style||o[n].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[o[n].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(e>0?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Vælg Ingen",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Vælg alle",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,e>=1)}function groupActionFunction(){var e=[],t=getCheckedDevices(),n=0;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Konto sikkerhed",'Kan ikke få adgang til denne funktion, før to-faktor-godkendelse er aktiveret. Dette er nødvendigt for ekstra sikkerhed. Gå til fanen "Min konto" og se sektionen "Kontosikkerhed".'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(4194304&features)for(var o in t)if(16&getNodeFromId(t[o]).conn){e.push({v:103,name:"Send MQTT-besked"});break}for(var o in e.push({v:105,name:"Eksporter enhedsoplysninger",s:!0}),t){var i=getNodeFromId(t[o]),s=GetNodeRights(i);1&s&&!(2&n)&&(n|=2,e.push({v:102,name:"Flyt til enhedsgruppe"})),1&i.conn&&32768&s&&!(1&n)&&(n|=1,e.push({v:104,name:"Afinstaller agent"})),64&s&&!(8&n)&&(n|=8,e.push({v:100,name:"Væk enheder"})),262144&s&&!(4&n)&&(n|=4,e.push({v:4,name:"Sæt enheder i slumretilstand"}),e.push({v:3,name:"Nulstil enheder"}),e.push({v:2,name:"Sluk enheder"})),131072&s&&!(16&n)&&(n|=16,e.push({v:106,name:"Kør kommandoer"})),16384&s&&!(32&n)&&(n|=32,e.push({v:108,name:"Enhedsmeddelelse"})),4&s&&!(64&n)&&(n|=64,e.push({v:107,name:"Rediger Tags"})),8&s&&!(256&n)&&(n|=256,e.push({v:109,name:"Upload filer"})),32768&s&&!(128&n)&&(n|=128,e.push({v:101,name:"Slet enheder"})),null!=i.agent&&16&features2&&4294967295==s&&!(512&n)&&(n|=512,e.push({v:110,name:"Tving agentopdatering"}),e.push({v:111,name:"Fjern agent kerne"}),e.push({v:112,name:"Upload standard serverkerne"}))}var a="";for(var o in e.sort(nameSort),e)a+="<option value="+e[o].v+(e[o].s?" selected":"")+">"+e[o].name+"</option>";var r="Vælg en handling, der skal udføres på alle valgte enheder. Handlinger vil kun blive udført med de rette rettigheder.<br /><br />";setModalContent("xxAddAgent","Gruppehandling",r+=addHtmlFormFloating("Funktion",'<select id=d2groupop class="form-select">'+a+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(c=getCheckedDevices()).length)return;if(1==c.length)t+="Bekræft fjernelse af den valgte enhed?<br /><br />";else{t+=format("Bekræft fjernelse af {0} valgte enheder?<br />",c.length);var n=0,o=0;for(var i in c){null!=(u=getNodeFromId(c[i])).conn&&u.conn>0?n++:o++}var s="";1==n?s+=format("1 valgt enhed er online.<br />",n):n>1&&(s+=format("{0} udvalgte enheder er online.<br />",n)),1==o?s+=format("1 valgt enhed er offline.<br />",o):o>1&&(s+=format("{0} valgte enheder er offline.<br />",o)),t+=""!=s?"<div style=padding:8px>"+s+"</div>":"<br />"}setModalContent("xxAddAgent","Slet Enheder",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />Bekræft</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Kør kommandoer på udvalgte enheder.",func:uncheckAllDevices});else if(107==e){t="Udfør batch-enhedstag-handling<br /><br />";t+=addHtmlFormFloating("Funktion",'<select id=d2deviceop class="form-select"><option value=1>Tilføj et Tag</option><option value=2>Sæt tags</option><option value=3>Fjern Tags</option></select>'),t+=addHtmlFormFloating("Tags",'<select id=dp10devicevalue multiple class="form-control" maxlength=4096>');var a=[];s="";for(var i in nodes)if(nodes[i].tags)for(var r in nodes[i].tags)-1==a.indexOf(nodes[i].tags[r])&&a.push(nodes[i].tags[r]);if(a.length>0)for(var i in a.sort(),a){EscapeHtml(a[i]);s+="<option>"+EscapeHtml(a[i])+"</option>"}setModalContent("xxAddAgent","Rediger enheds Tags",t+=s+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:"Tag1, Tag2, Tag3",closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0}),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){t="<div style=margin-bottom:4px>Udfør batch-enhedsmeddelelse</div>";t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Toastmeddelelse</option><option value=1>Meddelelsesboks</option><option value=3>Alert Box</option></select>',t+='<input id=dp2notifyTitle maxlength=256 placeholder="Titel" style=width:100%;box-sizing:border-box;margin-bottom:4px />',t+="<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>",t+="<select style=width:100% id=d2notifyTimeout>",t+='<option disabled value="">Only Applicable to Message Box Notifications</option>',t+="<option value=2 selected>Show for 2 Minutes (Default)</option>",t+="<option value=10>Show for 10 minutes</option>",t+="<option value=30>Show for 30 minutes</option>",t+="<option value=60>Show for 60 minutes</option>",t+="<option value=0>Vis besked, indtil den afvises af brugeren</option>",setModalContent("xxAddAgent","Enhedsmeddelelse",t+="</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var l=!1,d=!1,c=getCheckedDevices();for(var i in c){var u;(u=getNodeFromId(c[i])).agent&&(u.agent.id>0&&u.agent.id<5||34==u.agent.id?l=!0:d=!0)}t="Upload valgte filer til alle valgte enheder<br /><br />";t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>",t+="<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+c.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />",t+='<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',l&&(t+=addHtmlFormFloating("Windows sti",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),d&&(t+=addHtmlFormFloating("Linux Path",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),t+='<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />Opret mappe hvis den ikke findes?</label><br />',setModalContent("xxAddAgent","Batch fil upload",t+='<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />Overskriv hvis filen findes?</label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e){setModalContent("xxAddAgent","Tving agentopdatering",t="Tving agentopdatering på udvalgte enheder?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec())}else if(111==e){setModalContent("xxAddAgent","Fjern agent kerne",t="Fjern agent kerne på valgte enheder?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec())}else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent","Upload standard serverkerne",t="Uploade standardserverkernen på udvalgte enheder?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=getCheckedDevices(),i=parseFloat(Q("d2notifyTimeout").value);if(0!=n.length)if(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(i)&&(i=2),1==e)for(var s=0;s<o.length;s++)meshserver.send({action:"msg",type:"messagebox",nodeid:o[s],title:t,msg:n,timeout:6e4*i});else if(2==e)meshserver.send({action:"toast",nodeids:o,title:t,msg:n});else if(3==e)for(s=0;s<o.length;s++)meshserver.send({action:"msg",type:"alertbox",nodeid:o[s],title:t,msg:n})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,n=[],o=$("#dp10devicevalue").select2("data");for(var i in o)n.push(o[i].text.trim());if(2==t)for(var i in e)meshserver.send({action:"changedevice",nodeid:e[i],tags:n.join(",")});else{var s=[];for(var i in n){var a=n[i].trim();a.length>0&&a.length<64&&-1==s.indexOf(a)&&s.push(a)}for(var i in e){var r=null,l=!1,d=getNodeFromId(e[i]);null!=d.tags&&(r=Clone(d.tags)),null==r&&(r=[]);for(var c=0;c<n.length;c++)if(1==t&&-1==r.indexOf(n[c])&&(r.push(n[c]),l=!0),3==t){var u=r.indexOf(n[c]);u>=0&&(r.splice(u,1),l=!0)}l&&meshserver.send({action:"changedevice",nodeid:e[i],tags:r.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e=getCheckedDevices(),t=!1;for(var n in e)null!=getNodeFromId(e[n]).intelamt&&(t=!0);var o="Download listen over enheder med et af filformaterne nedenfor.<br /><br />";o+=addHtmlValue("CSV-format","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"),o+=addHtmlValue("JSON-format","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>"),t&&(o+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Enhedsinformation export",o+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Inkludér enhedsoplysninger</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var n="id,name,rname,host,icon,ip,osdesc,state,groupname,conn,pwr,av,update,firewall,bitlocker,avdetails,tags,lastbootuptime\r\n";for(var o in e){var i=getNodeFromId(e[o]);if(n+='"'+i._id.split(",").join("")+'","'+i.name.split(",").join("")+'","'+(i.rname?i.rname.split(",").join(""):"")+'","'+(i.host?i.host.split(",").join(""):"")+'","'+i.icon+'","'+(i.ip?i.ip:"")+'","'+(i.osdesc?i.osdesc.split(",").join(""):"")+'","'+i.state+'","'+meshes[i.meshid].name.split(",").join("")+'","'+(i.conn?i.conn:"")+'","'+(i.pwr?i.pwr:"")+'"',"object"==typeof i.wsc?n+=',"'+csvClean(i.wsc.antiVirus)+'","'+csvClean(i.wsc.autoUpdate)+'","'+csvClean(i.wsc.firewall)+'"':n+=",,,","object"==typeof i.volumes){var s="",a=!0;for(var r in i.volumes)void 0!==i.volumes[r].protectionStatus&&(a?a=!1:s+="|",s+=r+"/"+i.volumes[r].volumeStatus);n+=',"'+csvClean(s)+'"'}else n+=",";if("object"==typeof i.av){var l="",d=!0;for(var r in i.av)"string"==typeof i.av[r].product&&(d?d=!1:l+="|",l+=i.av[r].product+"/"+(i.av[r].enabled?"enabled":"disabled")+"/"+(i.av[r].updated?"updated":"notupdated"));n+=',"'+csvClean(l)+'"'}else n+=",";if("object"==typeof i.tags){var c="",u=!0;for(var r in i.tags)u?u=!1:c+="|",c+=i.tags[r];n+=',"'+csvClean(c)+'"'}else n+=",";"number"==typeof i.lastbootuptime&&(n+=',"'+i.lastbootuptime+'"'),n+="\r\n"}saveAs(stringToUtf8Blob(n),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e=getCheckedDevices(),t={webappversion:"0.9.0",computers:[]};for(var n in e){var o=getNodeFromId(e[n]);if(null!=o.intelamt){var i={name:o.name,host:o.host,user:o.intelamt.user,pass:"",tls:1==o.intelamt.tls?1:0,ver:o.intelamt.ver,pstate:o.intelamt.state};2==o.intelamt.state&&(i.pmode=1),o.intelamt.realm&&(i.digestrealm=o.intelamt.realm),o.intelamt.hash&&(i.tlscerthash=o.intelamt.hash),t.computers.push(i)}}saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var n=[];for(var o in e)n.push(getNodeFromId(e[o]));saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t=!1,n=!1,o=!1;for(var i in e.nodeids){var s=getNodeFromId(e.nodeids[i]);s.agent&&(24&~GetNodeRights(s)||(o=!0),s.agent.id>0&&s.agent.id<5?t=!0:n=!0)}if(1==t||1==n||1==o){var a={type:1,runAs:0,source:1,cmd:""};try{a=JSON.parse(getstore("runopt",a))}catch(e){}if(e.selectedFile){var r=e.selectedFile.name.toLowerCase();console.log("filename",r),r.endsWith(".bat")&&(a.type=1),r.endsWith(".ps1")&&(a.type=2),r.endsWith(".sh")&&(a.type=3),r.endsWith(".agentconsole")&&(a.type=4)}var l="";e.title&&(l+=e.title+"<br />"),l+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==t&&(l+="<option value=1"+(1==a.type?" selected":"")+">Windows Command Prompt</option><option value=2"+(2==a.type?" selected":"")+">Windows PowerShell</option>"),1==n&&(l+="<option value=3"+(3==a.type?" selected":"")+">Linux / BSD / macOS Command Shell</option>"),1==o&&(l+="<option value=4"+(4==a.type?" selected":"")+">Agent konsol</option>"),l+="</select>",l+="<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==a.runAs?" selected":"")+">Kør som agent</option><option value=1"+(1==a.runAs?" selected":"")+">Kør som bruger, agent hvis ingen bruger</option><option value=2"+(2==a.runAs?" selected":"")+">Skal køre som bruger</option></select>",null==e.selectedFile&&(l+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==a.source?" selected":"")+">Commands from text box</option><option value=1"+(1==a.source?" selected":"")+">Commands from file</option>",8&userinfo.siteadmin&&(l+="<option value=2"+(2==a.source?" selected":"")+">Commands from file on server</option>"),l+="</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(a.cmd?EscapeHtml(decodeURIComponent(a.cmd)):"")+"</textarea>",l+='<div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin&&(l+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>')),xxdialogTag=e,setModalContent("xxAddAgent","Kør kommandoer",l),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles())),d2runCommandValidate()}}function d2runCommandValidate(){if(QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile){QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value);var e=!1;0==Q("d2cmdsource").value&&Q("d2runcmd").value.length>0&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)}else QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var n=3;try{n=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:n,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var o={action:"runcommands",nodeids:t.nodeids,type:n,runAsUser:parseInt(Q("d2cmduser").value)};if(t.selectedFile)(i=new FileReader).onload=function(e){o.cmds=e.target.result,meshserver.send(o),t.func&&t.func()},i.readAsText(t.selectedFile);else if(0==Q("d2cmdsource").value)o.cmds=Q("d2runcmd").value,meshserver.send(o),t.func&&t.func();else if(1==Q("d2cmdsource").value){var i;(i=new FileReader).onload=function(e){o.cmds=e.target.result,meshserver.send(o),t.func&&t.func()},i.readAsText(Q("d2runfileex").files[0])}else if(2==Q("d2cmdsource").value){var s=d3getFileSel();if(1!=s.length)return;o.cmdpath=d3filetreelocation.join("/")+"/"+s[0],meshserver.send(o),t.func&&t.func()}}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){var n=e.name.toLowerCase(),o=t.name.toLowerCase();return sortCollator.compare(n,o)}function meshSort(e,t){var n=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=n||0!=(n=sortCollator.compare(e.meshid,t.meshid))?n:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var n=e.pwr?e.pwr:0,o=t.pwr?t.pwr:0;return n>o?-1:n<o?1:n==o?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var n=e.lastconnect,o=t.lastconnect;return null==n&&(n=99999999999999),null==o&&(o=99999999999999),e.conn>0&&(n=99999999999998),t.conn>0&&(o=99999999999998),n==o?nameSort(e,t):n-o}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t=e.split(" og "),n=null;for(var o in t){var i=getDevicesThatMatchFilter(t[o]);if(null==n)n=i;else{var s=[];for(var a in i)n.indexOf(i[a])>=0&&s.push(i[a]);n=s}}return n}function parseSearchOrInput(e){var t=e.split(" eller "),n=null;for(var o in t){var i=parseSearchAndInput(t[o]);if(null==n)n=i;else for(var s in i)n.indexOf(i[s]>=0)&&n.push(i[s])}return n}function getDevicesThatMatchFilter(e){var t=[],n=null,o=null,i=null,s=null,a=null,r=null,l=null,d=null,c=null,u=null;if(e.startsWith("bruger:".toLowerCase())?n=e.substring(7):e.startsWith("u:".toLowerCase())?n=e.substring(2):e.startsWith("ip:".toLowerCase())?o=e.substring(3):e.startsWith("gruppe:".toLowerCase())?i=e.substring(7):e.startsWith("g:".toLowerCase())?i=e.substring(2):e.startsWith("tag:".toLowerCase())?s=e.substring(4):e.startsWith("t:".toLowerCase())?s=e.substring(2):e.startsWith("atag:".toLowerCase())?a=e.substring(5):e.startsWith("a:".toLowerCase())?a=e.substring(2):e.startsWith("os:".toLowerCase())?l=e.substring(3):e.startsWith("amt:".toLowerCase())?d=e.substring(4):e.startsWith("beskrivelse:".toLowerCase())?c=e.substring(12):e.startsWith("connectivity:".toLowerCase())?u=e.substring(13):e.startsWith("c:".toLowerCase())?u=e.substring(2):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var p in nodes)t.push(p);else if(null!=o)for(var p in nodes)null!=nodes[p].ip&&nodes[p].ip.toLowerCase().indexOf(o)>=0&&t.push(p);else if(null!=i)for(var p in nodes)meshes[nodes[p].meshid].name.toLowerCase().indexOf(i)>=0&&t.push(p);else if(null!=s){for(var p in nodes)if(null==nodes[p].tags&&""==s)t.push(p);else if(null!=nodes[p].tags)for(var m in nodes[p].tags)if(nodes[p].tags[m].toLowerCase().indexOf(s)>=0){t.push(p);break}}else if(null!=a)for(var p in nodes)(null!=nodes[p].agent&&null==nodes[p].agent.tag&&""==a||null!=nodes[p].agent&&null!=nodes[p].agent.tag&&nodes[p].agent.tag.toLowerCase().indexOf(a)>=0)&&t.push(p);else if(null!=n){for(var p in nodes)if(nodes[p].users&&nodes[p].users.length>0)for(var g in nodes[p].users)nodes[p].users[g].toLowerCase().indexOf(n)>=0&&t.push(p)}else if(null!=l)for(var p in nodes)null!=nodes[p].osdesc&&nodes[p].osdesc.toLowerCase().indexOf(l)>=0&&t.push(p);else if(null!=d)for(var p in nodes)null==nodes[p].intelamt||""!=d&&nodes[p].intelamt.state!=d||t.push(p);else if(null!=c)for(var p in nodes)null!=nodes[p].desc&&""!=nodes[p].desc&&(""==c||nodes[p].desc.toLowerCase().indexOf(c)>=0)&&t.push(p);else if(null!=r)for(var p in nodes)nodes[p].wsc&&(1==r&&"OK"==nodes[p].wsc.antiVirus&&"OK"==nodes[p].wsc.autoUpdate&&"OK"==nodes[p].wsc.firewall?t.push(p):(2!=r&&5!=r||"OK"==nodes[p].wsc.antiVirus)&&(3!=r&&5!=r||"OK"==nodes[p].wsc.autoUpdate)&&(4!=r&&5!=r||"OK"==nodes[p].wsc.firewall)||t.push(p));else if(null!=u){for(var p in nodes)if(nodes[p].conn&&(1&nodes[p].conn&&(4==nodes[p].mtype?("PDU"==nodes[p].porttype&&"switch"==u.toLowerCase()||"ipkvm"==u.toLowerCase())&&t.push(p):"agent"==u.toLowerCase()&&t.push(p)),(2&nodes[p].conn&&"cira"==u.toLowerCase()||4&nodes[p].conn&&"amt"==u.toLowerCase())&&t.push(p),8&nodes[p].conn&&"relay"==u.toLowerCase()&&t.push(p),16&nodes[p].conn&&"mqtt"==u.toLowerCase()&&t.push(p)),3==nodes[p].mtype){var v=meshes[nodes[p].meshid];(v&&v.relayid&&"relay"==u.toLowerCase()||v&&void 0===v.relayid&&"local"==u.toLowerCase())&&t.push(p)}}else if("*"==e)for(var p in nodes)1==stars[nodes[p]._id]&&t.push(p);else try{var h=e.split(/\s+/).join("|"),f=new RegExp(h);for(var p in nodes)32768&features2?268435456&features2?(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):268435456&features2?showRealNames?(null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):showRealNames?null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())&&t.push(p):f.test(nodes[p].name.toLowerCase())&&t.push(p)}catch(e){for(var p in nodes)t.push(p)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim();putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e);var t=parseSearchOrInput(e);for(var n in nodes)nodes[n].v=t.indexOf(n)>=0;var o=Q("DevFilterSelect").value;if(1==o)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn||3==nodes[n].mtype||(nodes[n].v=!1);if(2==o)for(var n in nodes){(null==(i=nodes[n]).sessions||null==i.sessions.kvm&&null==i.sessions.terminal&&null==i.sessions.files&&null==i.sessions.tcp&&null==i.sessions.udp)&&(i.v=!1)}if(3==o)for(var n in nodes)1!=stars[nodes[n]._id]&&(nodes[n].v=!1);if(4==o)for(var n in nodes)null==nodes[n].intelamt&&(nodes[n].v=!1);if(5==o)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn&&(nodes[n].v=!1);if(6==o)for(var n in nodes){null!=(i=nodes[n]).sessions&&null!=i.sessions.help||(i.v=!1)}if(7==o)for(var n in nodes){null!=(i=nodes[n]).tags&&0!=i.tags.length||(i.v=!1)}if(8==o)for(var n in nodes){var i;null!=(i=nodes[n]).tags&&i.tags.length>0&&(i.v=!1)}}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(serverinfo.linuxshell&&currentNode.agent.id>4)return;var n=e.target.nextElementSibling;if(n)for(var o=n.children,i=currentNode.agent.id>4&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,s=0;s<o.length;s++)o[s].style.display=i?o[s].classList.contains(i)?"block":"none":o[s].classList.contains("lin")||o[s].classList.contains("ass")?"none":"block"}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,o=document.elementFromPoint(e.pageX-t,e.pageY-n);o&&null!=o&&null==o.attributes.cmenu;)o=o.parentElement;if(null==o)return!0;var i=o.attributes.cmenu.value;if("devsContentMenu"===i){contextelement=o;var s,a=document.getElementById("contextMenu");showContextMenuDiv(a,e.pageX,e.pageY);var r=getNodeFromId((s=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,s.length-18)),l=GetNodeRights(r),d=!!(16&l),c=4294967295==l||!(65536&l),u=4294967295==l||!(512&l),p=4294967295==l||!(1024&l);QV("cxdesktop",!!(1&r.conn)&&4!=r.mtype&&(1==r.mtype||null==r.agent||null==r.agent.caps||!!(1&r.agent.caps)||r.intelamt&&2==r.intelamt.state)&&(8&l||256&l)&&c),QV("cxterminal",!!(1&r.conn)&&4!=r.mtype&&(1==r.mtype||null==r.agent||null==r.agent.caps||!!(2&r.agent.caps)||r.intelamt&&2==r.intelamt.state)&&8&l&&u),QV("cxfiles",4!=r.mtype&&2==r.mtype&&(null==r.agent||null==r.agent.caps||!!(4&r.agent.caps))&&8&l&&p),QV("cxevents",null!=r.intelamt&&(2==r.intelamt.state||2&r.conn)&&8&l),QV("cxdetails",r.mtype<3),QV("cxwebvnc",(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)&&!(536870912&features)),QV("cxwebrdp",(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)&&!(1073741824&features)),QV("cxwebssh",512&features2&&(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)),QV("cxconsole",d&&2==r.mtype&&(null==r.agent||null==r.agent.caps||!!(8&r.agent.caps))&&8&l),QV("cxrdp",!1),(1&r.conn||3==r.mtype)&&r.agent&&8&l&&r.agent.id>0&&r.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(a=document.getElementById(i)))return!0;contextelement=o,showContextMenuDiv(a,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,n){var o=document.documentElement.getBoundingClientRect(),i=o.height,s=o.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,t>s/2?e.style.right=s-event.pageX+"px":e.style.left=event.pageX+"px",n>i/2?e.style.bottom=i-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var n;if(n=(n=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,n.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),e>0&&e<9){var o=[0,10,12,11,13,16,17,15,19][e];if(t&&1==t.shiftKey)safeNewWindow(window.location.origin+"?node="+n.split("/")[2]+"&viewmode="+o+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+n);else{gotoDevice(n,o);var i=meshes[currentNode.meshid];1&currentNode.conn&&2==i.mtype&&(11==o&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==o&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==o&&null==files&&connectFiles(null))}}if(10==e){for(var s=document.getElementsByClassName("DeviceCheckbox"),a=[],r=0;r<s.length;r++)!0===s[r].checked&&a.push(s[r].defaultValue.substring(6));for(var r in 0==a.length&&a.push(n),a)null!=stars[a[r]]&&(delete stars[a[r]],delete a[r]);var l=Object.keys(stars).length;for(var r in a)l<200&&null==stars[a[r]]&&(stars[a[r]]=1,l++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(n),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(n):12==e?p10rfb(n):13==e?p10ssh(n):14==e&&p10MCRouter(n,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),n=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var o=0;o<n.length;o++)n[o].attributes&&n[o].attributes.class.value.split(" ")[0]==t&&(n[o].checked=1==e);if(1==e)for(var o in nodes)nodes[o].meshid==t&&1==nodes[o].v&&(checkedNodeids[nodes[o]._id]=1);else if(2==e)for(var o in checkedNodeids){var i=getNodeFromId(o);null!=i&&i.meshid==t&&1==i.v&&delete checkedNodeids[o]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","RDP-forbindelse",'RDP fjernforbindelsesport:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rdpport").value.length>0?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport)}}function cmsshportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","SSH forbindelse",'SSH fjernforbindelsesport:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10sshport").value.length>0?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport)}}function cmrfbportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","VNC-forbindelse",'VNC fjernforbindelsesport:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rfbport").value.length>0?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport)}}function cmhttpportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","HTTP-forbindelse",'HTTP fjernforbindelsesport:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpport").value.length>0?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport)}}function cmhttpsportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","HTTPS-forbindelse",'HTTPS fjernforbindelsesport:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpsport").value.length>0?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport)}}function cmfilesaction(e){if(!xxdialogMode){var t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)];1==e?(setModalContent("xxAddAgent","Omdøb",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Fil editor","Kun filer på mindre end 200k kan redigeres."):3==e&&(setModalContent("xxAddAgent","Slet","Slet element?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t)))}}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes){if((o=nodes[t]).tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(o.tags[n])]=!0}if(4==sort)for(var t in CollapsedGroups={},nodes){var o=nodes[t],i=meshes[o.meshid];if(i){if(CollapsedGroups["tag:"+encodeURIComponentEx(i.name)]=!0,o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(i.name+" - "+o.tags[n])]=!0}else if(o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+o.tags[n])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(32768&features){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t=null;for(var n in nodes)try{var o=map_parseNodeLoc(nodes[n]),i=xxmap.markersSource.getFeatureById(nodes[n]._id);if(null==o||nodes[n].meshid!=e&&null!=e)i&&xxmap.markersSource.removeFeature(i);else{var s=o[0],a=o[1];o[2];null==t?t=[s,a,s,a,0]:(s<t[0]&&(t[0]=s),a<t[1]&&(t[1]=a),s>t[2]&&(t[2]=s),a>t[3]&&(t[3]=a)),null==i?(addFeature(nodes[n]),t[4]=1):(updateFeature(nodes[n],i),i.setStyle(markerStyle(nodes[n],o[2])))}}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[n]))}return t}}}function stringToIntHash(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}function map_parseNodeLoc(e){var t=null,n=0;return e.iploc&&(t=e.iploc,n=1),e.wifiloc&&(t=e.wifiloc,n=2),e.gpsloc&&(t=e.gpsloc,n=3),e.userloc&&(t=e.userloc,n=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==n?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,n]:[parseFloat(t[0]),parseFloat(t[1]),n])}function loadmap(){if(32768&features&&null!=xxmap)if(32768&features){QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){var n=t.getId();if(null!=n)gotoDevice(n,10);else gotoDevice(getCorrespondingFeature(t).getId(),10)}}),xxmap.map.on("pointermove",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){xxmap.map.getTargetElement().style.cursor="pointer";var n=t.getGeometry().getCoordinates();if(map_cm_popup.setPosition(n),t.getId())QH("xmap-info-window",t.get("name"));else{var o=getCorrespondingFeature(t);QH("xmap-info-window",o.get("name"))}}else xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window","")});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(xxmap.contextmenu.clear(),t)if(t.getId())addContextMenuItems(t);else{var n=getCorrespondingFeature(t);n?addContextMenuItems(n):xxmap.contextmenu.extend(contextmenu_items)}else xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}else xxmap=null}function addFeature(e,t,n){var o=getModifiedFeature(e._id);if(o)xxmap.markersSource.addFeature(o);else{if(!t&&!n){var i=map_parseNodeLoc(e);t=i[0],n=i[1]}if(n>180&&(n=180-n,meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,n]})),t<90&&t>-90&&n<180&&n>-180){var s=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:n});s.setId(e._id),s.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(s)}}}function removeFeature(e){var t=xxmap.markersSource.getFeatureById(e._id);t&&xxmap.markersSource.removeFeature(t)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var n=map_parseNodeLoc(e);if(null!=n){var o=n[0],i=n[1];if(o!=t.get("lat")||i!=t.get("lon")){t.set("lat",o),t.set("lon",i);var s=ol.proj.transform([parseFloat(i),parseFloat(o)],"EPSG:4326","EPSG:3857");t.getGeometry().setCoordinates(s)}}e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t=e.getId();if(t&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),!getActiveInteractions(e))){var n=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10});xxmap.activeInteractions.push({featureid:t,feature:e,interaction:n}),xxmap.map.addInteraction(n)}}function saveMarkerloc(e){var t=e.getId();if(t){var n=getActiveInteractions(e);if(n){xxmap.map.removeInteraction(n),removeInteraction(t);var o=e.getGeometry().getCoordinates(),i=ol.proj.transform(o,"EPSG:3857","EPSG:4326");i[0]>180&&(i[0]=180-i[0]);var s=[i[1],i[0]];meshserver.send({action:"changedevice",nodeid:t,userloc:s})}}}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc&&(t=4));var n=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:n,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(e){getActiveInteractions(e)?(map_cm_saveMarker.data=e,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=e,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(e.a).userloc&&(map_cm_clearMarker.data=e,xxmap.contextmenu.push(map_cm_clearMarker)));map_cm_nodemenu_items.forEach(function(t){"Zoom ind for at tilpasse til området"==t.text||"Zoom ud for at tilpasse til området"==t.text?t.data=e:"-"!=t&&(t.data=e.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid==t)return xxmap.activeInteractions[n].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid===e){t=n;break}t>=0&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),n=0;n<xxmap.activeInteractions.length;n++){var o=xxmap.activeInteractions[n].feature,i=o.getGeometry().getCoordinates();if(i[0].toFixed(5)==t[0].toFixed(5)&&i[1].toFixed(5)==t[1].toFixed(5))return o}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);var n=updateMapMarkers();if(null!=n&&(t||1==n[4])){var o=(n[0]+n[2])/2,i=(n[1]+n[3])/2,s=Math.max(Math.abs(n[0]-n[2]),Math.abs(n[1]-n[3])),a=xxmap.map.getView();a.setCenter(ol.proj.transform([i,o],"EPSG:4326","EPSG:3857"));for(var r=360,l=-2;r>s;)l++,r/=2;a.setZoom(l)}}function placeNode(e){if(!xxdialogMode){var t='<div style=margin-bottom:6px><label for=selectnode-search>Søg</label>&nbsp&nbsp<input type=text placeholder="Enhedsnavn" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Ingen enheder fundet.</div>';for(var n in nodes)t+="<div class=noselect id="+nodes[n]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[n]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[n]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />',t+="<div class=j"+nodes[n].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[n].name+"</div></div>";setModalContent("xxAddAgent","Vælg en node at placere",t+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var n=document.getElementsByName("PlaceMapDeviceCheckbox");for(var o in n)if(n[o].checked){var i=getNodeFromId(n[o].id.substring(0,n[o].id.length-8));if(i){var s=xxmap.markersSource.getFeatureById(o),a=ol.proj.transform(t,"EPSG:3857","EPSG:4326"),r=[a[1],a[0]];if(s)s.getGeometry().setCoordinates(t),getActiveInteractions(s)?saveMarkerloc(s):meshserver.send({action:"changedevice",nodeid:i._id,userloc:r});else meshserver.send({action:"changedevice",nodeid:i._id,userloc:r})}}}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t=0;for(var n in nodes){var o=nodes[n].namel.indexOf(e)>=0||""==e||null!=nodes[n].rnamel&&nodes[n].rnamel.indexOf(e)>=0;o&&t++,QV(nodes[n]._id+"-rowid",o)}QV("noNodesMapPlace",0==t)}function selectNodeToPlace(e,t){if("PlaceMapDeviceCheckbox"!=e.target.name){var n=Q(t+"-checkid");n.checked=!n.checked}var o=document.getElementsByName("PlaceMapDeviceCheckbox"),i=0;for(var s in o)o[s].checked&&i++;QE("idx_dlgOkButton",i>0)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e=Q("mapSearchLocation").value.trim();if(e.length>0){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&formatSearchData(t.responseText)},t.open("GET","https://nominatim.openstreetmap.org/search?q="+e+"&format=json",!0),t.send()}}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),n=0,o='<div class="xmapItem">',i=0;i<t.length;i++)if(t[i].display_name&&t[i].boundingbox[0]&&t[i].boundingbox[1]&&t[i].boundingbox[2]&&t[i].boundingbox[3]){n++;o+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[i].display_name+"</div><div style=display:none>"+t[i].boundingbox[0]+"!#!"+t[i].boundingbox[1]+"!#!"+t[i].boundingbox[2]+"!#!"+t[i].boundingbox[3]+"</div></div>"}if(o+="</div>",1==n)zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]);else 0==n&&(o="<div style=width:200px>Ingen placering fundet.<div>"),QV("xmapSearchResultsDlg",!0);QH("xmapSearchResults",o)}catch(e){}}function mapGotoSelectedLocation(e){var t=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(t[2]),parseFloat(t[0]),parseFloat(t[3]),parseFloat(t[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var n=xxmap.map.getView();n.setCenter(e),n.setZoom(t)}function zoomToFitExtent(){if(xxmap.markersSource.getFeatures().length>0){var e=xxmap.markersSource.getExtent();xxmap.map.getView().fit(e,xxmap.map.getSize())}}function zoomToExtent(e){var t=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(t,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Rediger nodeplacering",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Fjern node lokation",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Gem nodeplacering",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Generel information",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Skrivebord",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminal",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Zoom ind for at tilpasse til området",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Zoom ud for at tilpasse til området",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Opdater",callback:function(){refreshMap(!0,!0)}},{text:"Zoom for at tilpasse til området",callback:function(){zoomToFitExtent()}},{text:"Centrer kortet her",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Placer node her",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,n,o){if(!o||3!=o.which&&2!=o.button){if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Konto sikkerhed",'Kan ikke få adgang til denne funktion, før en e-mailadresse er bekræftet. Dette er nødvendigt for gendannelse af adgangskode. Gå til fanen "Min konto" for at ændre og bekræfte en e-mailadresse.'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Konto sikkerhed",'Kan ikke få adgang til denne funktion, før to-faktor-godkendelse er aktiveret. Dette er nødvendigt for ekstra sikkerhed. Gå til fanen "Min konto" og se sektionen "Kontosikkerhed".'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(!o||1!=o.shiftKey&&2!=o.which&&1!=o.button){var i=getNodeFromId(e);if(null!=i){null!=currentNode&&currentNode._id==i._id&&1&i.conn||deviceDetailsStatsClear();var s=meshes[i.meshid],a=GetNodeRights(i),r=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=i._id||1==n){if(currentNode=i,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery){var l=currentNode.sessions.battery,d="";"ac"==l.state&&(d="Enheden er sat i"),"dc"==l.state&&(d="Enheden er batteridrevet");var c="",u=-1;"number"==typeof l.level&&l.level>=0&&l.level<=100&&(c=l.level+"%",(u=Math.floor((l.level+10)/25)+1)>5&&(lvl=5),"ac"==l.state&&(100==l.level?u=11:u+=5)),u>0&&(Q("p10deviceBattery").title=null!=d?d+", "+c:c,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+u)}else QV("p10deviceBattery",!1);var p,m=EscapeHtml(i.name);0==m.length&&(m="<i>Ingen</i>"),4&a&&(!s.flags||!(2&s.flags)||16&s.flags)&&(m='<span tabindex=0 title="Klik her for at redigere enhedsnavnet på serversiden" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+m+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),p=m,s&&(m+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(s.name)+"</span>"),QH("p10deviceName",m),QH("p11deviceName",m),QH("p12deviceName",m),QH("p13deviceName",m),QH("p14deviceName",m),QH("p15deviceName","Konsol -"+m),QH("p16deviceName",m),QH("p17deviceName",m),QH("p19deviceName",m);var g="<table style=width:100%>";8&args.hide&&(g+="<br />"+addDeviceAttribute("Navn",p)),s&&(g+=addDeviceAttribute('<span title="Navnet på den enhedsgruppe, som denne computer tilhører.">Gruppe</span>','<a href=# title="Navnet på den enhedsgruppe, som denne computer tilhører" onclick=gotoMesh("'+i.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[i.meshid].name)+"</a>")),null!=i.rname&&i.name!=i.rname&&(g+=addDeviceAttribute('<span title="Namnet på den här datorn, som anges i operativsystemet">OS-navn</span>','<span title="Namnet på den här datorn, som anges i operativsystemet">'+EscapeHtml(i.rname)+"</span>")),(1&features||4==i.mtype)&&3!=i.mtype||(g+=addDeviceAttribute("Hostnavn",addLinkConditional(i.host?EscapeHtml(i.host):"<i>Ingen</i>","showEditNodeValueDialog(1)",4&a)));var v=i.desc?EscapeHtml(i.desc):"<i>Ingen</i>";if(g+=addDeviceAttribute("Beskrivelse",4&a?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+v+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':v),4==i.mtype&&(null!=i.portnum&&(g+=addDeviceAttribute("Port Nummer",i.portnum)),null!=i.porttype&&(g+=addDeviceAttribute("Port Type",i.porttype))),null!=i.agent&&null!=i.agent.id&&3==i.mtype)4==i.agent.id&&(g+=addDeviceAttribute("Enhedstype","Windows")),6==i.agent.id&&(g+=addDeviceAttribute("Enhedstype","Linux")),29==i.agent.id&&(g+=addDeviceAttribute("Enhedstype","Mac OS"));else if(null!=i.agent&&null!=i.agent.id&&null!=i.agent.ver){var h="";h=i.agent.id<=agentsStr.length?agentsStr[i.agent.id]:agentsStr[0],0!=i.agent.ver&&(h+=" v"+i.agent.ver),14==i.agent.id&&(h=i.agent.core),!1===i.agent.root&&1&i.conn&&(h+=", Begrænset"),g+=addDeviceAttribute("Mesh Agent",h)}if(null!=i.intelamt){h="";var f={0:nobreak("Ikke aktiveret (Pre)"),1:nobreak("Ikke aktiveret (In)"),2:nobreak("Aktiveret")};if(null!=i.intelamt.ver&&null==i.intelamt.state?h+="<i>Ukendt tilstand</i>, v"+EscapeHtml(i.intelamt.ver):null==i.intelamt.ver&&2==i.intelamt.state?h+="<i>Aktiveret</i>":null==i.intelamt.ver||null==i.intelamt.state?h+="<i>Ukendt version og tilstand</i>":(h+=f[i.intelamt.state],2==i.intelamt.state&&i.intelamt.flags&&(2&i.intelamt.flags?h+=' <span title="Intel&reg; AMT er aktiveret i Client Control Mode">CCM</span>':4&i.intelamt.flags&&(h+=' <span title="Intel&reg; AMT er aktiveret i Admin Control Mode">ACM</span>')),h+=", v"+EscapeHtml(i.intelamt.ver)),2==i.intelamt.state){1==i.intelamt.tls&&(h+=', <span title="Intel&reg; AMT er opsat med TLS-netværkssikkerhed">TLS</span>');var k=!1;if(null==i.intelamt.user||""==i.intelamt.user)4&a?(h+=', <i style=color:#FF0000;cursor:pointer title="Rediger Intel&reg; AMT-legitimationsoplysninger" onclick=editDeviceAmtSettings("'+i._id+'")>Ingen legitimationsoplysninger</i>',k=!0):h+=", <i style=color:#FF0000>Ingen legitimationsoplysninger</i>";else if(1&features2&&null!=i.intelamt.warn){var x=null;1&i.intelamt.warn&&(x="Ugyldige legitimationsoplysninger"),8&i.intelamt.warn&&(x="Prøver legitimationsoplysninger"),null!=x&&(4&a?(h+=', <i style=color:#FF0000;cursor:pointer title="Rediger Intel&reg; AMT-legitimationsoplysninger" onclick=editDeviceAmtSettings("'+i._id+'")>'+x+"</i>",k=!0):h+=", <i style=color:#FF0000>"+x+"</i>")}4&a&&!(1&features2)&&(k=!0),h+=" ",k&&(h+='<img src=images/link4.png height=10 width=10 title="Rediger Intel&reg; AMT-legitimationsoplysninger" style=cursor:pointer onclick=editDeviceAmtSettings("'+i._id+'")>')}var b='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>';"number"==typeof i.intelamt.sku&&(8&i.intelamt.sku?b='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':16&i.intelamt.sku&&(b='<span title="Intel&reg; Standard Manageability">Intel&reg; SM<span>')),g+=addDeviceAttribute(b,h)}if(null!=i.agent&&null!=i.agent.tag)(y=EscapeHtml(i.agent.tag)).startsWith("mailto:")&&(y='<a href="'+EscapeHtml(y)+'">'+EscapeHtml(y.substring(7))+"</a>"),g+=addDeviceAttribute("Agent Tag",y);else if(null!=i.intelamt&&null!=i.intelamt.tag){var y;(y=EscapeHtml(i.intelamt.tag)).startsWith("mailto:")&&(y='<a href="'+EscapeHtml(y)+'">'+EscapeHtml(y.substring(7))+"</a>"),g+=addDeviceAttribute("Intel&reg; AMT Tag",y)}if(i.osdesc&&(g+=addDeviceAttribute("Operativ system",i.osdesc)),i.wsc){var w=[];null!=i.wsc.antiVirus&&("OK"==i.wsc.antiVirus?w.push("AV - <span style=color:green>OK</span>"):w.push("AV - <span style=color:red>Ugyldig</span>")),null!=i.wsc.autoUpdate&&("OK"==i.wsc.autoUpdate?w.push("Opdatering - <span style=color:green>OK</span>"):w.push("Opdatering - <span style=color:red>Ugyldig</span>")),null!=i.wsc.firewall&&("OK"==i.wsc.firewall?w.push("Firewall - <span style=color:green>OK</span>"):w.push("Firewall - <span style=color:red>Ugyldig</span>")),g+=addDeviceAttribute("Windows Sikkerhed",w.join(", "))}if(i.defender){w=[];null!=i.defender.RealTimeProtection&&(1==i.defender.RealTimeProtection?w.push("RealTimeProtection - <span style=color:green>On</span>"):w.push("RealTimeProtection - <span style=color:red>slukket</span>")),null!=i.defender.TamperProtected&&(1==i.defender.TamperProtected?w.push("TamperProtection - <span style=color:green>On</span>"):w.push("TamperProtection - <span style=color:red>slukket</span>")),w.length>0&&(g+=addDeviceAttribute("Windows Defender",w.join(", ")))}if(i.av&&i.av.length>0){w=[];for(var S in i.av)if(i.av[S].product){var M=EscapeHtml(i.av[S].product);!0!==i.av[S].enabled&&(M+=" - <span style=color:red>Deaktiveret</span>"),!0!==i.av[S].updated&&(M+=" - <span style=color:red>Out of date</span>"),1==i.av[S].enabled&&1==i.av[S].updated&&(M+=" - <span style=color:green>OK</span>"),w.push(M)}g+=addDeviceAttribute("Antivirus",w.join("<br />"))}if(i.users&&i.users.length>0){var C=i.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Låst",i.lusers&&i.lusers.indexOf(e)>=0)}).join(", ");g+=addDeviceAttribute(i.users.length>1?"Aktive brugere":"Aktive bruger",C)}if(null!=i.agent&&14!=i.agent.id&&3!=i.mtype){var A=[],D=0;i.consent&&(D=i.consent),serverinfo.consent&&(D|=serverinfo.consent),64&D&&8&D?A.push("Skrivebords Prompt + Værktøjslinje"):64&D?A.push("Skrivebords værktøjslinje"):8&D?A.push("Prompt på skrivebordet"):1&D&&A.push("Skrivebordsnotifikation"),16&D?A.push("Terminal Prompt"):2&D&&A.push("Terminalbesked"),32&D?A.push("Filer Prompt"):4&D&&A.push("Filer Notifikation"),7==D&&(A=["Altid besked"]),56&~D||(A=["Spørg altid"]),""==(A=A.join(", "))&&(A="<i>Ingen</i>"),g+=addDeviceAttribute("Brugersamtykke",addLinkConditional(A,"p20editmeshconsent(3)",1&a))}var T=[];if(null!=userinfo.notify&&null!=userinfo.notify[i._id]){var E=userinfo.notify[i._id];if(2&E&&T.push("Forbind"),4&E&&T.push("Afbryd"),null!=i.intelamt&&8&E&&T.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var I=0;16&E&&I++,32&E&&I++,64&E&&I++,I>0&&T.push(format("Email ({0})",I))}if(null!=userinfo.msghandle&&33554432&features2){I=0;128&E&&I++,256&E&&I++,512&E&&I++,I>0&&T.push(format("Messaging ({0})",I))}}""==(T=T.join(", "))&&(T="<i>Ingen</i>"),g+=addDeviceAttribute("Beskeder",addLink(T,"p20editDeviceNotify()"));var N=i.conn;if(N&&N>1){var _=[];1&i.conn&&_.push('<span title="Mesh agent er tilsluttet og klar til brug.">Mesh Agent</span>'),2&i.conn?_.push('<span title="Intel&reg; AMT CIRA forbundet og klar til brug">Intel&reg; AMT CIRA</span>'):4&i.conn&&_.push('<span title="Intel&reg; AMT er routbar og klar til brug.">Intel&reg; AMT</span>'),8&i.conn&&_.push('<span title="Mesh-agent kan nås ved at bruge en anden agent som relæ.">Mesh Relæ</span>'),16&i.conn&&_.push('<span title="MQTT forbindelsen til enheden er aktiv.">MQTT</span>'),g+=addDeviceAttribute("Forbindelse",_.join(", "))}var V="<i>Ingen</i>";if(null!=i.tags)for(var S in V="",i.tags)V+="<span class=tagSpan>"+EscapeHtml(i.tags[S])+"</span> ";if(g+=addDeviceAttribute("Tags",4&a?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+V+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+V+"</span>"),null!=i.ssh||null!=i.rdp){w=[];4&a?(null!=i.ssh&&w.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==i.ssh?"SSH-bruger+pas":2==i.ssh?"SSH-bruger+nøgle+pas":"SSH-bruger+nøgle")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=i.rdp&&w.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=i.ssh&&w.push(1==i.ssh?"SSH-bruger+pas":2==i.ssh?"SSH-bruger+nøgle+pas":"SSH-bruger+nøgle"),null!=i.rdp&&w.push("RDP")),g+=addDeviceAttribute("Legitimationsoplysninger",w.join(", "))}var U=[];for(var S in meshes)meshes[S].relayid==i._id&&U.push('<a href=# onclick=gotoMesh("'+meshes[S]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[S].name)+"</a>");if(U.length>0&&(g+=addDeviceAttribute('<span title="Enhedsgrupper denne enhed er et relæ for">Relæ for</span>',U.join(","))),g+="</table><br />",262220&a&&i.mtype<3&&(null==i.agent||34!=i.agent.id)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Handlinger" title="Udfør strømhandlinger på enheden" onclick=deviceActionFunction() />'),g+='<input type=button class="btn btn-primary btn-sm me-2" value="Noter" title="Se noter om denne enhed" onclick=showNotes('+!(128&a)+',"'+encodeURIComponentEx(i._id)+'") />',g+='<input type=button class="btn btn-primary btn-sm me-2" value="Log hændelse" title="Skriv en hændelse for denne enhed" onclick=writeDeviceEvent("'+encodeURIComponentEx(i._id)+'") />',2==i.mtype&&1&N&&131072&a&&(g+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Run" title="Kør kommandoer på denne enhed." onclick=runDeviceCmd("'+encodeURIComponentEx(i._id)+'") />'),4!=i.mtype){if((8&a&&1&N&&16384&a||1==i.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Meddelelse" title="Vis en tekstmeddelelse på fjernenheden" onclick=deviceMessageFunction() />'),(8&a&&1&N&&16384&a||1==i.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Chat" title="Åbn chatvinduet til denne computer" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&a&&1&N)for(var S in serverinfo.altmessenging){var F=serverinfo.altmessenging[S];null!=F.type&&"device"!=F.type||(g+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[S].name)+'" onclick=altDeviceChat(event,'+S+") />")}!(!1!==serverinfo.guestdevicesharing&&null!=i.agent&&3&i.agent.caps&&1&N)||524296&~a||4294967295!=a&&4096&a?QV("DeskGuestShareButton",!1):(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Del" title="Opret et link for at dele denne enhed med en gæst" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0))}if(4==i.mtype&&1&N&&("PDU"==i.porttype?1==i.pwr?262144&a&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Sluk" title="Sluk" onclick=setIpPduState(0) />'):8==i.pwr&&64&a&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Tænd" title="Tænd" onclick=setIpPduState(1) />'):8&a&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Fjernkontrol" title="Fjernkontrol" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(i._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var S in customui.devicebuttons)(null==customui.devicebuttons[S].showif||null!=s&&customui.devicebuttons[S].showif==s._id||customui.devicebuttons[S].showif==currentNode._id)&&(g+='<input id="cui:'+S+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[S].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",g),mainUpdate(256);var R=4294967295==a||!(65536&a),B=4294967295==a||!(512&a),H=4294967295==a||!(1024&a),O=4294967295==a||!(2048&a);if(g='<div class="p10html3right">',1&a&&4!=i.mtype&&(g+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+i._id+'"]) title="Flyt denne enhed til en anden enhedsgruppe">Skift gruppe</a>'),32768&a&&(g+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+i._id+'") title="Fjern denne enhed">Slet enhed</a>'),g+='</div><div class="p10html3left">',i.agent&&3!=i.mtype&&1048576&a&&(g+='<a href=# onclick=p10showNodeNetInfoDialog("'+i._id+'") title="Vis oplysninger om enhedens netværksinterface">Interfaces</a>&nbsp;'),32768&features&&null!=xxmap&&(g+='<a href=# onclick=p10showNodeLocationDialog("'+i._id+'") title="Vis oplysninger om enhedsplaceringer">Lokation</a>&nbsp;'),null==i.agent||14!=i.agent.id&&34!=i.agent.id){if(4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||B&&8&a&&null!=i.agent&&14!=i.agent.id&&(g+='<a href=# onclick=p10showMeshCmdDialog(1,"'+i._id+'") title="Trafikrouter bruges til at oprette forbindelse til en enhed via denne server.">MeshCmd</a>&nbsp;'),!(0===args.xterm&&i.agent&&2&i.agent.caps&&8&a)||4294967295!=a&&512&a||(g+='<a href=# onclick=p10openxterm(event,"'+i._id+'") title="Åben XTerm terminal">XTerm</a>&nbsp;'),(1&N||3==i.mtype)&&i.agent&&8&a&&(0!=webRelayPort&&(g+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+i._id+'",1,'+(i.httpport?i.httpport:80)+")>HTTP"+(i.httpport&&80!=i.httpport?"/"+i.httpport:"")+"</a>&nbsp;",g+='<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+i._id+'",2,'+(i.httpsport?i.httpsport:443)+")>HTTPS"+(i.httpsport&&443!=i.httpsport?"/"+i.httpsport:"")+"</a>&nbsp;"),i.agent.id>0&&i.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(g+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+i._id+'",3) title="Kræver installation af MeshCentral Router.">RDP'+(i.rdpport&&3389!=i.rdpport?"/"+i.rdpport:"")+"</a>&nbsp;")),i.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",4,'+(i.sshport?i.sshport:22)+') title="Kræver installation af MeshCentral Router.">SSH'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",5,'+(i.sshport?i.sshport:22)+') title="Kræver installation af MeshCentral Router.">SCP'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var S in serverinfo.devicemeshrouterlinks.extralinks){var P=serverinfo.devicemeshrouterlinks.extralinks[S],L='"'+P.protocol+'"';if(doesDeviceMatchFilterTags(i,P.filter)){if("number"==typeof P.protocol?L=P.protocol:"http"==P.protocol?L=1:"https"==P.protocol?L=2:"rdp"==P.protocol?L=3:"ssh"==P.protocol?L=4:"scp"==P.protocol?L=5:"mcrdesktop"==P.protocol?L=6:"mcrfiles"==P.protocol&&(L=7),(6==L||7==L)&&2!=i.mtype)continue;g+='<a href=# onclick=p10MCRouter("'+i._id+'",'+L+","+P.port+(P.ip?',"'+P.ip+'"':",null")+","+(P.localport?P.localport:0)+') title="Kræver installation af MeshCentral Router.">'+P.name+"</a>&nbsp;"}}(1&N||3==i.mtype)&&i.agent&&8&a&&!(536870912&features)&&(g+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+i._id+'") title="Start webbaseret VNC-session til denne enhed.">Web-VNC</a>&nbsp;'),(1&N||3==i.mtype)&&i.agent&&8&a&&!(1073741824&features)&&(g+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+i._id+'") title="Start webbaseret RDP-session til denne enhed.">Web-RDP</a>&nbsp;'),512&features2&&(1&N||3==i.mtype)&&i.agent&&8&a&&(g+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+i._id+'") title="Start webbaseret SSH-session til denne enhed.">Web-SSH</a>&nbsp;'),4294967295==a&&4194304&features&&(g+='<a href=# onclick=p10showMqttLoginDialog("'+i._id+'") title="Hent MQTT-loginoplysninger til denne enhed.">MQTT Login</a>&nbsp;')}g+="</div><br>",3==i.mtype?(QH("p10html3",""),QH("p10html5",g)):(QH("p10html3",g),QH("p10html5",""));var j=PowerStateStr(i.state),K="";null!=i.agent&&!1===i.agent.root&&(K=', <span title="Agent kører på fjernenhed med reducerede rettigheder.">Begrænset</span>'),1&N&&(j.length>0&&(j+="<br/>"),4==i.mtype?"PDU"==i.porttype?j+='<span style=font-size:12px title="Switch port forbundet">Switch port forbundet</span>'+K:j+='<span style=font-size:12px title="IP-KVM port forbundet">IP-KVM port forbundet</span>'+K:j+='<span style=font-size:12px title="Agent tilsluttet">Agent tilsluttet</span>'+K),2&N?(j.length>0&&(j+="<br/>"),j+='<span style=font-size:12px title="Intel&reg; AMT forbundet">Intel&reg; AMT forbundet</span>'):4&N&&(j.length>0&&(j+="<br/>"),j+='<span style=font-size:12px title="Intel&reg; AMT detekteret">Intel&reg; AMT detekteret</span>'),16&N&&(j.length>0&&(j+="<br/>"),j+='<span style=font-size:12px title="MQTT forbundet">MQTT channel forbundet</span>'),""==j&&i.lastconnect?j="<span style=font-size:12px>Sidst sete:<br />"+printDateTime(new Date(i.lastconnect))+"</span>":("PDU"==i.porttype||i.pwr>1&&7!=i.pwr)&&(j+="<br/>"+powerStateStrings[i.pwr]),QH("MainComputerState",j),Q("MainComputerImage").setAttribute("src","images/icons256-"+i.icon+"-1.png"),Q("MainComputerImage").className=i.conn&&0!=i.conn||3==i.mtype?"":"gray",3==i.mtype&&null!=i.agent&&i.agent.id>4&&512&features2&&(i.agent.caps=6),B&&setupTerminal(),H&&setupFiles();var G=!!(16&a);G?setupConsole():15==t&&(t=10),QV("MainDevDesktop",R&&(null==i.agent&&null!=i.intelamt&&("number"!=typeof i.intelamt.sku||!!(8&i.intelamt.sku))||null!=i.agent&&(null==i.agent.caps||!!(1&i.agent.caps)||i.intelamt&&2==i.intelamt.state)||3==i.mtype&&(3==i.agent.id||4==i.agent.id))&&(8&a||256&a)),QV("MainDevTerminal",(null==i.agent&&null!=i.intelamt||i.agent&&null==i.agent.caps||i.agent&&!!(2&i.agent.caps)||i.intelamt&&2==i.intelamt.state)&&8&a&&B),QV("MainDevFiles",null!=i.agent&&null!=i.agent.caps&&!!(4&i.agent.caps)&&8&a&&H),QV("MainDevInfo",i.mtype<3&&!!(1048576&a)),QV("MainDevAmt",null!=i.intelamt&&(2==i.intelamt.state||2&i.conn)&&8&a&&O),QV("MainDevConsole",G&&null!=i.agent&&null!=i.agent.caps&&!!(8&i.agent.caps)&&8&a),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=i.agent&&null!=i.agent.caps&&!!(16&i.agent.caps)),QH("p15coreName",null!=i.agent&&null!=i.agent.core?i.agent.core:""),null!=i.intelamt&&"number"==typeof i.intelamt.sku&&16&i.intelamt.sku?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT"));var z=Q("p14iframe").contentWindow.getCurrentMeshNode();null!=z&&z._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect();var W=!!(6&i.conn);if(Q("p14iframe").contentWindow.setConnectionState(W),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&xxcurrentView>=10&&xxcurrentView<20?currentNode.name+(s?" - "+s.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),r&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler){QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,n,o);var q=getstore("_curPluginPage",null);null!=q&&null!=Q("p19ph-"+q)&&pluginHandler.callPluginPage(q,Q("p19ph-"+q))}if(g="",7&a&&(g+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Tilføj bruger</button>',null!=usergroups)){var J=0,$=!1;for(var S in usergroups)null==usergroups[S].membershipType&&usergroups[S]._id.split("/")[1]==e.split("/")[1]&&(J++,null!=currentNode.links&&null!=currentNode.links[S]||($=!0));J>0&&$&&(g+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Tilføj brugergruppe</a>')}g+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Brugerautorisationer</th><th scope=col style=text-align:left></th></tr>';var X=1;if(null!=currentNode.links){var Z=[];for(var S in currentNode.links)(S.startsWith("user/")||S.startsWith("ugrp/"))&&Z.push(S);for(var S in Z.sort(),Z){var Y="",ee="",te=Z[S],ne=currentNode.links[te].rights,oe=EscapeHtml(te.split("/")[2]),ie=(ee=makeUserDeviceRightsString(ne),!1);null!=currentNode.links[te].name&&(oe=EscapeHtml(currentNode.links[te].name)),te==userinfo._id&&(oe=EscapeHtml(userinfo.name)),null!=users&&null!=users[te]&&(oe=EscapeHtml(users[te].name)),null!=usergroups&&null!=usergroups[te]&&(oe=EscapeHtml(usergroups[te].name),ie=!0),2&a&&(ie?(Y="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Fjern brugergrupperettigheder til denne enhedsgruppe" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(Y="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Fjern brugerrettigheder til denne enhedsgruppe" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),null!=users&&(oe=ie?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+oe+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+oe+"</a>"),g+="<tr "+(++X%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(ie?"Brugergruppe":"Bruger")+'" class=m'+(ie?4:2)+"></div><div>&nbsp;"+oe+"<div></div></div></td><td style=width:70%><div style=float:right>"+Y+"</div><div>"+ee+"</div></td></tr>"}}if(1==X&&(g+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen brugere med særlige enhedstilladelser</i><div></div></div></td><td></td></tr>"),g+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&deviceShares.length>0){g+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktiv enhedsdeling</th><th scope=col style=text-align:left></th></tr>',X=1;for(S=0;S<deviceShares.length;S++){var se=deviceShares[S];Y="";null!=se.url&&(Y+='<a href="'+se.url+'" rel="noreferrer noopener" target=_blank title="Enhedsdelings link" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),Y+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(se.publicid)+'","'+encodeURIComponentEx(se.guestName)+'")\' title="Fjern enhedsdeling" class="fa-fw fa-solid fa-trash text-danger"></i>';var ae="";se.p<=7?ae=["","Terminal","Skrivebord","Skrivebord + Terminal","Filer","Terminal + filer","Skrivebord + Filer","Skrivebord + Terminal + Filer"][se.p]:8==se.p?ae="HTTP/"+se.port:16==se.p&&(ae="HTTPS/"+se.port);var re=ae;null!=se.startTime&&null!=se.expireTime&&(re=format("{0}, {1} til {2}",ae,printFlexDateTime(new Date(se.startTime)),printFlexDateTime(new Date(se.expireTime)))),null!=se.startTime&&null!=se.duration&&(re=se.duration<2?format("{0}, {1} i {2} minut",ae,printFlexDateTime(new Date(se.startTime)),se.duration):format("{0}, {1} i {2} minutter",ae,printFlexDateTime(new Date(se.startTime)),se.duration)),1==se.recurring&&(re+=", Tilbagevendende dagligt"),2==se.recurring&&(re+=", Tilbagevendende ugentligt"),2&se.p&&!0===se.viewOnly&&(re+=", Vis kun skrivebord"),null!=se.consent&&(0==se.consent?re+=", Ingen samtykke":(56&se.consent&&(re+=", Bed om samtykke"),64&se.consent&&(re+=", Værktøjsfelt")));var le=EscapeHtml(se.guestName);se.publicid.startsWith("AS:node/")&&(le="<i>Agent selv-deling</i>"),g+="<tr "+(++X%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+le+"<div></div></div></td><td style=width:70%><div style=float:right>"+Y+"</div><div>"+re+"</div></td></tr>"}g+="</tbody></table>"}QH("p10html4",g);var de="";if(!(268435456&features)&&xxcurrentView>=10&&xxcurrentView<=19&&null!=currentNode){for(var S in de="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)de+="&"+S+"="+urlargs[S];try{window.history.replaceState({},document.title,window.location.pathname+de)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),t||(t=10),go(t)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Power Operation","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Power Operation","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified?1:0;userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]);var n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Websidemeddelelser</div>';return n+='<div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Enhedsforbindelser</label></div>',n+='<div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Enheds afbrydelser</label></div>',null!=currentNode.intelamt&&(t+=2,n+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Intel&reg; AMT desktop og serial hændelser</label></div>'),1&t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">E-mail notifikationer</div>',n+='<div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Enhedsforbindelser</label></div>',n+='<div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Enheds afbrydelser</label></div>',n+='<div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',n+='<div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Enhedsforbindelser</label></div>',n+='<div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Enheds afbrydelser</label></div>',n+='<div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),setModalContent("xxAddAgent","Beskedindstillinger",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editDeviceNotifyEx(e,t){var n=0;n+=Q("p20notifyIntelDeviceConnect").checked?2:0,n+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,2&t&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0,n+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,n+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(n+=Q("p20emsgDeviceConnect").checked?128:0,n+=Q("p20emsgDeviceDisconnect").checked?256:0,n+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:n})}function makeUserDeviceRightsString(e){if(57592==e)return"Fuld enhedsrettigheder";var t=[];if(8&e){var n=[];256&e&&n.push("Ingen input"),512&e&&n.push("Ingen Terminal"),1024&e&&n.push("Ingen filer"),2048&e&&n.push("Ingen AMT"),4096&e&&n.push("Begrænset input"),65536&e&&n.push("Ingen skrivbord"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Gæste share"),n.length>0?t.push("Control ("+n.join(", ")+")"):t.push("Kontrollér")}return 16&e&&t.push("Konsol"),32&e&&t.push("Server Filer"),64&e&&t.push("Vække"),128&e&&t.push("Noter"),8192&e&&t.push("Begræns hændelser"),16384&e&&t.push("Chat"),32768&e&&t.push("Afinstaller"),131072&e&&t.push("Kommandoer"),262144&e&&t.push("Nulstil/Sluk"),524288&e&&t.push("Deling"),1048576&e&&t.push("Detaljer"),2097152&e&&t.push("Relay"),0==t.length?"Ingen rettigheder":t.join(", ")}function makeDeviceGroupRightsString(e){if(4294967295==e)return"Fuld rettigheder";var t=[];if(1&e&&t.push("Rediger Gruppe"),2&e&&t.push("Administrer brugere"),4&e&&t.push("Administrer enheder"),8&e){var n=[];256&e&&n.push("Ingen input"),512&e&&n.push("Ingen Terminal"),1024&e&&n.push("Ingen filer"),2048&e&&n.push("Ingen AMT"),4096&e&&n.push("Begrænset input"),65536&e&&n.push("Ingen skrivbord"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Gæste share"),n.length>0?t.push("Control ("+n.join(", ")+")"):t.push("Kontrollér")}return 16&e&&t.push("Konsol"),32&e&&t.push("Server Filer"),64&e&&t.push("Vække"),128&e&&t.push("Noter"),8192&e&&t.push("Begræns hændelser"),16384&e&&t.push("Chat"),32768&e&&t.push("Afinstaller"),131072&e&&t.push("Kommandoer"),262144&e&&t.push("Nulstil/Sluk"),524288&e&&t.push("Deling"),1048576&e&&t.push("Detaljer"),2097152&e&&t.push("Relay"),0==t.length?"Ingen rettigheder":t.join(", ")}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Tilføj enhedsbegivenhed","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Dette vil tilføje en post til denne enheds hændelseslog.<span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){if(!xxdialogMode){null==t&&(t=encodeURIComponentEx("p"+userinfo._id));var n="<textarea id=d2devNotes ro="+e+" noteid="+t+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>';t.startsWith("node%2F%2F")&&(n+="<span style=font-size:10px>Enhedsgruppenoter kan ses og ændres af andre enhedsgruppeadministratorer.<span>"),"true"===showNotesPanel&&(n+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Noter",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)})}}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){if(!xxdialogMode){var t=decodeURIComponent(e).split("/")[2];safeNewWindow("/ipkvm.ashx/"+t+"/","ipkvm:"+t)}}function deviceChat(e){if(!xxdialogMode){var t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name;""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&2&features2&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)})}}function altDeviceChat(e,t){if(!xxdialogMode){var n=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),o=encodeURIComponentEx(userinfo._id.split("/")[2]),i=encodeURIComponentEx(userinfo._id.split("/").join("-")),s=o,a=i;null!=userinfo.realname&&(s=encodeURIComponentEx(userinfo.realname.split(" ").join("")),a=encodeURIComponentEx(userinfo.realname.split(" ").join("-")));var r=n=n.split("{4}").join(o).split("{5}").join(i).split("{6}").join(s).split("{7}").join(a);"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(o).split("{5}").join(i).split("{6}").join(s).split("{7}").join(a)),""!=n&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:n}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560")}}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Åbn side på enhed",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&e.length>7||e.startsWith("https://")&&e.length>8)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Enhedsbesked","<div style=margin-bottom:4px>Vis en beskedboks på fjernenheden.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Vis besked, indtil den afvises af brugeren</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus()}}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){if(null!=desktop&&3==desktop.State)if(desktop.m.getClipboard){var e=desktop.m.getClipboard();null!=e&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})}else meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2})}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Fjernindtastning låst",1==e?"Lås fjernbrugerens mus og tastatur?":"Låse fjernbrugerens mus og tastatur op?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Enhedsmeddelelse",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Toastmeddelelse</option><option value=1>Meddelelsesboks</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Titel" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Vis besked, indtil den afvises af brugeren</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus()}}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=parseFloat(Q("d2notifyTimeout").value);0!=n.length&&(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(o)&&(o=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:n,timeout:6e4*o}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:n}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:n}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Lås computer","Lås brugerens skrivebord?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t="",n="Opretter et link, der giver en gæst uden en konto mulighed for at fjernstyre denne enhed i en begrænset periode.<br /><br />";n+=addHtmlFormFloating("Gæstenavn",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />');var o="<option value=2>Skrivebord</option>";4294967295!=e&&256&e&&(o="");var i="<option value=1>Terminal</option>";4294967295!=e&&512&e&&(i="");var s="<option value=4>Filer</option>";4294967295!=e&&1024&e&&(s="");var a="<option value=5>Skrivebord + Filer</option>";4294967295!=e&&1280&e&&(a="");var r="<option value=6>Terminal + filer</option>";4294967295!=e&&1536&e&&(r="");var l="<option value=7>Skrivebord + Terminal + Filer</option>";4294967295!=e&&1792&e&&(l="");var d="";0!=webRelayPort&&(d="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=e&&8&e&&(d=""));t="";var c="";1&~currentNode.agent.caps||(t+=o+"<option value=3>Skrivbord, Vis kun</option>"),2&~currentNode.agent.caps||(t+=i),4&~currentNode.agent.caps||(t+=s),5&~currentNode.agent.caps||(t+=a),6&~currentNode.agent.caps||(t+=r),7&~currentNode.agent.caps||(t+=l),n+=addHtmlFormFloating("Type",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(t+=d)+"</select>");var u={1:"1 minut",5:"5 minutter",10:"10 minutter",15:"15 minutter",30:"30 minutter",45:"45 minutter",60:"60 minutter",120:"2 timer",240:"4 timer",480:"8 timer",720:"12 timer",960:"16 timer",1440:"24 timer",2880:"2 dage",5760:"4 dage",0:"Ubegrænset"};for(var p in t="",u)(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(t+="<option value="+p+">"+u[p]+"</option>"),p>0&&p<=720&&(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(c+="<option value="+p+">"+u[p]+"</option>");n+=addHtmlFormFloating("Gyldighed",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>Starter nu</option><option value=1>Tidsinterval</option><option value=2>Tilbagevendende dagligt</option><option value=3>Tilbagevendende ugentligt</option></select>'),n+="<div id=d2modenow>",n+=addHtmlFormFloating("Udløbstid",'<select id=d2inviteExpire class="form-select">'+t+"</select>"),n+="</div><div id=d2moderange style=display:none>",n+=addHtmlFormFloating("Tidsintervalstart",'<input id=d2timeRangeStartSelector class="flatpickr form-select" type="text" placeholder="Vælg dato og tid..." data-id="altinput">'),n+=addHtmlFormFloating("Tidsinterval",'<input id=d2timeRangeEndSelector class="flatpickr form-select" type="text" placeholder="Vælg dato og tid..." data-id="altinput">'),n+="</div><div id=d2moderecurring style=display:none>",n+=addHtmlFormFloating("Starttid",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Vælg dato og tid..." data-id="altinput">'),n+=addHtmlFormFloating("Varighed",'<select id=d2inviteDuration class="form-select">'+c+"</select>"),n+="</div>",1&currentNode.agent.caps&&(n+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Brugersamtykke",'<select id=d2userConsent class="form-select"><option value=0>Giv kun besked<option value=1>Bed om samtykke</option><option value=2>No Consent</option></select>')+"</div>"),n+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>",n+="<div id=d2httpsPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>",xxdialogButtons=3,setModalContent("xxAddAgent","Del enhed",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showShareDeviceEx("",xxdialogTag)),showShareDeviceValidate();var m=new Date;m.setDate(m.getDate()+1);var g=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,n){v.set("minDate",t),v.selectedDates[0]&&v.selectedDates[0]<e[0]&&v.clear()}}),v=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,minDate:m,defaultDate:m,minuteIncrement:1,plugins:[new confirmDatePlugin({})]}),h=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:g,rangeEnd:v,start:h}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",Q("d2timeRange").value>=2);var e=!0;if(8==Q("d2shareType").value){var t=parseInt(Q("d2httpPort").value);(Q("d2httpPort").value!=t||t<1||t>65535)&&(e=!1)}if(9==Q("d2shareType").value){t=parseInt(Q("d2httpsPort").value);(Q("d2httpsPort").value!=t||t<1||t>65535)&&(e=!1)}0==Q("d2inviteName").value.trim().length&&(e=!1),QE("idx_dlgOkButton",e)}function showShareDeviceEx(e,t){var n=0,o=parseInt(Q("d2shareType").value),i=!1,s=0;8!=o?9!=o?(3==o&&(i=!0),1&(s=[0,1,2,2,4,6,5,7][o])&&(n|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=16),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),2&s&&(n|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=8),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),4&s&&(n|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=32),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:s,expire:parseInt(Q("d2inviteExpire").value),consent:n,viewOnly:i}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:s,start:Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3),end:Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),consent:n,viewOnly:i}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:s,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:n,viewOnly:i})):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0})}function deviceActionFunction(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t=0,n="Vælg en handling, der skal udføres på denne enhed.<br /><br />",o="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",i="";null!=currentNode.agent&&14==currentNode.agent.id?1&currentNode.conn&&8&e&&(t++,o+="<option value=400>Flash</option>",o+="<option value=401>Vibrere</option>",i+="<div id=d2devicetimediv>"+addHtmlFormFloating("Tid","<select id=d2devicetime class=form-select><option value=1000>1 sekund</option><option value=5000>5 sekunder</option><option value=10000>10 sekunder</option></select>")+"</div>"):(64&e&&(t++,o+="<option value=100>Væk</option>"),1&currentNode.conn&&131072&e&&(t++,o+="<option value=106>Kør kommandoer</option>"),0!=currentNode.conn&&262144&e&&(t++,o+="<option value=4>Slumretilstand</option><option value=3>Nulstil</option><option value=2>Sluk</option>"),16&currentNode.conn&&(t++,o+="<option value=103>Send MQTT-besked</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&262144&e&&(t++,o+="<option value=310>Intel&reg; AMT Reset</option>",o+="<option value=308>Intel&reg; AMT Sluk</option>",11!=xxcurrentView&&12!=xxcurrentView||(o+="<option value=312>Intel&reg; AMT Reset to BIOS</option>",o+="<option value=311>Intel&reg; AMT Power on to BIOS</option>",o+="<option value=315>Intel&reg; AMT Power on to PXE</option>",o+="<option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&64&e&&(t++,o+="<option value=302>Intel&reg; AMT Tænd</option>"),(11==xxcurrentView||12==xxcurrentView)&&getNodeAmtVersion(currentNode)>=15&&2==currentNode.intelamt.state&&6&currentNode.conn&&4294967295==e&&!(1024&features)&&(t++,o+="<option value=107>Intel&reg; AMT One Click Recovery</option>"),1&currentNode.conn&&32768&e&&(t++,o+="<option value=104>Afinstaller agent</option>")),n+=addHtmlFormFloating("Funktion",o+="</select>"),0==t&&(n="Der er i øjeblikket ingen tilgængelige handlinger for denne enhed."),xxdialogButtons=0==t?2:3,xxdialogTag=n+i,setModalContent("xxAddAgent","Enhedshandling",n),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),t>0&&deviceActionFunctionValidate()}}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t=!1,n=!1;if(currentNode.agent&&(currentNode.agent.id>0&&currentNode.agent.id<5?t=!0:n=!0),1==t||1==n){var o="Kør kommandoer på udvalgte enheder.<br />";1==t&&(o+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px>",o+="<option value=1>Windows Command Prompt</option><option value=2>Windows PowerShell</option>",1==n&&(o+="<option value=3>Linux / BSD / macOS Command Shell</option>"),o+="</select>"),o+="<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Kør som agent</option><option value=1>Kør som bruger, agent hvis ingen bruger</option><option value=2>Skal køre som bruger</option></select>",setModalContent("xxAddAgent","Kør kommandoer",o+="<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus()}}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Intel&reg; AMT One Click Recovery",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Vil du tænde for Intel&reg; AMT?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Udføre Intel&reg; AMT-nulstilling?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(311==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT power on to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})});else{if(312!=e)return 400==e||401==e?(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}),!0):(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0);setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT reset to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||xxcurrentView>19||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now();currentNode._id==powerTimelineNode&&(e=powerTimeline);var n=new Date;n.setHours(0,0,0,0);(n=new Date(n.getTime()-5184e5)).getTime();var o=[];if(null!=e&&e.length>1){o.push([0,e[1],e[0]]);for(var i=e[1],s=2;s<e.length;s+=2){var a=e[s],r=t;e.length>s+1&&(r=e[s+1]),o.push([i,i+r,a]),i+=r}}var l="",d=1,c=new Date,u=Q("column_l").offsetWidth-192;c.setHours(0,0,0,0);for(s=0;s<7;s++){var p="",m=c.getTime(),g=m+864e5;for(var v in o){var h=o[v];if(1==isTimeBlockInside(m,g,h[0],h[1])){var f=Math.max(m,h[0]),k=Math.min(Math.min(g,h[1]),t),x=Math.round((k-f)*u/864e5);if(x>0){var b=format("{0} fra {1} til {2}.",powerStateStrings2[h[2]],printTime(new Date(f)),printTime(new Date(k)));p+='<div class="pwState '+powerColor(h[2])+'" title="'+b+'" style="width:'+x+'px;"></div>'}}}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(c)+"<div></div></div></td><td><div>"+p+"</div></td></tr>",++d,c=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)}var y="";try{y="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Dag</th><th scope=col>7-dages strømtilstand<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+y+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Download strøm hændelser" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,n,o){return n<e&&o>t||(n>e&&n<t||o>e&&o<t)}function addDeviceAttribute(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${n[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,n){if(!xxdialogMode){var o="",i=getNodeFromId(e),s=3;4&GetNodeRights(i)&&(o+=addHtmlFormFloating("Brugernavn",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),o+=addHtmlFormFloating("Kodeord",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),1&features2||(o+=addHtmlFormFloating("Sikkerhed",'<select id=dp10tls class="form-select"><option value=0>Ingen TLS-sikkerhed</option><option value=1>TLS-sikkerhed påkrævet</option></select>')),null!=i.intelamt.user&&""!=i.intelamt.user&&(s=7),setModalContent("xxAddAgent","Rediger Intel&reg; AMT-legitimationsoplysninger",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(s,{node:i,func:t,arg:n})),null!=i.intelamt.user&&""!=i.intelamt.user?Q("dp10username").value=i.intelamt.user:Q("dp10username").value="admin",1&features2||(Q("dp10tls").value=i.intelamt.tls),validateDeviceAmtSettings())}}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){if(2==e)meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}});else{var n=Q("dp10username").value;""==n&&(n="admin");var o=Q("dp10password").value;""==o&&(n="");var i={action:"changedevice",nodeid:t.node._id,intelamt:{user:n,pass:o}};1&features2||(i.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(i),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3)}}function p10showSendMqttMsgDialog(e){if(xxdialogMode)return!1;var t=addHtmlFormFloating("Emne",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />');return setModalContent("xxAddAgent","Send MQTT besked",t+=addHtmlFormFloating("Meddelelse",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus(),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",Q("dp2topic").value.length>0&&Q("dp2msg").value.length>0)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){if(xxdialogMode)return!1;var t="";return t=e.length>1?format("Er du sikker på, at du vil afinstallere de valgte {0} agenter?",e.length):"Er du sikker på, at du vil afinstallere den valgte agent?",t+="<br /><br />",e.length>1?t+="Dette fjerner ikke enhederne fra serveren, men enhederne vil ikke længere være i stand til at oprette forbindelse til serveren. Al fjernadgang til enhederne vil gå tabt. Enhederne skal være tilsluttet, for at denne kommando kan fungere.":t+="Dette vil ikke fjerne denne enhed fra serveren, men enheden vil ikke længere være i stand til at oprette forbindelse til serveren. Al fjernadgang til enheden vil gå tabt. Enheden skal være tilsluttet, for at denne kommando kan fungere.",setModalContent("xxAddAgent","Afinstaller agent",t+='<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bekræft</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog(),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(xxdialogMode)return!1;var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var n='<select id=p10newGroup class="form-select">',o=0,i=[];for(var s in meshes){var a=GetMeshRights(s);meshes[s]._id!=t&&4&a&&i.push(meshes[s])}for(var s in i.sort(nameSort),i)o++,n+="<option value='"+i[s]._id+"'>"+i[s].name+"</option>";if(n+="</select>",o>0){var r=1==e.length?"Vælg en ny gruppe til denne enhed<br /><br />":"Vælg en ny gruppe for udvalgte enheder<br /><br />";setModalContent("xxAddAgent","Skift gruppe",r+=addHtmlFormFloating("Ny enhedsgruppe",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))}else setModalContent("xxAddAgent","Skift gruppe","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton");return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){if(xxdialogMode)return!1;var t=format("Er du sikker på, at du vil slette noden {0}?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bekræft</label>';return xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Slet Node",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog(),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,n,o){var i=null,s=getNodeFromId(e);if(3==s.mtype){var a=meshes[s.meshid];a&&a.relayid&&(i=a.relayid,o=s.host)}var r=serverinfo.name;(-1==r.indexOf(".")||2&features)&&(r=window.location.hostname),""!=webRelayDns&&(r=webRelayDns);var l="https://"+r+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+n+"&appid="+t+"&c="+authRelayCookie;return null!=o&&(l+="&addr="+o),null!=i&&(l+="&relayid="+i),safeNewWindow(l,"WebRelay"),!1}function p10MCRouter(e,t,n,o,i){var s=getNodeFromId(e),a=meshes[s.meshid];return 3==t&&null==n&&(n=null!=s.rdpport?s.rdpport:3389),3==s.mtype&&a&&a.relayid&&(e=a.relayid,o=s.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:n,ip:o,tag:"MCRouter",protocol:t,localport:i,name:a?a.name:null}),!1}function p10rfb(e,t){var n=getNodeFromId(e),o=null,i=meshes[n.meshid];null==t&&(t=null!=n.rfbport?n.rfbport:5900),3==n.mtype&&i&&i.relayid&&(e=i.relayid,o=n.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:o,tag:"novnc",name:i?i.name:null})}function p10mstsc(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.rdpport?n.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:o?o.name:null})}function p10ssh(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.sshport?n.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:o?o.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;var e=function(t){var n=[],o=["iploc","wifiloc","gpsloc","userloc"],i=null;for(var s in o)if(null!=currentNode[o[s]]){var a=currentNode[o[s]].split(","),r=parseFloat(a[0]),l=parseFloat(a[1]);if(r<90&&r>-90&&l<180&&l>-180){var d=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([l,r]))});d.setStyle(markerStyle(currentNode,parseInt(s)+1)),n.push(d),null==i?i=[r,l,r,l,0]:(r<i[0]&&(i[0]=r),l<i[1]&&(i[1]=l),r>i[2]&&(i[2]=r),l>i[3]&&(i[3]=l))}}var c=new ol.source.Vector({features:n}),u=new ol.layer.Vector({source:c}),p=0,m=0,g=8;if(null!=i){m=(i[0]+i[2])/2,p=(i[1]+i[3])/2;var v=Math.max(Math.abs(i[0]-i[2]),Math.abs(i[1]-i[3])),h=360;for(g=-2;h>v;)g++,h/=2}1==n.length&&(g=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),u],view:new ol.View({center:ol.proj.fromLonLat([p,m]),zoom:g})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",e)};document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",e);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Enhedsplacering","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Netværks interface","<div id=d2netinfo>Indlæser...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){if(!xxdialogMode){var e="<div>MeshCentral Router er et Windows-værktøj til kortlægning af TCP-porte. Du kan for eksempel RDP ind i en ekstern enhed via denne server.</div><br />";e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>',e+='<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>';var t=serverinfo.name;(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);e+='<br /><div class="alert alert-info">Kør MeshCentral Router og klik på "install" for at gøre det muligt at starte fra browseren.</div>',e+='<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Start MeshCentral Router" class="btn btn-primary btn-block" /></a>',setModalContent("xxAddAgent","MeshCentral Router",e+='<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")})}}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var n="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",o=getNodeFromId(t);if(null!=o)return[1,2,3,4,21,22].indexOf(o.agent.id)>=0?n+="&os=win":n+="&os=linux",urlargs.key&&(n+="&key="+urlargs.key),safeNewWindow(n,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){if(!xxdialogMode){0;var n="";0==e&&(n+="<div>MeshCmd er et kommandolinjeværktøj, der udfører mange forskellige operationer. Handlingsfilen kan eventuelt downloades og redigeres for at give serveroplysninger og legitimationsoplysninger.<br /><br />"),1==e&&(n+='<div>Download "meshcmd" med en handlingsfil for at dirigere trafik gennem denne server til denne enhed. Sørg for at redigere meshaction.txt og tilføje adgangskoden til din konto eller foretage de nødvendige ændringer.<br /><br />'),n+=addHtmlFormFloating("Operativ system","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64bit)</option><option value=29>macOS ARM (64bit)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"),n+=addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(n+=addHtmlValue("Handlings fil",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(n+=addHtmlValue("Handlings fil",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Download MeshCmd",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick()}}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 executable)"),4==e&&(t="MeshCmd (Win x86-64 executable)"),43==e&&(t="MeshCmd (Win ARM-64 executable)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS, x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){if(!xxdialogMode&&4&GetNodeRights(currentNode)){setModalContent("xxAddAgent","Ikonvalg",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0)}}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Rediger enhed","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Rediger enhed","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Enhedsnavn","Hostnavn","Beskrivelse","Tags"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Tag1, Tag2, Tag3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",n="",o=currentNode[showEditNodeValueDialog_modes2[e]];if(null==o&&(o=""),3==e){t="<select id=dp10devicevalue multiple maxlength="+showEditNodeValueDialog_modes4[e]+" class=form-control>";var i=[];for(var s in nodes)if(nodes[s].tags)for(var a in nodes[s].tags)-1==i.indexOf(nodes[s].tags[a])&&i.push(nodes[s].tags[a]);if(i.length>0)for(var s in i.sort(),i)n+=Array.isArray(o)&&-1!==o.indexOf(i[s])?"<option selected=selected>"+EscapeHtml(i[s])+"</option>":"<option>"+EscapeHtml(i[s])+"</option>";setModalContent("xxAddAgent","Edit Tags",t+=n+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Rediger enhed",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(o)&&(o=o.join(", ")),Q("dp10devicevalue").value=o;p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogEx(e,t){var n="",o={action:"changedevice",nodeid:currentNode._id};if(3==t){var i=$("#dp10devicevalue").select2("data");for(var s in i)n+=i[s].text.trim()+", ";o[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(n.slice(0,-2))}else o[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(o)}function p10editdevicevalueValidate(e,t){var n=e>1||Q("dp10devicevalue").value.length>0;QE("idx_dlgOkButton",n),null!=t&&1==n&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){if(desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktopNode=null,desktop=null),desktopNode!=currentNode||null==desktop){var e=multiDesktop[currentNode._id];if(null!=e){QH("DeskParent","");var t=e.m.CanvasId;t.setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},8192&features2&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]}else null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode;Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})}desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo,deskDisplayInfo(desktop.m,desktop.m.displays,desktop.m.selectedDisplay)),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0;null!=desktop&&(e=desktop.State);var t=GetNodeRights(currentNode),n=1==currentNode.agent?1:2;QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",!(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==n?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&!!(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&16&currentNode.intelamt.sku||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype));var o=!(8192&features2||null!=currentNode.agent&&14==currentNode.agent.id||4294967295!=t&&(!(8&t)||256&t||4096&t)),i=!!(1&currentNode.conn);QE("connectbutton1",i),QE("connectbutton1d",i),QE("connectbutton1r",i||3==currentNode.mtype),QE("connectbutton1rd",i||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport?currentNode.rdpport:3389)+"</a>"):QH("desktopCustomUpperRight","");var s=!!(6&currentNode.conn);QE("connectbutton1h",s),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",o&&currentNode.agent&&!!(6144&~features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&o),QE("DeskType",3==e),QV("DeskType",o),QE("DeskWD",3==e),QV("DeskWD",o),QV("deskkeys",o),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none";var a=desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard;QV("DeskClipboardOutButton",i&&o&&null!=desktop&&!(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=a||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&!(4096&features2)),QV("DeskClipboardInButton",i&&o&&null!=desktop&&!(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=a||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",!!(131072&t)&&i),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&!(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&!(1024&features2)),QV("DeskChatButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&i),QV("DeskNotifyButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&i),QV("DeskLockButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&o&&3==e),QV("DeskToolsButton",currentNode.agent&&i),QE("DeskToolsButton",o),QV("DeskOpenWebButton",0==browserfullscreen&&o&&currentNode.agent&&i),QV("DeskBackgroundButton",o&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&i),QV("DeskControlSpan",o),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==i&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){null==autoConnectDesktopTimer?autoConnectDesktopTimer=setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),autoConnectDesktopTimer=null)}var agentConsoleMessages=["","Venter på, at brugeren giver adgang...","Afslået","Kunne ikke starte fjernterminalsession, {0} ({1})","Timeout","Modtog ugyldige netværksdata","Kan ikke fange skærmbilledet","Protokolforhandling mislykkedes ({0})","NLA understøttes ikke","SSL kræves af serveren","SSL er ikke tilladt af serveren","SSL-certifikat er ikke på serveren","Inkonsekvente flag","Hybrid kræves af serveren","SSL med brugergodkendelse påkrævet af serveren"];function formatAgentConsoleMessage(e,t,n){for(null==n&&(n=[]);n.length<3;)n.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],n[0],n[1],n[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,n,o){if(!xxdialogMode)if(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop)if(desktopNode=currentNode,2==t){if(null==desktopNode.intelamt.user||""==desktopNode.intelamt.user)return void editDeviceAmtSettings(desktopNode._id,connectDesktop,2);(desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0!=e.length){var t=null;try{t=JSON.parse(e)}catch(e){}if(null!=t&&null!=t.action)if("restart"==t.action)webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}));else if("present"==t.action&&null==webRtcDesktop){webRtcDesktop={platform:t.platform};"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("DataChannel",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}else"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset)}else desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})))},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2}else null==t||1==t||3==t&&currentNode.agent.id>4&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=n&&(desktop.options.tsid=n),null!=o&&(desktop.options.consent=o),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,8192&features2&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:o}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport?currentNode.rdpport:3389,n),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()});else desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")}function askRdpCredentials(){if(!xxdialogMode){var e="<div>";1==currentNode.rdp?(e+=addHtmlFormFloating("Legitimationsoplysninger",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Brug serverlegitimationsoplysninger</option><option value=2>Brug nye legitimationsoplysninger</option></select>'),e+="<div id=d2cred style=display:none>"):e+="<div id=d2cred>",e+=addHtmlFormFloating("Domæne",'<input type=text id=d2domain class="form-control" maxlength=128 />'),e+=addHtmlFormFloating("Brugernavn",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'),e+=addHtmlFormFloating("Kodeord",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),4194304&features2||(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Husk legitimationsoplysninger</label>')),e+="</div>",e+=MoreStart(),e+=addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'),e+=addHtmlFormFloating("Arbejder Dir",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'),setModalContent("xxAddAgent","RDP-legitimationsoplysninger",e+=MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx())}}function askRdpCredentialsValidate(){1!=currentNode.rdp||(QV("d2cred",2==Q("d2mode").value),1!=Q("d2mode").value)?QE("idx_dlgOkButton",""!=Q("d2user").value):QE("idx_dlgOkButton",!0)}function askRdpCredentialsEx(){var e=null,t=null;if(desktopsettings.rdpsize)if("browser"==desktopsettings.rdpsize)e=window.innerWidth,t=window.innerHeight;else if("screen"==desktopsettings.rdpsize)e=window.screen.width,t=window.screen.height;else if("canvas"==desktopsettings.rdpsize)e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;else{var n=desktopsettings.rdpsize.indexOf("x");n>=1&&(e=parseInt(desktopsettings.rdpsize.substring(0,n)),t=parseInt(desktopsettings.rdpsize.substring(n+1)))}else e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;if(1==currentNode.rdp&&1==Q("d2mode").value)connectDesktop(null,4,{servercred:!0,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value});else{var o=!1;4194304&features2||(o=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:o,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value})}}function updateMetadata(e,t){var n="",o=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var i in e.metadata.users)o+=e.metadata.users[i];o>1&&(n="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} ser med",o)+"</span>")}QH("deskmetadata",n),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=null;if(1==e&&(t=desktop),t&&t.metadata){var n="";if(t.metadata.startTime&&(n+=addHtmlValue4("Starttid",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var o in t.metadata.users){var i=1==t.metadata.users[o]?"1 forbindelse":format("{0} forbindelser",t.metadata.users[o]);n+=addHtmlValue2(getUserName(o),i)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Session Information",n),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var n=t;3==n&&2==e.contype&&n++;var o=StatusStrs[n];switch(null!=desktop&&1==desktop.webRtcActive&&(o+=", WebRTC"),null!=desktop&&3==n&&4==desktop.contype&&(o+=", RDP"),QH("deskstatus",o),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Alle fokus",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:default:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,deskLastClipboardSent=null,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&desktop.latency.current>=0&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&terminal.latency.current>=0&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){if(!xxdialogMode){applyDesktopSettings(),updateDesktopButtons();var e=!1;("none"!=QS("td7meshkvm").display&&Q("td7meshkvm").className.indexOf("active")>0||"none"!=QS("td7rdpkvm").display&&Q("td7rdpkvm").className.indexOf("active")>0||"none"!=QS("td7amtkvm").display&&Q("td7amtkvm").className.indexOf("active")>0)&&(e=!0),0==e&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Indstillinger for fjernskrivebord",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged)}}function changeDesktopSettingsTab(e,t){var n,o,i;for(o=document.getElementsByClassName("tabcontent"),n=0;n<o.length;n++)o[n].style.display="none";for(i=document.getElementsByClassName("tablinks"),n=0;n<i.length;n++)i[n].className=i[n].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,putstore("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh())),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Alle fokus"),0!=desktop.State&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50))),4==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw))}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(var n in t)e+="<option value="+t[n]+">"+t[n]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,t.indexOf(parseInt(desktopsettings.quality))>=0&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(n=1;n<10;n++)5!=n&&(Q("d7rdp"+n).checked=!!(desktopsettings.rdpflags&1<<n-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);if(fullscreen=!fullscreen)QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("body")),browserfullscreen=!0);else{QC("body").remove("fulldesk");var n=args.hide;0==footerBar&&(n|=4);var o=(1&n?0:66)+(2&n?0:24)+(4&n?0:45)+(8&n?0:60);QS("deskarea3x").height="calc(100vh - "+(75+o)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+o)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+o)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+o)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)}deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Alle fokus","Lille fokus","Stort fokus"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,n=Q("Desk").height,o=Q("Desk").width;if(2==deskAspectRatio)QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden";else if(1==deskAspectRatio)QS("Desk")["margin-top"]="0px",QS("Desk").height=n+"px",QS("Desk").width=o+"px",QS("DeskParent").overflow="scroll";else{if(e/t>n/o){var i=n*t/o+"px";QS("Desk").height=i,QS("Desk").width="100%"}else{var s=o*e/n+"px";QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=s}QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden"}}function mdeskAdjust(e,t,n,o){if(e&&t&&n&&o){var i=Q("viewselect").value;if(3==i||5==i)if("Desk"!=o.id){if(5==i){var s=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];QS(o.id).width=(0!=e.State?t*s.y/n:s.x)+"px"}QS(o.id)["margin-top"]=null,QS(o.id)["margin-bottom"]=null}else deskAdjust()}}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){if(haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length){var t=e.dataTransfer.files[0],n=t.name.toLowerCase();if(n.endsWith(".bat")||n.endsWith(".ps1")||n.endsWith(".sh")||n.endsWith(".agentconsole"))d2runCommandDialog({nodeids:[currentNode._id],selectedFile:t});else if(n.endsWith(".txt")){var o=new FileReader;o.onload=function(e){showDeskType(e.target.result)},o.readAsText(t)}}}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);var t=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",t),QV("p11bigfail",!t)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e="",t=parseInt(Q("deskkeys").value);for(var n in""==t&&deskKeyboardShortcuts.length>0&&(t=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)e+="<option value="+deskKeyboardShortcuts[n]+(t==deskKeyboardShortcuts[n]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[n])+"</option>";QH("deskkeys",e)}var keyStrings={8:"BackSpace",9:"Tab",13:"Enter",27:"Escape",32:"Space",44:"Print Screen",45:"Indsæt",46:"Del",36:"Hjem",35:"Slut",33:"Page Up",34:"Page Down",37:"Venstre",38:"Op",39:"Ret",40:"Ned",0:"Ingen"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Shift"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),(e&=65535)>=112&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';for(var t in e+='<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Shift</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>',e+=" <select id=d2keySelect>",keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";e+="</select> <input type=button value=Tilføj onclick=addDeskCustomizeKey() /></div>",setModalContent("xxAddAgent","Tilpasning af tastaturgenveje",e+='<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e="";for(var t in deskKeyboardShortcuts){var n=keyShortcutTotext(deskKeyboardShortcuts[t]),o="";t!=deskKeyboardShortcuts.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[t]+")>"),0!=t&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[t]+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[t]+">"+n+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[t]+")>"+o+"</div>"}""==e&&(e="<i>Ingen tastaturgenveje defineret</i>"),QH("d2shortcuts",e)}function deskCustomizeKeyDown(e){var t=deskKeyboardShortcuts.indexOf(e),n=deskKeyboardShortcuts[t+1];deskKeyboardShortcuts[t+1]=deskKeyboardShortcuts[t],deskKeyboardShortcuts[t]=n,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var t=deskKeyboardShortcuts.indexOf(e),n=deskKeyboardShortcuts[t];deskKeyboardShortcuts[t]=deskKeyboardShortcuts[t-1],deskKeyboardShortcuts[t-1]=n,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t=[];for(var n in deskKeyboardShortcuts)deskKeyboardShortcuts[n]!=e&&t.push(deskKeyboardShortcuts[n]);deskKeyboardShortcuts=t,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var t in e)""!=e[t]&&deskKeyboardShortcuts.push(parseInt(e[t]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),e>0&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){if(!xxdialogMode){var e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';e+=addHtmlFormFloating("Navn",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),e+=addHtmlFormFloating("Værdi",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),setModalContent("xxAddAgent","Tilpasning af tastaturstrenge",e+=addHtmlFormFloating("",'<input id=d2addbutton type=button value=Tilføj onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate()}}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e="";for(var t in deskKeyboardStrings){var n="";t!=deskKeyboardStrings.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+t+")>"),0!=t&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+t+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(t+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[t].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+t+")>"+n+"</div>",e+="<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[t].v)+"</div>",e+="</div>"}""==e&&(e="<i>Ingen tastaturstrenge defineret</i>"),QH("d2strings",e)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e="";for(var t in deskKeyboardStrings){e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(t)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[t].n)+"</div>"}""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu2",e)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406!=e){var t=(16711680&e)>>16,n=65535&e,o=[],i=[],s={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(o.push([65505,1]),i.push([65505,0])),2&t&&(o.push([65513,1]),i.push([65513,0])),8&t&&(o.push([65507,1]),i.push([65507,0])),16&t&&(o.push([65511,1]),i.push([65511,0])),s[n]&&(n=s[n]),n>=65&&n<=90&&(n+=32),0!=n&&(o.push([n,1]),i.push([n,0])),i.reverse();for(var a=0;a<i.length;a++)o.push(i[a]);desktop.m.sendkey(o)}else{1&t&&(o.push([desktop.m.KeyAction.DOWN,16]),i.push([desktop.m.KeyAction.UP,16])),2&t&&(o.push([desktop.m.KeyAction.EXDOWN,18]),i.push([desktop.m.KeyAction.EXUP,18])),8&t&&(o.push([desktop.m.KeyAction.EXDOWN,17]),i.push([desktop.m.KeyAction.EXUP,17])),16&t&&(o.push([desktop.m.KeyAction.EXDOWN,91]),i.push([desktop.m.KeyAction.EXUP,91])),0!=n&&(o.push([desktop.m.KeyAction.DOWN,n]),i.push([desktop.m.KeyAction.UP,n])),i.reverse();for(a=0;a<i.length;a++)o.push(i[a]);desktop.m.SendKeyMsgKC(o)}}else desktop.m.sendcad()}}function showDeskType(e){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskType").blur();var t="<div>Indtast tekst, og klik på OK for at fjernskrive den. Sørg for at placere fjernbetjeningsmarkøren i den rigtige position, før du fortsætter.<div>";setModalContent("xxAddAgent","Fjernbetjening af tastaturet",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus()}}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,n,o=[],i=!1;if("string"==typeof e?(t=e,n=e.toUpperCase()):(t=Q("d2typeText").value,n=Q("d2typeText").value.toUpperCase()),2==desktop.contype){for(var s in t){var a=t.charCodeAt(s);o.push([a,1],[a,0])}AmtDeskTypeContent=o,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var s in t){a=t.charCodeAt(s);var r=n.charCodeAt(s);a>=65&&a<=90||a>=97&&a<=122?(a==r&&0==i&&(o.push([desktop.m.KeyAction.DOWN,16]),i=!0),a!=r&&1==i&&(o.push([desktop.m.KeyAction.UP,16]),i=!1)):a>=48&&a<=57?1==i&&(o.push([desktop.m.KeyAction.UP,16]),i=!1):DeskTypeTranslate[a]?(1==i&&(o.push([desktop.m.KeyAction.UP,16]),i=!1),r=DeskTypeTranslate[a]):DeskTypeShiftTranslate[a]&&(0==i&&(o.push([desktop.m.KeyAction.DOWN,16]),i=!0),r=DeskTypeShiftTranslate[a]),o.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==i&&(o.push([desktop.m.KeyAction.UP,16]),i=!1),desktop.m.SendKeyMsgKC(o)}}function showDeskClip(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskClip").blur();var e="";2048&features2||(e+='<input id=dlgClipGet type=button value="Hent Udklipsholder" style=width:160px onclick=showDeskClipGet()>'),4096&features2||(e+='<input id=dlgClipSet type=button value="Indstil udklipsholder" style=width:160px onclick=showDeskClipSet()>'),e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>',e+='<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>',xxdialogTag="clipboard",setModalContent("xxAddAgent","Fjernudklipsholder",e+='<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>Fjernudklipsholder er gyldig i 60 sekunder.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus()}}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&currentNode.agent.id>4&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){var t=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==t&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==t&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(deskTools.msg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=n){for(var o in n)t.push({p:parseInt(o),c:n[o].cmd,d:n[o].cmd.toLowerCase(),u:n[o].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var i="";for(var s in t)if(0!=t[s].p){var a=t[s].c;i+="<div onclick=showProcessDetails("+t[s].p+') class="deskToolsBar d-flex">',i+='<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[s].p)+"</div>",i+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(a)+'">'+a+"</div>",i+='<div class="ms-auto">'+(t[s].u?EscapeHtml(t[s].u):""),i+='<i class="ps-1 fa-solid fa-trash-can" role="button" title="Stop process" onclick=\'return stopProcess('+EscapeHtml(t[s].p)+',"'+EscapeHtml(t[s].c)+"\")'></i></div>",i+="</div>"}QH("DeskToolsProcesses",i)}}}else QH("DeskToolsProcesses","")}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Process Details, #{0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(deskTools.smsg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(deskTools.services=n,null!=n){for(var o in n)n[o].status?t.push({p:capitalizeFirstLetter(n[o].status.state.toLowerCase()),d:n[o].displayName,i:o}):n[o].serviceType&&t.push({p:n[o].serviceType,d:n[o].name,i:o});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var i="";for(var o in t)if(0!=t[o].p){var s=t[o].d,a=t[o].p;"Stopped"==a?a="Stoppet":"Running"==a&&(a="Kører"),i+="<div onclick=showServiceWaitDialog("+t[o].i+") class=deskToolsBar>",i+="<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(a)+"</div>",i+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+s+'">'+EscapeHtml(s)+"</div>",i+="</div>"}QH("DeskToolsServices",i)}}}else QH("DeskToolsProcesses","")}function showServiceDetailsDialog(e){if(xxdialogMode&&-1!=xxdialogTag.indexOf("service_")){var t=xxdialogTag.replace("service_",""),n=e.value?JSON.parse(e.value):deskTools.services[t];if(e.value&&(n.displayName=deskTools.services[t].displayName),null!=n){var o="";if(n.name&&(o+=addHtmlValue("Navn",n.name)),n.displayName&&(o+=addHtmlValue("Visningsnavn",n.displayName)),n.status){var i=capitalizeFirstLetter(n.status.state.toLowerCase());"Stopped"==i?i="Stoppet":"Running"==i&&(i="Kører"),n.status.state&&(o+=addHtmlValue("Tilstand",i)),n.status.pid&&(o+=addHtmlValue("PID",n.status.pid));var s=[];!0===n.status.isFileSystemDriver&&s.push("FileSystemDriver"),!0===n.status.isInteractive&&s.push("Interaktiv"),!0===n.status.isKernelDriver&&s.push("KernelDriver"),!0===n.status.isOwnProcess&&s.push("OwnProcess"),!0===n.status.isSharedProcess&&s.push("SharedProcess"),s.length>0&&(o+=addHtmlValue("Type",s.join(", ")))}if(n.startType&&(o+=addHtmlValue("Start Type",n.startType)),n.user&&(o+=addHtmlValue("Bruger",n.user)),n.installedBy&&(o+=addHtmlValue("Installed By",n.installedBy)),n.installedDate&&(o+=addHtmlValue("Installed Date",printDateTime(new Date(n.installedDate)))),n.failureActions){if(n.failureActions.resetPeriod){var a=(n.failureActions.resetPeriod<86400?0:n.failureActions.resetPeriod)/86400;o+=addHtmlValue("Restart Fail Count After ",a+" Day"+(1!=a?"s":""))}n.failureActions.actions&&(n.failureActions.actions[0]&&(o+=addHtmlValue("First Failure",n.failureActions.actions[0].type)),n.failureActions.actions[1]&&(o+=addHtmlValue("Second Failure",n.failureActions.actions[1].type)),n.failureActions.actions[2]&&(o+=addHtmlValue("Subsequent Failures",n.failureActions.actions[2].type)))}xxdialogTag="service_"+t,setModalContent("xxAddAgent","Serviceinformation",o+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Luk" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Start" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Stop" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Genstart" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function showServiceWaitDialog(e){if(xxdialogMode)return!1;var t=deskTools.services[e];return null!=t&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Serviceinformation","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){if(setDialogMode(0),0!=e){var n=deskTools.services[t];null!=n&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:n.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:n.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:n.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){if(null!=desktop)if(null==desktop.m.recordedData)Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording();else{Q("DeskRecordButtonImage").style.color="";var e=new Date,t="SkrivebordsSession-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);saveAs(data2blob(desktop.m.StopRecording().join("")),t+".mcrec")}}function deskSaveImage(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){var e=new Date,t="Skrivebord-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);Q("Desk").toBlob(function(e){saveAs(e,t+".png")})}}function deskDisplayInfo(e,t,n){var o=0,i="";for(var s in t){o++;var a=t[s],r=1;"All Displays"==a&&(a="Alle skærme",r=2),a.startsWith("Display ")&&(a=format("Vis {0}",a.substring(8)));var l="id=DeskMonitorSelectionX"+s+' title="'+EscapeHtml(a)+'" onclick=deskSetDisplay('+s+") role=button";i+=2==r?"<span "+l+' class="fa-layers fa-fw '+(n==s?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+l+' class="fa-fw fa-solid fa-desktop '+(n==s?"":" gray")+'"></i>',deskPreferedStickyDisplay==s&&n!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(s),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",i),QV("DeskMonitorSelectionSpan",o>1)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){var t=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=t<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){if(deskTools.resizing){var t=Q("DeskTools").getBoundingClientRect().right-e.clientX;t<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=t+"px")}});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){if(1==e.buttons){var t=Date.now();t-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY}}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked)&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),!0)}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Process Control",format('Stop processen #{0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminalNode=null,terminal=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state;3==terminalNode.mtype&&null!=terminalNode.agent&&terminalNode.agent.id>4&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&!(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH Port {0}",terminalNode.sshport?terminalNode.sshport:22)+"</a>");var t=!!(1&terminalNode.conn)||3==terminalNode.mtype;QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t);var n=!!(6&terminalNode.conn);QE("connectbutton2h",n),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR + LF":"LF");var o=!(0===args.xterm||null!=terminal&&null==xterm);QV("termarea3xdiv",o),QV("Term",!o),QV("bsbutton",!o),QV("pastebutton",!o),QV("devListToolbarViewIcons2",o),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var n=t;3==n&&2==e.contype&&n++;var o=StatusStrs[n];switch(3==n&&(3==e.contype&&(o+=", SSH"),1==e.webRtcActive&&(o+=", WebRTC")),QH("termstatus",o),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){null==autoConnectTerminalTimer?autoConnectTerminalTimer=setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),autoConnectTerminalTimer=null)}function CreateRemoteTunnel(e,t){var n={protocol:1};return null!=t&&"number"==typeof t.protocol&&(n.protocol=t.protocol),n.onTunnelUpdate=e,n.xxStateChange=function(e){},n.ProcessBinaryData=function(e){n.onTunnelUpdate(e)},n.ProcessData=function(e){n.onTunnelUpdate(e)},n.terminalEmulation=1,n.fxEmulation=0,n.lineFeed="\r\n",n}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){var n="";e.askkeypass?n+=addHtmlFormFloating("Godkendelse",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Gemt nøgle</option><option value=1>Brugernavn & Adgangskode</option><option value=2>Brugernavn og nøgle</option></select>'):n+=addHtmlFormFloating("Godkendelse",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Brugernavn & Adgangskode</option><option value=2>Brugernavn og nøgle</option></select>'),n+="<div id=d2userauth style=display:none>",n+=addHtmlFormFloating("Brugernavn",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),n+="</div>",n+="<div id=d2passauth style=display:none>",n+=addHtmlFormFloating("Kodeord",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(n+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Husk legitimationsoplysninger</label>')),n+="</div><div id=d2keyauth style=display:none>",n+=addHtmlValue("Nøglefil",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Nøglefilen skal være i OpenSSH format.</div>'),n+=addHtmlFormFloating("Nøgle kodeord",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(n+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Husk bruger og nøgle</label>'),n+=addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Husk kodeord</label>')),n+="</div>",e.askkeypass&&(n+="<div id=d2keyauth2 style=display:none>",n+=addHtmlFormFloating("Kodeord",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),n+="</div>"),setModalContent("xxAddAgent","Godkendelse",n);var o=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),connectTerminal()};document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Forbindelsesfejl",5e3);break;case"autherror":p12setConsoleMsg("Godkendelses fejl",5e3);break;case"sessionerror":p12setConsoleMsg("Sessionen er udløbet",5e3);break;case"sessiontimeout":p12setConsoleMsg("Session timeout",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){if(QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2user").value.length>0&&Q("dp2pass").value.length>0);else if(3==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2keypass2").value.length>0);else{if(QE("idx_dlgOkButton",!1),4194304&features2||QE("dp2keep2",Q("dp2keep1").checked),1==(Q("dp2user").value.length>0&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)){var t=new FileReader;t.onload=function(e){var t=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")>=0||e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END RSA PRIVATE KEY-----")>=0;QE("idx_dlgOkButton",t),QS("d2badkey").color=t?"#000":"#F00"},t.readAsText(Q("dp2key").files[0])}}e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id&&dialogclose(1))}function sshConnectEx(e){if(0==e)null!=terminal&&connectTerminal();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else if(3==Q("dp2authmethod").value)terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var n=new FileReader,o=Q("dp2user").value,i=Q("dp2keypass").value;n.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:o,keypass:i,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},n.readAsText(Q("dp2key").files[0])}}}function xTermSendResize(){xtermResizeTimer=null,null!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,n){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var o={};1==Q("termSizeList").value?(o.cols=80,o.rows=25):2==Q("termSizeList").value&&(o.cols=100,o.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",o),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{o={protocol:null!=n&&"number"==typeof n.protocol?n.protocol:1};n&&n.requireLogin&&(o.requireLogin=!0),n&&n.consent&&(o.consent=n.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(o.cols=80,o.rows=25,o.xterm=!0):2==Q("termSizeList").value?(o.cols=100,o.rows=30,o.xterm=!0):3==Q("termSizeList").value&&(o.cols=Math.floor((Q("column_l").clientWidth-60)/10),o.rows=Math.floor((Q("column_l").clientHeight-120)/20),o.xterm=!0)),e&&1==e.shiftKey&&(currentNode.agent.id>4?1==o.protocol&&(o.protocol=7):1==o.protocol&&(o.protocol=6)),null!=serverinfo.linuxshell&&currentNode.agent.id>4&&("root"==serverinfo.linuxshell&&(o.protocol=1,delete o.requireLogin),"user"==serverinfo.linuxshell&&(o.protocol=8,delete o.requireLogin),"login"==serverinfo.linuxshell&&(o.protocol=1,o.requireLogin=!0)),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),o.cols=xterm.cols,o.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.options=o,o.requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=o,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=[1,2,3,4,21,22].indexOf(currentNode.agent.id)>=0?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["UTF8-terminal","Udvidet ASCII","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC + [OM)","Alternativ (F10 = ESC + 0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR + LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Sæt ind",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),filesNode=null,files=null);var e=!!(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",!(!(512&features2)||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id||8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&!(8388608&features2)),QV("p13Disconnect",0!=t);var n=StatusStrs[t];switch(3==t&&(2==files.contype&&(n+=", SFTP"),1==files.webRtcActive&&(n+=", WebRTC")),Q("p13Status").textContent=n,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var o=[];try{o=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var i=0;i<o.length;i++)o[i].n==currentNode._id&&(p13targetpath=o[i].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){null==autoConnectFilesTimer?autoConnectFilesTimer=setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),autoConnectFilesTimer=null)}function connectFiles(e,t,n){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:n},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(e){if(e.length>0&&123!=e.charCodeAt(0))p13gotDownloadBinaryData(e);else{try{e=JSON.parse(decode_utf8(e))}catch(t){try{e=JSON.parse(e)}catch(t){return void console.log("Unable to parse: "+e)}}if("download"!=e.action)if("findfile"!=e.action)if(null!=e.action&&e.action.startsWith("upload"))p13gotUploadData(e);else{switch(e.action){case"sshauth":return void sshTunnelAuthDialog(e,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Godkendelses fejl",5e3);case"connectionerror":return void p13setConsoleMsg("Forbindelsesfejl",5e3);case"sessionerror":return void p13setConsoleMsg("Sessionen er udløbet",5e3);case"sessiontimeout":return void p13setConsoleMsg("Session timeout",5e3)}if("dialogmessage"!=e.action)if("refresh"!=e.action){if(null!=e.path)if(null==e.dir)""!=p13targetpath&&p13folderup();else if(e.path=e.path.replace(/\//g,"\\"),null!=p13filetree&&e.path==p13filetree.path){var t=p13getCheckedNames();p13filetree=e,p13updateFiles(t)}else{for(var n=e.path.replace(/\//g,"\\"),o=p13targetpath.replace(/\//g,"\\");n.length>0&&"\\"==n[0];)n=n.substring(1);for(;o.length>0&&"\\"==o[0];)o=o.substring(1);(n==o||"\\"==e.path&&""==p13targetpath)&&(p13filetree=e,p13updateFiles())}}else p13folderup(9999);else null==e.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Filhåndtering","<div style=margin:10px>"+EscapeHtml(e.file)+"</div><br /><progress value="+EscapeHtml(e.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Filhåndtering","<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(e.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Filhåndtering","<div style=margin:10px>Unzipping file...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Filhåndtering","<div style=margin:10px>Komprimerer filer...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)))}else xxdialogTag==e.reqid&&(null==e.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Ingen filer fundet</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(e.r)+"</div>"));else p13gotDownloadCommand(e)}}function p13sshConnectEx(e){if(0==e)null!=files&&connectFiles();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}));else if(3==Q("dp2authmethod").value)files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var n=new FileReader,o=Q("dp2user").value,i=Q("dp2keypass").value;n.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:o,keypass:i,key:e.target.result,keep:t}))},n.readAsText(Q("dp2key").files[0])}}}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);return e}function p13updateFiles(e){var t="",n="",o='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Root</a>';if(null!=p13filetree){var i=p13filetree.path.split("\\");for(var s in p13filetreelocation=[],i)""!=i[s]&&p13filetreelocation.push(i[s]);for(var s in p13filetreelocation)o+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(s)+1)+')">'+EscapeHtml(p13filetreelocation[s])+"</a>";var a=p13filetreelocation.join("/"),r=p13sort_files(p13filetree.dir);for(var s in r){var l,d=r[s],c=d.n;l=c.length>70?'<span title="'+EscapeHtml(c)+'">'+EscapeHtml(c.substring(0,70))+"...</span>":EscapeHtml(c);var u="";if(null!=d.d){var p=new Date(d.d);"number"==typeof d.d&&(p=new Date(1e3*d.d));u=printDateTime(p)+"&nbsp;"}var m="";if(null!=d.s){const e=["Bytes","KB","MB","GB","TB"],t=parseInt(Math.floor(Math.log(Math.abs(d.s))/Math.log(1024)),10),n=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex];m=0==Q("p13sizedropdown").value?0===d.s?"n/a":0===t?`${d.s} ${e[t]}`:`${(d.s/1024**t).toFixed(2)} ${e[t]}`:1==Q("p13sizedropdown").value?getFileSizeStr(d.s):`${(d.s/2**n.value).toFixed(2)} ${n.title}`}var g="";if(d.t<3){g="<div class=filelist file=999>",g+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+'\'>&nbsp;<span style=float:right title=""></span>',g+="<span><div class=fileIcon"+("REMOVABLE"==d.dt?5:"CDROM"==d.dt?6:d.t)+' onclick=p13folderset("'+encodeURIComponentEx(d.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(d.nx)+"\")'>",isWindowsNode(currentNode)&&d.dt&&currentNode.volumes&&currentNode.volumes[l.charAt(0).toUpperCase()]&&currentNode.volumes[l.charAt(0).toUpperCase()].name?g+=currentNode.volumes[l.charAt(0).toUpperCase()].name+" ("+l+")":g+=l,g+="</a></span></div>"}else{var v=l;d.s>0&&(v=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(a+"/"+c)+"','"+encodeURIComponentEx(c)+"',"+d.s+')">'+l+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(a+"/"+c)+'","'+encodeURIComponentEx(c)+'") style=cursor:pointer>'+l+"</a>"),g="<div id=fileEntry cmenu=filesContextMenu fileIndex="+s+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+"'>&nbsp;<span class=fsize>"+u+"</span><span style=float:right>"+EscapeHtml(m)+"</span><span><div class=fileIcon"+d.t+"></div>"+v+"</span></div>"}d.t<3?t+=g:n+=g}if(QH("p13files",t+n),QH("p13currentpath",o),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e){var h=document.getElementsByName("fd");for(s=0;s<h.length;s++)e.indexOf(p13filetree.dir[h[s].value].n)>=0&&(h[s].checked=!0)}p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open File/Folder","Are you sure you want to open this file/folder on the remote devices desktop?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[n].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Go To Folder",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],n=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var o=0;o<t.length;o++)t[o].n==currentNode._id&&(n=o);for(n>=0&&t.splice(n,1),t.push({n:currentNode._id,p:e});t.length>40;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){if(!xxdialogMode){var e=addHtmlFormFloating("Filtrer",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>');e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>',e+="<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Luk style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>",setModalContent("xxAddAgent","Søg filer",e+="<input id=filefind_dlgOkButton type=submit value=Søg style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus()}}function p13findfileDown(e){"Enter"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",Q("d2findFilter").value.length>0)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){if(0!=Q("d2findFilter").value.length){var n=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,o=n?"\\":"/",i=p13filetreelocation.join(o)+o;n||(i=o+i),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:i,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1)}}function p13sort_filename(e,t){return e.ln>t.ln?1*p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?1*p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t=[],n=Q("p13sortdropdown").value;for(var o in e)e[o].nx=o,null==e[o].s&&(e[o].s=0),null==e[o].n&&(e[o].n=o),e[o].ln=e[o].n.toLowerCase(),t.push(e[o]);return p13sortorder=1,n>3&&(p13sortorder=-1,n-=3),1==n?t.sort(p13sort_filename):2==n?t.sort(p13sort_bysize):3==n&&t.sort(p13sort_timestamp),t}function p13setActions(){var e=null!=currentNode.agent&&14!=currentNode.agent.id;if(null==p13filetree)QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Vælg alle",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1);else{var t=p13getFileSelCount(),n=p13getFileCount(),o=p13getFileSelCount(!1),i=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id;QE("p13DeleteFileButton",t>0&&(p13filetreelocation.length>0||0==i)),QE("p13NewFolderButton",e&&(p13filetreelocation.length>0||0==i)),QE("p13UploadButton",p13filetreelocation.length>0||0==i||14==currentNode.agent.id),QE("p13RenameFileButton",e&&1==t&&(p13filetreelocation.length>0||0==i)),QE("p13ViewFileButton",e&&1==t&&1==o&&(p13filetreelocation.length>0||0==i)),QE("p13SelectAllButton",n>0),Q("p13SelectAllButton").value=t>0?"Vælg Ingen":"Vælg alle",QE("p13RefreshButton",!0),QE("p13FindButton",e&&(p13filetreelocation.length>0||0==i)),QE("p13CutButton",e&&t>0&&t==o&&(p13filetreelocation.length>0||0==i)),QE("p13CopyButton",e&&t>0&&t==o&&(p13filetreelocation.length>0||0==i)),QE("p13ZipButton",e&&t>0&&(p13filetreelocation.length>0||0==i)),QE("p13UnzipButton",e&&1==t&&1==o&&(p13filetreelocation.length>0||0==i)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",e&&(p13filetreelocation.length>0||0==i)&&null!=p13clipboard&&p13clipboard.length>0),QE("p13GoToFolderButton",e),QE("p13OpenButton",e&&1==t),QE("p13DownloadButton",t>0&&t==o&&(p13filetreelocation.length>0||0==i))}1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH Port {0}",filesNode.sshport?filesNode.sshport:22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,n=document.getElementsByName("fd"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),n=0;n<t.length;n++)if(t[n].checked&&!p13filetree.dir[t[n].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Ny mappe","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=p13getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Rekursiv sletning</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Slet",e>1?format("Slet {0} valgte element?",e)+t:"Slet det valgte element?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Omdøb",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Upload Fil",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",Q("p13uploadinput").files.length>0)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Fil editor","Kun filer på mindre end 200k kan redigeres.");break}}function p13unzipFile(){for(var e,t,n=document.getElementsByName("fd"),o=0;o<n.length;o++)if(n[o].checked){var i=isWindowsNode(currentNode)?"\\":"/";e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(i)+i+p13filetree.dir[n[o].value].n.split(".zip")[0]+i,t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(i)+i+p13filetree.dir[n[o].value].n}setModalContent("xxAddAgent","Unzip To Folder",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:t})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Zip filnavn",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[n].value].n);p13updateClipview()}function p13pasteFile(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format("Bekræft kopiering af {0} post(er) til denne placering?",p13clipboard.length):format("Bekræft kopiering af 1 post til denne placering?"):p13clipboard.length>1?format("Bekræft flytning af {0} poster til denne placering?",p13clipboard.length):format("Bekræft flytning af 1 post til denne placering?")),setModalContent("xxAddAgent","Sæt ind",e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format('Holder {0} poster for kopiering, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Fjern</a>.',p13clipboard.length):format('Holder 1 post for kopiering, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Fjern</a>.'):p13clipboard.length>1?format('Holder {0} poster for flytning, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Fjern</a>.',p13clipboard.length):format('Holder 1 post for flytning, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Fjern</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t=[];for(var n in e.dataTransfer.files)null!=e.dataTransfer.files[n].size&&0!=e.dataTransfer.files[n].size&&t.push(e.dataTransfer.files[n]);0!=t.length&&p13doUploadFiles(t)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);var t=null!=p13filetree;QV("p13bigok",t),QV("p13bigfail",!t)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,n,o){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:n,tsize:0,data:"",state:0,id:Math.random(),tag:o},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Download Fil","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+n+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){if(gdownloadFile&&0!=gdownloadFile.state)if(e.length>4&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),1&ReadInt(e,0))if("viewer"==gdownloadFile.tag){setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large");var t=gdownloadFile.file;showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null}else saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0);else files.sendText({action:"download",sub:"ack",id:gdownloadFile.id})}function p13downloadButton(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){var n=p13filetree.dir[e[t].value],o="devicefile.ashx?c="+authCookie;o+="&m="+currentNode.meshid.split("/")[2],o+="&n="+currentNode._id.split("/")[2],downloadFile(o+="&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+n.n),encodeURIComponentEx(n.n))}}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Wrap: ON","Wrap: OFF"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Størrelse: 100%","Størrelse: 120%","Størrelse: 150%","Størrelse: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(Q("d4editorarea").value):encode_utf8(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Kodning: RAW","Kodning: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var n,o=Q("d4editorarea").value;o=0===d4EditLineBreakVal?o.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?o.replace(/\r\n|\n/g,"\r"):o.replace(/\r\n|\r/g,"\n"),p13uploadFileContinue(1,[{name:t,size:(n=1==d4EditEncodingVal?(new TextEncoder).encode(o):(new TextEncoder).encode(decode_utf8(o))).byteLength,type:"text/plain",xdata:n}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=[],o=0;for(var i in p13filetree.dir)t?n.push(p13filetree.dir[i].n.toLowerCase()):n.push(p13filetree.dir[i].n);for(i=0;i<e.length;i++)t?n.indexOf(e[i].name.toLowerCase())>=0&&o++:n.indexOf(e[i].name)>=0&&o++;0==o?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Upload Fil",format(1==o?"Upload vil overskrive 1 fil. Fortsæt?":"Upload vil overskrive {0} filer. Fortsæt?",o)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Upload Fil","<div id=p13dfileName>Forbinder...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}const byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var n=new FileReader;n.onerror=function(e){t(null)},n.onload=function(){window.crypto.subtle.digest("SHA-384",n.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},n.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var e=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(e.name)),Q("d2progressBar").max=e.size,Q("d2progressBar").value=0,null==e.xdata){uploadFile.xfile=e;var t=null;for(var n in p13filetree.dir)p13filetree.dir[n].n==e.name&&(t=p13filetree.dir[n]);null!=t&&t.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(n){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,tag:{h:n.toUpperCase(),s:t.s,skip:t.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=e.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":uploadFile.xdataPriming=8,p13uploadNextPart(!1);break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile():p13uploadFileTransferDone();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,n=uploadFile.xptr;if(n>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((s=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;s=t.byteLength}var o=new Uint8Array(t.slice(n,s));if(123==o[0]||0==o[0]){var i=new Uint8Array(s-n+1);i.set(o,1),files.send(i)}else files.send(o);uploadFile.xptr=s,Q("d2progressBar").value=s}}else if(uploadFile.xfile){if(null!=uploadFile.xreader)return;if(uploadFile.xptr>=uploadFile.xfile.size)return;var s;if((s=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;s=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e=uploadFile.xreader.result;if(delete uploadFile.xreader,null!=e){var t=new Uint8Array(e);if(123==t[0]||0==t[0]){var n=new Uint8Array(e.byteLength+1);n.set(t,1),files.send(n)}else files.send(t);uploadFile.xptr=s,Q("d2progressBar").value=s,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):uploadFile.xdataPriming>0&&(uploadFile.xdataPriming--,p13uploadNextPart(!0))}},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,s))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(var n in currentDeviceEvents){var o=currentDeviceEvents[n],i=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(i)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(i))+"</td></tr>");var s,a="fa-mobile-screen";if("user"==o.etype&&(a="fa-user"),"server"==o.etype&&(a="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])s="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{for(var n in s=eventsMessageId[o.msgid],o.msgArgs){var r=o.msgArgs[n];"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9))))),s=s.split("{"+n+"}").join(r)}s=EscapeHtml(s).split("(R)").join("&reg;")}if(o.username){var l="";o.guestname&&(l=' / <span title="Dette er en gæstedelingssession">'+EscapeHtml(o.guestname)+"</span>"),s=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+l+" &rarr; "+s:EscapeHtml(o.username)+l+" &rarr; "+s}"relay"!=o.etype&&"relaylog"!=o.action||(a="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+a+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(i)+" - "+s+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ingen begivenheder fundet</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var n,o;for(var i in 1==t&&(n=currentDeviceEvents),2==t&&(n=events),3==t&&(n=currentUserEvents),n)if(n[i].h==e){o=n[i];break}if(o){var s="<div style=overflow-y:auto;max-height:300px>";for(var i in o)"h"!=i&&"_id"!=i&&"ids"!=i&&"domain"!=i&&null!=o[i]&&("object"==typeof o[i]?s+=addHtmlValue3(EscapeHtml(i),EscapeHtml(JSON.stringify(o[i]))):s+=addHtmlValue3(EscapeHtml(i),EscapeHtml(o[i])));setModalContent("xxAddAgent","Hændelsesdetaljer",s+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"CPU",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Memory",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){"none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc()):deviceDetailsStatsClear()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;deviceDetailsStatsData.length>0&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var n=[],o=[];for(var i in deviceDetailsStatsData){var s=deviceDetailsStatsData[i];n.push({x:100-(s[0]-t),y:s[1]}),o.push({x:100-(s[0]-t),y:s[2]})}if(deviceDetailsConfig.data.datasets[0].data=n,deviceDetailsConfig.data.datasets[1].data=o,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&e.thermals.length>0){var a="&nbsp;";for(var i in e.thermals)a+='<div class=thermalSensor title="'+e.thermals[i].InstanceName+'">'+parseFloat(e.thermals[i].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[i].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",a)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,n){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=e._id),null!=t&&(DeviceDetailsHardware=t),null!=n&&(DeviceDetailsNetwork=n),null==(t=DeviceDetailsHardware)&&(t={}),null==(n=DeviceDetailsNetwork)&&(n={});var o=[],i={},s="";if(e.rname&&(s+=addDetailItem("Navn",EscapeHtml(e.rname),i)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(s+=addDetailItem("Beskrivelse",EscapeHtml(t.windows.osinfo.Description),i)),e.osdesc&&(s+=addDetailItem("Version",EscapeHtml(e.osdesc),i)),t.windows&&t.windows.osinfo)if((p=t.windows.osinfo).OSArchitecture&&(p.OSArchitecture.startsWith("32")?s+=addDetailItem("Arkitektur","32-bit",i):p.OSArchitecture.startsWith("64")?s+=addDetailItem("Arkitektur","64-bit",i):s+=addDetailItem("Arkitektur",EscapeHtml(p.OSArchitecture),i)),p.LastBootUpTime){var a={year:parseInt(p.LastBootUpTime.substring(0,4)),month:parseInt(p.LastBootUpTime.substring(4,6))-1,day:parseInt(p.LastBootUpTime.substring(6,8)),hours:parseInt(p.LastBootUpTime.substring(8,10)),minutes:parseInt(p.LastBootUpTime.substring(10,12)),seconds:parseInt(p.LastBootUpTime.substring(12,14))};s+=addDetailItem("Last Boot Up Time",printDateTime(new Date(a.year,a.month,a.day,a.hours,a.minutes,a.seconds)))}if(t.linux&&t.linux.LastBootUpTime){s+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))}if(t.darwin&&t.darwin.LastBootUpTime){s+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))}if(""!=s&&o.push({name:"Operativ system",html:s,img:"software64.png"}),e.agent){s="";if(null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver){var r="";r=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(r+=" v"+e.agent.ver),14==e.agent.id&&(r=e.agent.core),s+=addDetailItem("Mesh Agent",r)}if(1&e.conn?s+=addDetailItem("Seneste agentforbindelse","Forbundet nu"):e.lastconnect&&(s+=addDetailItem("Seneste agentforbindelse",printDateTime(new Date(e.lastconnect)))),e.lastaddr){var l=e.lastaddr.split(":");l.length>2?s+=addDetailItem("Seneste agent adresse",'<a href="https://iplocation.com/?ip='+l.slice(0,-1).join(":")+'" rel="noreferrer noopener" target="MeshIPLoopup">'+l.slice(0,-1).join(":")+"</a>"):isPrivateIP(e.lastaddr)?s+=addDetailItem("Seneste agent adresse",l[0]):s+=addDetailItem("Seneste agent adresse",'<a href="https://iplocation.com/?ip='+l[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+l[0]+"</a>")}if(null!=t.agentvers&&t.agentvers.compileTime){var d=Date.parse(t.agentvers.compileTime);s+=addDetailItem("Kompileringstid",isNaN(d)?t.agentvers.compileTime:printDateTime(new Date(d)))}""!=s&&o.push({name:"Mesh Agent",html:s,img:"meshagent64.png"})}if(t.mobile){s="";t.mobile.brand&&t.mobile.model&&(s+=addDetailItem("Model",EscapeHtml(t.mobile.brand+", "+t.mobile.model),i)),t.mobile.device&&(s+=addDetailItem("Enhed",EscapeHtml(t.mobile.device),i)),t.mobile.bootloader&&(s+=addDetailItem("Bootloader",EscapeHtml(t.mobile.bootloader),i)),t.mobile.id&&(s+=addDetailItem("Identificér",EscapeHtml(t.mobile.id),i)),t.mobile.host&&(s+=addDetailItem("Hostnavn",EscapeHtml(t.mobile.host),i)),t.mobile.androidapi&&t.mobile.androidrelease&&(s+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),i)),""!=s&&o.push({name:"Mobil Enhed",html:s,img:"mobile64.png"})}if(null!=n.netif){var c={};for(var u in n.netif){"string"==typeof(p=n.netif[u]).mac&&(null==c[p.mac]?(c[p.mac]=p,c[p.mac].ipv4layer=[{v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}]):c[p.mac].ipv4layer.push({v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}))}s="";for(var u in s+='<table class="table table-hover" style=width:100%>',c){var p=c[u];for(var m in s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.name+(p.dnssuffix?", "+p.dnssuffix:""))+"</b></div>",p.desc&&(s+=addDetailItem("Beskrivelse",EscapeHtml(p.desc).split("(R)").join("&reg;"))),p.mac&&(p.gatewaymac?s+=addDetailItem("MAC Layer",format("MAC: {0}, Gateway: {1}",EscapeHtml(p.mac),EscapeHtml(p.gatewaymac))):p.mac&&(s+=addDetailItem("MAC Layer",format("MAC: {0}",EscapeHtml(p.mac))))),p.ipv4layer){var g=p.ipv4layer[m];g.v4gateway&&g.v4mask?s+=addDetailItem("IPv4 Layer",format("IP: {0}, Mask: {1}, Gateway: {2}",EscapeHtml(g.v4addr),EscapeHtml(g.v4mask),EscapeHtml(g.v4gateway))):g.v4addr&&(s+=addDetailItem("IPv4 Layer",format("IP: {0}",EscapeHtml(g.v4addr))))}s+="</div></td></tr>"}""!=(s+="</table>")&&o.push({name:"Netværk",html:s,img:"networking64.png"})}if(null!=n.netif2){s="";for(var u in s+='<table class="table table-hover" style=width:100%>',n.netif2){p=n.netif2[u];if(!(0==Array.isArray(p)||p.length<1||null==p[0]||"string"==typeof p[0].mac&&p[0].mac.startsWith("00:00:00:00"))){s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var v="";null!=u&&(v+=u),null!=p[0].fqdn&&""!=p[0].fqdn&&(v+=", "+p[0].fqdn),v.length>0&&(s+="<div style=margin-bottom:3px><b>"+EscapeHtml(v)+"</b></div>"),p.desc&&(s+=addDetailItem("Beskrivelse",EscapeHtml(p.desc).split("(R)").join("&reg;"))),"string"==typeof p[0].mac&&(p[0].gatewaymac?s+=addDetailItem("MAC Layer",format("MAC: {0}, Gateway: {1}",EscapeHtml(p[0].mac),EscapeHtml(p[0].gatewaymac))):s+=addDetailItem("MAC Layer",format("MAC: {0}",EscapeHtml(p[0].mac))));for(m=0;m<p.length;m++){var h=p[m],f=[];h.address&&f.push(format("IP: {0}",EscapeHtml(h.address))),h.netmask&&f.push(format("Maske: {0}",EscapeHtml(h.netmask))),h.gateway&&f.push(format("Gateway: {0}",EscapeHtml(h.gateway))),f.length>0&&("IPv4"==h.family&&(s+=addDetailItem("IPv4 Layer",f.join(","))),"IPv6"==h.family&&(s+=addDetailItem("IPv6 Layer",f.join(","))))}s+="</div></td></tr>"}}t.network&&t.network.dns&&(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+=addDetailItem("<b>DNS Servers</b>",t.network.dns.join(",")),s+="</div></td></tr>"),""!=(s+="</table>")&&o.push({name:"Netværk",html:s,img:"networking64.png"})}if(null!=e.intelamt){s="";s+=addDetailItem("Version",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Ukendt</i>",i);var k={0:nobreak("Ikke aktiveret"),1:nobreak("Pre-aktivering"),2:nobreak("Aktiveret")},x="";2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?x=", Client Control Mode (CCM)":4&e.intelamt.flags&&(x=", Admin Control Mode (ACM)")),s+=addDetailItem("Provisioning State",(e.intelamt.state?k[e.intelamt.state]:"<i>Ukendt</i>")+x,i),s+=addDetailItem("Sikkerhed",1==e.intelamt.tls?"Sikret med TLS":"TLS er ikke konfigureret",i),""!=(s+=addDetailItem("Admin legitimationsoplysninger",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&9&e.intelamt.warn?"Ukendt":"Kendt",i))&&("number"==typeof e.intelamt.sku&&16&e.intelamt.sku?o.push({name:"Intel&reg; Standard Manageability (Intel&reg; SM)",html:s,img:"amt64.png"}):o.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:s,img:"amt64.png"}))}if(t.identifiers){s="";var b=t.identifiers;if(b.bios_vendor&&(s+=addDetailItem("Leverandør",EscapeHtml(b.bios_vendor),i)),b.bios_version&&(s+=addDetailItem("Version",EscapeHtml(b.bios_version),i)),b.bios_serial&&(s+=addDetailItem("Serial",EscapeHtml(b.bios_serial),i)),b.bios_mode&&(s+=addDetailItem("Mode",EscapeHtml(b.bios_mode),i)),""!=s&&o.push({name:"BIOS",html:s,img:"chip64.png"}),s="",b.board_vendor&&(s+=addDetailItem("Leverandør",EscapeHtml(b.board_vendor),i)),b.board_name&&(s+=addDetailItem("Navn",EscapeHtml(b.board_name),i)),b.board_serial&&""!=b.board_serial&&(s+=addDetailItem("Serial",EscapeHtml(b.board_serial),i)),b.board_version&&(s+=addDetailItem("Version",EscapeHtml(b.board_version),i)),b.product_uuid&&(s+=addDetailItem("Identificér",EscapeHtml(b.product_uuid),i)),b.cpu_name&&(s+=addDetailItem("CPU",EscapeHtml(b.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),i)),b.gpu_name)for(var u in b.gpu_name)s+=addDetailItem("GPU",EscapeHtml(b.gpu_name[u]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),i);""!=s&&o.push({name:"Motherboard",html:s,img:"motherboard64.png"})}if(t.tpm){s="";var y=t.tpm;y.SpecVersion&&(s+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(y.SpecVersion)).toFixed(1),i)),y.ManufacturerId&&(s+=addDetailItem("ManufacturerId",EscapeHtml(y.ManufacturerId),i)),y.ManufacturerVersion&&(s+=addDetailItem("ManufacturerVersion",EscapeHtml(y.ManufacturerVersion),i)),null!=y.IsActivated&&(s+=addDetailItem("IsActivated",y.IsActivated?"Yes":"No",i)),null!=y.IsEnabled&&(s+=addDetailItem("IsEnabled",y.IsEnabled?"Yes":"No",i)),null!=y.IsOwned&&(s+=addDetailItem("IsOwned",y.IsOwned?"Yes":"No",i)),""!=s&&o.push({name:"TPM",html:s,img:"tpm64.png"})}if(t.windows&&t.windows.memory&&t.windows.memory.length>0){s="";for(var u in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),s+='<table class="table table-hover" style=width:100%>',t.windows.memory){p=t.windows.memory[u];s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.BankLabel?p.BankLabel:p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Capacity&&p.Speed?s+=addDetailItem("Kapacitet / hastighed",format("{0} Mb, {1} MHz",p.Capacity/1024/1024,p.Speed),i):p.Capacity&&(s+=addDetailItem("Kapacitet",format("{0} Mb",p.Capacity/1024/1024),i)),p.PartNumber&&(s+=addDetailItem("Partnummer",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),i)),s+="</div>"}""!=(s+="</table>")&&o.push({name:"Memory",html:s,img:"ram64.png"})}if(t.linux&&t.linux.memory&&t.linux.memory.Memory_Device.length>0){s="";for(var u in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),s+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device){(p=t.linux.memory.Memory_Device[u]).Size&&"No Module Installed"==p.Size||(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Locator?p.Locator:"Unknown")+"</b></div>",p.Size&&p.Speed?s+=addDetailItem("Kapacitet / hastighed",format("{0}, {1}",p.Size,p.Speed),i):p.Size&&(s+=addDetailItem("Kapacitet",format("{0}",p.Size),i)),p.PartNumber&&(s+=addDetailItem("Partnummer",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),i)),s+="</div>")}""!=(s+="</table>")&&o.push({name:"Memory",html:s,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&t.darwin.memory.length>0){s="";for(var u in s+='<table class="table table-hover" style=width:100%>',t.darwin.memory){(p=t.darwin.memory[u]).Size&&"No Module Installed"==p.Size||(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Size&&p.Speed?s+=addDetailItem("Kapacitet / hastighed",format("{0}, {1}",p.Size,p.Speed),i):p.Size&&(s+=addDetailItem("Kapacitet",format("{0}",p.Size),i)),p.PartNumber&&(s+=addDetailItem("Partnummer",EscapeHtml(p.Manufacturer&&""!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),i)),s+="</div>")}""!=(s+="</table>")&&o.push({name:"Memory",html:s,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){s="";for(var u in b.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),s+="<table style=width:100%>",b.storage_devices){if((p=b.storage_devices[u]).Size){if(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Caption)+"</b></div>",p.Model&&p.Model!=p.Caption&&(s+=addDetailItem("Model",EscapeHtml(p.Model),i)),p.Size&&("string"==typeof p.Size&&parseInt(p.Size)==p.Size&&(p.Size=parseInt(p.Size)),"number"==typeof p.Size&&(s+=addDetailItem("Kapacitet",format("{0} Mb",Math.floor(p.Size/1024/1024)),i)),"string"==typeof p.Size&&(s+=addDetailItem("Kapacitet",EscapeHtml(p.Size),i))),t.windows&&t.windows.drives&&p.Model){const e=t.windows.drives.find(e=>e.Model===p.Model);e&&e.Status&&(s+=addDetailItem("Status",EscapeHtml(e.Status),i))}s+="</div>"}}""!=(s+="</table>")&&o.push({name:"Lagring",html:s,img:"storage64.png"})}if(t.windows&&t.windows.volumes){s="";for(var u in t.windows.volumes){if(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+u+":"+(null==(p=t.windows.volumes[u]).name||""==p.name?"":" - "+EscapeHtml(p.name))+"</b></div>",p.size){var w=["Bytes","KB","MB","GB","TB"],S=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;s+=addDetailItem("Kapacitet",EscapeHtml(S),i)}if(p.sizeremaining){w=["Bytes","KB","MB","GB","TB"],S=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.sizeremaining))/Math.log(1024)),10))?`${p.sizeremaining} ${w[m]}`:`${(p.sizeremaining/1024**m).toFixed(2)} ${w[m]}`;s+=addDetailItem("Capacity Remaining",EscapeHtml(S),i)}if(p.type)s+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Ukendt":EscapeHtml(p.type)),i);if(p.protectionStatus||p.volumeStatus){var M=[];p.protectionStatus&&M.push("Aktiveret"),p.volumeStatus&&"FullyDecrypted"==p.volumeStatus&&M.push("Fully Decrypted"),p.volumeStatus&&"EncryptionInProgress"==p.volumeStatus&&M.push("Encryption In Progress"),p.volumeStatus&&"FullyEncrypted"==p.volumeStatus&&M.push("Fully Encrypted"),M=M.join(" - "),p.recoveryPassword&&(M+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(u)+'","'+encodeURIComponentEx(p.identifier)+'","'+encodeURIComponentEx(p.recoveryPassword)+'")')),s+=addDetailItem("BitLocker",M,i)}s+="</div>"}""!=s&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+s+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){s="";for(var u in t.linux.volumes){if(!(p=t.linux.volumes[u]).mount_point.startsWith("/var/lib/docker/overlay2")){if(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size){w=["KB","MB","GB","TB"],S=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;s+=addDetailItem("Kapacitet",EscapeHtml(S),i)}if(p.available){if(0==Math.abs(p.available))S="0 KB";else w=["KB","MB","GB","TB"],S=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.available))/Math.log(1024)),10))?`${p.available} ${w[m]}`:`${(p.available/1024**m).toFixed(2)} ${w[m]}`;s+=addDetailItem("Capacity Remaining",EscapeHtml(S),i)}if(p.type)s+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Ukendt":EscapeHtml(p.type)),i);s+="</div>"}}""!=s&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+s+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){s="";for(var u in t.darwin.volumes){if(!(p=t.darwin.volumes[u]).mount_point.startsWith("/var/lib/docker/overlay2")){var C;if(s+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",s+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size&&(s+=addDetailItem("Kapacitet",EscapeHtml(p.size),i)),p.available&&(s+=addDetailItem("Capacity Remaining",EscapeHtml(p.available),i)),p.type)s+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Ukendt":EscapeHtml(p.type)),i);s+="</div>"}}""!=s&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+s+"</table>",img:"storage64.png"})}s="";for(var u in o)null==o[u].img?s+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+o[u].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+o[u].html+"</div>":(s+="<table style=width:100%><tr>",s+="<td style=width:64px;vertical-align:top><img src=images/details/"+o[u].img+" border=0 width=64 /></td>",s+="<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+o[u].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+o[u].html+"</div></td>",s+="</tr></table>");""==s?QH("p17info2","Ingen oplysninger om denne enhed."):QH("p17info2",s)}}function deviceDetailsShowBitlockerInfo(e,t,n){if(xxdialogMode)return!1;var o="<div><p>Identificér</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Ukendt")+"</p>";o+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(n?decodeURIComponent(n):"Ukendt")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker Information",o),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){if(e.ctrlKey||e.altKey)return!0;var t=0,n=Q("p15consoleText");if(e.key)if(13==e.keyCode&&0==consoleFocus)p15consoleSend(e),t=1;else if(8==e.keyCode&&0==consoleFocus){var o=n.value;n.value=o.substring(0,o.length-1),t=1}else if(27==e.keyCode)n.value="",t=1;else if(38==e.keyCode||40==e.keyCode){var i=consoleHistory.indexOf(n.value);38==e.keyCode&&consoleHistory.length-1>i?n.value=consoleHistory[i+1]:40==e.keyCode&&i>0?n.value=consoleHistory[i-1]:40==e.keyCode&&0==i&&(n.value=""),t=1}else 1===e.key.length&&(insertTextAtCursor(n,e.key),t=1);else 0!=e.charCode&&0==consoleFocus&&(n.value=n.value+String.fromCharCode(e.charCode),t=1);return t>0?haltEvent(e):void 0}function insertTextAtCursor(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t;else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.setSelectionRange(o+1,o+1)}else e.value+=myValue}var consoleServerText="";function setupConsole(){if(115==xxcurrentView){var e="server"==consoleNode;consoleNode="server",QH("p15deviceName","Min serverkonsol"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)}else{e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid];if(16&GetNodeRights(currentNode)){null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight);1&consoleNode.conn||consoleNode.conn;var t=1&consoleNode.conn?"Agenten er online":"Agenten er offline";16&consoleNode.conn&&(t+=", MQTT er online"),QH("p15statetext",t),QE("p15uploadCore",!!(1&consoleNode.conn)),QV("p15outputselecttd",!!(16&consoleNode.conn)||1==currentNode.pmt&&!!(4&features2)),QV("p15outputselect2",!!(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&!!(4&features2));var n=Q("p15outputselect").value;16&consoleNode.conn||2!=n||(n=1,Q("p15outputselect").value=1),1==currentNode.pmt&&4&features2||3!=n||(n=1,Q("p15outputselect").value=1);var o=!1;1&consoleNode.conn&&1==n&&(o=!0),16&consoleNode.conn&&2==n&&(o=!0),1==currentNode.pmt&&4&features2&&3==n&&(o=!0),QE("p15consoleText",o)}else QH("p15statetext","Adgang nægtet"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1);QV("devListToolbarViewIcons3",!!(1&consoleNode.conn))}}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){if(!e||13==e.keyCode){var t=Q("p15consoleText").value,n="<div style=color:green>&gt; "+EscapeHtml(t)+"<br/></div>";if(115==xxcurrentView?(consoleServerText+=n,meshserver.send({action:"serverconsole",value:t})):16&consoleNode.conn&&2==Q("p15outputselect").value?(n="<div style=color:orange>MQTT&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=n,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:t})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&4&features2?(n="<div style=color:violet>PUSH&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=n,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:t})):1&consoleNode.conn&&(consoleNode.consoleText+=n,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:t})),Q("p15agentConsoleText").innerHTML+=n,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",t.length>0){var o=consoleHistory.indexOf(t);o>=0&&consoleHistory.splice(o,1),consoleHistory.unshift(t),consoleHistory.splice(10)}}}function p15consoleReceive(e,t,n){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==n?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){if(!xxdialogMode)if(1==e.shiftKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"});else if(1==e.altKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"});else if(1==e.ctrlKey)p15uploadCore2();else{setModalContent("xxAddAgent","Udfør agenthandling",addHtmlFormFloating("Handling",'<select id=d3coreMode class="form-select me-2"><option value=1>Upload standard serverkerne</option><option value=2>Ryd kernen</option><option value=3>Upload af kerne fil</option><option value=4>Soft afbryd agent</option><option value=5>Hård afbrydelse af agent</option><option value=6>Upload gendannelseskerne</option><option value=7>Upload lille kerne</option><option value=8>Restart agent service</option><option value=9>Tving agentopdatering</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)}}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value?meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"}):9==Q("d3coreMode").value&&meshserver.send({action:"updateAgents",nodeids:[consoleNode._id]})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Upload Mesh Agent kerne",""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Tidligere logins","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){if(!xxdialogMode){var t=0==e?userinfo:currentUser;setModalContent("xxAddAgent","Administrer kontobillede",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2);var n=Q("p2canvas").getContext("2d");null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random()));var o="";1==e&&(o="&id="+t._id.split("/")[2]);var i=new Image;i.onload=function(){n.clearRect(0,0,256,256),n.drawImage(i,0,0)},i.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+o:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1)}}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],t=new Image;t.onload=function(){var e=0,n=0,o=Math.min(t.width,t.height);t.width>o&&(e=(t.width-o)/2),t.height>o&&(n=(t.height-o)/2);var i=Q("p2canvas").getContext("2d");i.imageSmoothingEnabled=!0,i.webkitImageSmoothingEnabled=!0,i.mozImageSmoothingEnabled=!0,i.clearRect(0,0,256,256),i.drawImage(t,e,n,o,o,0,0,256,256),QE("idx_dlgOkButton",!0)},t.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){var e;!xxdialogMode&&33554432&features&&(null!=userinfo.phone?(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Bekræftet telefonnummer</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>",setModalContent("xxAddAgent","Telefonmeddelelser",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Fjern telefonnummer</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate()):(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td>Indtast dit SMS-kompatible telefonnummer. Når det er bekræftet, kan nummeret bruges til login-bekræftelse og andre meddelelser.",xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Telefonmeddelelser",e+='<br /><br /><div style=width:100%;text-align:center>Telefonnummer: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate()))}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var n=0;n<e.length;n++){var o=e.charCodeAt(n);(o<48||o>57)&&32!=o&&45!=o&&46!=o&&(t=!1)}return t&&e.length>=10}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e;if(!xxdialogMode&&33554432&features2)if(null!=userinfo.msghandle)e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Verified handle</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>",setModalContent("xxAddAgent","Messaging Notifications",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remove messaging</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate();else{e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>',e+="<td>Enter your messaging service and handle. Once verified, this server can send you login verification and other notifications.<br /><br />";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>";1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate()}}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Emne":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Brugernavn";var t=Q("d2handleinput").value.length>0;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){if(0!=Q("d2handleinput").value.length)return QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}),!1}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){if(!xxdialogMode&&8388608&features){var e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified;setModalContent("xxAddAgent","E-mail godkendelse",'Når aktiveret, vil du ved hvert login få mulighed for at modtage et login-token til din e-mail-konto for øget sikkerhed.<br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+(e?"checked":"")+"/>Aktivér e-mail 2-faktor godkendelse.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})})}}function account_manageAuthDuo(){!xxdialogMode&&536870912&features2&&(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo Authentication",'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo Authentication",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&4096&features)return 1==userinfo.otpsecret?account_removeOtp():account_addOtp(),!1}function account_addOtp(){!xxdialogMode&&1!=userinfo.otpsecret&&4096&features&&(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","Godkender App","<div id=d2optinfo>Indlæser...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){return meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value}),!1}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){!xxdialogMode&&1==userinfo.otpsecret&&4096&features&&(setModalContent("xxAddAgent","Godkender App","Bekræft fjernelse af godkendelsesapplikation 2-trins login?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return!!(4096&features)&&(count2factoraAuths()>0&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1)}function account_managePushAuthDev(){if(!xxdialogMode&&64&features2){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Godkendelses enhed","Bekræft fjernelse af push-godkendelsesenhed?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(var t in nodes){var n=nodes[t];null!=n.agent&&14==n.agent.id&&1==n.pmt&&4294967295==GetNodeRights(n)&&e.push(n)}if(0==e.length)setModalContent("xxAddAgent","Godkendelses enhed","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var o="Vælg en enhed, der skal registreres til push-notifikationsgodkendelse. Når den er valgt, vil enheden bede om bekræftelse.<br /><br />",i='<select id=d2devselect class="form-select">';for(var t in e)i+='<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>";setModalContent("xxAddAgent","Godkendelses enhed",o+=addHtmlFormFloating("Enhed",i+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),!(xxdialogMode||!(4096&features))&&(meshserver.send({action:"otp-hkey-get"}),!1)}function account_addhkey(e){if(3==e){var t="Indtast navnet på den nøgle, der skal tilføjes.<br /><br />";t+=addHtmlFormFloating("Nøglenavn",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="MyKey" onkeyup=account_addhkeyValidate(event,2) />')}else if(2==e){t="Indtast et nøglenavn, vælg OTP-boksen og tryk på knappen på YubiKey™.<br /><br />";t+=addHtmlFormFloating("Nøglenavn",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="MyKey" onkeyup=account_addhkeyValidate(event,1) />'),t+=addHtmlFormFloating("YubiKey™ OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')}setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var n=Q("dp1keyname").value;if(""==n&&(n="MyKey"),2==t)meshserver.send({action:"otp-hkey-yubikey-add",name:n,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Tilføj sikkerhedsnøgle","<br />Kontrollerer...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");else if(3==t)return meshserver.send({action:"webauthn-startregister",name:n}),!1}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"Afrikansk",sq:"Albansk",ar:"Arabisk (standard)","ar-dz":"Arabisk (Algeriet)","ar-bh":"Arabisk (Bahrain)","ar-eg":"Arabisk (Egypten)","ar-iq":"Arabisk (irak)","ar-jo":"Arabisk (Jordanien)","ar-kw":"Arabisk (Kuwait)","ar-lb":"Arabisk (Libanon)","ar-ly":"Arabisk (Libyen)","ar-ma":"Arabisk (Marokko)","ar-om":"Arabisk (oman)","ar-qa":"Arabisk (Qatar)","ar-sa":"Arabisk (Saudiarabien)","ar-sy":"Arabisk (Syrien)","ar-tn":"Arabisk (Tunesien)","ar-ae":"Arabisk (U.A.E.)","ar-ye":"Arabisk (Yemen)",an:"Aragonesisk",hy:"Armensk",as:"Assamesisk",ast:"Asturisk",az:"Azerbajdzjansk",eu:"Baskisk",bg:"Bulgarsk",be:"Hviderussisk",bn:"Bengalsk",bs:"Bosnisk",br:"Bretonsk",my:"Burmesisk",ca:"Katalansk",ch:"Chamorro",ce:"Tjetjensk",zh:"Kinesisk","zh-hk":"Kinesisk (Hong Kong)","zh-cn":"Kinesisk (PRC)","zh-sg":"Kinesisk (Singapore)","zh-tw":"Kinesisk (Taiwan)",cv:"Chuvash",co:"Korsikansk",cr:"Cree",hr:"Kroatisk",cs:"Tjeckisk",da:"Dansk",nl:"Hollandsk (standard)","nl-be":"Hollandsk (belgisk)",en:"Engelsk","en-au":"Engelsk (Australien)","en-bz":"Engelsk (Belize)","en-ca":"Engelsk (Canada)","en-ie":"Engelsk (Irland)","en-jm":"Engelsk (Jamaica)","en-nz":"Engelsk (New Zealand)","en-ph":"Engelsk (Filippinerne)","en-za":"Engelsk (Sydafrika)","en-tt":"Engelsk (Trinidad og Tobago)","en-gb":"Engelsk (Storbritanien)","en-us":"Engelsk (United States)","en-zw":"Engelsk (Zimbabwe)",eo:"Esperanto",et:"Estisk",fo:"Færøsk",fa:"Farsi (persisk)",fj:"Fijisk",fi:"Finsk",fr:"Fransk (standard)","fr-be":"Fransk (Belgien)","fr-ca":"Fransk (Canada)","fr-fr":"Fransk (Frankrig)","fr-lu":"Fransk (Luxembourg)","fr-mc":"Franske (Monaco)","fr-ch":"Fransk (Schweiz)",fy:"Frisisk",fur:"Friulian",gd:"Gælisk (skotsk)","gd-ie":"Gælisk (Irlandsk)",gl:"Galacian",ka:"Georgisk",de:"Tysk (standard)","de-at":"Tysk (Østrigsk)","de-de":"Tysk (Tyskland)","de-li":"Tysk (Liechtenstein)","de-lu":"Tysk (Luxembourg)","de-ch":"Tysk (Schweiz)",el:"Græsk",gu:"Gujurati",ht:"Haitiansk",he:"Hebræisk",hi:"Hindi",hu:"Ungarsk",is:"Islandsk",id:"Indonesisk",iu:"Inuktitut",ga:"Irsk",it:"Italiensk (Standard)","it-ch":"Italiensk (Schweiz)",ja:"Japansk",kn:"Canada",ks:"Kashmirsk",kk:"Kazakstansk",km:"Khmer",ky:"Kirghisisk",tlh:"Klingon",ko:"Koreansk","ko-kp":"Koreansk (Nordkorea)","ko-kr":"Koreansk (Sydkorea)",la:"Latinsk",lv:"Lettisk",lt:"Litauisk",lb:"Luxembourgsk",mk:"FYRO Makedonsk",ms:"Malaysisk",ml:"Malayalam",mt:"Maltesisk",mi:"Maori",mr:"Marathi",mo:"Moldavisk",nv:"Navajo",ng:"Ndonga",ne:"Nepalesisk",no:"Norsk",nb:"Norsk (bokmal)",nn:"Norsk (nynorsk)",oc:"Occitansk",or:"Oriya",om:"Oromo","fa-ir":"Persisk/Iran",pl:"Polsk",pt:"Portugisisk","pt-br":"Portugisisk (Brasilien)",pa:"Punjabi","pa-in":"Punjabi (Indien)","pa-pk":"Punjabi (Pakistan)",qu:"Quechua",rm:"Retoromansk",ro:"Rumænsk","ro-mo":"Rumænsk (Moldavien)",ru:"Russisk","ru-mo":"Russisk (Moldavien)",sz:"Samisk (lappisk)",sg:"Sango",sa:"Sanskrit",sc:"Sardinsk",sd:"Sindhi",si:"Singhalese",sr:"Serbisk",sk:"Slovakisk",sl:"Slovensk",so:"Somani",sb:"Sorbisk",es:"Spansk","es-ar":"Spansk (Argentina)","es-bo":"Spansk (Bolivia)","es-cl":"Spansk (Chile)","es-co":"Spansk (Colombia)","es-cr":"Spansk (Costa Rica)","es-do":"Spansk (Dominikanske republik)","es-ec":"Spansk (Ecuador)","es-sv":"Spansk (El Salvador)","es-gt":"Spansk (Guatemala)","es-hn":"Spansk (Honduras)","es-mx":"Spansk (Mexico)","es-ni":"Spansk (Nicaragua)","es-pa":"Spansk (Panama)","es-py":"Spansk (Paraguay)","es-pe":"Spansk (Peru)","es-pr":"Spansk (Puerto Rico)","es-es":"Spansk (Spanien)","es-uy":"Spansk (Uruguay)","es-ve":"Spansk (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"svensk","sv-fi":"Svensk (Finland)","sv-sv":"Svensk (Sverige)",ta:"Tamil",tt:"Tatarisk",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Tyrkisk",tk:"Turkmen",uk:"Ukrainsk",hsb:"Øvre sorbisk",ur:"Urdu",ve:"Venda",vi:"Vietnamesisk",vo:"Volapyk",wa:"Vallonsk",cy:"Walesisk",xh:"Xhosa",ji:"Jiddisch",zu:"Zulu"},loclistex={"zh-chs":"Kinesisk (Simpel)","zh-cht":"Kinesisk (Traditionel)"};function account_showLocalizationSettings(){if(xxdialogMode)return!1;var e=getstore("loctag",0),t="",n='<select id=d2locselect class="form-select"><option value="*">Brugerbrowserværdi</option>';for(var o in loclist)n+='<option value="'+o+'"'+(e==o?" selected":"")+">"+o+" - "+loclist[o]+"</option>";if(n+="</select>",serverinfo.languages&&serverinfo.languages.length>0){t+="Ændring af sproget kræver at du opdaterer siden.<br /><br />";var i='<select id=d2langselect class="form-select"><option value="*">Brugerbrowserværdi</option>';for(var o in serverinfo.languages){var s=serverinfo.languages[o];i+='<option value="'+s+'"'+(userinfo.lang==s?" selected":"")+">"+s+" - "+(loclist[s]?loclist[s]:loclistex[s])+"</option>"}t+=addHtmlFormFloating("Sprog",i+="</select>")}return t+=addHtmlFormFloating("Dato og tid",n),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Hjælp med at oversætte MeshCentral</a>'),setModalContent("xxAddAgent","Lokaliseringsindstillinger",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx),!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),t=e?e.value:null;"*"==t&&null==userinfo.lang&&(t=userinfo.lang),t!=userinfo.lang&&meshserver.send({action:"changelang",lang:t});var n=getstore("loctag",0),o=Q("d2locselect").value;n!=o&&("*"!=o?args.locale=o:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e="",t="Opret et midlertidigt brugernavn og adgangskode, der kan bruges som alternativt login til din konto. Dette er nyttigt for at give værktøjer eller andre tjenester adgang til din konto.<br /><br />",n={0:"Ubegrænset",1:"1 minut",5:"5 minutter",10:"10 minutter",15:"15 minutter",30:"30 minutter",45:"45 minutter",60:"60 minutter",120:"2 timer",240:"4 timer",480:"8 timer",720:"12 timer",960:"16 timer",1440:"24 timer",2880:"2 dage",5760:"4 dage",10080:"7 Dages"};for(var o in n)e+="<option value="+o+">"+n[o]+"</option>";t+='<div class="form-floating mb-3">',t+='<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Token Navn" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>',t+="<label for=d2tokenName>Token Navn</label>",t+="</div>",setModalContent("xxAddAgent","Opret Login Token",t+=addHtmlFormFloating("Udløbstid",'<select class="boxsize form-select" id=d2tokenExpire>'+e+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",Q("d2tokenName").value.length>0)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){if(xxdialogMode)return!1;setModalContent("xxAddAgent","Beskedindstillinger",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Lyd for besked</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Vis enhedsgruppenavn</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Enhedsforbindelser</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Enheds afbrydelser</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT desktop og serial hændelser</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx);var e=getstore("notifications",0);return Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e,!1}function account_showAccountNotifySettingsEx(){var e=0;e+=Q("p2notifyPlayNotifySound").checked?1:0,e+=Q("p2notifyIntelDeviceConnect").checked?2:0,e+=Q("p2notifyIntelDeviceDisconnect").checked?4:0,e+=Q("p2notifyIntelAmtKvmActions").checked?8:0,putstore("notifications",e+=Q("p2notifyGroupName").checked?16:0)}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","E-mail bekræftelse","Klik ok for at sende en bekræftelsesmail til:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Vent et par minutter på at modtage bekræftelsen."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){if(xxdialogMode)return!1;return setModalContent("xxAddAgent","Ændring af e-mail adresse",'Skift email adresse for din konto her.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus(),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){if(xxdialogMode)return!1;var e="For at slette denne konto skal du indtaste kontoadgangskoden i begge felter nedenfor og trykke på ok.<br /><br />";return e+="<form method=post>",e+="<input type=hidden name=action value=deleteaccount />",e+='<input type=hidden name=authcookie value="'+authCookie+'" />',e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+='<label for="apassword1">Password</label>',e+="</div>",e+='<div class="form-floating mb-3">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+="<label for=apassword2>Confirm Password</label>",e+="</div>",e+="</div>",setModalContent("xxAddAgent","Slet Konto",e+="</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus(),!1}function account_showChangePassword(){if(xxdialogMode)return!1;var e="Skift din kontoadgangskode ved at indtaste den gamle adgangskode og den nye adgangskode to gange i felterne nedenfor.";if(e+="<br /><br />",e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword0>Old password</label>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword1>New password</label>",e+="<b><span id=dxPassWarn></span></b>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword2>Confirm new password</label>",e+="</div>",65536&features&&(e+='<div class="form-floating mb-2">',e+='<input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apasswordhint>Password hint</label>",e+="</div>"),e+="</div>",passRequirements){var t=[],n=0;for(var o in passRequirements)"reset"!=o&&"hint"!=o&&(t.push(o+":"+passRequirements[o]),n++);n>0&&(e+="<br /><span style=font-size:x-small>Krav:"+t.join(", ")+".</span>")}return setModalContent("xxAddAgent","Skift Kodeord",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword(),!1}function account_showChangePasswordEx(){if(Q("apassword1").value==Q("apassword2").value){var e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value};65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e)}}function account_showThemesSwitcher(){if(xxdialogMode)return!1;var e=getstore("theme")||"default",t=JSON.parse(getstore("lastThemes")||"[]"),n=new Set(t),o='<div class="form-group"><label for="theme-switcher">Vælg et tema:</label>';return o+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',t.length>0&&(o+='<optgroup label="Seneste temaer"">',t.forEach(function(t){o+=`<option value="${t}"${t===e?" selected":""}>${t.charAt(0).toUpperCase()+t.slice(1)}</option>`}),o+="</optgroup>"),o+='<optgroup label="Alle temaer">',[{value:"default",label:"Standard"},{value:"cerulean",label:"Cerulean"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Darkly"},{value:"flatly",label:"Flatly"},{value:"journal",label:"Journal"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(t){if(!n.has(t.value)){var i=t.value===e?" selected":"";o+=`<option value="${t.value}"${i}>${t.label}</option>`}}),o+="</optgroup>",setModalContent("xxAddAgent","Skift tema",o+="</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function account_switchThemeEx(){const e=document.getElementById("theme-switcher").value,t="default"!=e?encodeURIComponent(e):encodeURIComponent("..");document.getElementById("theme-stylesheet").href=`styles/themes/${t}/bootstrap-min.css`,putstore("theme",e);var n=JSON.parse(getstore("lastThemes")||"[]");n.includes(e)?(n=n.filter(t=>t!==e)).unshift(e):(n.length>=4&&n.pop(),n.unshift(e)),putstore("lastThemes",JSON.stringify(n))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin)return setModalContent("xxAddAgent","Ny enhedsgruppe","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Konto sikkerhed",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Konto sikkerhed",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;var e=[];if(!(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}var o="Opret en ny enhedsgruppe ved hjælp af mulighederne nedenfor.<br /><br />",i="";if(o+=addHtmlFormFloating("Navn",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),1&features||(i+="<option value=3>Lokale enheder, ingen agent</option>"),!(2&features)&&e.length>0&&(i+="<option value=103>Ingen agentenheder videregivet gennem agenten</option>"),65536&features2&&(1&features||(i+="<option value=4>IP-KVM / Power device</option>"),!(2&features)&&e.length>0&&(i+="<option value=104>IP-KVM / Power-enhed videregivet gennem agent</option>")),o+=addHtmlFormFloating("Type","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Administrer ved hjælp af en softwareagent</option><option value=1>Kun Intel&reg; AMT, ingen agent</option>"+i+"</select>"),e.length>0){o+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var s=[];for(var t in e)s.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");o+=addHtmlFormFloating("Relay enhed","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+s.join("")+"</select>"),o+="</div>"}return o+=addHtmlFormFloating("Beskrivelse","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>"),o+="<div id=d2ipkvm style=display:none><hr />",o+=addHtmlFormFloating("Model","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Raritan Dominion KX III</option><option value=2>Web Power Switch 7</option></select>"),o+=addHtmlFormFloating("Hostnavn",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),o+=addHtmlFormFloating("Brugernavn",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),o+=addHtmlFormFloating("Kodeord",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />'),setModalContent("xxAddAgent","Ny enhedsgruppe",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus(),!1}function account_validateMeshCreate(e,t){var n=parseInt(Q("dp2meshtype").value);1==t&&null!=e&&"Enter"==e.key&&Q("dp2meshname").value.length>0&&Q("dp2meshtype").focus(),2==t&&null!=e&&"Enter"==e.key&&Q("dp2meshdesc").focus();var o=Q("dp2meshname").value.length>0;QV("d2ipkvm",4==n||104==n);try{QV("d2devrelaydiv",n>100)}catch(e){}4==n&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(o=!1),QE("idx_dlgOkButton",o)}function account_createMeshEx(e,t){var n=parseInt(Q("dp2meshtype").value),o={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:n,desc:Q("dp2meshdesc").value};4!=n&&104!=n||(o.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),o.kvmhost=Q("dp2ipkvmhost").value,o.kvmuser=Q("dp2ipkvmuser").value,o.kvmpass=Q("dp2ipkvmpass").value),n>100&&(o.meshtype=n-100,o.relayid=Q("d2devrelay").value),meshserver.send(o)}function account_validateDeleteAccount(){QE("account_dlgOkButton",Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e="",t=Q("apassword0").value.length>0&&Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;if(65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(t=!1),""!=Q("apassword1").value)if(null==passRequirements||""==passRequirements){var n=checkPasswordStrength(Q("apassword1").value);e=n>=80?"<span style=color:green>Stærk<span>":n>=60?"<span style=color:blue>God<span>":"<span style=color:red>Svag<span>"}else{0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(t=!1,e="<span style=color:red>Politik<span>")}QH("dxPassWarn",e),QE("idx_dlgOkButton",t)}function checkPasswordStrength(e){var t=0,n={},o=0,i={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var s=0;s<e.length;s++)n[e[s]]=(n[e[s]]||0)+1,t+=5/n[e[s]];for(var a in i)o+=1==i[a]?1:0;return parseInt(t+10*(o-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var n=0,o=0,i=0,s=0,a=0;a<e.length;a++)/\d/.test(e[a])&&n++,/[a-z]/.test(e[a])&&o++,/[A-Z]/.test(e[a])&&i++,/\W/.test(e[a])&&s++;return!(t.numeric&&n<t.numeric)&&(!(t.lower&&o<t.lower)&&(!(t.upper&&i<t.upper)&&!(t.nonalpha&&s<t.nonalpha)))}function updateMeshes(){var e='<div class="row">',t=0,n=0,o=[];for(i in meshes)o.push(meshes[i]);for(i in o.sort(nameSort),o){t>1&&(e+="</tr><tr>",t=0),t++,n++;var s=GetMeshRights(o[i]),a="Delvise rettigheder";4294967295==s?a="Fuld Administrator":0==s&&(a="Ingen rettigheder"),e+='\n                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"\n                            onclick="gotoMesh(\''+o[i]._id+"')\"\n                            onkeypress=\"if (event.key=='Enter') gotoMesh('"+o[i]._id+'\')"\n                            style="cursor:pointer;">\n                        <div class="card mb-3">\n                            <div class="row g-0">\n                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">\n                                    <i class="mi me-1"></i>\n                                </div>\n                                <div class="col-10 mx-auto" tabindex="0">\n                                    <div class="card-body" style=padding:0;>\n                                        <h5 class="card-title e1">'+EscapeHtml(o[i].name)+'</h5>\n                                        <p class="card-text">'+a+'</p>\n                                        <div class="g2"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    '}e+="</div>",meshcount=n,QH("p2meshes",e),QV("p2noMeshFound",0==n)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&loginTokens.length>0){e+='<p><strong>Aktive login Tokens</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Ny</button></span></p>',e+='<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Navn</th><th scope=col style=text-align:left>Brugernavn</th></tr>';for(var n=0;n<loginTokens.length;n++){var o=loginTokens[n],i="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(o.tokenUser)+'")\' title="Fjern login-token" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',s="";0!=o.expire&&(s=EscapeHtml(format("Udløber {0}",printDateTime(new Date(o.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(o.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+s+i+"</div><div>"+EscapeHtml(o.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var n=null,o=0;o<loginTokens.length;o++)loginTokens[o].tokenUser==t&&(n=loginTokens[o]);if(null!=n){var i="Bekræft fjernelse af dette login-token?<br /><br />";i+=addHtmlValue("Navn",EscapeHtml(n.name)),setModalContent("xxAddAgent","Fjern login-token",i+=addHtmlValue("Brugernavn",EscapeHtml(n.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})})}}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e=miscState.googleDrive;if(e.state<3){var t='<img style=float:right src="images/googledrive-48.png" /><div>Konfigurer denne server til automatisk at uploade sikkerhedskopier til Google Drev. Start med at oprette og indtaste et Google Drive ClientID og ClientSecret for din konto.</div><br />';t+=addHtmlValue("Legitimationsoplysninger",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Google Drive konsol</a>'),t+=addHtmlFormFloating("Klient ID",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'),setModalContent("xxAddAgent","Google Drive Backup",t+=addHtmlFormFloating("Klient kode",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)}else if(3==e.state){t='<img style=float:right src="images/googledrive-48.png" /><div>Google Drive backup er i øjeblikket aktiv.</div>';setModalContent("xxAddAgent","Google Drive Backup",t+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Fjern konfiguration</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1)}}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",Q("gdclientid").value.length>0&&Q("gdclientsecret").value.length>0)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",Q("gdcode").value.length>0)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){if(xxdialogMode)return!1;var e="Gendan serveren ved hjælp af en sikkerhedskopi, <span style=color:red>dette vil slette de eksisterende serverdata.</span> Gør kun dette, hvis du ved, hvad du laver.<br /><br />";return e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>',e+="<input type=hidden name=auth value="+authCookie+">",e+='<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>',setModalContent("xxAddAgent","Gendan server",e+="</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore(),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","MeshCentral-version","Indlæser..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Ukendt"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Ukendt"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Errors","Indlæser..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Ingen</i>"),1&e&&(t='<span role=button tabindex=0 title="Klik her for at redigere enhedsgruppens navn" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",t),QV("MeshSummary",4!=currentMesh.mtype);var n=format("Ukendt #{0}",currentMesh.mtype);1==currentMesh.mtype&&(n="Kun Intel&reg; AMT, ingen agent"),2==currentMesh.mtype&&(n="Administreret ved hjælp af en softwareagent"),3==currentMesh.mtype&&(n=null==currentMesh.relayid?"Lokale enheder, ingen agent":"Ingen agentenheder videregivet gennem agenten"),4==currentMesh.mtype&&(n=null==currentMesh.relayid?"IP-KVM device":"IP-KVM-enhed videregivet via agent",1==currentMesh.kvm.model&&(n+=", Raritan KX III"));var o="";if(8&args.hide&&(o+=addHtmlValue("Navn",t)),o+=addHtmlValue("Beskrivelse",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Ingen</i>","p20editmesh(2)",!!(1&e))),o+=addHtmlValue("Type",n),(3==currentMesh.mtype||4==currentMesh.mtype)&&null!=currentMesh.relayid){var i="<i>Ukendt</i>",s=getNodeFromId(currentMesh.relayid);null!=s&&(i=EscapeHtml(s.name)+" ("+EscapeHtml(s.meshnamel)+")"),o+=addHtmlValue("Relay enhed",addLinkConditional(i,"p20editmeshrelay()",!!(1&e)))}if(4==currentMesh.mtype&&(o+=addHtmlValue("Hostnavn",currentMesh.kvm.host),o+=addHtmlValue("Brugernavn",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]){var a=users[currentMesh.creatorid];o+=addHtmlValue("Oprettet af",'<a href=# onclick=gotoUser("'+encodeURIComponentEx(a._id)+'",false,null)>'+EscapeHtml(a.name)+"</a>")}else null!=currentMesh.creatorname&&(o+=addHtmlValue("Oprettet af",EscapeHtml(currentMesh.creatorname)));if(null!=currentMesh.creation&&(o+=addHtmlValue("Oprettelsestidspunkt",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype){var r=[];currentMesh.flags&&(1&currentMesh.flags&&r.push("Auto-fjernelse"),2&currentMesh.flags&&r.push(4==currentMesh.mtype?"Port Navn Synkronisering":"Hostnavn sync"),8&currentMesh.flags&&r.push("prefer --agentname"),16&currentMesh.flags&&r.push("allow override"),1==serverinfo.devGroupSessionRecording&&4&currentMesh.flags&&r.push("Optag sessioner")),"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&r.push("Fjern inaktive"),""==(r=r.join(", "))&&(r="<i>Ingen</i>"),o+=addHtmlValue("Funktioner",addLinkConditional(r,"p20editmeshfeatures()",1&e))}if(2==currentMesh.mtype){r=[];var l=0;currentMesh.consent&&(l=currentMesh.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?r.push("Skrivebords Prompt + Værktøjslinje"):64&l?r.push("Skrivebords værktøjslinje"):8&l?r.push("Prompt på skrivebordet"):1&l&&r.push("Skrivebordsnotifikation"),16&l?r.push("Terminal Prompt"):2&l&&r.push("Terminalbesked"),32&l?r.push("Filer Prompt"):4&l&&r.push("Filer Notifikation"),7==l&&(r=["Altid besked"]),56&~l||(r=["Spørg altid"]),""==(r=r.join(", "))&&(r="<i>Ingen</i>"),o+=addHtmlValue("Brugersamtykke",addLinkConditional(r,"p20editmeshconsent(1)",1&e))}if(!(3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&1024&userinfo.siteadmin)){var d=0,c=[];if(userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(d|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(d|=userinfo.notify[currentMesh._id]),2&d&&c.push("Forbind"),4&d&&c.push("Afbryd"),8&d&&c.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var u=0;16&d&&u++,32&d&&u++,64&d&&u++,u>0&&c.push(format("Email ({0})",u))}if(null!=userinfo.msghandle&&33554432&features2){u=0;128&d&&u++,256&d&&u++,512&d&&u++,u>0&&c.push(format("Messaging ({0})",u))}0==c.length&&c.push("<i>Ingen</i>"),o+=addHtmlValue("Beskeder",addLink(c.join(", "),"p20editMeshNotify()"))}if(16777216&features&&2==currentMesh.mtype){var p="<i>Ingen</i>",m=!1;null!=currentMesh.invite&&(m=!0,p=currentMesh.invite.codes.join(", ")),o+=addHtmlValue("Invitationskoder",addLinkConditional(p,"p20editmeshInviteCode()",1&e||m))}if(currentMesh.mtype<3&&1&features2){var g="Ingen politik";currentMesh.amt&&(1==currentMesh.amt.type?g="Deaktivér":2==currentMesh.amt.type?(g="Simpel Client Control Mode (CCM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):3==currentMesh.amt.type?(g="Simpel Admin Control Mode (ACM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):4==currentMesh.amt.type&&(g="Fuldt automatisk")),o+=addHtmlValue("Intel&reg; AMT",addLinkConditional(g,"p20editMeshAmt()",1&e))}if(1&e&&(o+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Noter title="Se noter om denne enhedsgruppe" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),o+="<br style=clear:both><br>",2&e&&(o+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Tilføj brugere</button>',null!=usergroups)){var v=0,h=!1;for(var f in usergroups)null==usergroups[f].membershipType&&usergroups[f]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(v++,null!=currentMesh.links&&null!=currentMesh.links[f]||(h=!0));v>0&&h&&(o+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Tilføj brugergruppe</button>')}1==currentMesh.mtype&&(1&e&&(o+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Import Intel&reg; AMT devices." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Import</button>'),null!=currentMesh.amt&&currentMesh.amt.type>0&&(o+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Udfør Intel&reg; AMT-aktivering og konfiguration." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Opsætning</button>')),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(o+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Tilføj en ny computer til denne enhedsgruppe ved at installere mesh-agenten."><i class="fa-solid fa-circle-plus"></i> Tilføj agent</button>',o+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Inviter nogen til at installere mesh-agenten på denne enhedsgruppe."><i class="fa-solid fa-user-plus"></i> Invitere</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(o+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Tilføj enhed placeret på det lokale netværk."><i class="fa-solid fa-circle-plus"></i> Tilføj en enhed</button>'),!(currentMesh.amt&&currentMesh.amt.type>2)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(o+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Skift Intel AMT til Admin Control Mode (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),o+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Brugerautorisationer</th><th scope=col></th></tr>';var k=1,x=[];for(var f in currentMesh.links){var b=f.split("/")[2];currentMesh.links[f].name&&(b=currentMesh.links[f].name),f==userinfo._id&&(b=userinfo.name),null!=usergroups&&null!=usergroups[f]&&(b=usergroups[f].name),x.push({id:f,name:b,rights:currentMesh.links[f].rights})}for(var f in x.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),x){var y="",w=makeDeviceGroupRightsString(x[f].rights),S="fa-user";x[f].id!=userinfo._id&&(4294967295==e||2&e)&&(4294967295!=e&&4294967295==currentMesh.links[x[f].id].rights||(y="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(x[f].id)+'")\' title="Fjern brugerrettigheder til denne enhedsgruppe"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),w='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(x[f].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(x[f].id)+"')\">"+w+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),x[f].id.startsWith("ugrp/")&&(S="fa-users");var M=EscapeHtml(decodeURIComponent(x[f].name));null!=usergroups&&x[f].id.startsWith("ugrp/")&&(M="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(x[f].id)+"\");haltEvent(event);'>"+M+"</a>"),null!=users&&x[f].id.startsWith("user/")&&(M="<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(x[f].id)+"\");haltEvent(event);'>"+M+"</a>"),o+="<tr style="+(k%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Bruger" class="fa-solid fa-fw '+S+'"></i>&nbsp;'+M+"<div></div></div></td><td style=width:70%><div style=float:right>"+y+"</div><div>"+w+"</div></td></tr>",++k}if(o+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&deviceShares.length>0){o+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktiv enhedsdeling</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>',k=1;for(f=0;f<deviceShares.length;f++){var C=deviceShares[f];y="";null!=C.url&&(y+='<a href="'+C.url+'" rel="noreferrer noopener" target=_blank title="Enhedsdelings link" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),y+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(C.nodeid)+'","'+encodeURIComponentEx(C.publicid)+'","'+encodeURIComponentEx(C.guestName)+'")\' title="Fjern enhedsdeling" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>';var A="";C.p<=7?A=["","Terminal","Skrivebord","Skrivebord + Terminal","Filer","Terminal + filer","Skrivebord + Filer","Skrivebord + Terminal + Filer"][C.p]:8==C.p?A="HTTP/"+C.port:16==C.p&&(A="HTTPS/"+C.port);var Q=A;null!=C.startTime&&null!=C.expireTime&&(Q=format("{0}, {1} til {2}",A,printFlexDateTime(new Date(C.startTime)),printFlexDateTime(new Date(C.expireTime)))),null!=C.startTime&&null!=C.duration&&(Q=C.duration<2?format("{0}, {1} i {2} minut",A,printFlexDateTime(new Date(C.startTime)),C.duration):format("{0}, {1} i {2} minutter",A,printFlexDateTime(new Date(C.startTime)),C.duration)),1==C.recurring&&(Q+=", Tilbagevendende dagligt"),2==C.recurring&&(Q+=", Tilbagevendende ugentligt"),2&C.p&&!0===C.viewOnly&&(Q+=", Vis kun skrivebord"),null!=C.consent&&(0==C.consent?Q+=", Ingen samtykke":(56&C.consent&&(Q+=", Bed om samtykke"),64&C.consent&&(Q+=", Værktøjsfelt")));var D=EscapeHtml(C.guestName);if(C.publicid.startsWith("AS:node/")&&(D="<i>Agent selv-deling</i>"),null!=(N=getNodeFromId(C.nodeid))){var T=N.conn>0?"":" gray";o+="<tr "+(++k%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+N._id+'",10);haltEvent(event);\' style=float:left class="j'+N.icon+T+'"></div>&nbsp;<a onclick=\'gotoDevice("'+N._id+"\",10);haltEvent(event);'>"+EscapeHtml(N.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+D+"<div></div></div></td><td style=width:70%><div style=float:right>"+y+"</div><div>"+Q+"</div></td></tr>"}}o+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));k=0,nodes.sort(deviceSort);var E="";1==currentMesh.mtype&&(E+='<a onclick=meshDownloadDeviceList()><img title="Download enhedsliste" src="images/link4.png" /></a>',1&features||(E+=' <a onclick=meshImportDeviceList()><img title="Importér enhedsliste" src="images/link6.png" /></a>'));var I='<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Enheder</th><th scope=col class="text-end">'+E+"</th></tr>";for(var f in nodes){var N;T=(N=nodes[f]).conn>0?"":" gray";currentMesh._id==N.meshid&&(I+="<tr><td style=width:30%><div onclick='gotoDevice(\""+N._id+'",10);haltEvent(event);\' style=float:left class="j'+N.icon+T+'"></div>&nbsp;<a onclick=\'gotoDevice("'+N._id+"\",10);haltEvent(event);'>"+EscapeHtml(N.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(N.pwr)+"&nbsp;</div><div>"+(N.osdesc?EscapeHtml(N.osdesc):"")+"</div></td></tr>",++k)}0==k&&(I+='<tr><td colspan="2"><i>Ingen</i></td></tr>'),I+="</tbody></table>",4294967295==e&&(I+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Slet Gruppe</a></span></div>"),QH("p20info",o),QH("p20info2",I);var _="";if(!(268435456&features)&&xxcurrentView>=20&&xxcurrentView<=29&&null!=currentMesh){for(var f in _="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)_+="&"+f+"="+urlargs[f];try{window.history.replaceState({},document.title,window.location.pathname+_)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e={webappversion:"0.9.0",computers:[]};for(var t in nodes){var n=nodes[t];if(currentMesh._id==n.meshid&&null!=n.intelamt){var o={name:n.name,host:n.host,user:n.intelamt.user,pass:"",tls:1==n.intelamt.tls?1:0,ver:n.intelamt.ver,pstate:n.intelamt.state};2==n.intelamt.state&&(o.pmode=1),n.intelamt.realm&&(o.digestrealm=n.intelamt.realm),n.intelamt.hash&&(o.tlscerthash=n.intelamt.hash),e.computers.push(o)}}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(e,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){if(!xxdialogMode){setModalContent("xxAddAgent","Importér Intel&reg; AMT enheder",'Importér en liste over lokale Intel&reg; AMT-enheder i MeshCommander JSON-format.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1)}}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importér Intel&reg; AMT enheder",format("Ugyldig JSON-fil: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var n=0;for(var o in t.computers){var i=t.computers[o];if("string"==typeof i.name&&"string"==typeof i.host&&"string"==typeof i.user&&"string"==typeof i.pass){var s={action:"addamtdevice",meshid:currentMesh._id,devicename:i.name,hostname:i.host,amtusername:i.user,amtpassword:i.pass,amttls:1==i.tls?1:0};"string"==typeof i.ver&&(s.ver=i.ver),"number"==typeof i.pstate&&(s.state=i.pstate),"string"==typeof i.digestrealm&&(s.realm=i.digestrealm),"string"==typeof i.tlscerthash&&(s.hash=i.tlscerthash),meshserver.send(s),n++}}0==n&&setModalContent("xxAddAgent","Brugerkontoimport","Unable to import any device.")}else setModalContent("xxAddAgent","Importér Intel&reg; AMT enheder","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){if(!xxdialogMode){var e="",t="";1048576&features&&(t="<option value=3>Simpel Admin Control Mode (ACM)</option>"),e+=addHtmlFormFloating("Type",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Ingen politik</option><option value=1>Deaktivér</option><option value=2>Simpel Client Control Mode (CCM)</option>'+t+"<option value=4>Fuldt automatisk</option></select>"),setModalContent("xxAddAgent","Intel&reg; AMT-politik",e+="<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),1024&features||(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy()}}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t+=addHtmlFormFloating("Kodeord",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Tilfældig adgangskode</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Behold eksisterende adgangskode</option>":"")+"<option value=2>Vælg ny adgangskode</option></select>"),t+="<div id=dp20amtpassdiv style=display:none>",t+=addHtmlFormFloating("Nyt kodeord*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+=addHtmlFormFloating("Nyt kodeord*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+="</div>",3==e&&(t+=addHtmlFormFloating("CCM mode",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Foretag ikke ændringer, behold CCM, hvis opsat</option><option value=1>Deaktiver CCM hvis sat op</option><option value=2>Aktiver til CCM hvis ACM fejler</option></select>')),t+="<div id=dp20amtbadpassdiv style=display:none>",t+=addHtmlFormFloating("Ukendt adgangskode",'<select id=dp20amtbadpass class="form-select"><option value=0>Gør ingenting</option><option value=1>Hvis du er i CCM, genaktiver Intel&reg; AMT</option></select>'),t+="</div>",1024&features||(t+=addHtmlFormFloating("CIRA konfiguration",'<select id=dp20amtcira class="form-select" title="Klientinitieret fjernadgang"><option value=0>Gør ingenting</option><option value=1>Forbind ikke til serveren</option><option value=2>Forbind til serveren</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 tegn, 1 STORT, 1 lille, 1 numerisk, 1 ikke-alfanumerisk.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Denne politik påvirker ikke enheder med Intel&reg; AMT i ACM-tilstand.</span>'));0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Når denne politik er valgt, administreres Intel&reg; AMT ikke af denne server. Intel AMT kan stadig bruges ved manuelt at aktivere og konfigurere det.</div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Når denne politik er valgt, vil enhver Intel&reg; AMT i Client Control Mode (CCM) blive deaktiveret. Andre enheder vil have CIRA ryddet og kan stadig administreres manuelt.</div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Dette er den anbefalede politik. Intel&reg; AMT aktivering og administration er fuldstændig automatiseret, og serveren vil forsøge at gøre bedst mulig brug af hardwareadministration.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e=!0,t=Q("dp20amtpolicy").value;if((2==t||3==t)&&2==Q("dp20amtpass").value){var n=Q("dp20amtpolicypass").value;e=n===Q("dp20amtpolicypass2").value&&passwordcheck(n)}QE("idx_dlgOkButton",e),2!=t&&3!=t||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==t||3==t)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==t||3==t&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},n=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(n=""),1==Q("dp20amtpass").value&&(n=null),2==Q("dp20amtpass").value&&(n=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):3==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){if(xxdialogMode)return!1;var e=format("Er du sikker på, at du vil slette gruppen {0}? Sletning af enhedsgruppen vil også slette alle oplysninger om enheder i denne gruppe.",EscapeHtml(currentMesh.name))+"<br /><br />";return setModalContent("xxAddAgent","Slet Gruppe",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />Bekræft</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog(),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(!(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}if(e.sort(nameSort),0==e.length)i="Ingen tilgængelige relæenheder.",setModalContent("xxAddAgent","Rediger enhedsgruppe","Ingen tilgængelige relæenheder."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var o=[];for(var t in e)o.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");var i=addHtmlFormFloating("Relay enhed",'<select id=d2devrelay class="form-select">'+o.join("")+"</select>");setModalContent("xxAddAgent","Rediger enhedsgruppe",i),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){if(!xxdialogMode){setModalContent("xxAddAgent","Rediger enhedsgruppe",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Navn" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Navn</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Beskrivelse"></textarea><label for=dp20meshdesc>Beskrivelse</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),2==e?Q("dp20meshdesc").focus():Q("dp20meshname").focus()}}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",Q("dp20meshname").value.length>0),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){if(!xxdialogMode){var t="",n=0,o="";1==e&&(n=currentMesh.consent?currentMesh.consent:0,o="Rediger enhedsgruppe brugersamtykke"),2==e&&(n=currentUser.consent?currentUser.consent:0,o="Rediger brugersamtykke"),3==e&&(n=currentNode.consent?currentNode.consent:0,o="Rediger enheds brugersamtykke"),4==e&&(n=currentUserGroup.consent?currentUserGroup.consent:0,o="Rediger brugergruppe brugersamtykke"),t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Skrivebord</b></div>',t+='<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&n?"checked":"")+">Giv bruger besked</label></div>",t+='<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&n?"checked":"")+">Bed om brugerens samtykke</label></div>",t+='<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&n?"checked":"")+">Vis forbindelsesværktøjslinjen</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminal</b></div>',t+='<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&n?"checked":"")+">Giv bruger besked</label></div>",t+='<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&n?"checked":"")+">Bed om brugerens samtykke</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Filer</b></div>',t+='<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&n?"checked":"")+">Giv bruger besked</label></div>",setModalContent("xxAddAgent",o,t+='<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&n?"checked":"")+">Bed om brugerens samtykke</label></div>"),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent)))}}function p20editmeshconsentEx(e,t){var n=0;Q("d20flag1").checked&&(n+=1),Q("d20flag2").checked&&(n+=8),Q("d20flag3").checked&&(n+=2),Q("d20flag4").checked&&(n+=16),Q("d20flag5").checked&&(n+=4),Q("d20flag6").checked&&(n+=32),Q("d20flag7").checked&&(n+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:n}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:n}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:n}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:n})}function p20editmeshfeatures(){if(!xxdialogMode){var e=currentMesh.flags?currentMesh.flags:0,t="",n=0;"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&(n=currentMesh.expireDevs)>2e3&&(n=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Optag sessioner</label><br></div>"),2!=currentMesh.mtype&&4!=currentMesh.mtype||(t+='<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Synkroniser serverenhedsnavnet med portnavnet":"Synkroniser serverenhedsnavn til værtsnavn")+"</label><br></div>",2==currentMesh.mtype&&(t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(8&e?"checked":"")+">Prefer value of --agentName</label><br></div>",t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag16 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(16&e?"checked":"")+">Allow to override server device name until next connection</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Fjern enheden ved frakobling</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(n>0?"checked":"")+">Automatisk fjerne inaktive enheder</label><br></div>",t+='<div style=margin-left:20px id=d20expireDeviceDev>Inaktive dage indtil fjernelse <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==n?30:n)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Som standard vil inaktive enheder blive fjernet efter 1 dag.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Som standard vil inaktive enheder blive fjernet efter {0} dage.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Rediger enhedsgruppefunktioner",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate()}}function p20editmeshfeaturesValidate(){var e=0,t=!0;if(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),2==currentMesh.mtype){Q("d20flag2").checked&&(e+=2,"d20flag2"==event.currentTarget.id&&(Q("d20flag8").checked=!0,Q("d20flag16").checked=!0));for(const t of[8,16]){const n=Q("d20flag"+t);(n.checked=n.checked&&!(n.disabled=!(2&e)))&&(e+=t)}}QE("d20expireDevice",!(1&e));var n=!(1&e)&&Q("d20expireDevice").checked;if(QV("d20expireDeviceDev",n),n){var o=parseInt(Q("d20expireDeviceDays").value);(isNaN(o)||o<1||o>2e3||o!=Q("d20expireDeviceDays").value)&&(t=!1)}QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0;2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2),Q("d20flag8").checked&&(e+=8),Q("d20flag16").checked&&(e+=16)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4);var t=0;1&e||!Q("d20expireDevice").checked||(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(xxdialogMode)return!1;var n="";if(null==e||5==e)null==t&&(n+=null==e?"Tillad brugere at administrere denne enhedsgruppe og enheder i denne gruppe.":"Tillad brugere at administrere denne enhed.",524288&features&&(n+=" Brugere skal logge ind på denne server én gang før de kan tilføjes til denne enhedsgruppe."),n+="<br /><br />"),n+="<div style='position:relative'>",n+=addHtmlFormFloating("Brugeridentifikatorer",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />'),n+="<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",n+="</div><br>";else if(1==e){var o="";if(null==t){var i=getOrderedList(meshes,"name");for(var s in i)null!=currentUser.links&&null!=currentUser.links[i[s]._id]||(o+="<option value="+encodeURIComponentEx(i[s]._id)+">"+EscapeHtml(i[s].name)+"</option>")}else o+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Enhedsgruppe","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+o+"</select>")}else if(2==e){if(null==usergroups)return;o="";var a=getOrderedList(usergroups,"name");for(var s in a)currentMesh._id.split("/")[1]==a[s]._id.split("/")[1]&&(null!=currentMesh.links&&null!=currentMesh.links[a[s]._id]||(o+="<option value="+encodeURIComponentEx(a[s]._id)+">"+EscapeHtml(a[s].name)+"</option>"));n+=addHtmlFormFloating("Brugergruppe",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+o+"</select>")}else if(6==e){if(null==usergroups)return;o="";if(null==t){a=getOrderedList(usergroups,"name");for(var s in a)null==a[s].membershipType&&currentNode._id.split("/")[1]==a[s]._id.split("/")[1]&&(null!=currentNode.links&&null!=currentNode.links[a[s]._id]||(o+="<option value="+encodeURIComponentEx(a[s]._id)+">"+EscapeHtml(a[s].name)+"</option>"))}else o+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Brugergruppe","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+o+"</select>")}else if(3==e){o="";t&&(t=decodeURIComponent(t));i=getOrderedList(meshes,"name");for(var s in i)null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[i[s]._id]||(o+="<option value="+encodeURIComponentEx(i[s]._id)+(t==i[s]._id?" selected":" ")+">"+EscapeHtml(i[s].name)+"</option>");n+=addHtmlFormFloating("Enhedsgruppe","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+o+"</select>")}else if(4==e||7==e){o="";var r=null,l=null;null!=t&&null!=(l=getNodeFromId(decodeURIComponent(t)))&&(r=l.meshid);i=getOrderedList(meshes,"name");for(var s in i)null!=i[s].links[userinfo._id]&&7&i[s].links[userinfo._id].rights&&(null==r&&(r=i[s]._id),o+="<option value="+encodeURIComponentEx(i[s]._id)+(r==i[s]._id?" selected":" ")+">"+EscapeHtml(i[s].name)+"</option>");n+=addHtmlFormFloating("Enhedsgruppe","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+o+"</select>"),o="";var d=getOrderedList(nodes,"name");for(var s in d)d[s].meshid==r&&(o+="<option value="+encodeURIComponentEx(d[s]._id)+(l==d[s]?" selected":" ")+">"+EscapeHtml(d[s].name)+"</option>");n+=addHtmlFormFloating("Enhed","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+o+"</select>")}else{var c=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(c=users[e].name),usergroups&&usergroups[e]&&(c=usergroups[e].name),userinfo._id==e&&(c=userinfo.name),e.startsWith("ugrp/")?n+=format("Gruppetilladelser for {0}.",c)+"<br /><br />":n+=format("Gruppetilladelser for brugeren {0}.",c)+"<br /><br />"}var u=-1,p=4!=e&&5!=e&&6!=e&&7!=e;if(n+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',p&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Fuld Administrator</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Rediger enhedsgruppe</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Administrer enhedsgruppebrugere</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Administrer enhedsgruppecomputere</label><br>'),n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Remote Control & Relay</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Kun fjernvisning</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Kun begrænset input</label><br>',!1!==serverinfo.guestdevicesharing&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Gæstedeling</label><br>'),n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Ingen skrivbordsadgang</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Ingen Terminaladgang</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Ingen filadgang</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Ingen Intel&reg; AMT</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Mesh Agent konsol</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Server Filer</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Væk enhed</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Rediger enhedsnoter</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Vis kun egne hændelser</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chat & Besked</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Afinstaller Agent / Slet enhed</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Fjernkommandoer</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Nulstil / Sluk</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Enhedsinformation</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Use as Relay</label><br>',n+="</div>",null==e)xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Tilføj brugere til enhedsgruppe",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus();else if(1===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Tilføj enhedsgruppetilladelser":"Rediger enhedsgruppetilladelser",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(u=meshes[decodeURIComponent(t)].links[currentUser._id].rights),4294967295==u&&(Q("p20fulladmin").checked=!0,u=-1);else if(2===e)xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Tilføj brugergruppe",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh));else if(3===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Tilføj enhedsgruppe":"Rediger enhedsgruppe",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),null!=t&&(u=currentUserGroup.links[decodeURIComponent(t)].rights),4294967295==u&&(Q("p20fulladmin").checked=!0,u=-1);else if(4===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Tilføj enhedstilladelser":"Rediger enhedstilladelser",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t);else if(7===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Tilføj enhedstilladelser":"Rediger enhedstilladelser",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(u=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1));else if(5===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Rediger brugerens enhedstilladelser":"Tilføj bruger enhedstilladelser",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],u=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus();else if(6===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Rediger brugergruppens enhedstilladelser":"Tilføj brugergruppe enhedstilladelser",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(u=currentNode.links[decodeURIComponent(t)].rights);else{e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Rediger enhedsgruppetilladelser",n)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Rediger bruger enhedsgruppe tilladelser",n)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)});GetMeshRights(currentMesh);4294967295==(u=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,u=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))}return-1!=u&&(p&&(1&u&&(Q("p20editmesh").checked=!0),2&u&&(Q("p20manageusers").checked=!0),4&u&&(Q("p20managecomputers").checked=!0)),8&u&&(Q("p20remotecontrol").checked=!0,65536&u&&(Q("p20nodesktop").checked=!0),256&u&&(Q("p20remoteview").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&u&&(Q("p20noterminal").checked=!0),1024&u&&(Q("p20nofiles").checked=!0),2048&u&&(Q("p20noamt").checked=!0),4096&u&&(Q("p20remotelimitedinput").checked=!0)),16&u&&(Q("p20meshagentconsole").checked=!0),32&u&&(Q("p20meshserverfiles").checked=!0),64&u&&(Q("p20wakedevices").checked=!0),128&u&&(Q("p20editnotes").checked=!0),8192&u&&(Q("p20limitevents").checked=!0),16384&u&&(Q("p20chatnotify").checked=!0),32768&u&&(Q("p20uninstall").checked=!0),131072&u&&(Q("p20commands").checked=!0),262144&u&&(Q("p20resetoff").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&u&&(Q("p20details").checked=!0),2097152&u&&(Q("p20relay").checked=!0)),p20validateAddMeshUserDialog(e),!1}function p20changeMeshAddMeshUserDialog(e){var t="",n=decodeURIComponent(Q("dp2meshid").value);for(var o in nodes)nodes[o].meshid==n&&(t+="<option value="+encodeURIComponentEx(nodes[o]._id)+">"+EscapeHtml(nodes[o].name)+"</option>");QH("dp2nodeid",t),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t=Q("dp20username").value.split(",");for(var n in t)t[n]=t[n].trim();return t[t.length-1]=e,Q("dp20username").value=t.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,n=!0;if(4===e){var o=0,i=decodeURIComponent(Q("dp2nodeid").value);""!=i&&null!=currentUser.links&&null!=currentUser.links[i]&&(o=currentUser.links[i].rights),Q("p20remotecontrol").checked=!!(8&o),Q("p20meshagentconsole").checked=!!(16&o),Q("p20meshserverfiles").checked=!!(32&o),Q("p20wakedevices").checked=!!(64&o),Q("p20editnotes").checked=!!(128&o),Q("p20remoteview").checked=!!(256&o),Q("p20noterminal").checked=!!(512&o),Q("p20nofiles").checked=!!(1024&o),Q("p20noamt").checked=!!(2048&o),Q("p20remotelimitedinput").checked=!!(4096&o),Q("p20limitevents").checked=!!(8192&o),Q("p20chatnotify").checked=!!(16384&o),Q("p20uninstall").checked=!!(32768&o),Q("p20nodesktop").checked=!!(65536&o),Q("p20commands").checked=!!(131072&o),Q("p20resetoff").checked=!!(262144&o),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!!(524288&o)),Q("p20details").checked=!!(1048576&o),Q("p20relay").checked=!!(2097152&o),n=""!=i}if(Q("dp20username")){var s=Q("dp20username").value.split(",");for(var a in s){var r=s[a]=s[a].trim();(0==r.length||r.indexOf('"')>=0)&&(n=!1)}var l=!1,d=!1;if(null!=users){var c=s[s.length-1].trim(),u=c.toLowerCase(),p=[];if(c.length>0){for(var a in users){var m=users[a]._id.split("/");if((null==currentMesh||currentMesh.domain==m[1])&&(null==currentNode||currentNode.domain==m[1])){if(m[2]===u){d=!0;break}if(users[a].name.toLowerCase().indexOf(u)>=0&&(p.push([users[a]._id,users[a].name]),p.length>=8))break}}if(0==d&&p.length>0){var g="";for(var a in p){var v=p[a][0],h=p[a][1];v.split("/")[2]==h.toLowerCase()?g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'>"+EscapeHtml(h)+"</div>":g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'><div>"+EscapeHtml(h)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(v.split("/")[2])+"</div></div>"}QH("dp20usersuggest",g),l=!0}}}QV("dp20usersuggest",l)}QE("idx_dlgOkButton",n),null!=Q("p20fulladmin")?(t=!Q("p20fulladmin").checked,QE("p20editmesh",t),QE("p20manageusers",t),QE("p20managecomputers",t)):t=""!=i,QE("p20remotecontrol",t),QE("p20meshagentconsole",t),QE("p20meshserverfiles",t),QE("p20wakedevices",t),QE("p20editnotes",t),QE("p20limitevents",t),QE("p20remoteview",t&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",t&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",t&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",t&&Q("p20remotecontrol").checked),QE("p20noterminal",t&&Q("p20remotecontrol").checked),QE("p20nofiles",t&&Q("p20remotecontrol").checked),QE("p20noamt",t&&Q("p20remotecontrol").checked),QE("p20chatnotify",t),QE("p20uninstall",t),QE("p20commands",t),QE("p20resetoff",t),QE("p20details",t),QE("p20relay",t)}function p20showAddMeshUserDialogEx(e,t){var n=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?n=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(n+=1),1==Q("p20manageusers").checked&&(n+=2),1==Q("p20managecomputers").checked&&(n+=4)),1==Q("p20remotecontrol").checked&&(n+=8),1==Q("p20meshagentconsole").checked&&(n+=16),1==Q("p20meshserverfiles").checked&&(n+=32),1==Q("p20wakedevices").checked&&(n+=64),1==Q("p20editnotes").checked&&(n+=128),1==Q("p20remoteview").checked&&(n+=256),1==Q("p20nodesktop").checked&&(n+=65536),1==Q("p20noterminal").checked&&(n+=512),1==Q("p20nofiles").checked&&(n+=1024),1==Q("p20noamt").checked&&(n+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(n+=4096),1==Q("p20limitevents").checked&&(n+=8192),1==Q("p20chatnotify").checked&&(n+=16384),1==Q("p20uninstall").checked&&(n+=32768),1==Q("p20commands").checked&&(n+=131072),1==Q("p20resetoff").checked&&(n+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(n+=524288),1==Q("p20details").checked&&(n+=1048576),1==Q("p20relay").checked&&(n+=2097152)),8&n||(256&n&&(n-=256),512&n&&(n-=512),1024&n&&(n-=1024),2048&n&&(n-=2048),4096&n&&(n-=4096),65536&n&&(n-=65536)),1===t){var o=decodeURIComponent(Q("dp2groupid").value);null!=(s=meshes[o])&&meshserver.send({action:"addmeshuser",meshid:o,meshname:s.name,userids:[currentUser._id],meshadmin:n,remove:2==e})}else if(2===t){var i=decodeURIComponent(Q("dp2groupid").value);null!=(s=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:i,meshadmin:n,remove:2==e})}else if(3===t){var s;o=decodeURIComponent(Q("dp2groupid").value);null!=(s=meshes[o])&&meshserver.send({action:"addmeshuser",meshid:o,meshname:s.name,userids:[currentUserGroup._id],meshadmin:n,remove:2==e})}else if(4===t){null!=(c=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:c.name,userids:[currentUser._id],rights:n,remove:2==e})}else if(5===t){var a=Q("dp20username").value.split(","),r=[];for(var l in a)r.push(a[l].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:r,rights:n,remove:2==e})}else if(6===t){i=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[i],rights:n,remove:2==e})}else if(7===t){var d,c;null!=(c=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:c.name,userids:[currentUserGroup._id],rights:n,remove:2==e})}else if(null==t){a=Q("dp20username").value.split(","),r=[];for(var l in a)r.push(a[l].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:r,meshadmin:n,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:n,remove:2==e})}function p20viewuser(e){if(!xxdialogMode){var t=decodeURIComponent(e),n=GetMeshRights(currentMesh),o=GetMeshRights(currentMesh,t);if(userinfo._id!=t&&(4294967295==n||2&n&&4294967295!=o))p20showAddMeshUserDialog(e);else{var i=[];4294967295==o?i.push("Fuld administrator (alle rettigheder)"):(1&o&&i.push("Rediger enhedsgruppe"),2&o&&i.push("Administrer enhedsgruppebrugere"),4&o&&i.push("Administrer enhedsgruppecomputere"),8&o&&i.push("Fjernkontrol"),16&o&&i.push("Agent konsol"),32&o&&i.push("Server Filer"),64&o&&i.push("Væk enhed"),128&o&&i.push("Rediger noter"),8&o&&256&o&&i.push("Kun fjernvisning"),8&o&&65536&o&&i.push("Ingen skrivbord"),8&o&&512&o&&i.push("Ingen Terminal"),8&o&&1024&o&&i.push("Ingen filer"),8&o&&2048&o&&i.push("Ingen Intel&reg; AMT"),8&o&&4096&o&&!(256&o)&&i.push("Begrænset input"),8192&o&&i.push("Kun selv-hændelser"),16384&o&&i.push("Chat & Besked"),32768&o&&i.push("Afinstaller"),131072&o&&i.push("Kommandoer"),262144&o&&i.push("Nulstil/Sluk"),524288&o&&i.push("Deling"),1048576&o&&i.push("Detaljer"),2097152&o&&i.push("Relay")),0==i.length&&i.push("Ingen rettigheder");var s=t.split("/")[2];users&&users[t]&&(s=users[t].name),userinfo._id==t&&(s=userinfo.name);var a=1,r=addHtmlValue("Brugernavn",EscapeHtml(decodeURIComponent(s)));t.split("/")[2]!=s&&(r+=addHtmlValue("Brugeridentifikator",EscapeHtml(t.split("/")[2]))),r+=addHtmlValue("Tilladelser",i.join(",")),userinfo._id!=t&&(4294967295==n||2&n&&4294967295!=o)&&(a+=4),setModalContent("xxAddAgent","Enhedsgruppe Bruger",r),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(a,t))}}}function p20viewuserEx(e,t){if(2==e){var n=t.split("/")[2];users&&users[t]&&(n=users[t].name),usergroups&&usergroups[t]&&(n=usergroups[t].name),userinfo._id==t&&(n=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Fjern brugertilladelser",format('Bekræft fjernelse af rettigheder for brugeren "{0}"?',EscapeHtml(decodeURIComponent(n)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Fjern brugergruppetilladelser",format('Bekræft fjernelse af rettigheder for brugergruppen "{0}"?',EscapeHtml(decodeURIComponent(n))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t))}}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),n=serverinfo.name;((-1==n.indexOf(".")||2&features)&&(n=window.location.hostname),1==serverinfo.https)?e="https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):e="http://"+n+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:"");if(1&t){var o="Når aktiveret, kan invitationskoder bruges af alle til at slutte enheder til denne enhedsgruppe ved hjælp af følgende offentlige link:<br /><br />";o+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",o+='<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Aktivér invitationskoder</label></div>',o+=addHtmlFormFloating("Invitationskoder",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'),o+=addHtmlFormFloating("Agenter",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Alle tilgængelige agenter</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option></select>'),o+="<div id=d2agentInstallTypeDiv>",o+=addHtmlFormFloating("Installationstype",'<select id=agentInviteType class="form-select"><option value=0>Baggrund og interaktive</option><option value=2>Kun baggrund</option><option value=1>Kun interaktiv</option></select>'),setModalContent("xxAddAgent","Invitationskoder",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()}else{o="Invitationskoder kan bruges af alle til at slutte enheder til denne enhedsgruppe ved at bruge følgende offentlige link:<br /><br />";o+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",o+=addHtmlValue("Invitationskoder",currentMesh.invite.codes.join(", ")),setModalContent("xxAddAgent","Invitationskoder",o+=addHtmlValue("Installationstype",["Baggrund og interaktive","Kun interaktiv","Kun baggrund"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p20editmeshInviteCodeValidate(){var e=!0,t=Q("agentInviteCode").value.split(",");for(var n in t)t[n]=t[n].trim(),""==t[n]&&(e=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||e),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e=Q("agentInviteCode").value.split(",");for(var t in e)e[t]=e[t].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:e,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified;userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]);var n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Websidemeddelelser</div>';return n+='<div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Enhedsforbindelser</label></div>',n+='<div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Enheds afbrydelser</label></div>',currentMesh.mtype<3&&(n+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT desktop og serial hændelser</label></div>'),t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">E-mail notifikationer</div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Enhedsforbindelser</label></div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Enheds afbrydelser</label></div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',n+='<div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Enhedsforbindelser</label></div>',n+='<div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Enheds afbrydelser</label></div>',n+='<div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),setModalContent("xxAddAgent","Beskedindstillinger",n),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editMeshNotifyEx(e,t){var n=0;n+=Q("p20notifyIntelDeviceConnect").checked?2:0,n+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,currentMesh.mtype<3&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0,n+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,n+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(n+=Q("p20emsgDeviceConnect").checked?128:0,n+=Q("p20emsgDeviceDisconnect").checked?256:0,n+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:n})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Ikke forbundet","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Anti-virus ikke aktiv","Ingen automatisk opdatering","Firewall ikke aktiv","Flere problemer"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Ingen</i>"),1&e&&(t='<span tabindex=0 title="Klik her for at redigere enhedsgruppens navn" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",t);var n={},o={},i=[0,0,0,0],s=[0,0,0,0,0],a=!1,r=!1,l=!1,d=!1;for(var c in nodes)if(nodes[c].meshid==currentMesh._id&&(nodes[c].agent&&(a=!0,null==n[nodes[c].agent.id]?n[nodes[c].agent.id]=1:n[nodes[c].agent.id]++),nodes[c].pwr&&(r=!0,null==o[nodes[c].pwr]?o[nodes[c].pwr]=1:o[nodes[c].pwr]++),0==nodes[c].conn?(l=!0,i[0]++):6&nodes[c].conn?(l=!0,1&nodes[c].conn?i[3]++:i[2]++):1&nodes[c].conn&&(l=!0,i[1]++),nodes[c].wsc)){d=!0;var u=0;"OK"==nodes[c].wsc.antiVirus&&u++,"OK"==nodes[c].wsc.autoUpdate&&u++,"OK"==nodes[c].wsc.firewall&&u++,3==u?s[0]++:u<2?s[4]++:"OK"!=nodes[c].wsc.antiVirus?s[1]++:"OK"!=nodes[c].wsc.autoUpdate?s[2]++:"OK"!=nodes[c].wsc.firewall&&s[3]++}var p=[],m=[],g=[],v=[],h=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(var c in n)p.push(n[c]),m.push(h[c]);for(var c in o)g.push(o[c]),v.push(powerStatetable[c]);window.meshPowerChart.config.data.datasets[0].data=g,window.meshPowerChart.config.data.labels=v,window.meshPowerChart.update(),currentMesh.mtype>=2&&(window.meshOsChart.config.data.datasets[0].data=p,window.meshOsChart.config.data.labels=m,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=i,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=s,window.meshSecurityChart.update();var f="",k=0;if(g.length>0){var x=[];for(var c in o)x.push([powerStatetable[c],o[c]]);for(var c in x.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Driftstatus</th></tr>',x)f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[c][1]+" <td> "+x[c][0]+"</tr>";f+="</tbody></table>"}if(p.length>0&&currentMesh.mtype>=2){k=0;var b=[];for(var c in n)b.push([h[c],n[c]]);for(var c in b.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Agent typer</th></tr>',b)f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[c][1]+"<td> "+b[c][0]+"</tr>";f+="</tbody></table>"}if(l){k=0;var y=[];for(c=0;c<4;c++)y.push([["Ikke forbundet","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"][c],i[c]]);y.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Forbindelse</th></tr>';for(c=0;c<4;c++)y[c][1]>0&&(f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+y[c][1]+"<td> "+y[c][0]+"</tr>");f+="</tbody></table>"}if(d){k=0;var w=[];for(c=0;c<4;c++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Anti-virus ikke aktiv','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Ingen automatisk opdatering','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Firewall ikke aktiv','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Flere problemer'][c],s[c]]);w.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Sikkerhed</th></tr>';for(c=0;c<4;c++)w[c][1]>0&&(f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[c][1]+"<td> "+w[c][0]+"</tr>");f+="</tbody></table>"}""==f&&(f="<i>Ingen enheder i denne enhedsgruppe.</i>"),QH("p21info",f);var S=(r?1:0)+(currentMesh.mtype>=2&&a?1:0)+(l?1:0)+(d?1:0);QS("meshPowerChartDiv").display=r?"inline-block":"none",QS("meshOsChartDiv").display=currentMesh.mtype>=2&&a?"inline-block":"none",QS("meshConnChartDiv").display=l?"inline-block":"none",QS("meshSecurityChartDiv").display=d?"inline-block":"none",QS("meshPowerChartDiv").width=S>3?"23%":"31%",QS("meshOsChartDiv").width=S>3?"23%":"31%",QS("meshConnChartDiv").width=S>3?"23%":"31%",QS("meshSecurityChartDiv").width=S>3?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",!(8&features)),!(8&features)){for(var e,t="",n="",o='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Root</a>',i="Root",s=filetree,a=1,r=[],l=filetreelinkpath,d=[],c=document.getElementsByName("fc"),u=0;u<c.length;u++)c[u].checked&&d.push(c[u].value);for(var u in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[u]])break;if(r.push(filetreelocation[u]),i+=" / "+filetreelocation[u],1==a){var p=filetreelocation[u].split("/");e=window.location.origin+domainUrl+p[0]+"files/"+p[2],filetreelinkpath+=filetreelocation[u]}else""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[u],a>2&&(e+="/"+filetreelocation[u]));s=s.f[filetreelocation[u]],o+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+a+')">'+EscapeHtml(null!=s.n?s.n:filetreelocation[u])+"</a>",a++}filetreelocation=r;var m=i.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(s.f);for(var u in g){var v,h=g[u],f=h.n;v=f.length>70?'<span title="'+EscapeHtml(f)+'">'+EscapeHtml(f.substring(0,70))+"...</span>":EscapeHtml(f);var k="";if(null!=h.d)k=printDateTime(new Date(h.d))+"&nbsp;";var x="";null!=h.s&&(x=getFileSizeStr(h.s));var b="";if(h.t<3||4==h.t){var y=1==h.t||4==h.t?p5getQuotabar(h):"";b='<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(f)+'">&nbsp;<span style=float:right title="">'+y+"</span><span><div class=fileIcon"+h.t+' onclick=p5folderset("'+encodeURIComponentEx(h.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(h.nx)+"\")'>"+v+"</a></span></div>"}else{var w=v,S="",M=urlargs.key?"&key="+urlargs.key:"";m&&(S='<i class="fa-regular fa-copy" style=cursor:pointer title="Vis offentligt link" onclick=\'return p5showPublicLink("'+e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+M+'")\'></i> <i class="fa-regular fa-copy" title="Kopier link til udklipsholder" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+M)+'")></i>'),h.s>0&&(w=S+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+h.nx)+'")>'+v+"</a>"),b='<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+h.nx+'">&nbsp;<span class=fsize>'+k+"</span><span style=float:right>"+x+"</span><span><div class=fileIcon"+h.t+"></div>"+w+"</span></div>"}h.t<3?t+=b:n+=b}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",t+n),QH("p5currentpath",o),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),l==filetreelinkpath){c=document.getElementsByName("fc");for(u=0;u<c.length;u++)c[u].checked=d.indexOf(c[u].value)>=0}p5setActions()}}function getNiceSize(e){return e<=0?"Lagergrænsen overskredet":e<2048?format("{0} bytes tilbage",e):e<2097152?format("{0} kilobytes tilbage",Math.round(e/1024)):e<2147483648?format("{0} megabyte tilbage",Math.round(e/1024/1024)):format("{0} gigabyte tilbage",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Ingen":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} GB",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Ingen":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} GB",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;e.t>1&&4!=e.t;)e=e.parent;if(1!=e.t&&4!=e.t||null==e.maxbytes)return"";var t=Math.floor(e.s/1024),n=e.maxbytes-e.s;return'<span title="'+(e.c>1?format("{0}k i {1} filer. {2}k maximum",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0}k i 1 fil. {1}k maximum",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(n)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>"}function p5showPublicLink(e){return setModalContent("xxAddAgent","Public Link",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Kopier link til udklipsholder" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?1*sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?1*sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t=[],n=Q("p5sortdropdown").value;for(var o in e)e[o].nx=o,null==e[o].n&&(e[o].n=o),e[o].ln=e[o].n.toLowerCase(),t.push(e[o]);return sortorder=1,n>3&&(sortorder=-1,n-=3),1==n?t.sort(p5sort_filename):2==n?t.sort(p5sort_bysize):3==n&&t.sort(p5sort_timestamp),t}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),n=getFileSelCount(!1);QE("p5DeleteFileButton",e>0&&filetreelocation.length>0),QE("p5ViewFileButton",1==e&&1==n&&filetreelocation.length>0),QE("p5NewFolderButton",filetreelocation.length>0),QE("p5UploadButton",filetreelocation.length>0),QE("p5DownloadButton",e>0&&e==n&&filetreelocation.length>0),QE("p5RenameFileButton",1==e&&filetreelocation.length>0),QE("p5SelectAllButton",t>0),Q("p5SelectAllButton").value=e>0?"Vælg Ingen":"Vælg alle",QE("p5CutButton",n>0&&e==n),QE("p5CopyButton",n>0&&e==n),QE("p5PasteButton",null!=p5clipboard&&p5clipboard.length>0&&filetreelocation.length>0)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t=0,n=0;for(var o in e.f)setupBackPointers(e.f[o]),e.f[o].parent=e,e.f[o].s&&(t+=e.f[o].s),e.f[o].c&&(n+=e.f[o].c),3==e.f[o].t&&n++;e.s=t,e.c=n}return e}function getFileSizeStr(e){return"number"!=typeof e&&(e=0),1==e?"1 byte":format("{0} bytes",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Ny mappe",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Rekursiv sletning</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Slet",e>1?format("Slet {0} valgte element?",e)+t:"Slet det valgte element?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);setModalContent("xxAddAgent","Omdøb",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=function(){var e=/^[^\\/:\*\?"<>\|]+$/,t=/^\./,n=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(o){return e.test(o)&&!t.test(o)&&!n.test(o)&&"."!=o[0]}}();function p5uploadFile(){setModalContent("xxAddAgent","Upload Fil",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />Bekræft overskrivning?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t=filetree;for(var n in filetreelocation)null!=t.f&&null!=t.f[filetreelocation[n]]&&(t=t.f[filetreelocation[n]]);return t.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(var n in e)null!=e[n].size&&0!=e[n].size&&t.push(e[n]);var o=filetree,i=[],s=0;for(var n in filetreelocation)null!=o.f&&null!=o.f[filetreelocation[n]]&&(o=o.f[filetreelocation[n]]);if(QE("idx_dlgOkButton",e.length>0),e.length>0){if(null!=o.f){for(var n in o.f)i.push(n);for(n=0;n<e.length;n++)i.indexOf(e[n].name)>=0&&s++}QV("p5confirmOverwriteSpan",s>0),s>0?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)if(e[t].checked){var n=p5GetFileInfo(e[t].value);if(null==n)return;return void(n.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:e[t].value,tag:"edit"}):messagebox("Fil editor","Kun filer på mindre end 200k kan redigeres."))}}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p5clipboard.push(t[n].value);p5updateClipview()}function p5pasteFile(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("Bekræft {0} af {1} indtastning{2} til denne placering?",0==p5clipboardCut?"copy":"move",p5clipboard.length,p5clipboard.length>1?"s":"")),setModalContent("xxAddAgent","Sæt ind",e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("Holder {0} post{1} for {2}",p5clipboard.length,p5clipboard.length>1?"s":"",0==p5clipboardCut?"kopier":"flyt")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Fjern</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(var n in e.dataTransfer.files)null!=e.dataTransfer.files[n].size&&0!=e.dataTransfer.files[n].size&&t.push(e.dataTransfer.files[n]);if(0!=t.length){var o=filetree,i=[],s=0;for(var n in filetreelocation)null!=o.f&&null!=o.f[filetreelocation[n]]&&(o=o.f[filetreelocation[n]]);if(null!=o.f){for(var n in o.f)i.push(n);for(n=0;n<e.dataTransfer.files.length;n++)i.indexOf(e.dataTransfer.files[n].name)>=0&&s++}0==s?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Upload Fil",format(1==s?"Upload vil overskrive 1 fil. Fortsæt?":"Upload vil overskrive {0} filer. Fortsæt?",s)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var n=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){n=1}if(0==n&&p5uploadFileEx(),setDialogMode(0),1==n){if(0==filetreelocation.length)return;for(var o=[],i=[],s=[],a=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(l>13e5)return void p5uploadFile();for(d=0;d<t.length;d++){var c=new FileReader,u=t[d];o.push(u.name),i.push(u.size),s.push(u.type),c.onload=function(e){a.push(e.target.result),0==--r&&(Q("p5fileDragName").value=o.join("*"),Q("p5fileDragSize").value=i.join("*"),Q("p5fileDragType").value=s.join("*"),Q("p5fileDragData").value=a.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},c.readAsDataURL(u)}}}var p5dragtimer=null;function p5fileDragOver(e){if(!xxdialogMode){haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null);var t=!0;0==filetreelocation.length&&(t=!1),QV("bigok",t),QV("bigfail",!t)}}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++){if(e[t].checked)downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}}var eventsMessageId={1:"Konto login",2:"Konto logout",3:"Skiftede sprog fra {1} til {2}",4:"Deltog i desktop multiplex session",5:"Forlod desktop-multipleks sessionen",6:"Startede multiplex session på skrivebordet",7:"Afsluttede optagelsessession, {0} sekund(er)",8:"Lukkede desktop multiplex-session, {0} sekund(er)",9:'Afsluttet relæsession "{0}" fra {1} til {2}, {3} sekund(er)',10:'Afsluttet terminalsession "{0}" fra {1} til {2}, {3} sekund(er)',11:'Afsluttet skrivebordssession "{0}" fra {1} til {2}, {3} sekund(er)',12:'Afsluttet filhåndteringssession "{0}" fra {1} til {2}, {3} sekund(er)',13:'Startede relay session "{0}" fra {1} til {2}',14:'Startede terminalsession "{0}" fra {1} til {2}',15:'Startede skrivebordssession "{0}" fra {1} til {2}',16:'Startede filhåndteringssession "{0}" fra {1} til {2}',17:'Behandler konsolkommando: "{0}"',18:'Viser beskedboks, title="{0}", message="{1}"',19:"Stopper proces {0}",20:"Åbner: {0}",21:"Henter udklipsholderindhold, {0} byte(r)",22:"Indstilling af udklipsholderindhold, {0} byte(r)",23:"Forsøger aktivering af Intel (R) AMT mode",24:"Kører kommandoer",25:"Udfører strømhandling={0}, tvunget={1}",26:'Viser toast-meddelelse, title="{0}", message="{1}"',27:"Lokal bruger accepterede fjernterminal anmodning",28:"Lokal bruger afviste fjernterminal anmodning",29:"Fjernskrivebordsforbindelse tvangslukket af lokal bruger",30:"Starter fjernskrivebord efter lokal bruger har accepteret",31:"Remote Desktop Connection Bar aktiveret/opdateret",32:"Anslutningsfältet för fjärrskrivbord misslyckades eller stöds inte",33:"Fjernskrivebordsforbindelse tvangslukket af lokal bruger",34:"Kunne ikke starte fjernskrivebord, da den lokale bruger afviste",35:"Startede fjernskrivebord med toast-meddelelse",36:"Startede fjernskrivebord uden meddelelse",37:"Remote Desktop Connection Bar aktiveret/opdateret",38:"Forbindelseslinje til fjernskrivebord mislykkedes eller understøttes ikke",39:"Fjernskrivebordsforbindelse tvangslukket af lokal bruger",40:"Starter fjernfiler efter lokal bruger har accepteret",41:"Kunne ikke starte fjernfiler, da den lokale bruger afviste",42:"Startede fjernfiler med toast-meddelelse",43:"Startede fjernfiler uden meddelelse",44:'Opret mappe: "{0}"',45:'Slet: "{0}"',46:'Slet rekursivt: "{0}", {1} element(er) fjernet',47:'Slet: "{0}", {1} element(er) er fjernet',48:'Omdøb: "{0}" til "{1}"',49:'Download: "{0}"',50:'Upload: "{0}"',51:'Kopiér: "{0}" till "{1} "',52:'Flyt: "{0}" till "{1} "',53:"Låser fjernbruger ude af skrivebordet",54:"Agent lukket session med {0} % agent til server-komprimering. Sendt: {1}, komprimeret: {2}",55:"Opret enhedsgruppe: {0}",56:"Enhedsgruppe genoprettet: {0}",57:"Tilføjet enhed {0} til enhedsgruppe {1}",58:"Enheden anmodede om Intel(R) AMT ACM-aktivering, FQDN: {0}",59:"Ændrede enhed {0} fra gruppe {1}: {2}",60:"Fjernede brugerens enhedsrettigheder for {0}",61:"Ændrede brugerens enhedsrettigheder for {0}",62:"Fjernede bruger {0} fra brugergruppe {1}",63:"Kontoen er fjernet",64:"Konto oprettet, brugernavn er {0}",65:"Konto oprettet, email er {0}",66:"Kontoen er ændret: {0}",67:"Brugergruppemedlemskab ændret: {0}",68:"Tilføjet brugergruppe {0} til enhedsgruppe {1}",69:"Brugergruppe oprettet: {0}",70:"Fjernede brugergruppen {0} fra enhedsgruppen {1}",71:"Tilføjet bruger {0} til brugergruppe {1}",72:"Fjernede bruger {0} fra brugergruppe {1}",73:"Underretning om enhedsgruppe ændret",74:"Konto kodeord ændret: {0}",75:"Ændrede kontooplysninger",76:"Enhedsgruppe oprettet: {0}",77:"Enhedsgruppe slettet: {0}",78:"Medlemskab af enhedsgruppe ændret: {0}",79:"Brugergruppe ændret: {0}",80:"Tilføjet bruger {0} til brugergruppe {1}",81:"Fjernede brugerens enhedsrettigheder for {0}",82:"Ændrede brugerens enhedsrettigheder for {0}",83:"Fjernede brugeren {0} fra enhedsgruppen {1}",84:"Tilføjet enhed {0} til enhedsgruppe {1}",85:"Flyttede enhed {0} til gruppe {1}",86:"Fjernede brugerens enhedsrettigheder for {0}",87:"Fjernede enhed {0} fra enhedsgruppe {1}",88:"Aktiveret e-mail 2-faktor godkendelse",89:"Deaktiveret e-mail 2-faktor godkendelse",90:"Tilføjet godkendelses applikation",91:"Fjernet godkendelsesapplikation",92:"Nye 2FA backup koder genereret",93:"2FA-backup koder er slettet",94:"Fjernet sikkerhedsnøgle",95:"Tilføjet sikkerhedsnøgle",96:"Bekræftet telefonnummer på bruger {0}",97:"Fjernet telefonnummer på bruger {0}",98:"Hjælp anmodet, bruger: {0}, detaljer: {1}",99:"Kører kommandoer som bruger",100:"Kører kommandoer som bruger, hvis det er muligt2",101:"Tilføjet enhedsdeling {0} fra {1} til {2}",102:"Fjernet enhedsdeling {0}",103:"Batch upload af {0} file(r) til mappen {1}",104:'Automatisk download af agent core dump fil: "{0}"',105:'Upload: "{0}", Størrelse: {1}',106:'Download: "{0}", Størrelse: {1}',107:"Konto login fra {0}, {1}, {2}",108:"Brugerloginforsøg med forkert 2. faktor fra {0}, {1}, {2}",109:"Brugerloginforsøg på låst konto fra {0}, {1}, {2}",110:"Ugyldigt brugerloginforsøg fra {0}, {1}, {2}",111:"Enheden anmodede om Intel(R) AMT ACM TLS-aktivering, FQDN: {0}",112:'Afsluttet messenger-session "{0}" fra {1} til {2}, {3} sekund(er)',113:"Tilføjet godkendelses enhed til push notifikation",114:"Fjernet push-notifikationsgodkendelsesenhed",115:"Tilføjet login token",116:"Fjernet login-token",117:"Dette er en gammel agentversion, overvej at opdatere.",118:"Denne agent har en forældet certifikatvalideringsmekanisme. Overvej at opdatere.",119:"Denne agent bruger usikre tunneler. Overvej at opdatere.",120:'Startede lokal relay session "{0}", protokol {1} til {2}',121:'Afsluttet lokal relæsession "{0}", protokol {1} til {2}, {3} sekund(er)',122:"Forlod desktop-multiplekssessionen efter {0} sekund(er).",123:'Forlod Web-SSH-session "{1}" efter {0} sekund(er).',124:'Forlod Web-SFTP-session "{1}" efter {0} sekund(er).',125:'Forlod Web-RDP-session "{1}" efter {0} sekund(er).',126:"Forlod Web-VNC-session efter {0} sekund(er).",127:"Ændrede kontoens visningsnavn til {0}.",128:"Konto oprettet, navnet er {0}",129:"Fjernet kontovisningsnavn.",130:"Brugermeddelelser ændret",131:"Tilføjet enhedsdeling {0} med ubegrænset tid.",132:"Tænd.",133:"Sluk.",134:"Tvungen afbrudt desktopsession for brugeren {0}",135:"Tvangsafbrudt terminalsession for brugeren {0}",136:"Tvangsafbrudt filsession for bruger {0}",137:"Tvangsafbrudt routingsession for brugeren {0}",138:"Tilføjet enhedsandel {0} tilbagevendende dagligt.",139:"Tilføjet enhedsdeling {0} tilbagevendende ugentligt.",140:"Ændrede enhed {0} fra gruppe {1}: {2}",141:"Ændring af Intel(r) AMT-politik",142:"Enhedsgruppe {0} blev ændret: {1}",143:'Deltog i desktop multiplex session "{0}"',144:'Forlod desktop-multipleksessionen "{0}" efter {1} sekund(er).',145:'Startede multiplex-session på skrivebordet "{0}"',146:'Afsluttet optagelsessession "{0}", {1} sekund(er)',147:'Lukket desktop multipleks session "{0}", {1} sekund(er)',148:'Startede Web-SSH session "{0}".',149:'Startede Web-SFTP session "{0}".',150:'Startede Web-RDP-session "{0}".',151:'Startede Web-VNC session "{0}".',152:'Ikke længere et relæ for "{0}".',153:'Er et relæ for "{0}".',154:"Account changed to sync with LDAP data.",155:"Denied user login from {0}, {1}, {2}",156:"Verified messaging account of user {0}",157:"Removed messaging account of user {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication",162:'Startede messenger-session "{0}" fra {1} til {2}'},eventsShortMessageId={1:"Gruppe navn",2:"Beskrivelse",3:"Flag",4:"Samtykke",5:"Auto-fjernelse",6:"Invitations kode",7:"Relæ enhed"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(var n in events){var o=events[n],i=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(i)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(i))+"</td></tr>");var s,a="fa-mobile-screen";if("ugrp"==o.etype&&(a="fa-users"),"user"==o.etype&&(a="fa-user"),"server"==o.etype&&(a="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])s="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{if(s=eventsMessageId[o.msgid],null!=o.msgArgs)for(var n in o.msgArgs){var r=o.msgArgs[n];if(Array.isArray(r)){var l=[];for(var d in r)"number"==typeof r[d]&&eventsShortMessageId[r[d]]?l.push(eventsShortMessageId[r[d]]):l.push(r[d]);r=l.join(",")}else"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9)))));s=s.split("{"+n+"}").join(r)}s=EscapeHtml(s).split("(R)").join("&reg;")}if(o.nodeid){var c=getNodeFromId(o.nodeid);if(null!=c){switch(c.icon){case 1:a="fa-computer";break;case 2:a="fa-laptop";break;case 8:a="fa-laptop-code"}s="<a href=# onclick='gotoDevice(\""+o.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(c.name)+"</a> &rarr; "+s}}if(o.username){var u="";o.guestname&&(u=' / <span title="Dette er en gæstedelingssession">'+EscapeHtml(o.guestname)+"</span>"),s=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+u+" &rarr; "+s:EscapeHtml(o.username)+u+" &rarr; "+s}o.remoteaddr&&(s+=" ("+o.remoteaddr+")"),"relay"!=o.etype&&"relaylog"!=o.action||(a="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+a+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(i)+" - "+s+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ingen begivenheder fundet</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){if(!xxdialogMode){var e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>";e+=addHtmlFormFloating("Rapport type",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Alla hændelser</option>'),e+=addHtmlFormFloating("Tidsperiode",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Alle tilgængelige</option><option value=2>En dag</option></select>'),e+="<div id=d2daySelector>"+addHtmlFormFloating("Rapportdag",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>",e+=addHtmlFormFloating("Gruppér efter",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Ingen</option><option value=2>Enhedsgruppe</option><option value=3>Bruger</option>'),e+=addHtmlFormFloating("Formatér",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>'),setModalContent("xxAddAgent","Download Rapport",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus()}}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value;Q("d2reportGroupBy").value,Q("d2reportFormat").value;QV("d2daySelector",2==e);var n=!0;2==e&&""==t&&(n=!1),QE("idx_dlgOkButton",n)}function p3showDownloadEventsDialog(e){if(!xxdialogMode){var t="Download listen over begivenheder med et af filformaterne nedenfor.<br /><br />";t+=addHtmlValue("CSV-format",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'),setModalContent("xxAddAgent","Exporter hændelsesliste",t+=addHtmlValue("JSON-format",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p3downloadEventsDialogCSV(e){var t,n;for(var o in 1==e&&(n=currentDeviceEvents),2==e&&(n=events),3==e&&(n=currentUserEvents),t="utc, time, type, action, user, device, message\r\n",n){var i="";if(n[o].nodeid){var s=getNodeFromId(n[o].nodeid);s&&s.name&&(i=s.name)}t+='"'+n[o].time+'","'+printDateTime(new Date(n[o].time))+'","'+n[o].etype+'","'+(null!=n[o].action?n[o].action:"")+'","'+(null!=n[o].username?n[o].username:"")+'","'+EscapeHtml(i)+'","'+(null!=n[o].msg?n[o].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,n=[];for(var o in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),3==e&&(t=currentUserEvents),t)n.push(events[o]);return saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",!(4&features)&&0==serverinfo.domainauth),null==users||4&features)QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],n=e,o=0;for(var i in users)t.push(users[i]);t.sort(nameSort);var s=Q("UserSearchInput").value.toLowerCase(),a=s;s.startsWith("email:")?(s=null,a=a.substring(6)):s.startsWith("name:")?(a=null,s=s.substring(5)):s.startsWith("e:")?(s=null,a=a.substring(2)):s.startsWith("n:")&&(a=null,s=s.substring(2));var r='<table class="table table-hover" cellpadding=0 cellspacing=0>',l=!0;r+="<th>Navn<th style=width:80px>Enhedsgrupper<th style=width:120px>"+nobreak("Seneste adgang")+"<th style=width:120px>Tilladelser";var d=[],c=document.getElementsByClassName("UserCheckbox");for(i=0;i<c.length;i++)c[i].checked&&d.push(c[i].value);for(var i in t){var u=t[i],p=null;null!=wssessions&&(p=wssessions[u._id]),null!=p&&(null!=s&&(""==s||u.name.toLowerCase().indexOf(s)>=0)||null!=a&&null!=u.email&&u.email.toLowerCase().indexOf(a)>=0)&&(n>0?(l&&(r+="<tr><td class=userTableHeader colspan=4>Online brugere",l=!1),r+=addUserHtml(u,p),n--):o++)}for(var i in l=!0,t){u=t[i],p=null;null!=wssessions&&(p=wssessions[u._id]),null==p&&(null!=s&&(""==s||u.name.toLowerCase().indexOf(s)>=0)||null!=a&&null!=u.email&&u.email.toLowerCase().indexOf(a)>=0)&&(n>0?(l&&(r+="<tr><td class=userTableHeader colspan=4>Offline brugere",l=!1),r+=addUserHtml(u,p),n--):o++)}r+="</table>",1==o?r+="<br />1 brugere mere vises ikke, brug søgefeltet for at søge efter brugere...<br />":o>1&&(r+="<br />"+format("{0} flere brugere ikke vist, brug søgefeltet til at søge efter brugere...",o)+"<br />"),n==e&&(r+="<br />Ingen brugere fundet.<br />"),QH("p3users",r),c=document.getElementsByClassName("UserCheckbox");var m=encodeURIComponentEx(userinfo._id);for(i=0;i<c.length;i++)c[i].checked=d.indexOf(c[i].value)>=0&&c[i].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var n="",o=" gray",i="",s=e._id!=userinfo._id,a="",r="";null!=t?(o="",s&&(i='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",i+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),a+=nobreak(1==t?"1 session":format("{0} sessioner",t))):e.access?a+='<span title="'+format("Seneste adgang: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(a+='<span title="'+format("Seneste login: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),s&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(r+="Låst,&nbsp;"),r+="<span title='Servertilladelser'>";var l=4294966047&e.siteadmin;null==e.siteadmin||0==l?r+="Bruger":8==l?r+="Bruger + filer":4294967295==e.siteadmin?r+="Administrator":r+=2&l?"Manager":"Delvis",null!=e.siteadmin&&4294967295!=e.siteadmin&&1216&e.siteadmin&&(r+="*"),r+="</span>",s&&(r+="</a>");var d=0;if(e.links)for(var c in e.links)c.startsWith("mesh/")&&d++;var u=EscapeHtml(e.name),p="";if(1==serverinfo.emailcheck&&(p=1!=e.emailVerified?' <b style=color:red title="E-mail er ikke bekræftet">&#x2717;</b>':' <b style=color:green title="E-mail er bekræftet">&#x2713</b>'),null!=e.email&&(2097152&features&&e.email.toLowerCase()==e.name.toLowerCase()?u+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Send e-mail til brugeren" style="margin-top:2px" /></a>'+p:u+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+p),null!=serverinfo.crossDomain){var m=e._id.split("/")[1];""!=m&&(u+=", <span style=color:#26F>"+m+"</span>")}return(e.otpsecret>0||e.otphkeys>0||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(u+=' <i class="fa-solid fa-key" title="2. faktor godkendelse aktiveret" style="margin-top:2px"></i>'),null!=e.phone&&(u+=' <i class="fa-solid fa-mobile-screen" title="Bekræftet telefonnummer" style="margin-top:2px"></i>'),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(u+=' <img src="images/padlock12.png" height=12 width=8 title="Kontoen er spærret" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(u+=' <i class="fa-solid fa-comment fa-xs" title="Verified messaging account" style="margin-top:2px" />'),n+="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>",n+="<div>",n+='<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>',n+='<div class=baricon><i class="fa-fw fa-solid fa-user '+o+'"></i></div>',n+="<div>",n+="<div><span style=line-height:24px>"+u+"</span>"+i+"</div></div><td style=text-align:center>"+d+"<td style=text-align:center>"+a+"<td style=text-align:center>"+r}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupActionButton",t>0),Q("UsersSelectAllButton").value=t>0?"Vælg Ingen":"Vælg alle"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;if(0!=t){var o="";serverinfo.emailcheck&&(o+="<option value=4>Bekræft e-mail</option><option value=5>Ugyldig e-mail</option>");var i="Vælg en handling, der skal udføres på alle valgte brugere.<br /><br />";setModalContent("xxAddAgent","Gruppehandling",i+=addHtmlFormFloating("Funktion","<select id=d3groupop class=form-select><option value=1>Lås konto</option><option value=2>Lås konto op</option>"+o+"<option value=3>Slet konto</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx)}}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));var o=Q("d3groupop").value;if(1==o)for(var n in t){32&(i=null==(s=users[t[n]]).siteadmin?0:s.siteadmin)||(i+=32,meshserver.send({action:"edituser",id:s._id,siteadmin:i}))}else if(2==o)for(var n in t){var i;32&(i=null==(s=users[t[n]]).siteadmin?0:s.siteadmin)&&(i-=32,meshserver.send({action:"edituser",id:s._id,siteadmin:i}))}else if(3==o){QE("idx_dlgOkButton",!1)}else if(4==o)for(var n in t){!0!==(s=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:s._id,emailVerified:!0})}else if(5==o)for(var n in t){var s;!0===(s=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:s._id,emailVerified:!1})}}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),n=[],o=0;o<t.length;o++)!0===t[o].checked&&n.push(decodeURIComponent(t[o].value));for(var o in n){var i=users[n[o]];meshserver.send({action:"deleteuser",userid:i._id,username:i.name})}}function userMouseHover(e,t){var n=e.children[0].children[0].children[1];n.children[1].classList.remove("g1s"),n.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var n=e.children[0].children[0];n.children[2].classList.remove("g1s"),n.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[2].classList.add("g1s"),n.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,n){if(!xxdialogMode){haltEvent(e);var o="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+n;return null!=authCookie&&""!=authCookie&&(o+="&auth="+authCookie),urlargs.key&&(o+="&key="+urlargs.key),safeNewWindow(o,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}}function altUserChat(e,t,n,o){if(!xxdialogMode){haltEvent(e);var i=serverinfo.altmessenging[o].url,s=decodeURIComponent(t),a=encodeURIComponentEx(s.split("/")[2]),r=encodeURIComponentEx(s.split("/").join("-")),l=a,d=r,c=users[s];return null!=c&&null!=c.realname&&(l=encodeURIComponentEx(c.realname.split(" ").join("")),d=encodeURIComponentEx(c.realname.split(" ").join("-"))),i=i.split("{0}").join(a).split("{1}").join(r).split("{2}").join(l).split("{3}").join(d),urlargs.key&&(i+="&key="+urlargs.key),safeNewWindow(i,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[o].name,msgid:11,url:i}),!1}}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","Send SMS","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",Q("d2smsText").value.length>0)}function showSendSMSEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Send Message","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){if(!xxdialogMode){setModalContent("xxAddAgent","Send e-mail",'<input id=d2emailSubject style=width:100% placeholder="Emne"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate()}}function showSendEmailValidate(){QE("idx_dlgOkButton",Q("d2emailSubject").value.length>0&&Q("d2emailText").value.length>0)}function showSendEmailEx(e,t){Q("d2emailText").value.length>0&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode){haltEvent(e);return setModalContent("xxAddAgent",format("Giv besked til {0}",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Send en tekstmeddelelse til denne bruger.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Vis besked, indtil den afvises af brugeren</option><option value=10>Vis i 10 sekunder</option><option value=60>Vis i 1 minut</option><option value=300>Vis i 5 minutter</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){if(!xxdialogMode){null==userViewSettings&&(userViewSettings={});var e="";setModalContent("xxAddAgent","Brugervisning",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(userViewSettings.noViewLimit?"":" checked")+">Vis kun de første 100 brugere</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx)}}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){if(!xxdialogMode){setModalContent("xxAddAgent","Brugerkontoimport",'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx)}}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){const i=e.target.result.split("\n"),s=i[0].trim().split(","),a=[];for(let e=1;e<i.length;e++){const t=i[e].trim();if(""===t)continue;const n=t.split(",");let o=!1;for(let e=0;e<n.length;e++)if(""!==n[e].trim()){o=!0;break}if(!o)continue;const r={};for(let e=0;e<s.length;e++){const t=n[e].trim();""!==s[e].trim()&&""!==t&&(r[s[e]]="true"===t.toLowerCase()||t)}a.push(r)}if(null!=(t=a)&&Array.isArray(t)){var n=!0;for(var o in t)("string"!=typeof t[o].user||t[o].user.length<1||t[o].user.length>64)&&(n=!1),("string"!=typeof t[o].pass||t[o].pass.length<1||t[o].pass.length>256)&&(n=!1),0==checkPasswordRequirements(t[o].pass,passRequirements)&&(n=!1),null!=t[o].email&&("string"!=typeof t[o].email||t[o].email.length<1||t[o].email.length>128)&&(n=!1);0==n?setModalContent("xxAddAgent","Brugerkontoimport","Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Brugerkontoimport","Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Brugerkontoimport",format("Ugyldig JSON-fil: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){n=!0;for(var o in t)("string"!=typeof t[o].user||t[o].user.length<1||t[o].user.length>64)&&(n=!1),("string"!=typeof t[o].pass||t[o].pass.length<1||t[o].pass.length>256)&&(n=!1),0==checkPasswordRequirements(t[o].pass,passRequirements)&&(n=!1),null!=t[o].email&&("string"!=typeof t[o].email||t[o].email.length<1||t[o].email.length>128)&&(n=!1);0==n?setModalContent("xxAddAgent","Brugerkontoimport","Ugyldigt JSON-filformat."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Brugerkontoimport","Ugyldigt JSON-filformat.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){if(!xxdialogMode){var e="Download listen over brugere med et af filformaterne nedenfor.<br /><br />";e+=addHtmlValue("CSV-format","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"),setModalContent("xxAddAgent","Eksport af brugerliste",e+=addHtmlValue("JSON-format","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p4downloadUserInfoCSV(){var e="id,navn,e-mail,oprettelse,sidste login,grupper,authfactors,siteadmin,brugeradmin,låst\r\n";for(var t in users){var n=!1,o=[];(users[t].otpsecret>0||users[t].otphkeys>0)&&(n=!0,users[t].otpsecret>0&&o.push("AuthApp"),users[t].otphkeys>0&&o.push("SecurityKey"),users[t].otpkeys>0&&o.push("BackupCodes")),e+='"'+users[t]._id+'","'+users[t].name+'","'+(users[t].email?users[t].email:"")+'","'+(users[t].creation?new Date(1e3*users[t].creation):"")+'","'+(users[t].login?new Date(1e3*users[t].login):"")+'","'+(users[t].groups?users[t].groups.join(","):"")+'","'+(n?o.join(","):"")+'"',e+=","+(4294967295==users[t].siteadmin?"1":"0"),e+=","+(2&users[t].siteadmin?"1":"0"),e+=","+(32&users[t].siteadmin?"1":"0"),e+="\r\n"}return saveAs(stringToUtf8Blob(e),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e=[];for(var t in users)e.push(users[t]);return saveAs(new Blob([JSON.stringify(e,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){if(!xxdialogMode){setModalContent("xxAddAgent","Send en meddelelse",'<div style=margin-bottom:6px>Send en besked til alle tilsluttede brugere.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Vis besked, indtil den afvises af brugeren</option><option value=10>Vis i 10 sekunder</option><option value=60>Vis i 1 minut</option><option value=300>Vis i 5 minutter</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus()}}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(var n in serverinfo.crossDomain)t+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Standard":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";e+=addHtmlFormFloating("Domæne",t+="</select>")}if(2097152&features||(e+=addHtmlFormFloating("<span id=p4hname>Brugernavn</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e+=addHtmlFormFloating("<span id=p4hemail>E-mail",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+="",e+=addHtmlFormFloating("<span id=p4hp1>Kodeord</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+=addHtmlFormFloating("<span id=p4hp2>Confirm Password</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+='<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Tilfældig adgangskode.</label></div>',e+='<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Fjern alle tidligere hændelser for dette bruger-id.</label></div>',e+='<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Tving nulstilling af adgangskode ved næste login.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />E-mail er bekræftet</label></div>',e+='<div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=E-mail bekræftet og tvungen nulstilling af adgangskode påkrævet. />Send invitationsmail.</label></div>'),passRequirements){var o=[],i=0;for(var n in passRequirements)"reset"!=n&&"hint"!=n&&(o.push(n+":"+passRequirements[n]),i++);i>0&&(e+="<div style=font-size:x-small;padding:6px>"+format("Krav: {0}.",o.join(", "))+"</div>")}setModalContent("xxAddAgent","Opret konto",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),2097152&features?Q("p4email").focus():Q("p4name").focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,n=Q("p4pass1").value.length>0&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements);2097152&features||(t=!Q("p4name")||Q("p4name").value.length>0&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=n||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=n||Q("p4randomPassword").checked?"black":"#7b241c";var o=t&e;0==Q("p4randomPassword").checked&&(o&=n),QE("idx_dlgOkButton",o)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:2097152&features?Q("p4email").value:Q("p4name").value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n=users[t.toLowerCase()],o="";null!=n.groups&&(o=n.groups.join(", "));var i="Indtast en kommasepareret liste over administrative realms navne.<br /><br />";return setModalContent("xxAddAgent","Administrative Realms",i+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${o}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,n)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}}function p4validateUserGroups(){var e=Q("dp4usergroups").value,t=0,n=e.indexOf('"')+e.indexOf("/")+e.indexOf(">")+e.indexOf("<")+e.indexOf("'"),o=e.split(",");for(var i in o)0==o[i].trim().length&&t++;QE("idx_dlgOkButton",""==e||-5==n&&t<1)}function showUserGroupDialogEx(e,t){var n=Q("dp4usergroups").value.split(","),o=[];for(var i in n){var s=n[i].trim();s.length>0&&o.push(s)}meshserver.send({action:"edituser",id:t._id,groups:o})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n=users[t];if(null!=n){var o=userinfo._id==n._id,i="";return i+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>Server Filer</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, blank for standard</div><br><hr/>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Fuld Administrator</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Server Backup</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Servergendannelse</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Serveropdateringer</label><br></div>',i+='<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Administrer brugere</label><br></div>',i+='<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Administrer brugergrupper</label><br></div>',i+='<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Administrer optagelser</label><br></div>',""!=(i+='<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Se alle hændelser</label><br></div>')&&(i+="<hr/>"),i="<div><div id=d2AdminPermissions>"+i,i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Lås konto</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>Ingen nye enhedsgrupper</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>Ingen nye enheder</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Ingen værktøjer (MeshCmd/router)</label><br>',i+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Lås kontoindstillinger</label><br>',setModalContent("xxAddAgent","Servertilladelser",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(o?0:1),n)}),n.siteadmin&&0!=n.siteadmin&&(Q("ua_fulladmin").checked=4294967295==n.siteadmin,Q("ua_serverbackup").checked=4294967295!=n.siteadmin&&!!(1&n.siteadmin),Q("ua_serverrestore").checked=4294967295!=n.siteadmin&&!!(4&n.siteadmin),Q("ua_fileaccess").checked=4294967295!=n.siteadmin&&!!(8&n.siteadmin),Q("ua_serverupdate").checked=4294967295!=n.siteadmin&&!!(16&n.siteadmin),Q("ua_lockedaccount").checked=4294967295!=n.siteadmin&&!!(32&n.siteadmin),Q("ua_nonewgroups").checked=4294967295!=n.siteadmin&&!!(64&n.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=n.siteadmin&&!!(128&n.siteadmin),Q("ua_locksettings").checked=4294967295!=n.siteadmin&&!!(1024&n.siteadmin),Q("ua_nonewdevices").checked=4294967295!=n.siteadmin&&!!(4096&n.siteadmin)),2&userinfo.siteadmin&&(Q("ua_manageusers").checked=4294967295!=n.siteadmin&&!!(2&n.siteadmin),QE("ua_manageusers",!o&&2&userinfo.siteadmin)),256&userinfo.siteadmin&&(Q("ua_manageusergroups").checked=4294967295!=n.siteadmin&&!!(256&n.siteadmin),QE("ua_manageusergroups",!o&&256&userinfo.siteadmin)),512&userinfo.siteadmin&&(Q("ua_managerecordings").checked=4294967295!=n.siteadmin&&!!(512&n.siteadmin),QE("ua_managerecordings",!o&&512&userinfo.siteadmin)),2048&userinfo.siteadmin&&(Q("ua_allevents").checked=4294967295!=n.siteadmin&&!!(2048&n.siteadmin),QE("ua_allevents",!o&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!o&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!o&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!o&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!o&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!o&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!o&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",!!(2&userinfo.siteadmin)),QV("d2MngGrp",!!(256&userinfo.siteadmin)),QV("d2MngRec",!!(512&userinfo.siteadmin)),QE("ua_lockedaccount",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewgroups",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nomeshcmd",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewdevices",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_locksettings",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),Q("ua_fileaccessquota").value=null!=n.quota?n.quota/1024:"",showUserAdminDialogValidate(),!1}}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var n=0,o=parseInt(Q("ua_fileaccessquota").value);1==Q("ua_fulladmin").checked?n=4294967295:(1==Q("ua_serverbackup").checked&&(n+=1),1==Q("ua_manageusers").checked&&(n+=2),1==Q("ua_serverrestore").checked&&(n+=4),1==Q("ua_fileaccess").checked&&(n+=8),1==Q("ua_serverupdate").checked&&(n+=16),1==Q("ua_lockedaccount").checked&&(n+=32),1==Q("ua_nonewgroups").checked&&(n+=64),1==Q("ua_nomeshcmd").checked&&(n+=128),1==Q("ua_manageusergroups").checked&&(n+=256),1==Q("ua_managerecordings").checked&&(n+=512),1==Q("ua_locksettings").checked&&(n+=1024),1==Q("ua_allevents").checked&&(n+=2048),1==Q("ua_nonewdevices").checked&&(n+=4096));var i={action:"edituser",id:t._id,siteadmin:n};0==isNaN(o)&&(i.quota=1024*o),meshserver.send(i)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",!!(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var n in usergroups)e.push(usergroups[n]);e.sort(nameSort);var o=[],i=document.getElementsByClassName("UserGroupCheckbox");for(n=0;n<i.length;n++)i[n].checked&&o.push(i[n].value);if(0==e.length)t+="<br />Ingen grupper fundet.<br />",QV("DuplicateUserGroupButton",!1);else{for(var n in t+='<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>',t+="<th>Navn<th style=width:80px>Brugere<th style=width:80px>Enhedsgrupper<th style=width:80px>Enheder",e)t+=addUserGroupHtml(e[n]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t),i=document.getElementsByClassName("UserGroupCheckbox");for(n=0;n<i.length;n++)i[n].checked=o.indexOf(i[n].value)>=0;p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,n=0,o=0;if(e.links)for(var i in e.links)i.startsWith("user/")&&t++,i.startsWith("mesh/")&&n++,i.startsWith("node/")&&o++;var s=EscapeHtml(e.name);if(null!=serverinfo.crossDomain){var a=e._id.split("/")[1];""!=a&&(s+=", <span style=color:#26F>"+EscapeHtml(a)+"</span>")}var r="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>";return r+="<div style=width:100%>",r+='<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>",r+='<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>',r+='<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>',r+='<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+s+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+n+"<td style=text-align:center>"+o}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupsGroupActionButton",t>0),Q("UsersGroupsSelectAllButton").value=t>0?"Vælg Ingen":"Vælg alle"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;if(0!=t){var o="Vælg en handling, der skal udføres på alle valgte brugere.<br /><br />";o+=addHtmlFormFloating("Funktion","<select id=d50groupop class=form-select><option value=1>Slet gruppe</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Gruppehandling",o),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx)}}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));if(1==Q("d50groupop").value){setModalContent("xxAddAgent","Slet Bruger Grupper",'Bekræft sletning af valgte brugergruppe(r)?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />Bekræft</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)}}}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<t.length;n++)!0===t[n].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[n].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",n="";if(2==e){if(usergroups)for(var o in usergroups)n+="<option value="+encodeURIComponentEx(o)+">"+EscapeHtml(usergroups[o].name)+"</option>";t+=addHtmlFormFloating("Brugergruppe",'<select id=dp4groupid class="form-select">'+n+"</select>")}if(1==e&&serverinfo.crossDomain){n='<select id=p4domain class="form-select">';for(var o in serverinfo.crossDomain)n+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Standard":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";t+=addHtmlFormFloating("Domæne",n+="</select>")}t+=addHtmlFormFloating("Navn","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"),t+=addHtmlFormFloating("Beskrivelse",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Opret brugergruppe":"Duplikér brugergruppe",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",Q("p4name").value.length>0)}function showCreateUserGroupDialogEx(e,t){var n={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(n.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(n.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(n)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){var n=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null!=n){var o=EscapeHtml(n.name);0==o.length&&(o="<i>Ingen</i>"),null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(o='<span role=button tabindex=0 title="Klik her for at redigere brugergruppens navn" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+o+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",o);var i=0,s=0,a=0;if(n.links)for(var r in n.links)r.startsWith("user/")&&i++,r.startsWith("mesh/")&&s++,r.startsWith("node/")&&a++;var l=n.desc;l=null==l||""==l?"<i>Ingen<i>":EscapeHtml(l);var d="<div style=min-height:80px><table style=width:100%>";if(8&args.hide&&(d+="<br />"+addDeviceAttribute("Navn",o)),null!=serverinfo.crossDomain||0!=debugmode){var c=n._id.split("/")[1];d+=addDeviceAttribute("Domæne",""!=c?EscapeHtml(c):"<i>Standard</i>"),d+=addDeviceAttribute("Gruppe-id",EscapeHtml(n._id))}if(null!=currentUserGroup.membershipType&&(d+=addDeviceAttribute("Group Type",EscapeHtml(currentUserGroup.membershipType))),256&userinfo.siteadmin?d+=addDeviceAttribute("Beskrivelse","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+l+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):d+=addDeviceAttribute("Beskrivelse",l),1==serverinfo.userGroupsSessionRecording){var u=[];n.flags&&2&n.flags&&u.push("Optag sessioner"),""==(u=u.join(", "))&&(u="<i>Ingen</i>"),d+=addDeviceAttribute("Funktioner",addLink(u,"p51edituserGroupFeatures()"))}var p=[],m=0;n.consent&&(m=n.consent),serverinfo.consent&&(m|=serverinfo.consent),64&m&&8&m?p.push("Skrivebords Prompt + Værktøjslinje"):64&m?p.push("Skrivebords værktøjslinje"):8&m?p.push("Prompt på skrivebordet"):1&m&&p.push("Skrivebordsnotifikation"),16&m?p.push("Terminal Prompt"):2&m&&p.push("Terminalbesked"),32&m?p.push("Filer Prompt"):4&m&&p.push("Filer Notifikation"),7==m&&(p=["Altid besked"]),56&~m||(p=["Spørg altid"]),""==(p=p.join(", "))&&(p="<i>Ingen</i>"),d+=addDeviceAttribute("Brugersamtykke",addLinkConditional(p,"p20editmeshconsent(4)",!0)),d+=addDeviceAttribute("Brugere",i),d+=addDeviceAttribute("Enhedsgrupper",s),d+=addDeviceAttribute("Enheder",a),d+="</table></div><br />",256&userinfo.siteadmin&&(d+='<input type=button class="btn btn-primary btn-sm" value="Meddelelse" title="Send en meddelelse til alle brugere i denne gruppe." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(n._id)+'") />'),QH("p51group",d),d="<br />",null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Tilføj brugere</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gruppemedlemmer</th><th scope=col></th></tr>';var g=1,v=[];for(var r in currentUserGroup.links)if(0!=r.startsWith("user/")){var h=r.split("/")[2];currentUserGroup.links[r].name&&(h=currentUserGroup.links[r].name),r==userinfo._id&&(h=userinfo.name),v.push({id:r,name:h,rights:currentUserGroup.links[r].rights})}for(var r in v.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),v){var f="";null==currentUserGroup.membershipType&&(f="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(v[r].id)+'")\' title="Fjern brugerrettigheder til denne enhedsgruppe" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>');var k=EscapeHtml(decodeURIComponent(v[r].name));null!=users&&(k="<a href=# onclick='gotoUser(\""+encodeURIComponentEx(v[r].id)+"\");haltEvent(event);'>"+k+"</a>"),d+="<tr "+(g%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Bruger"></i>&nbsp;'+k+"</td><td><div style=float:right>"+f+"</div></td></tr>",++g}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen medlemmar</i><div></div></div></td><td></td></tr>"),d+="</tbody></table><br />",g=1;var x=0,b=!1;for(var r in meshes)currentUserGroup._id.split("/")[1]==meshes[r]._id.split("/")[1]&&(x++,null!=currentUserGroup.links&&null!=currentUserGroup.links[r]||(b=!0));if(x>0&&b&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Tilføj enhedsgruppe</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Fælles enhedsgrupper</th><th scope=col></th></tr>',currentUserGroup.links){var y=[];for(var r in currentUserGroup.links)r.startsWith("mesh/")&&null!=meshes[r]&&y.push(meshes[r]);for(var r in y=getOrderedList(y,"name")){var w=0,S=y[r],M=(f="",makeDeviceGroupRightsString(currentUserGroup.links[S._id].rights));userinfo.links&&null!=userinfo.links[S._id]&&null!=userinfo.links[S._id].rights&&(w=userinfo.links[S._id].rights);var C="<i>Ukendt enhedsgruppe</i>";S&&(C="<a href=# onclick='gotoMesh(\""+S._id+"\");haltEvent(event);'>"+S.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(S._id)+'")\' title="Fjern brugergrupperettigheder til denne enhedsgruppe" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',M='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(S._id)+'")>'+M+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Enhedsgruppe" class=m99></div><div>&nbsp;'+C+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+M+"</div></td></tr>"}}if(1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen enhedsgrupper til fælles</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",g=1,d+="<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Tilføj en enhed</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Fælles enheder</th><th scope=col></th></tr>',currentUserGroup.links){var A=[];for(var r in currentUserGroup.links){if(r.startsWith("node/"))null!=(Q=getNodeFromId(r))&&A.push(Q)}for(var r in A=getOrderedList(A,"name")){var Q=A[r],D=(f="",M=makeUserDeviceRightsString(currentUserGroup.links[Q._id].rights),w=GetNodeRights(Q),"<i>Ukendt enhed</i>");Q&&(D="<a href=# onclick='gotoDevice(\""+Q._id+"\");haltEvent(event);'>"+Q.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(Q._id)+'")\' title="Fjern brugergrupperettigheder til denne enhed" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',M='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(Q._id)+'")>'+M+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Enhedsgruppe" class=m99></div><div>&nbsp;'+D+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+M+"</div></td></tr>"}}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen enheder til fælles</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",(null==currentUserGroup.membershipType||0==i)&&256&userinfo.siteadmin&&(d+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Slet Bruger Gruppe</a></span></div>"),QH("p51group2",d),go(51);var T="";if(!(268435456&features)&&xxcurrentView>=51&&xxcurrentView<=59&&null!=currentUserGroup){for(var r in T="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)T+="&"+r+"="+urlargs[r];try{window.history.replaceState({},document.title,window.location.pathname+T)}catch(e){}}}else 51==xxcurrentView&&go(50)}}function p51edituserGroupFeatures(){if(!xxdialogMode){var e=currentUserGroup.flags?currentUserGroup.flags:0,t="";1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Optag sessioner</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Rediger brugergruppe funktioner",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx)}}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){if(!xxdialogMode){var n=getNodeFromId(decodeURIComponent(t));null!=n&&(setModalContent("xxAddAgent","Fjern enhedstilladelser",format('Bekræft fjernelse af adgangsrettigheder til enheden "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,n._id)))}}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){if(!xxdialogMode){var n=meshes[decodeURIComponent(t)];null!=n&&(setModalContent("xxAddAgent","Fjern enhedsgruppetilladelser",format('Bekræft fjernelse af adgangsrettigheder for enhedsgruppen "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,n._id)))}}function p51editgroup(e,t){if(!xxdialogMode){var n=addHtmlFormFloating("Navn",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>");n+=addHtmlFormFloating("Beskrivelse",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Rediger Bruger Gruppe",n),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),2==e?Q("dp51desc").focus():Q("dp51name").focus()}}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",Q("dp51name").value.length>0),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){if(xxdialogMode)return!1;var e=format("Slet bruger gruppe {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />";return xxdialogButtons=3,setModalContent("xxAddAgent","Slet Bruger Gruppe",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />Bekræft</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog(),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){if(2==e){var n=t.split("/")[2];users&&users[t]&&(n=users[t].name),userinfo._id==t&&(n=userinfo.name),setModalContent("xxAddAgent","Fjern brugermedlemskab",format('Bekræft fjernelse af medlemskab for bruger "{0}"?',EscapeHtml(decodeURIComponent(n)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t))}}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){if(xxdialogMode)return!1;var e="Tillad brugere at administrere denne enhedsgruppe og enheder i denne gruppe.";return 524288&features&&(e+=" Brugere skal logge ind på denne server én gang før de kan tilføjes til denne enhedsgruppe."),e+="<br /><br /><div style='position:relative'>",e+=addHtmlFormFloating("Brugeridentifikatorer",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'),e+="<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",setModalContent("xxAddAgent","Tilføj brugere til brugergruppe",e+="</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog(),!1}function p51setname(e){e=decodeURIComponent(e);var t=Q("dp51username").value.split(",");for(var n in t)t[n]=t[n].trim();return t[t.length-1]=e,Q("dp51username").value=t.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(var n in t){var o=t[n]=t[n].trim();(0==o.length||o.indexOf('"')>=0)&&(e=!1)}var i=!1,s=!1;if(null!=users){var a=t[t.length-1].trim(),r=a.toLowerCase(),l=[];if(a.length>0){for(var n in users){var d=users[n]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===r){s=!0;break}if(users[n].name.toLowerCase().indexOf(r)>=0&&currentUserGroup.domain==d[1]&&(l.push([users[n]._id,users[n].name]),l.length>=8))break}if(0==s&&l.length>0){var c="";for(var n in l){var u=l[n][0],p=l[n][1];u.split("/")[2]==p.toLowerCase()?c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(u.split("/")[2])+"</div></div>"}QH("dp51usersuggest",c),i=!0}}}QV("dp51usersuggest",i)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var n=Q("dp51username").value.split(","),o=[];for(var i in n)o.push(n[i].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:o})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,n){if((!xxdialogMode||t)&&(null==n||null==n.originalTarget||null==n.originalTarget.href)){var o=currentUser=users[decodeURIComponent(e)];if(null!=o){QH("p30userName",EscapeHtml(o.name)),QH("p31userName",EscapeHtml(o.name));var i=o._id==userinfo._id,s=0;null!=wssessions&&wssessions[o._id]&&(s=wssessions[o._id]),null!=o.flags&&1&o.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==o.accountImageRnd&&(o.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+o._id.split("/")[2]+"&rnd="+o.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==s&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1));var a=o._id.split("/")[2];a.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):a.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):a.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):a.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):a.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):a.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):a.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):a.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1);var r=[],l="";null!=o.siteadmin&&32&o.siteadmin&&4294967295!=o.siteadmin&&(l='<img src="images/padlock12.png" height=12 width=8 title="Kontoen er spærret" style="margin-top:2px" /> ',r.push("Låst konto")),null!=o.siteadmin&&4294966047&o.siteadmin?8==o.siteadmin?r.push("Adgang til server filer"):4294967295==o.siteadmin?r.push("Fuld administrator"):r.push("Delvise rettigheder"):r.push("Ingen serverrettigheder"),null!=o.siteadmin&&4294967295!=o.siteadmin&&1216&o.siteadmin&&r.push("Begrænsninger");var d="<div style=min-height:80px><table style=width:100%>";8&args.hide&&(d+="<br />"+addDeviceAttribute("Navn",o.name));var c=o.email?EscapeHtml(o.email):"<i>Ikke indstillet</i>",u="",p=o.realname?EscapeHtml(o.realname):"<i>Ikke indstillet</i>";if(serverinfo.emailcheck&&(u=1==o.emailVerified?'<b style=color:green;cursor:pointer title="E-mail er bekræftet">&#x2713</b> ':'<b style=color:red;cursor:pointer title="E-mail er ikke bekræftet">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode){var m=o._id.split("/")[1];d+=addDeviceAttribute("Domæne",""!=m?EscapeHtml(m):"<i>Standard</i>"),d+=addDeviceAttribute("Brugeridentifikator",EscapeHtml(o._id))}else o.name.toLowerCase()!=o._id.split("/")[2]&&(d+=addDeviceAttribute("Brugeridentifikator",EscapeHtml(o._id.split("/")[2])));var g="";o.email&&(g=' <a href="mailto:'+EscapeHtml(o.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),4294967295!=o.siteadmin||4294967295==userinfo.siteadmin?(d+=addDeviceAttribute("E-mail",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+u+c+g+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),d+=addDeviceAttribute("Rigtige navn",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+p+' <i class="fa-solid fa-pencil fa-xs"></i></span>')):(d+=addDeviceAttribute("E-mail",u+c+g),d+=addDeviceAttribute("Rigtige navn",p)),(33554432&features||null!=o.phone)&&(d+=addDeviceAttribute("Telefonnummer","<span role=button onclick=p30editPhone()>"+(o.phone?o.phone:"<i>Ingen</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=o.msghandle)&&(d+=addDeviceAttribute("Messaging",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Messaging enabled" style="margin-top:2px"></i> '+(o.msghandle?o.msghandle:"<i>Ingen</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'));var v=[];1==serverinfo.usersSessionRecording&&o.flags&&2&o.flags&&v.push("Optag sessioner"),o.removeRights&&(8&o.removeRights?v.push("Ingen fjernadgang"):(65536&o.removeRights?v.push("Ingen skrivbord"):256&o.removeRights&&v.push("Kun Skrivebordsvisning"),512&o.removeRights&&v.push("Ingen Terminal"),1024&o.removeRights&&v.push("Ingen filer")),16&o.removeRights&&v.push("Ingen konsol"),32768&o.removeRights&&v.push("Ingen afinstallation"),131072&o.removeRights&&v.push("Ingen fjernkommando"),64&o.removeRights&&v.push("Ingen Wake"),262144&o.removeRights&&v.push("Ingen Reset/Off")),""==(v=v.join(", "))&&(v="<i>Ingen</i>"),d+=addDeviceAttribute("Funktioner",addLink(v,"p20edituserfeatures()")),d+=addDeviceAttribute("Serverrettigheder","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(o._id)+"\")'>"+l+r.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),o.quota&&(d+=addDeviceAttribute("Serverkvote",EscapeHtml(parseInt(o.quota)/1024)+" k")),d+=addDeviceAttribute("Oprettelse",printDateTime(new Date(1e3*o.creation))),o.login&&(d+=addDeviceAttribute("Seneste login",printDateTime(new Date(1e3*o.login)))),-1==o.passchange?d+=addDeviceAttribute("Kodeord","Ændres ved næste login."):o.passchange&&(d+=addDeviceAttribute("Kodeord",format("Senest ændret: {0}",printDateTime(new Date(1e3*o.passchange)))));var h=0,f="<i>Ingen<i>";if(o.links){for(var k in o.links)k.startsWith("mesh/")&&h++;1==h?f="1 gruppe":h>1&&(f=format("{0} grupper",h))}if(d+=addDeviceAttribute("Enhedsgrupper",f),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var x="<i>Ingen</i>";if(o.groups)for(var k in x="",o.groups)x+='<span class="tagSpan">'+EscapeHtml(o.groups[k])+"</span>";d+=addDeviceAttribute("Admin Realms",addLinkConditional(x,'showUserGroupDialog(event,"'+encodeURIComponentEx(o._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=o._id&&4294967295!=o.siteadmin))}var b=[],y=0;o.consent&&(y=o.consent),serverinfo.consent&&(y|=serverinfo.consent),64&y&&8&y?b.push("Skrivebords Prompt + Værktøjslinje"):64&y?b.push("Skrivebords værktøjslinje"):8&y?b.push("Prompt på skrivebordet"):1&y&&b.push("Skrivebordsnotifikation"),16&y?b.push("Terminal Prompt"):2&y&&b.push("Terminalbesked"),32&y?b.push("Filer Prompt"):4&y&&b.push("Filer Notifikation"),7==y&&(b=["Altid besked"]),56&~y||(b=["Spørg altid"]),""==(b=b.join(", "))&&(b="<i>Ingen</i>"),d+=addDeviceAttribute("Brugersamtykke",addLinkConditional(b,"p20editmeshconsent(2)",!0));var w=0;if(o.otpsecret>0||o.otphkeys>0||o.otpekey>0||o.otpduo>0){w=1;var S=[];o.otpsecret>0&&S.push("Godkendelses App"),o.otphkeys>0&&S.push("Sikkerhedsnøgle"),o.otpekey>0&&S.push("E-mail"),o.otpduo>0&&S.push("Duo"),o.otpkeys>0&&S.push("Sikkerhedskopi koder"),o.otpdev>0&&S.push("Enheds Push"),null!=o.phone&&67108864&features&&S.push("SMS"),null!=o.msghandle&&67108864&features2&&S.push("Messaging"),d+=addDeviceAttribute("Sikkerhed",'<i class="fa-solid fa-key" title="2. faktor godkendelse aktiveret" style="margin-top:2px"></i> '+S.join(", "))}if(d+="</table></div><br />",d+='<input type=button class="btn btn-primary btn-sm me-1" value="Noter" title="Se noter om denne bruger" onclick=showNotes(false,"'+encodeURIComponentEx(o._id)+'") />',o.phone&&33554432&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="SMS" title="Send en SMS-besked til denne bruger" onclick=showSendSMS("'+encodeURIComponentEx(o._id)+'") />'),o.msghandle&&33554432&features2&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Meddelelse" title="Send a message to this user" onclick=showSendMessage("'+encodeURIComponentEx(o._id)+'") />'),"string"==typeof o.email&&!0===o.emailVerified&&64&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="E-mail" title="Send en e-mail til denne bruger" onclick=showSendEmail("'+encodeURIComponentEx(o._id)+'") />'),!i&&(s>0||8&features2&&o.webpush)&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Giv besked" title="Send brugermeddelelse" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(o._id)+'") />',d+='<input type=button class="btn btn-primary btn-sm me-1" value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'") />',s>0&&null!=serverinfo&&null!=serverinfo.altmessenging))for(var k in serverinfo.altmessenging){var M=serverinfo.altmessenging[k];null!=M.type&&"user"!=M.type||(d+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(M.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'",'+k+") />")}QH("p30html",d),drawUserPermissions();var C=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=o.siteadmin||4294967295==userinfo.siteadmin;d="<div style=float:right;font-size:small>",C&&userinfo._id!=o._id&&(d+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Fjern denne bruger\">Slet Bruger</a>"),d+="</div><div style=font-size:small>",!C||524288&features||"~"==o._id.split("/")[2][0]||(d+="<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+w+')\' title="Skift kodeord for denne bruger">Skift Kodeord</a>',d+=" <a href=# style=cursor:pointer onclick='return p30viewPreviousLogins()' title=\"Se tidligere logins for denne bruger\">Tidligere logins</a>"),d+="</div><br>",QH("p30html3",d),d="",1==s?d="1 aktiv session":s>1&&(d=format("{0} aktive sessioner",s)),QH("MainUserState",d),go(30),QH("p31events",""),refreshUsersEvents();var A="";if(!(268435456&features)&&xxcurrentView>=30&&xxcurrentView<=39&&null!=currentUser){for(var k in A="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)A+="&"+k+"="+urlargs[k];try{window.history.replaceState({},document.title,window.location.pathname+A)}catch(e){}}}else go(4)}}function p30editPhone(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>';e+="<td style=width:100%;text-align:center>SMS-kompatibelt telefonnummer til denne bruger.<br />Efterlad tom for ingen.",e+='<br /><br /><div style=width:100%;text-align:center>Telefonnummer: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone?currentUser.phone:"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Telefonmeddelelser",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate()}}function p30editMessaging(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>';e+="<td style=width:100%>Messaging account for this user.";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Ingen</option>";if(1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle){if(currentUser.msghandle.startsWith("telegram:")&&1&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&4&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&8&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&16&serverinfo.userMsgProviders){Q("d2serviceselect").value=16;var n=currentUser.msghandle.substring(10).split("|");"signal"==n[0]&&3==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(n[1])+"&apikey="+decodeURIComponent(n[2])),"whatsapp"==n[0]&&3==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(n[1])+"&apikey="+decodeURIComponent(n[2])),"facebook"==n[0]&&2==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(n[1]))}currentUser.msghandle.startsWith("pushover:")&&32&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&64&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&128&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:")&&256&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6))}p30editMessagingValidate()}}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Emne":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Brugernavn",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){if(!xxdialogMode){var e=currentUser.flags?currentUser.flags:0,t="",n=currentUser.removeRights?currentUser.removeRights:0;t="";1==serverinfo.usersSessionRecording&&(t+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Optag sessioner</label><br></div>"),t+='<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&n?"checked":"")+">Ingen fjernadgang</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&n?"checked":"")+">Ingen skrivbordsadgang</label><br></div>",t+='<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&n?"checked":"")+">Kun fjernvisning</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&n?"checked":"")+">Ingen Terminaladgang</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&n?"checked":"")+">Ingen filadgang</label><br></div>",t+='<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&n?"checked":"")+">Ingen agentkonsol</label><br></div>",t+='<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&n?"checked":"")+">Ingen afinstallation</label><br></div>",t+='<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&n?"checked":"")+">Ingen fjernkommando</label><br></div>",t+='<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&n?"checked":"")+">Ingen Wake</label><br></div>",setModalContent("xxAddAgent","Rediger brugerfunktioner",t+='<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&n?"checked":"")+">Ingen Reset/Off</label><br></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate()}}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags?currentUser.flags:0);1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2);var t=0;Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){if(xxdialogMode)return!1;return xxdialogButtons=3,setModalContent("xxAddAgent",format("Skift rigtige navn for {0}",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname?currentUser.realname:"",!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){if(xxdialogMode)return!1;var t="";return t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Status",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>Ikke verificeret</option><option value=1>Verificeret</option></select>')),setModalContent("xxAddAgent",format("Skift email adresse for {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email?currentUser.email:"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail(),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@");t=0==e.length||2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0)),QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Tidligere logins","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t="";if(t+='<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>',t+='<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>',65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var n=[],o=0;for(var i in passRequirements)"reset"!=i&&"hint"!=i&&(n.push(i+":"+passRequirements[i]),o++);o>0&&(t+="<div style=font-size:x-small;padding:6px>"+format("Krav: {0}.",n.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Tving nulstilling af adgangskode ved næste login.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Fjern al 2. faktor-godkendelse.</label></div>'),setModalContent("xxAddAgent",format("Skift Kodeord for {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var n=!1;if(1==t&&1==Q("p4twoFactorRemove").checked&&(n=!0),Q("p4pass1").value==Q("p4pass2").value){var o={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:n,resetNextLogin:Q("p4resetNextLogin").checked};65536&features&&(o.hint=Q("p4hint").value),meshserver.send(o)}}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Slet Bruger {0}",EscapeHtml(currentUser.name)),format("Bekræft sletning af bruger {0}?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bekræft</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",n=0,o=!1;for(var i in meshes)meshes[i]._id.split("/")[1]==currentUser._id.split("/")[1]&&(n++,null!=currentUser.links&&null!=currentUser.links[i]||(o=!0));if(n>0&&o&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Tilføj enhedsgruppe</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Fælles enhedsgrupper</th><th scope=col></th></tr>',currentUser.links){var s=[];for(var i in currentUser.links)i.startsWith("mesh/")&&null!=meshes[i]&&s.push(meshes[i]);for(var i in s=getOrderedList(s,"name")){var a=0,r=s[i],l="",d=makeDeviceGroupRightsString(v=currentUser.links[r._id].rights);if(null!=r){userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(a=userinfo.links[r._id].rights);var c="<i>Ukendt enhedsgruppe</i>";r&&(c="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&2&a&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Fjern brugerrettigheder til denne enhedsgruppe" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Enhedsgruppe" class=m99></div><div>&nbsp;'+c+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen enhedsgrupper til fælles</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",256&userinfo.siteadmin){var u=0,p=!1;for(var i in usergroups)null==usergroups[i].membershipType&&usergroups[i]._id.split("/")[1]==currentUser._id.split("/")[1]&&(u++,null!=currentUser.links&&null!=currentUser.links[i]||(p=!0));u>0&&p&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Tilføj brugergruppe</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Brugergruppemedlemskaber</th><th scope=col></th></tr>',currentUser.links){var m=[];for(var i in currentUser.links)i.startsWith("ugrp/")&&null!=usergroups[i]&&m.push(usergroups[i]);for(var i in m=getOrderedList(m,"name")){var g=m[i],v=currentUser.links[m[i]._id].rights,h=(l="","<i>Ukendt brugergruppe</i>");null!=g&&(h=EscapeHtml(g.name),null!=usergroups&&(h="<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(m[i]._id)+"\");haltEvent(event);'>"+h+"</a>")),null==g.membershipType&&256&userinfo.siteadmin&&(l="<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(m[i]._id)+'")\' title="Fjern brugergruppe medlemskab" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>'),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Brugergruppe" class=m4></div><div>&nbsp;'+h+"<div></div></div></td><td><div style=float:right>"+l+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen brugergruppemedlemskaber</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Tilføj en enhed</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Fælles enheder</th><th scope=col></th></tr>',currentUser.links){var f=[];for(var i in currentUser.links){if(i.startsWith("node/"))null!=(k=getNodeFromId(i))&&f.push(k)}for(var i in f.sort(nameSort),f){var k=f[i];v=currentUser.links[k._id].rights,l="",a=GetNodeRights(k);userinfo.links&&null!=userinfo.links[i]&&null!=userinfo.links[i].rights&&(a=userinfo.links[i].rights);var x=k?EscapeHtml(k.name):"<i>Ukendt enhed</i>";2&a&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(k._id)+'")\' title="Fjern brugerrettigheder til denne enhedsgruppe" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(k._id)+'")>'+makeUserDeviceRightsString(v)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),x="<a href=# onclick='gotoDevice(\""+k._id+"\",10);haltEvent(event);'>"+x+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Enhed" class=si'+k.icon+"></div><div>&nbsp;"+x+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ingen enheder til fælles</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,n,o){xxdialogMode||(setModalContent("xxAddAgent","Fjern enhedsdeling",format('Bekræft fjernelse af enhedsdeling "{0}"?',decodeURIComponent(o))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(n)]))}function p30removeNodeFromUser(e,t){if(!xxdialogMode){var n=getNodeFromId(decodeURIComponent(t));setModalContent("xxAddAgent","Fjern enhedstilladelser",format('Bekræft fjernelse af adgangsrettigheder til enheden "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,n)}}function p30removeUserFromNode(e,t){if(!xxdialogMode){var n=null,o="";t=decodeURIComponent(t),xxdialogButtons=3,xxdialogTag=n,t.startsWith("user/")?(users&&null!=(n=users[t])&&(o=n.name),setModalContent("xxAddAgent","Fjern brugertilladelser",o?format('Bekræft fjernelse af adgangsrettigheder for brugeren "{0}"?',o):"Bekræft fjernelse af adgangsrettigheder?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,n){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})})):t.startsWith("ugrp/")&&(usergroups&&null!=(n=usergroups[t])&&(o=n.name),setModalContent("xxAddAgent","Fjern brugergruppetilladelser",o?format('Bekræft fjernelse af adgangsrettigheder for brugergruppen "{0}"?',o):"Bekræft fjernelse af adgangsrettigheder?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,n){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})}))}}function p30RemoveUserGroup(e,t){if(!xxdialogMode&&null!=usergroups){var n=decodeURIComponent(t),o=usergroups[n];setModalContent("xxAddAgent","Fjern brugergruppemedlemskab",format('Bekræft fjernelse af medlemskab for brugergruppen "{0}"?',null!=o?EscapeHtml(o.name):"<i>Ukendt</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,n)})}}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e="";for(var t in usergroups)null==usergroups[t].membershipType&&usergroups[t]._id.split("/")[1]==currentUser._id.split("/")[1]&&(null!=currentUser.links&&null!=currentUser.links[t]||(e+="<option value="+encodeURIComponentEx(t)+">"+EscapeHtml(usergroups[t].name)+"</option>"));var n=addHtmlFormFloating("Brugergruppe",'<select id=dp2groupid class="form-select">'+e+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","Tilføj medlemsskab",n),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){if(!xxdialogMode){var n=meshes[decodeURIComponent(t)];null!=n&&(setModalContent("xxAddAgent","Fjern enhedsgruppetilladelser",format('Bekræft fjernelse af adgangsrettigheder for enhedsgruppen "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,n._id)}))}}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(var n in currentUserEvents){var o=currentUserEvents[n],i=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(i)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(i))+"</td></tr>");var s,a="fa-mobile-screen";if("user"==o.etype&&(a="fa-user"),"server"==o.etype&&(a="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])s="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{for(var n in s=eventsMessageId[o.msgid],o.msgArgs){var r=o.msgArgs[n];"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9))))),s=s.split("{"+n+"}").join(r)}s=EscapeHtml(s).split("(R)").join("&reg;")}if(o.nodeid){var l=getNodeFromId(o.nodeid);null!=l&&(a="si"+l.icon,s="<a href=# onclick='gotoDevice(\""+o.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(l.name)+"</a> &rarr; "+s)}if(o.username&&o.username!=currentUser.name){var d="";o.guestname&&(d=' / <span title="Dette er en gæstedelingssession">'+EscapeHtml(o.guestname)+"</span>"),s=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+d+" &rarr; "+s:EscapeHtml(o.guestname)+" &rarr; "+s}else o.guestname&&(s='<span title="Dette er en gæstedelingssession">'+EscapeHtml(o.guestname)+"</span> &rarr; "+s);"relay"!=o.etype&&"relaylog"!=o.action||(a="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+a+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(i)+" - "+s+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ingen begivenheder fundet</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),n="",o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);if(null==p52recordings)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Indlæser...</i></div>";else if("number"==typeof p52recordings)n+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to read from the recordings folder.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to get recordings from the database.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>An unknown error occured.</i></div>";else if(0==p52recordings.length)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Ingen optagelser.</i></div>";else{if(n+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>',n+="<th>Session</th><th style=width:110px>"+nobreak("Starttid")+"</th><th style=width:110px>Varighed</th><th style=width:110px>Størrelse</th></tr></thead><tbody>",null!=p52recordings){var i=null;for(var o in p52recordings){var s=p52recordings[o],a=printDate(new Date(s.startTime));a!=i&&(i=a,n+="<tr><td class=userTableHeader colspan=4>"+a),n+=addRecordingHtml(o,s)}}n+="</tbody></table>"}QH("p52recordings",n),t=document.getElementsByClassName("RecordingCheckbox");for(o=0;o<t.length;o++)t[o].checked=e.indexOf(t[o].value)>=0;p52updateInfo()}function addRecordingHtml(e,t){var n="";t.lengthTime&&(n=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60)));var o=printTime(new Date(t.startTime));t.sessionStart&&(o=printTime(new Date(t.sessionStart)));var i="";t.size&&(i=format("{0} Kb",Math.round(t.size/1024)));var s="<i>Ukendt</i>";t.name&&t.meshname&&(s=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name));if(null!=t.userids&&t.userids.length>0)if(t.userids.length>1)s+=" - "+format("{0} users",t.userids.length);else{var a=null;null!=users&&(a=users[t.userids[0]]),s+=null!=a?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(a.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])}1==t.protocol&&(s+=" - Terminal session"),2==t.protocol&&(s+=" - Skrivebordssession"),5==t.protocol&&(s+=" - Filoverførsel"),6==t.protocol&&(s+=" - Admin PowerShell"),8==t.protocol&&(s+=" - Bruger Shell"),9==t.protocol&&(s+=" - Bruger PowerShell"),100==t.protocol&&(s+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(s+=" - Intel&reg; AMT-omdirigering"),200==t.protocol&&(s+=" - Messenger");var r="",l="fa-circle-xmark text-danger";1==t.present&&(l="fa-circle-check text-success",r='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',r+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>');var d="<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>";return d+="<div class=bar style=width:100%>",d+="<div></div>",d+='<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+l+'"></i></div>',d+='<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>',d+='<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+r+"<div style=font-size:16px>"+s+"</div></div></div><td style=text-align:center>"+o+"<td style=text-align:center>"+n+"<td style=text-align:center>"+i}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var n=p52recordings[t],o="";if(n.protocol){var i="Ukendt";1==n.protocol&&(i="Terminal"),2==n.protocol&&(i="Skrivebord"),5==n.protocol&&(i="Filer"),6==n.protocol&&(i="Admin PowerShell"),8==n.protocol&&(i="Bruger Shell"),9==n.protocol&&(i="Bruger PowerShell"),100==n.protocol&&(i="Intel&reg; AMT WSMAN"),101==n.protocol&&(i="Intel&reg; AMT-omdirigering"),200==n.protocol&&(i="Messenger"),o+=addHtmlValue4("Protocol",i)}if(o+=addHtmlValue4("Status",1==n.present?"Findes på serveren":"Ikke på serveren"),n.name&&(o+=addHtmlValue4("Enhedsnavn",EscapeHtml(n.name))),n.meshname&&(o+=addHtmlValue4("Enhedsgruppe",EscapeHtml(n.meshname))),n.size&&(o+=addHtmlValue4("Størrelse",format("{0} bytes",n.size))),n.startTime&&(o+=addHtmlValue4("Starttid",printTime(new Date(n.startTime)))),n.startTime&&n.lengthTime&&(o+=addHtmlValue4("Slut tid",printTime(new Date(n.startTime+1e3*n.lengthTime)))),n.lengthTime&&(o+=addHtmlValue4("Varighed",pad2(Math.floor(n.lengthTime/3600))+":"+pad2(Math.floor(n.lengthTime%3600/60))+":"+pad2(Math.floor(n.lengthTime%60)))),1==n.multiplex&&(o+=addHtmlValue4("Multiplexor","Aktiveret")),n.userids)for(var t in n.userids)o+=addHtmlValue4("Bruger",n.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Optagelsesdetaljer",o),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),1==e?d3setActions():d3updatefiles()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e="",t="",n=filetree,o=1,i="",s=[],a=[],r=document.getElementsByName("fc"),l=0;l<r.length;l++)r[l].checked&&a.push(r[l].value);for(var l in d3filetreelinkpath="",d3filetreelocation){if(null==n.f||null==n.f[d3filetreelocation[l]])break;if(s.push(d3filetreelocation[l]),1==o){var d=d3filetreelocation[l].split("/");window.location.origin+domainUrl+d[0]+"files/"+d[2],d3filetreelocation[l]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=d[0]+"/"+d[2]}else""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[l],o>2&&"/"+d3filetreelocation[l]);i=(n=n.f[d3filetreelocation[l]]).n,o++}d3filetreelocation=s;var c=p5sort_files(n.f),u="";for(var l in d3fileoptions.filter&&(u=Q(d3fileoptions.filter).value),c){var p,m=c[l],g=m.n;if(3!=m.t||""==u||0!=m.nx.toLowerCase().endsWith(u)){p=g.length>70?'<span title="'+EscapeHtml(g)+'">'+EscapeHtml(g.substring(0,70))+"...</span>":EscapeHtml(g);var v="";null!=m.s&&(v=getFileSizeStr(m.s));var h="";if(3!=m.t){h='<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+m.t+' onclick=d3folderset("'+encodeURIComponentEx(m.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(m.nx)+"\")'>"+p+"</a></span></div>"}else{var f=p;h='<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+m.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(v)+"</span><span><div class=fileIcon"+m.t+"></div>"+f+"</span></div>"}m.t<3?e+=h:t+=h}}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,i),QH(d3fileoptions.files,e+t),QE(d3fileoptions.folderup,d3filetreelocation.length>0),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",Q("d3localFile").value.length>0):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",n=JSON.parse(getstore("_ReportSettings","{}")),o={1:"Fjernsessioner",2:"Brugertrafik",3:"Bruger logins"};for(var i in 4294967295==userinfo.siteadmin&&(o[4]="Database Records"),o)e+="<option value="+i+(n.type==i?" selected":"")+">"+o[i]+"</option>";t+=addHtmlFormFloating("Type",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="<div id=d2GroupByDiv style=display:none>",e="";o={1:"Bruger",2:"Enhed",3:"Dag"};for(var i in o)e+="<option value="+i+(n.groupBy==i?" selected":"")+">"+o[i]+"</option>";t+=addHtmlFormFloating("Gruppér efter",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2GroupByDiv2 style=display:none>",e="";o={1:"Bruger",3:"Dag"};for(var i in o)e+="<option value="+i+(n.groupBy2==i?" selected":"")+">"+o[i]+"</option>";t+=addHtmlFormFloating("Gruppér efter",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==n.devGroup?" selected":"")+">Alle</option>";var s=getOrderedList(meshes,"name");for(var i in s)e+="<option value="+encodeURIComponentEx(s[i]._id)+(n.devGroup==s[i]._id?" selected":"")+">"+EscapeHtml(s[i].name)+"</option>";t+=addHtmlFormFloating("Enhedsgruppe",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"),t+="</div>",t+="<div id=d2timeBackDiv style=display:none>",e="",null==n.timeRange&&(n.timeRange=1);o={1:"Seneste dag",7:"Seneste 7 dage",30:"Seneste 30 dage",0:"Tidsinterval"};for(var i in o)e+="<option value="+i+(n.timeRange==i?" selected":"")+">"+o[i]+"</option>";t+=addHtmlFormFloating("Tid",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2timeRangeDiv style=display:none>",t+=addHtmlFormFloating("Tidsintervalstart",'<input id=d2timeRangeStartSelector class="flatpickr form-control" type="text" placeholder="Vælg dato og tid..." data-id="altinput">'),t+=addHtmlFormFloating("Tidsinterval",'<input id=d2timeRangeEndSelector class="flatpickr form-control" type="text" placeholder="Vælg dato og tid..." data-id="altinput">'),t+="</div>",t+="<div id=d2showTrafficDiv style=display:none>",t+=addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(n.showTraffic?"checked":"")+">Vis trafik</label><div>"),setModalContent("xxAddAgent","Generer rapport",t+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>generateReportDialogEx("",xxdialogTag)),generateReportDialogValidate();var a=new Date;a.setDate(a.getDate()-7);var r=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,maxDate:new Date,defaultDate:a,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,n){l.set("minDate",t),l.selectedDates[0]&&l.selectedDates[0]<e[0]&&l.clear()}}),l=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,maxDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:r,rangeEnd:l}}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var n,o;0==Q("d2timeRange").value?(o=Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),n=Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3)):(o=Math.floor(new Date/1e3),n=new Date,n=Math.floor(n.setDate(n.getDate()-Q("d2timeRange").value)/1e3));var i=null;try{i=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var s=decodeURIComponent(Q("d2groupId").value);0==s&&(s=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:s,showTraffic:Q("d2showTraffic").checked}));var a=parseInt(Q("d2groupBy").value);3==Q("d2reportType").value&&(a=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:a,start:n,end:o,tz:i,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:s,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Tid",device:"Enhed",session:"Session",user:"Bruger",devgroup:"Enhedsgruppe",guest:"Gæst",length:"Længde",bytesin:"Bytes Ind",bytesout:"Bytes Ud",os:"Operativ system",ip:"IP-adresse",browser:"Browser",msg:"Meddelelse",twofactor:"2. faktor"},n='<table class="table table-hover">',o=null,i=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),n+="<tr><td style=text-align:center;padding-top:32px>Rapporten gav ingen poster.</tr></td>";else{for(var s in reportCSV='"Gruppe"',n+="<tr>",e.columns){var a;a=null!=t[e.columns[s].title]?t[e.columns[s].title]:EscapeHtml(e.columns[s].title);var r="";e.columns[s].align?r+=";text-align:"+EscapeHtml(e.columns[s].align):r+=";text-align:left",0!=s||"datetime"!=e.columns[s].format&&"time"!=e.columns[s].format||(r+=";width:1%"),n+="<th style="+r+">"+a+"</th>",reportCSV+=',"'+csvClean(a)+'"'}for(var s in n+="</tr>",reportCSV+="\r\n",e.groups)for(var l in n+="<tr style=height:8px></tr>",n+="<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>',0!=s&&(n+=renderReportFormat(s,e.groupFormat)),n+="</b></td></tr>",e.groups[s].entries){var d=e.groups[s].entries[l];for(var c in n+="<tr>",reportCSV+=0!=s?'"'+csvClean(renderReportFormatCSV(s,e.groupFormat))+'"':'""',e.columns){r="";if(null!=e.columns[c].format&&(r="white-space:nowrap;"),e.columns[c].align&&(r="text-align:"+EscapeHtml(e.columns[c].align)),null!=d[e.columns[c].id]?(n+='<td style="'+r+'">'+renderReportFormat(d[e.columns[c].id],e.columns[c].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(d[e.columns[c].id],e.columns[c].format))+'"'):(n+="<td></td>",reportCSV+=","),null!=e.columns[c].sumBy){var u=d[e.columns[c].sumBy];!0===e.columns[c].sumBy&&(u=!0);var p=d[e.columns[c].id];o=e.columns[c].sumBy,null!=p&&(-1==i.indexOf(u)&&i.push(u),null==e.columns[c].subtotals&&(e.columns[c].subtotals={},e.columns[c].totals={}),null==e.columns[c].subtotals[u]?e.columns[c].subtotals[u]=p:e.columns[c].subtotals[u]+=p,null==e.columns[c].totals[u]?e.columns[c].totals[u]=p:e.columns[c].totals[u]+=p)}}n+="</tr>",reportCSV+="\r\n"}if(null!=o){var m=-1;if(!0===o)m=99999;else for(var s in e.columns)e.columns[s].id==o&&(m=s);if(m>=0){i.sort();var g=!0;for(var l in n+="<tr style=height:8px></tr>",i){for(var s in n+="<tr>",e.columns)if(s==m){r="";e.columns[c].align&&(r+=";text-align:"+EscapeHtml(e.columns[c].align)),g&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(i[l],e.columns[s].format)}else if(null!=e.columns[s].totals){r="";e.columns[c].align&&(r+=";text-align:"+EscapeHtml(e.columns[c].align)),g&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[s].totals[i[l]],e.columns[s].format)}else n+="<td></td>";n+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}n+="</table>",QH("p60report",n)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Skrivebord":5==e?"Filer":6==e?"Admin PowerShell":8==e?"Bruger Shell":9==e?"Bruger PowerShell":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messenger":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Ukendt ("+e+")";if("seconds"==t){var n=e%60,o=Math.floor(e/60)%60,i=Math.floor(e/3600);return zeroPad(i,2)+":"+zeroPad(o,2)+":"+zeroPad(n,2)}if("node"==t)return null!=(s=getNodeFromId(e))?"<div onclick='gotoDevice(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+s.icon+'"></div>'+EscapeHtml(s.name):"<i>Ukendt</i>";if("mesh"==t)return null!=(c=meshes[e])?"<div onclick='gotoMesh(\""+c._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(c.name):"<i>Ukendt</i>";if("nodemesh"==t){var s,a=null,r=null,l=e.split("/"),d="<table><tr>";if(l.length>=3&&(a=l[0]+"/"+l[1]+"/"+l[2]),l.length>=6&&(r=l[3]+"/"+l[4]+"/"+l[5]),null!=r){var c;if(null==(c=meshes[r]))return"<i>Ukendt</i>";d+="<td><div onclick='gotoMesh(\""+c._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(c.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(s=getNodeFromId(a))?"<i>Ukendt</i>":(d+="<td><div onclick='gotoDevice(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+s.icon+'"></div>'+EscapeHtml(s.name)+"</td>",d+="</tr></table>")}if("user"==t){var u=null;if(e==userinfo._id?u=userinfo:null!=users&&(u=users[e]),null!=u){var p=u.name;return null!=u.realname&&(p+=", "+u.realname),"<div onclick='gotoUser(\""+u._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(p)}return"<i>Ukendt bruger</i>"}if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Vellykket login';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>Forkert 2. faktor';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Låst konto';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Ugyldigt loginforsøg'}if("2fa"==t){if(""==e)return"Ingen";if("backup"==e)return"Sikkerhedskopi koder";if("fido"==e)return"FIDO nøgle";if("sms"==e)return"SMS besked";if("hwotp"==e)return"Hardware OTP";if("messenger"==e)return"Messenging";if("push"==e)return"Push notifikation";if("otp"==e)return"Engangskodeord";if("cookie"==e)return"Husk enhed";if("tokenlogin"==e)return"Login-token";if("ipaddr"==e)return"IP-adresse";if("sso"==e)return"Single Sign-on"}if("records"==t){var m={node:"Device record",mesh:"Device group record",user:"User records",sysinfo:"Device information records",iploc:"IP location information records",note:"Text notes records",ifinfo:"Network interface information records",cfile:"Configuration file records",lastconnect:"Last connection time records",power:"Device power transition records",events:"Event records",serverstats:"Server statistics records",ugrp:"User group records",deviceshare:"Device sharing records",logintoken:"Account login token records",smbios:"Device SMBIOS record",pmt:"Device Push Notification Record",meshcentral:"Device, users, groups and other records"};return null!=m[e]?m[e]:e}return EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Skrivebord":5==e?"Filer":6==e?"Admin PowerShell":8==e?"Bruger Shell":9==e?"Bruger PowerShell":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messenger":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Ukendt ("+e+")";if("node"==t){var n=getNodeFromId(e);if(null!=n)return n.name}if("mesh"==t){var o=meshes[e];if(null!=o)return o.name}if("user"==t){var i=null;if(e==userinfo._id?i=userinfo:null!=users&&(i=users[e]),null!=i){var s=i.name;return null!=i.realname&&(s+=" - "+i.realname),s}return"Ukendt bruger"}if("msg"==t){if(107==e)return"Vellykket login";if(108==e)return"Forkert 2. faktor";if(109==e)return"Låst konto";if(110==e)return"Ugyldigt loginforsøg"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",e>0))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Der er i øjeblikket ingen meddelelser</div>";else for(var n in notifications){var o=notifications[n],i="",s=new Date(o.time),a=0;if(null!=o.title&&(i="<b>"+EscapeHtml(o.title)+"</b>: "),null!=o.nodeid){var r=getNodeFromId(o.nodeid);null!=r&&(a=r.icon,i=16&e?"<b>"+EscapeHtml(meshes[r.meshid].name)+" / "+EscapeHtml(r.name)+"</b>: ":"<b>"+EscapeHtml(r.name)+"</b>: ")}t+='<div title="'+format("Opstod kl. {0}",printDateTime(s))+'" id="notifyx'+o.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',a&&(t+="<div class=j"+a+' onclick="notificationSelected('+o.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+o.id+')" class=unselectable title="Ryd denne notifikation" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+o.id+')" style=margin:5px>'+i+EscapeHtml(o.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(s)+"</div></div>"}var l="";notifications.length>1&&(l='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Fjern alt</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+l+"</div>")}function notificationSelected(e,t){var n=-1;for(var o in notifications)notifications[o].id==e&&(n=o);-1!=n&&(notificationSelectedEx(notifications[n],e),t&&notifications[n]&&(notifications[n].notification&&(notifications[n].notification.close(),delete notifications[n].notification),notificationDelete(e)))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,n=Q("notifyx"+e);if(null!=n){for(var o in notifications)notifications[o].id==e&&(t=o);if(-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),n.parentNode.removeChild(n),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),notifications.length>0&&0==t)){var i=notifications[0];QS("notifyx"+i.id)["border-top"]="1px solid transparent"}}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Ny konto","Servergrænse","Sikkerhedsadvarsel","Konto indstillinger","Enhedsgruppe","Invitationskoder"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Adgang nægtet","Ugyldigt brugernavn","Ugyldigt kodeord","Ugyldig email","Ugyldigt domæne","Ugyldige webstedstilladelser","Bruger eksisterer allerede","Kan ikke tilføje bruger i denne tilstand","Validering undtagelse","Kontogrænsen er nået.","Chatanmodning, klik her for at acceptere.","Der har været {0} mislykkede loginforsøg på denne konto siden sidste login.","Kunne ikke ændre e-mailadresse, en anden konto bruger allerede: {0}.","E-mail sendt.","Bruger {0} ikke fundet.","Brugere {0} ikke fundet.","Fejl, kan ikke ændres til tidligere brugt adgangskode.","Fejl, kan ikke ændres til almindeligt brugt adgangskode.","Fejl, adgangskode ikke ændret.","Adgangskode ændret.","Nuværende adgangskode er ikke korrekt.",'Fejl, invitationskoden "{0}" er allerede i brug.',"SMS-gateway ikke aktiveret","Ingen brugerstyringsrettigheder","Ugyldig SMS-besked","Intet telefonnummer til denne bruger","SMS succesfully sent.","SMS-fejl","SMS-fejl: {0}",'E-mail-domæne "{0}" er ikke tilladt. Kun ({1}) er tilladt',"Invalid message","Message succesfully sent.","Message error","Message error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t=getstore("notifications",0);1&t&&Q("chimes").play();var n=null;if(Notification&&"granted"==Notification.permission){var o=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n");if(e.nodeid){var i=getNodeFromId(e.nodeid);i&&(n=16&t?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[i.meshid].name+" - "+i.name,{tag:e.tag,body:o,icon:"/images/notify/icons128-"+i.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+i.name,{tag:e.tag,body:o,icon:"/images/notify/icons128-"+i.icon+".png"}))}else{null==e.icon&&(e.icon=0);var s=e.title;s=null==s?"":" - "+e.title,n=new Notification(decodeURIComponent("{{{extitle}}}")+s,{tag:e.tag,body:o,icon:"/images/notify/icons128-"+e.icon+".png"})}n.id=e.id,n.xtag=e.tag,n.url=e.url,n.nodeid=e.nodeid,n.username=e.username,n.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=n}if("number"==typeof e.maxtime&&e.maxtime>0){var a=function e(){notificationDelete(e.xid)};a.xid=e.id,setTimeout(a,1e3*e.maxtime)}}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Brugt","Ledig"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Brugt","Ledig"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t={ServerState:"Servertilstand",AgentErrorCounters:"Agent fejltællere",UnknownGroup:"Ukendt gruppe",InvalidPKCSsignature:"Ugyldig PKCS-signatur",InvalidRSAsignature:"Ugyldig RSA-signatur",InvalidJSON:"Ugyldig JSON",UnknownAction:"Ukendt handling",BadWebCertificate:"Ugyldig Web Certifikat",BadSignature:"Ugyldig signatur",MaxSessionsReached:"Maksimalt antal sessioner nået",UnknownDeviceGroup:"Ukendt enhedsgruppe",InvalidDeviceGroupType:"Ugyldig enhedsgruppetype",DuplicateAgent:"Duplikér agent",ConnectedIntelAMT:"Forbundne Intel&reg; AMT",ConnectedIntelAMTCira:"Forbundne Intel&reg; AMT CIRA",RelayErrors:"Relay fejl",UserAccounts:"Brugerkonti",DeviceGroups:"Enhedsgrupper",AgentSessions:"Agent sessioner",ConnectedUsers:"Forbundne brugere",UsersSessions:"Brugersessioner",RelaySessions:"Relay sessioner",RelayCount:"Antal Relays"};if(setupGeneralServerStats(),"object"==typeof e.cpuavg){var n=Math.min(e.cpuavg[0],1);window.serverStatCpu.config.data.datasets[0].data=[n,1-n],QH("serverCpuChartText",'<div style=margin-bottom:5px>CPU-belastning</div><div><b title="CPU-belastning det sidste minut">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="CPU-belastning i de seneste 5 minutter">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="CPU-belastning i de seneste 15 minutter">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()}"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Tilgængelig hukommelse</div><div><b>"+getNiceSize3(e.availablemem)+"</b> ledig, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memory</div><div><b>"+getNiceSize3(e.freemem)+"</b> ledig, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update());var o="<div style=width:100% cellpadding=0 cellspacing=0>";if("object"==typeof e.values)for(var i in e.values)for(var s in o+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(t[i]?t[i]:i)+"</div>",e.values[i])o+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(t[s]?t[s]:s)+"</span><span style=float:right>"+e.values[i][s]+"</span></td><td></td></tr></table></div>";o+="</div>",QH("serverStatsTable",o)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){if(null!=serverTimelineStats){var t=null;if(null!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t){serverTimelineStats.push(e);var n=Q("p40type").value;0==n?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am}),null!=e.conn.amc&&serverTimelineConfig.data.datasets[5].data.push({x:e.time,y:e.conn.amc})):1==n?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==n||4==n?updateServerTimelineStats():5==n&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours()}}}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}const trafficSeriesNames=["Agent","CIRA","AMT-OS","HTTP","Relay","Terminal","Skrivebord","Filer","WebRDP","WebSSH","WebVNC","Skrivebord Multiplex"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e,t=Q("p40type").value,n=pastDate(Q("p40time").value),o=[],i=null,s=!1,a=!0;if(null!=Q("p40server").value&&(""==(i=decodeURIComponent(Q("p40server").value))&&(i=null),a=!1),serverTimelineConfig.options.scales.x.min=n,serverTimelineConfig.options.scales.y.stacked=3==t||4==t,0==t){serverTimelineConfig.options.scales.y.title.text="Antal forbindelser",e={labels:[pastDate(0),n],datasets:[{label:"Agenter",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Brugere",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Brugersessioner",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Relay sessioner",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0},{label:"Intel AMT CIRA",data:[],backgroundColor:"rgba(255, 155, 0, .1)",borderColor:"rgb(255, 155, 0)",fill:!0}]};for(var r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a&&(i=serverTimelineStats[r].s,a=!1)),null==serverTimelineStats[r].s&&(s=!0),serverTimelineStats[r].s==i&&(1==serverTimelineStats[r].first&&(e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[5].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),e.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),e.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),e.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),e.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am}),null!=serverTimelineStats[r].conn.amc&&e.datasets[5].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.amc})))}}else if(1==t){serverTimelineConfig.options.scales.y.title.text="Megabyte",e={labels:[pastDate(0),n],datasets:[{label:"Ekstern",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Heap Used",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Heap total",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a&&(i=serverTimelineStats[r].s,a=!1)),null==serverTimelineStats[r].s&&(s=!0),serverTimelineStats[r].s==i&&(1==serverTimelineStats[r].first&&(e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),e.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),e.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),e.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==t||4==t){serverTimelineConfig.options.scales.y.title.text="Megabyte",e={labels:[pastDate(0),n],datasets:[]};var l=0;for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a&&(i=serverTimelineStats[r].s,a=!1)),null==serverTimelineStats[r].s&&(s=!0),serverTimelineStats[r].s==i&&serverTimelineStats[r].traffic&&(serverTimelineStats[r].traffic.AgentCtrlIn>0&&(l|=1),serverTimelineStats[r].traffic.CIRAIn>0&&(l|=2),serverTimelineStats[r].traffic.LMSIn>0&&(l|=4),serverTimelineStats[r].traffic.httpIn>0&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(serverTimelineStats[r].traffic.relayIn[0]>0&&(l|=16),serverTimelineStats[r].traffic.relayIn[1]>0&&(l|=32),serverTimelineStats[r].traffic.relayIn[2]>0&&(l|=64),serverTimelineStats[r].traffic.relayIn[5]>0&&(l|=128),serverTimelineStats[r].traffic.relayIn[10]>0&&(l|=256),serverTimelineStats[r].traffic.relayIn[11]>0&&(l|=512),serverTimelineStats[r].traffic.relayIn[12]>0&&(l|=1024)),serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in>0&&(l|=2048)));for(r=0;r<13;r++)l&1<<r&&e.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a&&(i=serverTimelineStats[r].s,a=!1)),null==serverTimelineStats[r].s&&(s=!0),serverTimelineStats[r].s==i)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var c=0;3==t?(1&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==t&&(1&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0}))}}else if(5==t){serverTimelineConfig.options.scales.y.title.text="Anvendelse",e={labels:[pastDate(0),n],datasets:[{label:"CPU",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)if("object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]){if(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a&&(i=serverTimelineStats[r].s,a=!1)),null==serverTimelineStats[r].s&&(s=!0),serverTimelineStats[r].s!=i)continue;1==serverTimelineStats[r].first&&e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]})}}if(serverTimelineConfig.data=e,window.serverMainStats.update(),o.length>0){var u="";for(r=0;r<o.length;r++)u+='<option value="'+encodeURIComponentEx(o[r])+'"'+(i==o[r]?" selected":"")+">"+EscapeHtml(o[r])+"</option>";s&&(u+='<option value=""'+(null==i?" selected":"")+">Null</option>"),QH("p40server",u)}QV("p40server",o.length>0)}}function p40downloadEvents(){for(var e="time, conn.agent, conn.users, conn.usersessions, conn.relaysession, conn.intelamt, mem.external, mem.heapused, mem.heaptotal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am?serverTimelineStats[t].conn.am:"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e="",t=parseInt(Q("p41limitdropdown").value);for(var n in serverTrace.length>t&&serverTrace.splice(t),serverTrace){var o=[];for(var i in serverTrace[n].args)"object"==typeof serverTrace[n].args[i]?o.push(JSON.stringify(serverTrace[n].args[i])):o.push(serverTrace[n].args[i]);e+="<div class=traceEvent onclick=showTraceEvent("+n+")>"+EscapeHtml(new Date(serverTrace[n].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[n].source.toUpperCase())+"</b>: "+EscapeHtml(o.join(", "))+"</div>"}QH("p41events",e)}function showTraceEvent(e){var t=serverTrace[e],n="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?n+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":n+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Serversporingshændelse","<div class=selecttext style=max-height:300px;overflow-y:auto>"+n+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Core Server</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(serverTraceSources.indexOf("cookie")>=0?"checked":"")+">Cookie encoder</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(serverTraceSources.indexOf("dispatch")>=0?"checked":"")+">Meddelelses formidler</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(serverTraceSources.indexOf("main")>=0?"checked":"")+">Hovedserver meddelelser</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(serverTraceSources.indexOf("peer")>=0?"checked":"")+">MeshCentral Server Peering</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(serverTraceSources.indexOf("agent")>=0?"checked":"")+">MeshAgent-trafik</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(serverTraceSources.indexOf("agentupdate")>=0?"checked":"")+">MeshAgent-opdatering</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(serverTraceSources.indexOf("cert")>=0?"checked":"")+">Server Certifikat</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(serverTraceSources.indexOf("db")>=0?"checked":"")+">Server Database</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(serverTraceSources.indexOf("email")>=0?"checked":"")+">E-mail/SMS/Push-trafik</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Webbserver</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(serverTraceSources.indexOf("web")>=0?"checked":"")+">Webbserver</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(serverTraceSources.indexOf("webrequest")>=0?"checked":"")+">Webserveranmodninger</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(serverTraceSources.indexOf("relay")>=0?"checked":"")+">Web Socket Relay</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(serverTraceSources.indexOf("httpheaders")>=0?"checked":"")+">Webbserver HTTP Headers</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(serverTraceSources.indexOf("authlog")>=0?"checked":"")+">User Authentication Log</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(serverTraceSources.indexOf("amt")>=0?"checked":"")+">Intel AMT manager</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(serverTraceSources.indexOf("webrelay")>=0?"checked":"")+">Forbindelsesrelæ</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(serverTraceSources.indexOf("mps")>=0?"checked":"")+">CIRA-server</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(serverTraceSources.indexOf("mpscmd")>=0?"checked":"")+">CIRA serverkommandoer</label></div>",setModalContent("xxAddAgent","Serversporing",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],n=1;n<22;n++)try{Q("p41c"+n).checked&&e.push(t[n-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e="time, source, message\r\n";for(var t in serverTrace)e+='"'+new Date(serverTrace[t].time).toLocaleTimeString()+'","'+serverTrace[t].source+'","'+serverTrace[t].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(e),"servertrace.csv"),!1}function setupServiceWorker(){8&features2&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,n,o,i,s){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=o,xxdialogButtons=n,xxdialogTag=s,QV("id_dialogclose",2&n||8&n),QV("idx_dlgDeleteButton",4&n),QV("idx_dlgButtonBar",7&n),QV("idx_dlgMoreButtons",16&n),t&&QH("xxAddAgentTitle",t);for(var a=1;a<24;a++)QV("dialog"+a,a==e);QV("dialog",e),i&&(2==e?QH("id_dialogOptions",i):QH("id_dialogMessage",i)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity();(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0!=backStack.length){var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||userinfo.otphkeys>0||userinfo.otpkeys>0||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Konto sikkerhed",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.');go(5)}"server"==t&&go(6)}else go(2)}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&e>2&&(e=2,setModalContent("xxAddAgent","Konto sikkerhed",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&!(2&userinfo.siteadmin)||4&features)&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var n=0;n<61;n++)QV("p"+n,n==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),!(268435456&features)&&xxcurrentView>0){var o="";for(var n in xxcurrentView>=10&&xxcurrentView<=19?null!=currentNode&&(o="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):xxcurrentView>=20&&xxcurrentView<=29?null!=currentMesh&&(o="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):xxcurrentView>=30&&xxcurrentView<=39?null!=currentUser&&(o="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):xxcurrentView>=51&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(o="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):xxcurrentView>1&&(o="?viewmode="+xxcurrentView),urlargs)o+=(""==o?"?":"&")+n+"="+urlargs[n];try{window.history.replaceState({},document.title,window.location.pathname+o)}catch(e){}}var i=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(var n in i)QC(i[n]).remove("fullselect"),QC(i[n]).remove("semiselect");var s=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(var n in s)QC(s[n]).remove("lbbuttonsel"),QC(s[n]).remove("lbbuttonsel2");var a=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0;goBackStack.length>0&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&e>=10&&e<20?(QC("MainMenuMyDevices").add(a),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&e>=20&&e<30?(QC("MainMenuMyAccount").add(a),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(a),QC("LeftMenuMyEvents").add(r)):4==e||e>=30&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(a),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(a),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||e>=40&&e<50)&&(QC("MainMenuMyServer").add(a),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&e>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",e>=10&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",e>=20&&e<30),QV("UserSubMenuSpan",e>=30&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e);var d={3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"};for(var n in d)QC(d[n]).remove("style3x"),QC(d[n]).remove("style3sel"),QC(d[n]).add(e==n?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&!(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&e>=10&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=[11,12].indexOf(e)>=0?"hidden":null}}else e>=10&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):e>=20&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):e>=30&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):e>=50&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(s=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(s))s[t].parentNode.removeChild(s[t]);var n={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},o={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},i=Q("p42tbl");installedPluginList.forEach(function(e){var t=[];if(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=n[e.status].text,e.statusColor=n[e.status].color,null==e.versionHistoryUrl&&t.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Kontrollerer...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]){var s=installedPluginList.version_info[e._id];s.hasUpdate?e.upgradeAvail='<a title="Vis Changelog" rel="noreferrer noopener" target="_blank" href="'+s.changelogUrl+'">'+s.version+"</a>":(t.push("upgrade"),e.status?e.upgradeAvail="Up to date":e.upgradeAvail='<a title="Vis Changelog" rel="noreferrer noopener" target="_blank" href="'+s.changelogUrl+'">'+s.version+"</a>"),s.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Version inkompatibel. Opgrader venligst din MeshCentral-installation først\" style=\"cursor: pointer; color:red;\"> ! </span> ]",t.push("install"),t.push("upgrade"))}e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>';var a=Object.entries(o[e.status]);for(var r in a)-1===t.indexOf(a[r][0])&&(e.actions+='<option value="'+a[r][0]+'">'+a[r][1]+"</option>");e.actions+="</select>";var l="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",d=i.insertRow(-1);d.innerHTML=l,d.classList.add("p42tblRow"),d.setAttribute("data-id",e._id),d.setAttribute("id","pluginRow-"+e._id)})}else{var s=Q("p42tbl").querySelectorAll(".p42tblRow");for(var t in Object.values(s))s[t].parentNode.removeChild(s[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,n=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==n&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:n}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var n=null;for(var o in installedPluginList)installedPluginList[o]._id==t&&(n=installedPluginList[o]);setModalContent("xxAddAgent","Plugin handling",format("Er du sikker på, at du vil {0} pluginnet: {1}",e.value,n.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){if(t!=userinfo._id||null==userinfo.removeRights)return e;var n=0,o=0;return 8&userinfo.removeRights&&(o+=8),65536&userinfo.removeRights&&(n+=65536),256&userinfo.removeRights&&(n+=256),512&userinfo.removeRights&&(n+=512),1024&userinfo.removeRights&&(n+=1024),16&userinfo.removeRights&&(o+=16),32768&userinfo.removeRights&&(o+=32768),131072&userinfo.removeRights&&(o+=131072),64&userinfo.removeRights&&(o+=64),262144&userinfo.removeRights&&(o+=262144),4294967295!=e?(e|=n,e&=4294967295-o):(e=2015471,e|=n,e&=4294967295-o),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var n=0,o=e.links[t];if(null!=o){if(4294967295==o.rights)return removeUserRights(4294967295,t);n=o.rights}var i=null;if(t==userinfo._id?i=userinfo:null!=users&&(i=users[t]),null!=i)for(var s in i.links)if(s.startsWith("ugrp/")&&null!=(o=e.links[s])){if(4294967295==o.rights)return removeUserRights(4294967295,t);n|=o.rights}return removeUserRights(n,t)}function IsMeshViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return!1;if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var o in n.links)if(o.startsWith("ugrp/")&&null!=e.links[o])return!0;return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var n=GetMeshRights(e.meshid,t);if(4294967295==n)return removeUserRights(n,t);if(null!=e.links&&null!=e.links[t]&&(n|=e.links[t].rights),null!=e.links&&null!=userinfo.links)for(var o in e.links)o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights&&(n|=e.links[o].rights);return removeUserRights(n,t)}function IsNodeViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return!1;if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var n in e.links)if(n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights)return!0;return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t=e.length,n=-1,o="undefined"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),i=0,s=0,a=0;a!==t;){if(i=e.charCodeAt(a),a+=1,i>=55296&&i<=56319){if(a===t){o[n+=1]=239,o[n+=1]=191,o[n+=1]=189;break}if(!((s=e.charCodeAt(a))>=56320&&s<=57343)){o[n+=1]=239,o[n+=1]=191,o[n+=1]=189;continue}if(a+=1,(i=1024*(i-55296)+s-56320+65536)>65535){o[n+=1]=240|i>>>18,o[n+=1]=128|i>>>12&63,o[n+=1]=128|i>>>6&63,o[n+=1]=128|63&i;continue}}i<=127?o[n+=1]=0|i:i<=2047?(o[n+=1]=192|i>>>6,o[n+=1]=128|63&i):(o[n+=1]=224|i>>>12,o[n+=1]=128|i>>>6&63,o[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?o.subarray(0,n+1):(o.length=n+1,o)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);return o}function joinPaths(){var e=[];for(var t in arguments){var n=arguments[t];if(null!=n&&""!=n){for(;n.endsWith("/")||n.endsWith("\\");)n=n.substring(0,n.length-1);for(;n.startsWith("/")||n.startsWith("\\");)n=n.substring(1);e.push(n)}}return e.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var n={};try{for(var o=0,i=localStorage.length;o<i;++o){var s=localStorage.key(o);"_"!=s[0]&&(n[s]=localStorage.getItem(s),"desktopsettings"!=s&&"stars"!=s&&"deskKeyShortcuts"!=s&&"deskStrings"!=s&&"cmdopt"!=s&&"string"==typeof n[s]&&n[s].length>64&&delete n[s])}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(n)})}}function stringToUtf8Blob(e){const t=(new TextEncoder).encode(e);var n=new Uint8Array(3+t.length);n[0]=239,n[1]=187,n[2]=191;for(var o=0;o<t.length;o++)n[o+3]=t[o];return new Blob([n],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){if(null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver)return 0;var t=e.intelamt.ver.split(".");return t.length<2?0:parseInt(t[0])+parseInt(t[1])/100}function getstore(e,t){try{if("undefined"==typeof localStorage)return t;var n=localStorage.getItem(e);return null==n||null==n?t:n}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,n){return n?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,n){return n?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,n){var o=document.createElement("option");o.text=t,o.value=n,Q(e).add(o)}function passwordcheck(e){return e.length>7&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr)&&(messagebox("Opkaldsfejl",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),!0)}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var n=TableStart();for(i in e)i&&e[i]&&(n+=TableEntry(i,e[i]));return n+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,n=[],o=0,i=e.options.length;o<i;o++)(t=e.options[o]).selected&&n.push(t.value);return n}function getInstance(e,t){for(var n in e)if(e[n].InstanceID==t)return e[n];return null}function getItem(e,t,n){for(var o in e)if(e[o][t]==n)return e[o];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)(e=n[o].indexOf("="))>0&&(t[n[o].substring(0,e)]=n[o].substring(e+1,n[o].length));return t}function addHtmlValue(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${n[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,n=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${n[0]||"col-md-12"}">${t}<label class="${n[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(navigator.userAgent.indexOf("Chrome/")>0||navigator.userAgent.indexOf("Firefox/")>0||navigator.userAgent.indexOf("Opera/")>0||navigator.userAgent.indexOf("Safari/")>0)}function findOne(e,t){return null!=e&&null!=t&&t.some(function(t){return e.indexOf(t)>=0})}function copyTextToClip(e){var t=document.createElement("DIV");t.textContent=e,document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function copyTextToClip2(e){var t=document.createElement("DIV");t.textContent=decodeURIComponent(e),document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return printDate(new Date)==printDate(e)?printTime(e):printDateTime(e)}function addDetailItem(e,t,n,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${o[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}function addTextLink(e,t,n){var o=t.toLowerCase().indexOf(e.toLowerCase());return-1==o?t:t.substring(0,o)+'<a href="'+n+'">'+e+"</a>"+t.substring(o+e.length)}function getOrderedList(e,t){var n=[];for(var o in e)n.push(e[o]);return n.sort(function(e,n){var o=e[t].toLowerCase(),i=n[t].toLowerCase();return o>i?1:o<i?-1:0}),n}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){var t="00"+e;return t.substr(t.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),n=t[0]+"/"+t[1]+"/"+t[2],o="";if(4==t.length&&t[3].startsWith("guest:")&&(o=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[n])return null!=users[n].realname?users[n].realname+o:users[n].name+o;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+o;if(e==userinfo._id)return userinfo.name+o;if(nodes)for(var i in nodes)if(nodes[i].links)for(var s in nodes[i].links)if(nodes[i].links[s].name&&s==e)return nodes[i].links[s].name+o;if(meshes)for(var i in meshes)if(meshes[i].links)for(var s in meshes[i].links)if(meshes[i].links[s].name&&s==e)return meshes[i].links[s].name+o;return t[2]+o}function round(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n}function safeNewWindow(e,t){var n=window.open(e,t,"noopener,noreferrer");n&&(n.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)>=0}function downloadFile(e,t,n){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("rel","noreferrer noopener"),o.setAttribute("target","fileDownloadFrame"),o.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&setDialogMode(0)}function dialogBoxDrag(){var e=Q("xxAddAgentModal"),t=0,n=0,o=0,i=0;function s(s){(s=s||window.event).preventDefault(),t=o-s.clientX,n=i-s.clientY,o=s.clientX,i=s.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function a(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,i=e.clientY,document.onmouseup=a,document.onmousemove=s}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>