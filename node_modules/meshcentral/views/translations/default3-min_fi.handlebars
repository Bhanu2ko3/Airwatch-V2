<!doctypehtml><html lang=fi dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link type=text/css href=styles/custom.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Tiedot</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Työpöytä</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Pääte</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Tiedostot</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Tapahtumat</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Tarkemmat tiedot</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Konsoli</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Verkko-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Liitännäiset</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Vaihda tähti</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Monipöytä</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Valitse kaikki</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Poista valinta</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Vaihtoehtoinen portti</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Vaihtoehtoinen portti</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Vaihtoehtoinen portti</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Vaihtoehtoinen portti</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Vaihtoehtoinen portti</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Nimeä uudelleen</div><div class=cmtext onclick=cmfilesaction(2,event)>Muokkaa</div><div class=cmtext onclick=cmfilesaction(3,event)>Poista</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Laajenna kaikki</div><div class=cmtext onclick=cmexpandaction(2,event)>Kutista kaikki</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Avaa pelaaja ...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Mukauta ...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Mukauta ...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Napsauta nähdäksesi nykyiset ilmoitukset">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Kokeile uutta meshcentral -käyttöliittymää</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Käyttöliittymän valinta"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Palkki vasemmalla käyttöliittymä"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Yläpalkki käyttöliittymä"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Kiinteä leveyksinen käyttöliittymä"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Henkilökohtaisia ​​muistiinpanoja"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Vaihda yötilaa"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Vaihda alatunnistepalkki"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Omat laitteet<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Oma Tili<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Omat Tapahtumat<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Omat Tiedostot<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Omat käyttäjät<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Oma Palvelin<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Yleinen<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Työpöytä<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Pääte<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Tiedostot<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Tapahtumat<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Tarkemmat tiedot<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Konsoli<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Liitännäiset<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Yleinen<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Yhteenveto<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Tapahtumat</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Raportit</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Yleinen<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Tapahtumat<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Käyttäjät<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Ryhmät<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Nauhoitukset<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Yleinen<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Tilastot<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Konsoli<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Jäljitä<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Liitännäiset<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Palvelinyhteys katkennut</span>,<href onclick=reload() style=cursor:pointer><u>napsauta yhdistääksesi uudelleen</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>Omat laitteet</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Go to first page"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Go to previous page"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Go to next page"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Go to last page"style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Sarakkeet><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Lista><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Työpöydät><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Työpöydät><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Kartta style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Kutista kaikki"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Laajenna kaikki"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Valitse kaikki"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value=Ryhmätoiminta onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll To Top"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Suodata onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Suodatin: user:xxx tai u:xxx ip:xxx group:xxx tai g:xxx tag:xxx tai t: xxx atag:xxx tai a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title=Laitesuodatin><option value=0 selected>Kaikki<option value=1>Online-tilassa<option value=5>Offline-tilassa<option value=2>Istuntoja<option value=3>Tähdellä merkitty<option value=4>Intel® AMT<option value=6>auta<option value=7>Merkitty<option value=8>Tunnistamaton</select><div class=form-check title="Näytä laitteiden käyttöjärjestelmän nimi"><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>OS-nimi</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Näytä vain online-tilassa olevat laitteet">Online-tilassa</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Kutista kaikki"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Laajenna kaikki"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Yhdistä kaikkiin"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Katkaise kaikki yhteydet"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll To Top"><div class="form-check me-1"title="Automaattinen yhdistäminen"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Auto</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=Asetukset> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Suodata onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Suodatin: user:xxx tai u:xxx ip:xxx group:xxx tai g:xxx tag:xxx tai t: xxx atag:xxx tai a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Etsi sijainti"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Etsi title="Etsi sijaintia"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Nollaa kartta näkymä"value=Nollaa onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Näytä <select id=viewselect onchange=onDeviceViewChange()><option value=1>Sarakkeet<option value=2>Lista<option value=3>Pöytäkoneet Kiinteä leveys<option id=viewselectmapoption value=4 style=display:none>Kartta<option value=5>Työpöydät</select></div><div style=display:none id=devListToolbarSize>Koko <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Pieni<option value=1>Keskikokoinen<option value=2>Suuri</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Lajittele <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Ryhmä<option>Virta<option>Laite<option>Tunnisteet<option>Ryhmätunnisteet<option>Viimeksi nähty</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Aloita <a href=# onclick="return account_createMesh()"><strong>luo laiteryhmä napsauttamalla tätä</strong></a>.</div><div id=getStarted2>Ei laiteryhmiä.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Sijaintitulokset</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Oma Tili</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Vaihda kuva</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Tilin turvallisuus</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Hallitse puhelinnumeroa</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Hallinnoi sähköpostitodennusta</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Hallinnoi todentajasovellusta</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Hallinnoi suojausavaimia</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Hallitse push -todennusta</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Hallinnoi varmuuskoodeja</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Näytä aiemmat kirjautumistiedot</a><br></span></div></div><div id=p2AccountActions><p><strong>Tilitoiminnot</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Hallitse puhelinnumeroa</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Vahvista sähköpostiosoite</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Ota käyttöön web-ilmoitukset</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Lokalisointiasetukset</a><br><a href=# onclick="return account_showAccountNotifySettings()">Ilmoitusasetukset</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Vaihda sähköpostiosoite</a><br></span><a href=# onclick="return account_showChangePassword()">Vaihda salasana</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Poista tili</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Luo kirjautumistunnus</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Vaihda teema</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Laiteryhmät</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Uusi</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Ei laiteryhmiä.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>Aloita täältä!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Omat Tapahtumat</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Suodata</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p3limitdropdown class=me-1>Näytä</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Viimeiset 60<option notransval=1 value=120>Viimeiset 120<option notransval=1 value=250>Viimeiset 250<option notransval=1 value=500>Viimeiset 500<option notransval=1 value=1000>Viimeiset 1000<option notransval=1 value="">Ei rajoitusta</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Lataa tapahtumat"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Omat käyttäjät</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Valitse kaikki"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Ryhmätoiminta onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Uusi tili..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Suodata onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value=Yleislähetys> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Lataa käyttäjän tiedot"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Erä luo useita käyttäjätilejä"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=Asetukset onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Omat Tiedostot</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Ylös> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Valitse kaikki"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value="Nimeä uudelleen"onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Poista onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=Muokkaa onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Uusi kansio"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value=Lähetä onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Lataa onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Leikkaa onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Kopioi onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value=Liitä onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Lajittele nimen mukaan<option value=2>Lajittele koon mukaan<option value=3>Lajittele päivämäärän mukaan<option value=4>Laskeva nimen mukaan<option value=5>Laskeva koon mukaan<option value=6>Laskeva päivämäärän mukaan</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Nämä tiedostot jaetaan julkisesti, napsauta "linkki" saadaksesi julkisen URL-osoitteen.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Oma Palvelin</h1></div><div id=p2ServerActions><p><strong>Palvelimen toiminnot</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Lataa palvelimen varmuuskopio</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Palauta palvelin varmuuskopiosta</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Google Driven varmuuskopio</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Tarkista palvelimen versio</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Näytä palvelimen virheloki</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Palvelintilastot</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Palvelimen varoitukset</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Yleistä - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Muistiinpanot<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title="Tähdellä merkitty"role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Luettelo tämän tietokoneen aktiivisista etäistunnoista."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Apua pyydetty"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Työpöytä - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Koko näyttö. Pidä vaihtonäppäintä selaimen koko näytössä."></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Uudelleenohjausportti tai KVM-ominaisuus on poistettu käytöstä<span id=p11warninga>, ota se käyttöön napsauttamalla tätä.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Remote computer is not powered on, click here to issue a power command.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>CAPS</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>SCROLL</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUM</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value="Automaattinen yhdistäminen"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Yhdistä</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Pyydä Hyväksyntää + Ilmoitus</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Pyydä Hyväksyntää</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Tietosuojapalkki</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Yhdistä RDP:n avulla"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>RDP-yhteys</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Vaihtoehtoinen portti</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Yhdistä laitteisto-KVM:llä"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Katkaise yhteys</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Irrota ja lukitse</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Katkaise yhteys</a></ul></div><span id=deskstatus style=line-height:22px>Yhteys katkaistu</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Vaihda etäkoneen virrantila"onkeypress=return!1 onkeydown=return!1 value=Virtatoiminnot... onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Virranhallintatoimintojen suorittaminen laitteessa"onkeypress=return!1 onkeydown=return!1 value=Toiminnot onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=Asetukset title="Muokkaa etätyöpöydän asetuksia"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Vaihda tarkennustila, kun aktiivinen vain hiiren ympärillä oleva alue päivitetään"onkeypress=return!1 onkeydown=return!1 value="Kohdista kaikki"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="Palvelin tallentaa tätä istuntoa"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Kierrä oikealle"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Käänny vasemmalle"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Vaihda näkymää"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>Päivitä</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Prosessit</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Palvelut</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Lajittele prosessi tunnuksen mukaan"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Lajittele nimen mukaan"onclick=sortProcess(1)>Nimi</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Lajittele tilan mukaan"onclick=sortService(0)>Tila</a> <a class=colmn2 title="Lajittele nimen mukaan"onclick=sortService(1)>Nimi</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Lähetä onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value=Leikepöytä onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Tyyppi onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Vaihda hiiren ja näppäimistön syötettä"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Syöte</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Työpöytä istunnon latenssi"></span> <span id=DeskTimer style=width:70px class=text-center title="Istunnon kesto"></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Työkalut title="Vaihda työkalujen näkymä"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Jaa laite vieraan kanssa"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="Etätulon lukitus on avattu"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="Etätulo on lukittu"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Päivitä työpöytä"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Lähetä paikallinen leikepöytä etälaitteeseen"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Lataa etäleikepöytä paikalliselle leikepöydälle"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Etätyöpöytäistunnon tallentaminen tiedostoon"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Tallenna kuvakaappaus etätyöpöydältä"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Vaihda etätyöpöydän tausta"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Avaa Web-osoite etätietokoneella"role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Lukitse etätietokone"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Näytä ilmoitus etätietokoneella"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Avaa chat-ikkuna tälle tietokoneelle"role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Run a script on this computer"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Pääte - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Koko näyttö. Pidä vaihtonäppäintä selaimen koko näytössä."></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Uudelleenohjausportti tai KVM-ominaisuus on poistettu käytöstä<span id=p12warninga>, ota se käyttöön napsauttamalla tätä.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Remote computer is not powered on, click here to issue a power command.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> Automaattinen yhdistäminen</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Yhdistä</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Järjestelmänvalvoja komentokehote</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Järjestelmänvalvojan PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Käyttäjän kuori</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>Käyttäjä PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Kysy Admin Shelliltä</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Kysy järjestelmänvalvojalta PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Kysy User Shelliltä</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Kysy käyttäjältä PowerShell</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Käyttäjän kuori</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>Käyttäjä PowerShell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Juuren kuori</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Käyttäjän kuori</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Kirjaudu sisään</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>SSH-yhteys</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Vaihtoehtoinen portti</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Yhdistä Intel® AMT -laitteiston KVM: llä"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Katkaise yhteys</button></span> <span id=termstatus style=line-height:22px>Yhteys katkaistu</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="Palvelin tallentaa tätä istuntoa"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Virranhallintatoimintojen suorittaminen laitteessa"onkeypress=return!1 onkeydown=return!1 value=Toiminnot class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value=Askelpalautin onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value=Liitä title="Tekstin liittäminen päätteeseen"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title="Istunnon kesto"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value=CR+LF title="Vaihda, mitä palautusavain lähettää"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC+[OM)"title="Vaihda F1 - F10-näppäinten emulointityyppi"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Laajennettu Ascii"title="Vaihda pääteemulointityyppi"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Lähetä title="Lähetä valittu erikoisavain"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Tiedostot - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> Automaattinen yhdistäminen</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Yhdistä</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Pyydä Hyväksyntää</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Katkaise yhteys</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Yhdistä käyttämällä MeshAgent-etätyöpöytää"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>SFTP-yhteys</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Vaihtoehtoinen portti</a></ul></div><span id=p13Status>Yhteys katkaistu</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Virranhallintatoimintojen suorittaminen laitteessa"value=Toiminnot onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="Palvelin tallentaa tätä istuntoa"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Ylös onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Valitse kaikki"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value="Nimeä uudelleen"onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Poista onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=Muokkaa onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Uusi kansio"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value=Lähetä onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Lataa onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Leikkaa onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Kopioi onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value=Liitä onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value=Postinumero onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Unzip onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=Päivitä onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=löytö onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megatavua<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Lajittele nimen mukaan<option value=2>Lajittele koon mukaan<option value=3>Lajittele päivämäärän mukaan<option value=4>Laskeva nimen mukaan<option value=5>Laskeva koon mukaan<option value=6>Laskeva päivämäärän mukaan</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Koko näyttö. Pidä vaihtonäppäintä selaimen koko näytössä."></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Tietoja tämän agentin nykyisestä ytimestä"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Agentin toiminta"onclick=p15uploadCore(event) title="Vaihda agentti Java Script -koodimoduuli"> <i onclick=p15downloadConsoleText() title="Lataa konsolin teksti"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agentti<option id=p15outputselect3 value=3>Työntää<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Tyhjennä onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Tapahtumat - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Suodata</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label class=me-1 for=p16limitdropdown>Näytä</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Viimeiset 60<option notransval=1 value=120>Viimeiset 120<option notransval=1 value=250>Viimeiset 250<option notransval=1 value=500>Viimeiset 500<option notransval=1 value=1000>Viimeiset 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Lataa tapahtumat"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Tarkemmat tiedot - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Näytä laitteen suorittimen ja muistin käyttö."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Live-graafi</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Liitännäiset - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Yleistä - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Yhteenveto - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Virta tilat</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Agenttityypit</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Liitettävyys</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Turvallisuus</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Yleistä - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Tapahtumat - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Suodata</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p31limitdropdown class=me-1>Näytä</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Viimeiset 60<option notransval=1 value=120>Viimeiset 120<option notransval=1 value=250>Viimeiset 250<option notransval=1 value=500>Viimeiset 500<option notransval=1 value=1000>Viimeiset 1000<option notransval=1 value="">Ei rajoitusta</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Lataa tapahtumat"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Palvelimeni tilastot</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Päivitä type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Loki-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Yhteyksiä<option value=1>Muisti<option value=5>Prosessori<option value=3>Saapuva liikenne<option value=4>Lähtevä liikenne</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Viimeiset 3 tuntia<option value=8>Viimeiset 8 tuntia<option value=24>Viime päivä<option value=168>Viime viikko<option value=720>Viimeiset 30 päivää</select> <i class="fa-solid fa-download"title="Lataa data pisteet (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Oma palvelimen jäljitys</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Jäljitä type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Ei mitään</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Näytä</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Viimeiset 100<option value=250>Viimeiset 250<option value=500>Viimeiset 500<option value=1000>Viimeiset 1000</select> <input value=Tyhjennä type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Lataa jäljitys (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Oma palvelin -laajennukset</h1><div class=areaHead><div class=toright2></div><div><input value="Lataa laajennus"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Päivitä agenttien ytimet"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Ilmoitus:</b> Laajennuksia on muutettu, mikä saattaa edellyttää agentin ytimen päivitystä.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Nimi<th class=chDescription>Kuvaus<th class=chSite style=text-align:center>Linkki<th class=chVersion style=text-align:center>Versio<th class=chUpgradeAvail style=text-align:center>Viimeisin<th class=chStatus style=text-align:center>Tila<th class=chAction style=text-align:center>Toiminta<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Ei palvelimen laajennuksia.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Takaisin onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Oma palvelinlaajennukset - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Omat käyttäjäryhmät</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Valitse kaikki"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Ryhmätoiminta onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Uusi ryhmä..."> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value="Monista Ryhmä..."></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Takaisin onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Käyttäjäryhmä - <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Omat käyttäjän tallenteet</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=Päivitä></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Avaa pelaaja ..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Omat raportit</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Lataa raportti"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Luo raportti...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Vahvista sähköpostiosoite</a> &nbsp;<a id=termsLinkFooter href=terms>Ehdot ja yksityisyys</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Tiedoston valinta</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Paikallinen tiedosto ladataan<option value=2>Palvelintiedoston valinta</select></div><div id=d3localmode style=display:none><div>Lataa tiedosto</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Ylös>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value="Kääri päälle"onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Pieni onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Raaka onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agentti</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Laatu</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Skaalaus</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87.5%<option value=768>75%<option value=640>62.5%<option value=512>50%<option value=384>37.5%<option value=256>25%<option value=128>12.5%</select></div><div><div>Ruudunpäivitysnopeus</div><select id=d7framelimiter dir=rtl><option selected value=50>Nopea<option value=100>Keskikokoinen<option value=400>Hidas<option value=1000>Hyvin hidas</select></div><div><div>Koodaus</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Muut asetukset</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Vaihda hiiren painikkeet</label> <label style=display:block><input type=checkbox id=d7deskrmw>Käänteinen hiiren pyörä</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Käytä kaukonäppäimistökarttaa</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Automaattinen leikepöytä</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Lukitse Katkaise yhteys</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Kuvan koodaus</div><select id=d7desktopmode><option value=1>RLE8, Nopein<option value=2>RLE16, Suositeltu<option value=3>RAW8, Hidas<option value=4>RAW16, Hyvin hidas</select></div><div><div>Muut asetukset</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Näytä tarkennustyökalu</label> <label style=display:block><input type=checkbox id=d7showcursor>Näytä paikallinen hiiren kohdistin</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Paikallinen näppäimistökartta</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Käänteinen hiiren pyörä</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Näytön koko</div><select id=d7rdpsize><option notransval=1 value=canvas>Kankaan koko<option notransval=1 value=browser>Selaimen koko<option notransval=1 value=screen>Näytön koko<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Vaihtoehdot</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Poista taustakuva käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp2>Poista koko ikkunan vetäminen käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp3>Poista valikon animaatiot käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp4>Poista Theming käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp6>Poista kohdistimen varjo käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp7>Poista kohdistimen asetukset käytöstä</label> <label style=display:block><input type=checkbox id=d7rdp8>Ota fontin tasoitus käyttöön</label> <label style=display:block><input type=checkbox id=d7rdp9>Ota työpöydän kokoonpano käyttöön</label> <label style=display:block><input type=checkbox id=d7rdpclip>Automaattinen leikepöytä</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Vaihda hiiren painikkeet</label> <label style=display:block><input type=checkbox id=d7rdprmw>Käänteinen hiiren pyörä</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Peruuta</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Poista</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Omat laitteet</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Oma Tili</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>Omat Tapahtumat</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>Omat Tiedostot</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>Omat käyttäjät</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Oma Palvelin</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Kirjaudu ulos</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>"use strict";var args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(var i in""!=webState&&(webState=JSON.parse(decodeURIComponent(webState))),null!=webState&&"object"==typeof webState||(webState={}),webState)if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Käynnissä","Nukkua","Nukkua","Nukkua","Horroksessa","Sammuta","Läsnä"],StatusStrs=["Yhteys katkaistu","Yhdistetään...","Asennus...","Yhdistetty","Intel&reg; AMT Yhdistetty"],agentsStr=["Tuntematon","Windows 32-bittinen konsoli","Windows 64-bittinen konsoli","Windows 32bit-palvelu","Windows 64bit-palvelu","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32-bittinen","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64-bittinen","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore -konsoli","Windows MinCore -palvelu","SolmuJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Tuntematon","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Assistant (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Tuntematon","Tuntematon","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service","ARMVIRT32 (OpenWRT)","RISC-V 64bit"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Omena"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=!!(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui="{{{customui}}}";customui=""!=customui?JSON.parse(decodeURIComponent(customui)):null;var deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null;null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder);var installedPluginList=null,goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(!(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}(null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodevicername,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale)||null!=(s=getstore("loctag",0))&&"*"!=s&&(args.locale=s);debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var t=0,n=parseInt("{{{hide}}}");(n||args.hide)&&(args.hide&&(t=parseInt(args.hide)),n&&(t|=n)),args.hide=t,QV("uiViewButton5",!(4&args.hide)),adjustPanels();var i="";logoutControls&&(null!=logoutControls.name&&(i='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Tervetuloa {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl&&(i+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Kirjaudu ulos</a>'))),1&args.hide?QH("logoutControlSpan2",i):QH("logoutControlSpan",i),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",!!(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",!(2097152&features)),mainUpdate(3);for(var a=1;a<5;a++)Q("devViewButton"+a).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);var o=null;try{o=localStorage.getItem("desktopsettings")}catch(e){}null!=o&&(desktopsettings=JSON.parse(o)),o=null;try{o=localStorage.getItem("multidesktopsettings")}catch(e){}null!=o&&(multidesktopsettings=JSON.parse(o)),applyDesktopSettings();for(var s="",l=1;l<27;l++)s+="<option value='"+l+"'>Ctrl-"+String.fromCharCode(64+l)+" ("+l+")</option>";QH("specialkeylist",s),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",!(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var r=document.getElementsByClassName("topbar_td");for(var d in r)r[d].innerHTML&&(r[d].innerHTML=r[d].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){s="";for(var d in customui.devicesbarbuttons){var u="one"==customui.devicesbarbuttons[d].selection||"many"==customui.devicesbarbuttons[d].selection?"disabled":"";s+='<input id="cui:'+d+'" type="button" value="'+customui.devicesbarbuttons[d].name+'" '+u+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",s)}if(customui.desktopbuttons){s="";for(var d in customui.desktopbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.desktopbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",s)}if(customui.terminalbuttons){s="";for(var d in customui.terminalbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.terminalbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",s)}if(customui.filesbuttons){s="";for(var d in customui.filesbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.filesbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",s)}}sessionTime>=10&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var c=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var d in c)""!=c[d]&&deskKeyboardShortcuts.push(parseInt(c[d]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",!(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Tyyppi"),QV("ScrollToTopButton",!!(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){var n=e.srcElement.id;if(0!=n.startsWith("cui:")){var i=customui[t][n.substring(4)];if(null!=i){if("devicesbarbuttons"==t){for(var a=document.getElementsByClassName("DeviceCheckbox"),o=[],s=0;s<a.length;s++)!0===a[s].checked&&o.push(a[s].defaultValue.substring(6));if("string"==typeof i.action&&("event"==i.action&&meshserver.send({action:"uicustomevent",section:t,element:n.substring(4),selectedDevices:o,logmsg:i.logmsg}),i.action.startsWith("dialog:")&&showCustomUiDialog(i.action.substring(7),{section:t,element:n.substring(4),selectedDevices:o}),i.deselectdevices)){for(s=0;s<a.length;s++)a[s].checked=!1;checkedNodeids={},p1updateInfo()}}if("devicebuttons"==t||"desktopbuttons"==t||"terminalbuttons"==t||"filesbuttons"==t){o=[currentNode._id];"string"==typeof i.action&&("event"==i.action&&meshserver.send({action:"uicustomevent",section:t,element:n.substring(4),selectedDevices:o,logmsg:i.logmsg}),i.action.startsWith("dialog:")&&showCustomUiDialog(i.action.substring(7),{section:t,element:n.substring(4),selectedDevices:o}))}}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var n="",i=customui.dialogs[e];if("string"==typeof i.text&&(n+="<div style=margin-bottom:8px>"+i.text+"</div>"),"number"==typeof i.buttons&&i.buttons,"object"==typeof i.elements)for(var a in i.elements){var o=i.elements[a];if("text"==o.type&&(n+=addHtmlFormFloating(o.name,"<input id=cui:"+a+" class=form-control autocomplete=off />")),"textarea"==o.type&&(null==o.name?n+="<textarea id=cui:"+a+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":n+=addHtmlFormFloating(o.name,"<textarea id=cui:"+a+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==o.type){var s="";for(var l in o.options)s+='<option value="'+l+'">'+EscapeHtml(o.options[l])+"</option>";n+=addHtmlFormFloating(o.name,'<select id="cui:'+a+'" class=form-select autocomplete=off />'+s+"</select>")}}setModalContent("xxAddAgent",i.title,n),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:i.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var n=customui.dialogs[t.element];if("object"==typeof n.elements)for(var i in n.elements){var a=n.elements[i];"droplist"!=a.type&&"textarea"!=a.type&&"text"!=a.type||(t.values[i]=Q("cui:"+i).value)}if(meshserver.send(t),n.deselectdevices){var o=document.getElementsByClassName("DeviceCheckbox");for(i=0;i<o.length;i++)o[i].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide;0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px"));var t=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),n=uiMode>1?24:0;QS("p2info").height="calc(100vh - "+(20+t+n)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p3events").height="calc(100vh - "+(50+t)+"px)",QS("p5filetable").height="calc(100vh - "+(99+t)+"px)",QS("p13filetable").height="calc(100vh - "+(127+t+n)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+t+n)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+t+n)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+t+n)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+t+n)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+t+n)+"px)";var i=!(0===args.xterm||null!=terminal&&null==xterm);fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,i&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+t+n)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+t+n)+"px)",QS("p14iframe").height="calc(100vh - "+(23+t+n)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+t+n)+"px)",i&&(QS("termarea3x").height="calc(100vh - "+(74+t+n)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+t+n)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+t)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+t)+"px)",QS("p6info").height="calc(100vh - "+(-50+t+n)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(-50+t+n)+"px)",QS("p10info").height="calc(100vh - "+(20+t+n)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p17info").height="calc(100vh - "+(20+t+n)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p20main").height="calc(100vh - "+(-50+t+n)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(-50+t+n)+"px)",QS("p21main").height="calc(100vh - "+(20+t+n)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p30info").height="calc(100vh - "+(20+t+n)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p51info").height="calc(100vh - "+(20+t+n)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+t+n)+"px)",QS("p16events").height="calc(100vh - "+(50+t+n)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("p31events").height="calc(100vh - "+(50+t+n)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+t+n)+"px)",QS("p41events").height="calc(100vh - "+(48+t+n)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+t+n)+"px)",QS("p52recordings").height="calc(100vh - "+(48+t+n)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+t+n)+"px)",QS("p60report").height="calc(100vh - "+(48+t+n)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+t+n)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),xxcurrentView>=10&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=uiMode>1,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&xxcurrentView>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){if(!xxdialogMode){var e=getstore("nightMode","0"),t="<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Selaimen oletus</label><br>";t+="<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Valotila</label><br>",xxdialogButtons=3,setModalContent("xxAddAgent","Yötila",t+="<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Tumma tila</label><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1)}}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),Q("night2").checked&&(e="2"),putstore("nightMode",e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,1048576&features2&&(e="1"),2097152&features2&&(e="2"),"1"==e?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){const t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),xxcurrentView>=10&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),xxcurrentView>=10&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;if(Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e){putstore("uiViewMode",e);var t=new URL(window.location.href);t.searchParams.has("sitestyle")&&(t.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,t.toString())),reload()}}function toggleBootstrapUIMode(){if(!xxdialogMode){var e=getstore("uiViewMode",3),t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==e?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>";setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1)}}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;e.endsWith("/#")&&(e=e.substring(0,e.length-2)),e.endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,n,i){if(0==t){if(setDialogMode(0),go(0),powerTimeline=null,powerTimelineReq=null,powerTimelineNode=null,powerTimelineUpdate=null,deviceShares=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==i)return void QH("p0span","Todennusta ei voida suorittaa");if("invalidorigin"==i)return void QH("p0span","Invalid origin in HTTP request");2==n?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Verkkopistoketta ei voida yhdistää"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null)}else 2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView&&refreshServerTimelineStats())}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return e.indexOf("WINDOWS")>=0||e.indexOf("WIN32")>=0||e.indexOf("WIN64")>=0}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,n=4294967295!=t&&!!(1024&t)||!!(256&features2);QV("p2AccountSecurity",!(4&features||0!=serverinfo.domainauth||!(4096&features)||0!=n)),QV("p2AccountActions",!n),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",!(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!n),QV("p2ServerActions",21&t&&!!(143&e)),QV("LeftMenuMyServer",21&t&&!!(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&!!(1&e)),QV("p2ServerActionsRestore",4&t&&!!(2&e)),QV("p2ServerActionsVersion",16&t&&!!(4&e)),QV("p2ServerActionsErrors",16&t&&!!(8&e)),QV("p2ServerActionsConfig",16&t&&!!(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),8&t||5!=xxcurrentView||(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",2&userinfo.siteadmin?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(users=null,wssessions=null,mainUpdate(16384),(4==xxcurrentView||xxcurrentView>=30&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&!!(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&!!(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6!=xxcurrentView||21&userinfo.siteadmin||go(1),21&t&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){webpSupport=t,t||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView&&p21updateMesh()),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){if(null==userinfo)return-1;var e=0;return 1==userinfo.otpsecret&&e++,1==userinfo.otpduo&&e++,1==userinfo.otpdev&&e++,userinfo.otphkeys>0&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,e>0&&userinfo.otpkeys>0&&!(262144&features2)&&e++,e}var backupCodesWarningDone=!1;function updateSelf(){var e=count2factoraAuths(),t=4294967295!=userinfo.siteadmin&&!!(1024&userinfo.siteadmin);QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==t),QV("manageOtp",1!=serverinfo.lock2factor&&e>0&&!(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&!!(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",!(1==serverinfo.lock2factor||1!=userinfo.otpsecret&&131072&features2)),QV("manageDuoApp",1!=serverinfo.lock2factor&&!!(536870912&features2)),QV("authKeySetupCheck",userinfo.otphkeys>0),QV("authPushAuthDevCheck",userinfo.otpdev>0&&!!(64&features2)),QV("authCodesSetupCheck",userinfo.otpkeys>0),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&e>0),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0!=backupCodesWarningDone||1!=e||524288&features2||(addNotification({text:"Lisää kahden tekijän varmuuskoodit. Jos nykyinen tekijä menetetään, tätä tiliä ei voida palauttaa.",title:"Kaksivaiheinen todennus",tag:"backupcodes"}),backupCodesWarningDone=!0);var n=4294967295==userinfo.siteadmin||!(64&userinfo.siteadmin);if(QV("p2createMeshLink1",n),QV("p2createMeshLink2",n),QV("getStarted1",n),QV("getStarted2",!n),"number"==typeof userinfo.passchange)if(-1==userinfo.passchange)QH("p2nextPasswordUpdateTime"," - Nollaa seuraavan kirjautumisen yhteydessä.");else if(null!=passRequirements&&"number"==typeof passRequirements.reset){var i=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3);if(i<0)QH("p2nextPasswordUpdateTime"," - Nollaa seuraavan kirjautumisen yhteydessä.");else if(i<3600){var a=Math.floor(i/60);QH("p2nextPasswordUpdateTime",format(1==a?" - Nollaa 1 minuutissa.":" - Nollaa {0} minuutissa.",a))}else if(i<86400){var o=Math.floor(i/3600);QH("p2nextPasswordUpdateTime",format(1==o?" - Nollaa 1 tunnissa.":" - Nollaa {0} tunnissa.",o))}else{var s=Math.floor(i/86400);QH("p2nextPasswordUpdateTime",format(1==o?" - Nollaa 1 päivässä.":" - Nollaa {0} päivässä.",s))}}QV("MainMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("LeftMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("UsersGeneral",null!=users&&!(4&features)),QV("UsersGroups",null!=users&&!(4&features)),QV("UsersRecordings",!!(512&userinfo.siteadmin)&&!!(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;if(e>serverinfo.timeout)null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutonidlesessiontimeout&&(window.location.href="logout");else{var t=Math.round((serverinfo.timeout-e)/1e3),n=null!=desktop||null!=terminal||null!=files,i=serverinfo.logoutonidlesessiontimeout||n,a=serverinfo.logoutonidlesessiontimeout,o="";t<=60?o=a?1==t?"1 sekunti sisäänkirjautumiseen":"{0} sekuntia sisäänkirjautumiseen asti":1==t?"1 sekuntti yhteyden katkaisuun":"{0} sekuntia yhteyden katkaisuun":(t=Math.round(t/60))<=5&&(o=a?1==t?"1 minuutti sisäänkirjautuminen":"{0} minuutti sisäänkirjautumiseen":1==t?"1 minuutti yhteyden katkaisuun":"{0} minuuttia, yhteyden sulkemiseen"),QH("idleTimeoutNotify",i&&o?"<br />"+format(o,t):"")}}function onMessage(e,t){switch(t.action){case"trace":serverTrace.unshift(t),displayServerTrace();break;case"intersession":"removeNotify"==t.subaction&&notificationDelete(t.id);break;case"traceinfo":"object"==typeof t.traceSources&&(null!=t.traceSources&&t.traceSources.length>0?(serverTraceSources=t.traceSources,QH("p41traceStatus",EscapeHtml(t.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ei mitään")));break;case"serverstats":updateGeneralServerStats(t);break;case"serverwarnings":if(null!=t.warnings&&t.warnings.length>0){var n={1:"",2:"Puuttuvat WebDAV-parametrit.",3:'Tuntematon määritysvaihtoehto "{0}".',4:"WebSocket-pakkaus on poistettu käytöstä, tämä ominaisuus on rikki NodeJS v11.11 - v12.15 ja v13.2",5:"Intel AMT TLS -juurivarmennetta ei voi ladata oletustoimialueelle.",6:"Ei voida ladata Intel AMT TLS -juurivarmennetta verkkotunnukselle {0}.",7:"CIRA:n paikalliset FQDN:t ohitetaan, kun palvelin on vain LAN- tai WAN-tilassa.",8:"CIRA:n paikallista FQDN:ää voi olla enintään 4. Arvon huomioiminen.",9:"Agentin hajautustarkistus ohitetaan, tämä ei ole turvallista.",10:"Let's Encrypt -sähköpostiosoite puuttuu.",11:"Virheelliset Let's Encrypt -isäntänimet.",12:"Virheelliset Let's Encrypt -nimet, ei voi sisältää *-merkkiä.",13:"Let's Encrypt -moduulia ei voi asentaa.",14:"Virheelliset Let's Encrypt -nimet, ei voi ratkaista: {0}",15:"Virheellinen Let's Encrypt -sähköpostiosoite, ei voida ratkaista: {0}",16:"CloudFlaren luotettujen välityspalvelinten IPv6-osoiteluetteloa ei voi ladata.",17:"SendGrid-palvelimen käyttö on rajoitettua LAN-tilassa.",18:"SMTP-palvelimen käyttö on rajoitettua LAN-tilassa.",19:"SMS-yhdyskäytävän käyttö on rajoitettua LAN-tilassa.",20:'Virheellinen "LoginCookieEncryptionKey" tiedostossa config.json.',21:"Varmuuskopiointipolkua ei voi määrittää meshcentral-data-kansiossa, varmuuskopiointiasetuksia ei huomioida.",22:"Agentin {0} allekirjoittaminen epäonnistui: {1}",23:"Unable to load agent icon file: {0}.",24:"Unable to load agent logo file: {0}.",25:"This NodeJS version does not support OpenID.",26:"This NodeJS version does not support Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},i="";for(var a in t.warnings){if("string"==typeof(s=t.warnings[a]))i+="<div style=color:red;padding-bottom:6px><b>VAROITUS: "+s+"</b></div>";else null==(r=n[s.id])?r=s.msg:null!=s.args&&(r=format(r,...s.args)),i+="<div style=color:red;padding-bottom:6px><b>VAROITUS: "+r+"</b></div>"}QH("serverWarnings",i),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(t.events);break;case"authcookie":authCookie=t.cookie,authRelayCookie=t.rcookie;break;case"serverinfo":if((serverinfo=t.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire){var o=Math.floor((serverinfo.certExpire-Date.now())/864e5);o>=0&&o<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>VAROITUS: "+format("Varmenne vanhenee {0} päivän kuluttua",o)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("Varmenne vanhenee {0} päivän kuluttua",o)}))}if(serverinfo.preConfiguredRemoteInput){i="";for(var a in serverinfo.preConfiguredRemoteInput)i+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+a+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[a].name)+"</div>";""!=i&&(i+="<hr />"),QH("deskPreConfigShortcutContextMenu1",i)}if(serverinfo.preConfiguredScripts){i="";var s="";for(var a in serverinfo.preConfiguredScripts){var l=serverinfo.preConfiguredScripts[a],r='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+a+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[a].name)+"</div>";3!=l.type&&(i+=r),l.type>=3&&(s+=r)}QH("deskPreConfigScriptContextMenu1",i),QH("deskPreConfigScriptContextMenu2",s)}break;case"userinfo":userinfo=t.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var d in users={},t.users)users[t.users[d]._id]=t.users[d];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=t.wssessions,mainUpdate(16384);break;case"meshes":for(var d in meshes={},t.meshes)meshes[t.meshes[d]._id]=t.meshes[d];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var u=0;if(Array.isArray(t.ugroups)){for(var a in usergroups={},t.ugroups)u++,usergroups[t.ugroups[a]._id]=t.ugroups[a];0==u&&(usergroups=null)}else{for(var a in usergroups=t.ugroups,t.ugroups)u++,t.ugroups[a]._id=a;0==u&&(usergroups=null)}mainUpdate(8192);break;case"files":filetree=setupBackPointers(t.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var d in nodes=[],t.nodes)for(var c in t.nodes[d])null!=t.nodes[d][c]._id?(null==t.nodes[d][c].name&&(t.nodes[d][c].name="???"),t.nodes[d][c].namel=t.nodes[d][c].name.toLowerCase(),t.nodes[d][c].rname?t.nodes[d][c].rnamel=t.nodes[d][c].rname.toLowerCase():t.nodes[d][c].rnamel=t.nodes[d][c].namel,t.nodes[d][c].meshnamel=meshes[d]?meshes[d].name.toLowerCase():"*",t.nodes[d][c].meshid=d,t.nodes[d][c].state=t.nodes[d][c].state?t.nodes[d][c].state:0,t.nodes[d][c].icon||(t.nodes[d][c].icon=1),t.nodes[d][c].ident=++nodeShortIdent,nodes.push(t.nodes[d][c])):console.log("Invalid node ("+c+"): "+JSON.stringify(t.nodes));for(var a in stars)null==getNodeFromId(a)&&delete stars[a];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==t.totalcount?null:{total:t.totalcount,skip:t.skip,limit:t.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(t.nodeid!=powerTimelineReq)break;for(var a in powerTimelineNode=t.nodeid,powerTimeline=t.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)a%2==1&&(powerTimeline[a]=1e3*powerTimeline[a]);currentNode._id==t.nodeid&&mainUpdate(256);break;case"deviceShares":if(t.nodeid!=deviceSharesReq)break;deviceSharesNode=t.nodeid,deviceShares=t.deviceShares,null!=currentNode&&currentNode._id==t.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":if(t.meshid!=deviceSharesReq)break;deviceSharesNode=t.meshid,deviceShares=t.deviceShares,null!=currentMesh&&currentMesh._id==t.meshid&&p20updateMesh();break;case"getsysinfo":if(t.nodeid!=powerTimelineReq)break;!0===t.noinfo?updateDeviceDetails(getNodeFromId(t.nodeid)):updateDeviceDetails(getNodeFromId(t.nodeid),t.hardware);break;case"lastconnect":null!=(ae=getNodeFromId(t.nodeid))&&(ae.lastconnect=t.time,ae.lastaddr=t.addr,currentNode._id==ae._id&&""==Q("MainComputerState").innerHTML&&null!=ae.lastconnect&&QH("MainComputerState","<span>Viimeksi nähty:<br />"+printDateTime(new Date(ae.lastconnect))+"</span>"));break;case"lastconnects":var p=Object.keys(t.lastconnects);for(var a in p){var m=p[a];null!=(ae=getNodeFromId(m))&&(ae.lastconnect=t.lastconnects[m])}mainUpdate(4);case"msg":if(null!=t.nodeid){var g=-1;if(null!=nodes)for(var a in nodes)if(nodes[a]._id==t.nodeid){g=a;break}if(-1!=g)if("cpuinfo"===t.type&&null!=currentNode&&currentNode._id==t.nodeid){var v=Date.now()/1e3,h=0,f=0;"number"==typeof t.cpu.total&&(h=t.cpu.total),"number"==typeof t.memory.percentConsumed&&(f=t.memory.percentConsumed),deviceDetailsStatsData.push([v,h,f]),deviceDetailsStatsDraw(t)}else if("console"===t.type)p15consoleReceive(nodes[g],t.value,t.source);else if("notify"===t.type){if(!(8&(c=getstore("notifications",0)))&&null!=t.amtMessage)break;c={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(c.id=t.id),null!=t.nodeid&&(c.nodeid=t.nodeid),null!=t.tag&&(c.tag=t.tag),null!=t.url&&(c.url=t.url),null!=t.username&&(c.username=t.username),"number"==typeof t.maxtime&&(c.maxtime=t.maxtime),addNotification(c)}else if("ps"===t.type)showDeskToolsProcesses(t);else if("services"===t.type)showDeskToolsServices(t);else if("service"===t.type)showServiceDetailsDialog(t);else if("getclip"===t.type&&null!=currentNode&&currentNode._id==t.nodeid)1==t.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=t.data:2===t.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(t.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===t.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==t.nodeid)QH("dlgClipStatus",t.success?"<span style=color:green>Onnistui</span>":"<span style=color:red>Epäonnistui</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===t.type&&null!=currentNode&&currentNode._id===t.nodeid&&null==desktop){var k=[];if(null!=t.data)for(var a in t.data)"Active"!=t.data[a].State&&"Connected"!=t.data[a].State&&"Console"!=t.data[a].StationName&&3!=debugmode||k.push(t.data[a]);if(0===k.length)connectDesktop(null,1,null,t.tag);else if(1===k.length)connectDesktop(null,1,k[0].SessionId,t.tag);else{i="";var x="{{{userSessionsSort}}}";for(var a in k.sort(function(e,t){return e[x]?t[x]?e[x]<t[x]?-1:e[x]>t[x]?1:0:1:-1}),k)i+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+k[a].SessionId+","+t.tag+")>"+k[a].State+(k[a].StationName?", "+k[a].StationName:""),k[a].Username&&(k[a].Domain?i+=" - "+k[a].Domain+"/"+k[a].Username:i+=" - "+k[a].Username),i+="</div>";QH("p11DeskSessionSelector",i),QV("p11DeskSessionSelector",!0)}}else if("psinfo"===t.type){if(xxdialogTag==="ps|"+t.nodeid+"|"+t.pid){i="<div style=max-height:200px;overflow-y:auto>";"object"==typeof t.value&&Object.keys(t.value).length>0?(t.value=jsonToCamel(t.value),!t.value.cmd&&t.value.path&&(t.value.cmd=t.value.path),!t.value.processUser&&t.value.userName&&(t.value.processUser=t.value.userName.split("\\")[1]),!t.value.processDomain&&t.value.userName&&(t.value.processDomain=t.value.userName.split("\\")[0]),t.value.processName&&(i+="<div style=padding:4px><div style=padding-bottom:4px>Prosessin nimi</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.processName+"</b></div></div>"),t.value.machineName&&(i+=addHtmlValue5("Koneen nimi",t.value.machineName)),t.value.cmd&&(i+="<div style=padding:4px><div style=padding-bottom:4px>Komentorivi</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.cmd+"</b></div></div>"),t.value.mainWindowTitle&&(i+="<div style=padding:4px><div style=padding-bottom:4px>Ikkunan otsikko</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.mainWindowTitle+"</b></div></div>"),t.value.processUser&&(i+=addHtmlValue5("Käyttäjä",t.value.processUser)),t.value.processDomain&&(i+=addHtmlValue5("Verkkotunnus",t.value.processDomain)),t.value.startTime&&(i+=addHtmlValue5("Käynnistys aika",t.value.startTime)),i+="<hr />",t.value.PriorityBoostEnabled&&(i+=addHtmlValue5("Priority Boost",t.value.PriorityBoostEnabled?"Käytössä":"Poistettu käytöstä")),t.value.sessionId&&(i+=addHtmlValue5("Istunnon tunniste",t.value.sessionId)),t.value.handleCount&&(i+=addHtmlValue5("Käsittele laskua",t.value.handleCount)),t.value.privilegedProcessorTime&&(i+=addHtmlValue5("Privileged -prosessorin aika",format("{0} sekuntia",t.value.privilegedProcessorTime))),t.value.totalProcessorTime&&(i+=addHtmlValue5("Prosessorin kokonaisaika",format("{0} sekuntia",t.value.totalProcessorTime))),t.value.userProcessorTime&&(i+=addHtmlValue5("Käyttäjän prosessorin aika",format("{0} sekuntia",t.value.userProcessorTime))),t.value.nonpagedSystemMemorySize&&(i+=addHtmlValue5("Sivuton muisti",getNiceSize2(t.value.nonpagedSystemMemorySize))),t.value.pagedMemorySize&&(i+=addHtmlValue5("Sivumuisti",getNiceSize2(t.value.pagedMemorySize))),t.value.privateMemorySize&&(i+=addHtmlValue5("Yksityinen muisti",getNiceSize2(t.value.privateMemorySize))),t.value.virtualMemorySize&&(i+=addHtmlValue5("Virtuaalimuisti",getNiceSize2(t.value.virtualMemorySize))),t.value.workingSet&&(i+=addHtmlValue5("Toimiva sarja",getNiceSize2(t.value.workingSet))),t.value.peakWorkingSet&&(i+=addHtmlValue5("Peak Working Set",getNiceSize2(t.value.peakWorkingSet))),t.value.peakPagedMemorySize&&(i+=addHtmlValue5("Peak Paged -muisti",getNiceSize2(t.value.peakPagedMemorySize))),t.value.peakVirtualMemorySize&&(i+=addHtmlValue5("Huippu virtuaalimuisti",getNiceSize2(t.value.peakVirtualMemorySize)))):i+="Ei tietoja",i+="</div>",QH("id_dialogOptions",i)}}else"deskBackground"===t.type&&(""!=t.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else if("notify"===t.type){c={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(c.id=t.id),null!=t.tag&&(c.tag=t.tag),null!=t.url&&(c.url=t.url),null!=t.username&&(c.username=t.username),"number"==typeof t.maxtime&&(c.maxtime=t.maxtime),addNotification(c)}break;case"getnetworkinfo":if(currentNode._id!=t.nodeid)return;if(updateDeviceDetails(getNodeFromId(t.nodeid),null,t),2==xxdialogMode&&xxdialogTag=="if"+t.nodeid){i="<div class=dialogText>";if(currentNode.lastconnect&&(i+=addHtmlValue2("Agentin edellinen yhteys",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr){var y=currentNode.lastaddr.split(":");y.length>2?i+=addHtmlValue2("Agentin edellinen osoite",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?i+=addHtmlValue2("Agentin edellinen osoite",y[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(y[0])+'")></i>'):i+=addHtmlValue2("Agentin edellinen osoite",'<a href="https://iplocation.com/?ip='+y[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+y[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(y[0])+'")></i>')}if(null!=t.updateTime&&(i+=addHtmlValue2("Viimeisin liittymien päivitys",printDateTime(new Date(t.updateTime)))),null!=t.netif)for(var a in t.netif){i+="<hr />",(b=t.netif[a]).name&&(i+=addHtmlValue2("Nimi","<b>"+EscapeHtml(b.name)+"</b>")),b.desc&&(i+=addHtmlValue2("Kuvaus",EscapeHtml(b.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),b.dnssuffix&&(i+=addHtmlValue2("DNS-liite",EscapeHtml(b.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi nimi leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.dnssuffix)+'")></i>')),b.mac&&(i+=addHtmlValue2("MAC osoite",'<a href="https://maclookup.app/search/result?mac='+b.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(b.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi MAC osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.mac.toLowerCase())+'")></i>')),b.v4addr&&(i+=addHtmlValue2("IPv4 osoite",EscapeHtml(b.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.v4addr)+'")></i>')),b.v4mask&&(i+=addHtmlValue2("IPv4 peite",EscapeHtml(b.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.v4mask)+'")></i>')),b.v4gateway&&(i+=addHtmlValue2("IPv4 yhdyskäytävä",EscapeHtml(b.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.v4gateway)+'")></i>')),b.gatewaymac&&(i+=addHtmlValue2("Yhdyskäytävän MAC osoite",'<a href="https://maclookup.app/search/result?mac='+b.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(b.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi MAC osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b.gatewaymac.toLowerCase())+'")></i>'))}else if(null!=t.netif2)for(var a in t.netif2){var b=t.netif2[a];if(!(0==Array.isArray(b)||b.length<1||null==b[0]||"string"==typeof b[0].mac&&b[0].mac.startsWith("00:00:00:00"))){i+="<hr />",i+=addHtmlValue2("Nimi","<b>"+EscapeHtml(a)+"</b>"),"string"==typeof b[0].mac&&(i+=addHtmlValue2("MAC osoite",'<a href="https://maclookup.app/search/result?mac='+b[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(b[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi MAC osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(b[0].mac.toLowerCase())+'")></i>')),b[0].fqdn&&(i+=addHtmlValue2("FQDN",b[0].fqdn));for(var w=0;w<b.length;w++){var M=b[w];"IPv6"==M.family?(M.address&&(i+=addHtmlValue2("IPv6 osoite",EscapeHtml(M.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.address)+'")></i>')),M.netmask&&(i+=addHtmlValue2("IPv6 peite",EscapeHtml(M.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.netmask)+'")></i>')),M.gateway&&(i+=addHtmlValue2("IPv6 yhdyskäytävä",EscapeHtml(M.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.gateway)+'")></i>'))):"IPv4"==M.family&&(M.address&&(i+=addHtmlValue2("IPv4 osoite",EscapeHtml(M.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.address)+'")></i>')),M.netmask&&(i+=addHtmlValue2("IPv4 peite",EscapeHtml(M.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.netmask)+'")></i>')),M.gateway&&(i+=addHtmlValue2("IPv4 yhdyskäytävä",EscapeHtml(M.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopioi osoite leikepöydälle" onclick=copyTextToClip2("'+encodeURIComponentEx(M.gateway)+'")></i>')))}}}else i+="<hr />",i+="Tälle laitteelle ei ole käytettävissä verkkoliittymien tietoja.";i+="</div>",QH("d2netinfo",i)}break;case"serverversion":if(2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag){i="<div class=dialogText>";t.tags.current||(t.tags.current="Tuntematon"),t.tags.stable||(t.tags.stable="Tuntematon"),t.tags.latest||(t.tags.latest="Tuntematon"),i+=addHtmlValue2("Nykyinen versio","<b>"+EscapeHtml(t.tags.current)+"</b>"),i+="<hr />",i+=addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Tuntematon"!=t.tags.stable&&t.tags.current!=t.tags.stable&&2048&features?"":" disabled")+" /> Vakaa versio</label>","<b>"+EscapeHtml(t.tags.stable)+"</b>"),i+=addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Tuntematon"!=t.tags.latest&&t.tags.current!=t.tags.latest&&2048&features?"":" disabled")+" /> Viimeisin versio</label>","<b>"+EscapeHtml(t.tags.latest)+"</b>"),i+="</div>",(t.tags.current!=t.tags.latest||t.tags.current!=t.tags.stable)&&2048&features?(i+="<hr />Valitse ja napsauta OK aloittaaksesi palvelimen itsepäivityksen.",xxdialogTag=t.tags,setModalContent("xxAddAgent","MeshCentral Versio",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,t.tags)}),server_showVersionDlgUpdate()):(setModalContent("xxAddAgent","MeshCentral Versio",i),showModal("xxAddAgentModal","idx_dlgOkButton"))}break;case"servererrors":if(2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag)if(null==t.data)setModalContent("xxAddAgent","Server Errors","Palvelimella ei ole virhelokia."),showModal("xxAddAgentModal","idx_dlgOkButton");else{i='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(t.data)+"</pre></div>";i+='<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Lataa virhe loki" onclick=d2CopyServerErrorsToClip()></i></div>',setModalContent("xxAddAgent","MeshCentral-palvelinvirheet",i+='<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Valitse ja napsauta OK tyhjentääksesi virhelokin.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()}break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==t.data?setModalContent("xxAddAgent","Server Configuration","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuration",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=t.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",t.value);break;case"events":null!=t.nodeid&&null!=currentNode&&t.nodeid==currentNode._id?(currentDeviceEvents=t.events,mainUpdate(1024)):null!=t.userid&&null!=currentUser&&t.userid==currentUser._id?(currentUserEvents=t.events,mainUpdate(2048)):(events=t.events,mainUpdate(32));break;case"recordings":p52recordings=t.events,null!=t.error&&(p52recordings=t.error),updateRecordings();break;case"getcookie":if("MCRouter"==t.tag){(-1==(ce=serverinfo.name).indexOf(".")||2&features)&&(ce=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var S="mcrouter://"+ce+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:"");null!=t.nodeid&&(S+="&nodeid="+t.nodeid),null!=t.tcpport&&(S+="&protocol=1&remoteport="+t.tcpport),t.localRelay&&(S+="&local=1"),t.localport&&(S+="&localport="+t.localport),null!=t.name&&(S+="&name="+encodeURIComponentEx(t.name)),null!=t.ip&&(S+="&remoteip="+t.ip),downloadFile(S+="&appid="+t.protocol+"&autoexit=1","")}else if("novnc"==t.tag){var C=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(t.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+t.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}";null!=(ae=getNodeFromId(t.nodeid))&&(C+="&name="+encodeURIComponentEx(ae.name)),safeNewWindow(C,"mcnovnc/"+t.nodeid)}else if("mstsc"==t.tag){var A=window.location.origin+domainUrl+"mstsc.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ae=getNodeFromId(t.nodeid))&&(A+="&name="+encodeURIComponentEx(ae.name)),t.localRelay&&(A+="&local=1"),safeNewWindow(A,"mcmstsc/"+t.nodeid)}else if("ssh"==t.tag){var T=window.location.origin+domainUrl+"ssh.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ae=getNodeFromId(t.nodeid))&&(T+="&name="+encodeURIComponentEx(ae.name)),t.localRelay&&(T+="&local=1"),safeNewWindow(T,"mcssh/"+t.nodeid)}break;case"getNotes":if((c=Q("d2devNotes"))&&t.id==decodeURIComponent(c.attributes.noteid.value))t.notes?QH("d2devNotes",decodeURIComponent(t.notes)):QH("d2devNotes",""),0==("true"==c.attributes.ro.value)&&(c.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"));else Q("notesPanelArea").innerHTML=t.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(t.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&t.notes?QV("notesPanel",!0):QV("notesPanel",!1);break;case"otpauth-request":if(2==xxdialogMode&&"otpauth-request"==xxdialogTag)if(null!=t.err){var D=["","2FA on lukittu","Varakoodit on lukittu","Kirjautumistunnus käytössä","OTP 2FA ei sallittu","Tili on lukittu","OTPLIB:n lataaminen epäonnistui"];t.err>0&&t.err<D.length?QH("d2optinfo",D[t.err]):QH("d2optinfo",format("Virhe #{0}",t.err))}else{var E=t.secret;52==E.length?E=E.split(/(.............)/).filter(Boolean).join(" "):32==E.length&&(E=(E=E.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+E.substring(20)),QH("d2optinfo","<table><tr><td style=vertical-align:top>"+format('Asenna <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> tai yhteensopiva sovellus ja skannaa viivakoodi, käytä <a href="{0}" rel="noreferrer noopener" target=_blank>tätä linkkiä</a> tai kirjoita salainen avain. Anna sitten alla oleva nykyinen 6-numeroinen tunnus aktivoidaksesi kaksivaiheisen kirjautumisen.',t.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+t.secret+'" style=font-size:12px>'+E+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+t.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Kirjoita kaksivaiheisen kirjautumisen tunnus tähän: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:t.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()}break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","Todennussovellus",t.success?"<b style=color:green>Todennussovelluksen aktivointi onnistui.</b> Tarvitset nyt kelvollisen tunnuksen kirjautumiseen uudelleen.":"<b style=color:red>Kaksivaiheisen kirjautumisen aktivointi epäonnistui.</b> Poista salainen avain sovelluksesta ja yritä uudelleen. Sinulla on vain muutama minuutti oikean koodin syöttämiseen."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","Todennussovellus",t.success?"<b>Todennussovellus poistettu.</b> Voit aktivoida tämän ominaisuuden uudelleen milloin tahansa.":"<b style=color:red>Kaksivaiheisen sisäänkirjautumisen aktivoinnin poisto epäonnistui.</b> Yritä uudelleen."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(2==xxdialogMode&&"otpauth-manage"!=xxdialogTag)return;i="Yhden kerran vahvistus koodeja voidaan käyttää toissijaisena todennuksena. Luo sarja, tulosta ne ja säilytä niitä turvallisessa paikassa.";if(i+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',t.passwords){w=0;var N="";for(var a in t.passwords){++w%2&&(i+="<tr>");for(var I=""+t.passwords[a].p;I.length<8;)I="0"+I;!0===t.passwords[a].u?(i+="<td>"+I.substring(0,4)+"&nbsp;"+I.substring(4),""!=N&&(N+=" "),N+=I):i+="<td><strike style=color:#BBB>"+I.substring(0,4)+"&nbsp;"+I.substring(4)}}else i+="<tr><td>Ei aktiivisia tunnuksia";i+="</table></div></div><br />",i+='<div class="btn-group">',i+='<button type=button class="btn btn-warning" onclick="account_manageOtp(1);">Luo uusia tunnuksia</input>',null!=t.passwords?(i+='<button type=button class="btn btn-danger" onclick="account_manageOtp(2);">Tyhjennä valtuudet</button></div>',i+='&nbsp;<i class="fa-regular fa-clipboard" title="Kopioi kelvolliset koodit leikepöydälle" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(N)+'")></i>'):i+="</div>",xxdialogTag="otpauth-manage",setModalContent("xxAddAgent","Hallinnoi varmuuskoodeja",i),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var V='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',_="</table></div></div>";i='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">Laiteavaimia </a> käytetään toissijaisena kirjautumistunnistuksena.';if(i+='<div class="backgroundContainer" style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',t.keys&&t.keys.length>0)for(var a in t.keys){var U=t.keys[a];i+=V+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(me=2==U.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+U.name+'<td style=text-align:right><button type=button class="btn btn-danger" onclick=account_removehkey('+U.i+")>Poista</button>"+_}else i+=V+"<tr style=text-align:center><td>Ei avaimia määritetty"+_;i+="</div>",i+="<div>";var R="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>R?(131072&features&&(i+='<button class="btn btn-primary" id=d2addkey3 type=button onclick="account_addhkey(3);">Lisää avain</input>'),16384&features&&(i+='<button class="btn btn-primary" id=d2addkey2 type=button onclick="account_addhkey(2);">Lisää YubiKey&reg; OTP</input>')):i+="Avainten enimmäismäärä saavutettu.",xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Hallinnoi suojausavaimia",i+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Lisää suojausavain","<br />Virhe, avainta ei voitu lisätä.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Lisää suojausavain","<br />Virhe, avainta ei voitu lisätä.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Lisää suojausavain",i='Paina avain nappia nyt.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+t.name+" />");var H=t.request;t.request.challenge=Uint8Array.from(atob(t.request.challenge),function(e){return e.charCodeAt(0)}),t.request.user.id=Uint8Array.from(atob(t.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:H}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}})},function(e){console.log("VIRHE:"+e),setModalContent("xxAddAgent","Lisää suojausavain","VIRHE:"+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;i='<table><tr><td><img src="images/phone80.png" style=padding:8px>';i+="<td>Tarkista puhelimesi ja kirjoita vahvistuskoodi.",setModalContent("xxAddAgent","Puhelin ilmoitukset",i+='<br /><br /><div style=width:100%;text-align:center>Vahvistuskoodi: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;i='<table><tr><td><img src="images/messaging40.png" style=padding:8px>';i+="<td>Check your messaging application and enter the verification code.",setModalContent("xxAddAgent","Messaging Notifications",i+='<br /><br /><div style=width:100%;text-align:center>Vahvistuskoodi: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(t.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){var n,i=Q("d4editorarea").value;i=0===d4EditLineBreakVal?i.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?i.replace(/\r\n|\n/g,"\r"):i.replace(/\r\n|\r/g,"\n"),n=1==d4EditEncodingVal?encode_utf8(i):i,meshserver.send({action:"fileoperation",fileop:"set",path:t.path,file:t.file,data:btoa(n)})}(0,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(t.data)):atob(t.data);break;case"event":if(!t.event.nolog){if(currentNode&&t.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(t.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(t.event);for(var j=parseInt(p16limitdropdown.value);currentDeviceEvents.length>j;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&t.event.userid==currentUser._id&&(t.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(t.event);for(j=parseInt(p31limitdropdown.value);currentUserEvents.length>j;)currentUserEvents.pop()}mainUpdate(2048)}if(t.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(t.event);for(j=parseInt(p3limitdropdown.value);events.length>j;)events.pop()}mainUpdate(32)}}if(t.event.noact)break;switch(t.event.action){case"serverinfochange":null!=t.event.lock2factor&&(serverinfo.lock2factor=t.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":if(t.event.nodeid!=deviceSharesReq)break;deviceSharesNode=t.event.nodeid,deviceShares=t.event.deviceShares,currentNode._id==deviceSharesNode&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":if(98==t.event.msgid&&GetNodeRights(t.event.nodeid)>0){c=getNodeFromId(t.event.nodeid);addNotification({text:format("Apua pyydettiin käyttäjältä {0}: {1}",t.event.msgArgs[0],t.event.msgArgs[1]),title:c.name,icon:c.icon,nodeid:t.event.nodeid})}break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(t.event),t.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var F=localStorage.getItem("showRealNames"),L=localStorage.getItem("uiMode"),B=localStorage.getItem("sort"),P=localStorage.getItem("loctag"),O=localStorage.getItem("nightMode"),K=localStorage.getItem("footerBar"),z=JSON.parse(t.event.state);for(var a in z)localStorage.setItem(a,z[a]);if(null!=z.showRealNames&&z.showRealNames!=F&&(showRealNames=Q("RealNameCheckBox").checked="1"==z.showRealNames,mainUpdate(6)),null!=z.uiMode&&z.uiMode!=L&&userInterfaceSelectMenu(parseInt(z.uiMode)),null!=z.sort&&z.sort!=B&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(z.sort),mainUpdate(6)),null!=z.loctag&&z.loctag!=P&&(null!=z.loctag?args.locale=z.loctag:delete args.locale,mainUpdate(4294967295)),null!=z.nightMode&&z.nightMode!=O&&(putstore("nightMode",z.nightMode),setNightMode()),null!=z.footerBar&&z.footerBar!=K&&(footerBar="1"==z.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=z.stars&&z.stars!=JSON.stringify(stars)&&(stars=JSON.parse(z.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode&&refreshDevice(currentNode._id)),null!=z.deskKeyShortcuts){deskKeyboardShortcuts=[];var W=z.deskKeyShortcuts.split(",");for(var a in W)""!=W[a]&&deskKeyboardShortcuts.push(parseInt(W[a]));updateDeskShortcutKeys()}if(null!=z.deskStrings){l=null;try{l=JSON.parse(z.deskStrings)}catch(e){}Array.isArray(l)&&(deskKeyboardStrings=l,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(t.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof t.event.account||null==t.event.account)return void console.log(t.event);if(userinfo._id==t.event.account._id){var G=t.event.account.siteadmin?t.event.account.siteadmin:0,q=userinfo.siteadmin?userinfo.siteadmin:0,J=t.event.account.removeRights?t.event.account.removeRights:0,Y=userinfo.removeRights?userinfo.removeRights:0;(t.event.account.quota!=userinfo.quota||!(8&userinfo.siteadmin)&&8&t.event.account.siteadmin)&&meshserver.send({action:"files"});var $=userinfo.groups;if(userinfo=t.event.account,q==G&&Y==J&&1!=t.event.accountImageChange||(1==t.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),2&userinfo.siteadmin){var X=$||[],Z=userinfo.groups?userinfo.groups:[];X.join(",")!=Z.join(",")&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"}))}t.event.nodeListChange==userinfo._id&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip})}if(currentNode&&refreshDevice(currentNode._id),null==users)break;null==userinfo.groups||0==userinfo.groups.length||1==findOne(t.event.account.groups,userinfo.groups)?users[t.event.account._id]=t.event.account:delete users[t.event.account._id],mainUpdate(16388);break;case"accountremove":if(null==users)break;delete users[t.event.userid],mainUpdate(16384);break;case"createusergroup":case"usergroupchange":null==usergroups&&(usergroups={});var ee=usergroups[t.event.ugrpid];null==ee?usergroups[t.event.ugrpid]={_id:t.event.ugrpid,name:t.event.name,desc:t.event.desc,domain:t.event.domain,links:t.event.links}:(ee.name=t.event.name,t.event.desc?ee.desc=t.event.desc:delete ee.desc,t.event.links?ee.links=t.event.links:delete ee.links,t.event.flags?ee.flags=t.event.flags:delete ee.flags,"number"==typeof t.event.consent&&(ee.consent=t.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[t.event.ugrpid]){delete usergroups[t.event.ugrpid];var te=0;for(var a in usergroups)te++;0==te&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[t.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==t.event.mesh.links[userinfo._id]||(meshes[t.event.meshid]=t.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[t.event.meshid]){var ne=!1;for(var a in null!=t.event.links[userinfo._id]&&(ne=!0),null!=userinfo.links[t.event.meshid]&&(ne=!0),userinfo.links)a.startsWith("ugrp/")&&null!=t.event.links[a]&&(ne=!0);ne&&(meshes[t.event.meshid]={_id:t.event.meshid,name:t.event.name,mtype:t.event.mtype,desc:t.event.desc,links:t.event.links,amt:t.event.amt,invite:t.event.invite,expireDevs:t.event.expireDevs,relayid:t.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=t.event.name)for(var a in meshes[t.event.meshid].name=t.event.name,nodes)nodes[a].meshid==t.event.meshid&&(nodes[a].meshnamel=t.event.name.toLowerCase());if(null!=t.event.desc&&(meshes[t.event.meshid].desc=t.event.desc),null!=t.event.flags&&(meshes[t.event.meshid].flags=t.event.flags),null!=t.event.consent&&(meshes[t.event.meshid].consent=t.event.consent),t.event.links&&(meshes[t.event.meshid].links=t.event.links),t.event.amt&&(meshes[t.event.meshid].amt=t.event.amt),null!=t.event.invite?meshes[t.event.meshid].invite=t.event.invite:delete meshes[t.event.meshid].invite,null!=t.event.expireDevs&&(t.event.expireDevs>0?meshes[t.event.meshid].expireDevs=t.event.expireDevs:delete meshes[t.event.meshid].expireDevs),null!=t.event.relayid&&(meshes[t.event.meshid].relayid=t.event.relayid),0==IsMeshViewable(t.event.meshid)){20==xxcurrentView&&currentMesh==meshes[t.event.meshid]&&go(2),delete meshes[t.event.meshid];var ie=[];for(var a in nodes)(nodes[a].meshid!=t.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[a]._id])&&ie.push(nodes[a]);nodes=ie,xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,xxcurrentView>=10&&xxcurrentView<20&&go(1)),20==xxcurrentView&&currentMesh._id==t.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[t.event.meshid]&&(delete meshes[t.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));ie=[];if(null!=nodes)for(var a in nodes)nodes[a].meshid!=t.event.meshid&&ie.push(nodes[a]);nodes=ie,mainUpdate(24580),xxcurrentView>=20&&xxcurrentView<30&&currentMesh._id==t.event.meshid&&(setDialogMode(0),go(2)),xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var ae=t.event.node;if(!meshes[ae.meshid])break;if(null!=getNodeFromId(ae._id))break;ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,ae.meshnamel=meshes[ae.meshid]?meshes[ae.meshid].name.toLowerCase():"*",ae.state=0,ae.icon||(ae.icon=1),ae.ident=++nodeShortIdent,nodes.push(ae),mainUpdate(23),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096);break;case"removenode":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g];currentNode==ae&&(xxcurrentView>=10&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(g,1),mainUpdate(20),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096)}break;case"changenode":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){if((ae=nodes[g]).name=t.event.node.name,ae.rname=t.event.node.rname,ae.lusers=t.event.node.lusers,ae.users=t.event.node.users,ae.host=t.event.node.host,ae.desc=t.event.node.desc,ae.ip=t.event.node.ip,ae.osdesc=t.event.node.osdesc,ae.publicip=t.event.node.publicip,ae.iploc=t.event.node.iploc,ae.wifiloc=t.event.node.wifiloc,ae.gpsloc=t.event.node.gpsloc,ae.tags=t.event.node.tags,ae.ssh=t.event.node.ssh,ae.rdp=t.event.node.rdp,ae.userloc=t.event.node.userloc,ae.rdpport=t.event.node.rdpport,ae.rfbport=t.event.node.rfbport,ae.sshport=t.event.node.sshport,ae.httpport=t.event.node.httpport,ae.httpsport=t.event.node.httpsport,ae.consent=t.event.node.consent,ae.pmt=t.event.node.pmt,null!=t.event.node.links?ae.links=t.event.node.links:delete ae.links,null!=t.event.node.agent&&(null==ae.agent&&(ae.agent={}),null!=t.event.node.agent.ver&&(ae.agent.ver=t.event.node.agent.ver),null!=t.event.node.agent.id&&(ae.agent.id=t.event.node.agent.id),null!=t.event.node.agent.caps&&(ae.agent.caps=t.event.node.agent.caps),null!=t.event.node.agent.root&&(ae.agent.root=t.event.node.agent.root),null!=t.event.node.agent.core?ae.agent.core=t.event.node.agent.core:ae.agent.core&&delete ae.agent.core,ae.agent.tag=t.event.node.agent.tag),null!=t.event.node.intelamt&&(null==ae.intelamt&&(ae.intelamt={}),null!=t.event.node.intelamt.state&&(ae.intelamt.state=t.event.node.intelamt.state),null!=t.event.node.intelamt.host&&(ae.intelamt.user=t.event.node.intelamt.host),null!=t.event.node.intelamt.user?ae.intelamt.user=t.event.node.intelamt.user:delete ae.intelamt.user,null!=t.event.node.intelamt.tls&&(ae.intelamt.tls=t.event.node.intelamt.tls),null!=t.event.node.intelamt.ver&&(ae.intelamt.ver=t.event.node.intelamt.ver),null!=t.event.node.intelamt.tag&&(ae.intelamt.tag=t.event.node.intelamt.tag),null!=t.event.node.intelamt.uuid&&(ae.intelamt.uuid=t.event.node.intelamt.uuid),null!=t.event.node.intelamt.realm&&(ae.intelamt.realm=t.event.node.intelamt.realm),null!=t.event.node.intelamt.flags&&(ae.intelamt.flags=t.event.node.intelamt.flags),null!=t.event.node.intelamt.warn?ae.intelamt.warn=t.event.node.intelamt.warn:delete ae.intelamt.warn),null!=t.event.node.av&&(ae.av=t.event.node.av),null!=t.event.node.wsc&&(ae.wsc=t.event.node.wsc),null!=t.event.node.volumes&&(ae.volumes=t.event.node.volumes),ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,t.event.node.icon&&(ae.icon=t.event.node.icon),null!=t.event.node.lastbootuptime&&(ae.lastbootuptime=t.event.node.lastbootuptime),t.event.node.meshid!=ae.meshid)if(null!=meshes[t.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[ae._id])ae.meshid=t.event.node.meshid,ae.meshnamel=meshes[t.event.node.meshid]?meshes[t.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==ae._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}nodes.splice(g,1),mainUpdate(20)}updateDeviceViewDevice(ae),mainUpdate(26),refreshDevice(ae._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096),currentNode==ae&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g];null!=meshes[t.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[ae._id]?(ae.meshid=t.event.newMeshId,ae.meshnamel=meshes[t.event.newMeshId]?meshes[t.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==ae._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(g,1),mainUpdate(20)),refreshDevice(t.event.nodeid)}else{ae=t.event.node;if(!meshes[ae.meshid])break;ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,ae.meshnamel=meshes[ae.meshid]?meshes[ae.meshid].name.toLowerCase():"*",ae.state=0,ae.icon||(ae.icon=1),ae.ident=++nodeShortIdent,nodes.push(ae),mainUpdate(23)}break;case"nodeconnect":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g],c=getstore("notifications",0);if(t.event.meshid&&userinfo.links&&userinfo.links[t.event.meshid]&&userinfo.links[t.event.meshid].notify&&(c|=userinfo.links[t.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[t.event.meshid]&&(c|=userinfo.notify[t.event.meshid]),null!=userinfo.notify[t.event.nodeid]&&(c|=userinfo.notify[t.event.nodeid])),2&c){var oe="Agentti yhdistetty";null!=ae.agent&&!1===ae.agent.root&&(oe="Agentti, jolla on rajoitetut oikeudet");var se={title:ae.name,icon:ae.icon,nodeid:ae._id,id:t.event.id};!(1&ae.conn)&&1&t.event.conn&&(se.text=oe,addNotification(se)),!(2&ae.conn)&&2&t.event.conn&&(se.text="Intel AMT CIRA kytketty",addNotification(se)),!(4&ae.conn)&&4&t.event.conn&&(se.text="Intel AMT kytketty",addNotification(se)),!(16&ae.conn)&&16&t.event.conn&&(se.text="MQTT yhdistetty",addNotification(se))}if(4&c){se={title:ae.name,icon:ae.icon,nodeid:ae._id,id:t.event.id};1&ae.conn&&!(1&t.event.conn)&&(se.text="Agentti irrotettu",addNotification(se)),2&ae.conn&&!(2&t.event.conn)&&(se.text="Intel AMT CIRA irrotettu",addNotification(se)),4&ae.conn&&!(4&t.event.conn)&&(se.text="Intel AMT irrotettu",addNotification(se)),16&ae.conn&&!(16&t.event.conn)&&(se.text="MQTT yhteys katkaistu",addNotification(se))}ae.conn=t.event.conn,ae.pwr=t.event.pwr,ae.lastconnect=Date.now(),1&ae.conn||delete ae.sessions;var le=Q("DevFilterSelect").value;1==le||5==le?mainUpdate(21):(updateDeviceViewDevice(ae),mainUpdate(17)),refreshDevice(ae._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096)}break;case"wssessioncount":null!=wssessions&&(0==t.event.count&&wssessions[t.event.userid]?delete wssessions[t.event.userid]:wssessions[t.event.userid]=t.event.count,mainUpdate(16384));break;case"login":null!=users&&users[t.event.userid]&&(users[t.event.userid].login=Math.floor(new Date(t.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+t.event.range)return;i="";if(null==t.event.results)i="<div style=width:100%;text-align:center;margin-top:12px>Tätä osoitealuetta ei voi skannata.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Esimerkki IP-alueen arvoista<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var a in amtScanResults=t.event.results,t.event.results){var re=t.event.results[a],de=re.hostname;"host"==re.hosttype&&(de=capitalizeFirstLetter(de.split(".")[0])),de.length>20&&(de=de.substring(0,20)+"...");var ue='<b title="'+EscapeHtml(re.hostname)+'">'+EscapeHtml(de)+"</b> - v"+re.ver;2==re.state?1==re.tls?ue+=" TLS: llä.":ue+=" ilman TLS: tä.":ue+=" not activated.",i+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(a)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+ue+"</div></div></div>"}""==i&&(i="<div style=width:100%;text-align:center;margin-top:12px>Scan ei tuottanut tuloksia.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Esimerkki IP-alueen arvoista<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",i),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":c={text:t.event.value,title:t.event.title,icon:t.event.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(c.id=t.id),null!=t.event.tag&&(c.tag=t.event.tag),"number"==typeof t.maxtime&&(c.maxtime=t.maxtime),addNotification(c);break;case"traceinfo":"object"==typeof t.event.traceSources&&(null!=t.event.traceSources&&t.event.traceSources.length>0?(serverTraceSources=t.event.traceSources,QH("p41traceStatus",EscapeHtml(t.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ei mitään")));break;case"sysinfohash":null!=currentNode&&t.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:t.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==t.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null==(ae=getNodeFromId(t.event.nodeid)))break;if(ae.sessions=t.event.sessions,null!=ae.sessions){for(var a in ae.sessions)0==Object.keys(ae.sessions[a]).length&&delete ae.sessions[a];0==Object.keys(ae.sessions).length&&delete ae.sessions}updateDeviceViewDevice(ae),null!=currentNode&&currentNode._id==t.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+t.event.nodeid&&showDeviceSessions(t.event.nodeid,!0),xxdialogTag=="MESSAGES-"+t.event.nodeid&&showDeviceMessages(t.event.nodeid,!0),xxdialogTag=="HELPREQ-"+t.event.nodeid&&showDeviceHelpRequests(t.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1);break;case"loginTokenChanged":if(t.event.userid!=userinfo._id)return;loginTokens=t.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(t.event.userid!=userinfo._id)return;null==loginTokens&&(loginTokens=[]),loginTokens.push(t.event.newToken),mainUpdate(65536);break;case"stopped":default:break;case"updatePluginList":installedPluginList=t.event.list,updatePluginList();break;case"pluginStateChange":if(null==pluginHandler)break;pluginHandler.refreshPluginHandler();break;case"plugin":if(null==pluginHandler)break;try{pluginHandler[t.event.plugin][t.event.pluginaction](t)}catch(e){console.log("PluginHandler ei voinut viestiä tapahtumasta:",e)}}break;case"createInviteLink":if(xxdialogTag!=t.meshid)break;var ce;(-1==(ce=serverinfo.name).indexOf(".")||2&features)&&(ce=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);if(1==serverinfo.https)S="https://"+ce+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");else S="http://"+ce+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");Q("agentInvitationLink").href=S;var pe=format(1==t.expire?"1 tunti":"{0} tuntia",t.expire);24==t.expire&&(pe="1 päivä"),168==t.expire&&(pe="1 viikko"),5040==t.expire&&(pe="1 kuukausi"),0==t.expire&&(pe="Rajoittamaton"),QH("agentInvitationLink",format("Kutsulinkki ({0})",pe)),QV("agentInvitationLinkDiv",!0);break;case"createDeviceShareLink":if(xxdialogTag)break;i="";if(null==(ae=getNodeFromId(t.nodeid)))break;i+=addHtmlValue("Laite",ae.name),i+=addHtmlValue("Vieraan nimi",t.guestname),i+=addHtmlValue("Käyttäjän syöttö",t.viewOnly?"Ei sallittu, vain katselu":"Sallittu"),t.start&&t.expire&&(t.recurring?(i+=addHtmlValue("Käynnistys aika",printDateTime(new Date(t.start))),t.expire<2?i+=addHtmlValue("Kesto",format("{0} minuutti",t.expire)):i+=addHtmlValue("Kesto",format("{0} minuuttia",t.expire))):(i+=addHtmlValue("Käynnistys aika",printDateTime(new Date(t.start))),i+=addHtmlValue("Vanhentumisaika",printDateTime(new Date(t.expire))))),1==t.recurring&&(i+=addHtmlValue("Toistuva","Päivittäin")),2==t.recurring&&(i+=addHtmlValue("Toistuva","Viikoittain"));s=[];7&t.consent&&s.push("Ilmoita"),56&t.consent&&s.push("Kysy"),64&t.consent&&s.push("Tietosuojapalkki"),0==s.length&&s.push("Ei mitään"),i+=addHtmlValue("Käyttäjän suostumus",s.join(", "));var me="";t.p<=7?me=["","Etäpäätelinkki","Etätyöpöydän linkki","Etätyöpöytä + päätelaite","Linkki etätiedostoihin","Etäpääte + Tiedostot -linkki","Etätyöpöytä + tiedostot -linkki","Etätyöpöytä + pääte + tiedostojen linkki"][t.p]:8==t.p?me=format("HTTP/{0} link",t.port):16==t.p&&(me=format("HTTPS/{0}",t.port)),setModalContent("xxAddAgent","Jaa laite",i+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+t.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+me+'</a> <i class="fa-regular fa-copy" title="Kopioi linkki leikepöydälle" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getmqttlogin":if(null==currentNode||currentNode._id!=t.nodeid||null!=xxdialogMode)return;i="Näitä asetuksia voidaan käyttää MQTT: n liittämiseen tälle laitteelle.<br /><br />";delete t.action,delete t.nodeid,setModalContent("xxAddAgent","MQTT Tunnukset",i+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(t)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",t.msg);break;case"updatePluginList":installedPluginList=t.list,updatePluginList();break;case"pluginVersionsAvailable":if(null==pluginHandler)break;updatePluginList(t.list);break;case"downgradePluginVersions":var ge='<select id="lastPluginVersion">';t.info.versionList.forEach(function(e){ge+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),ge+="</select>",setModalContent("xxAddAgent","Laajennuksen toiminto",format("Select the version to downgrade the plugin: {0}",t.info.name)+"<hr />"+ge+"<hr />Huomaa, että alentamista ei suositella. Tee niin vain siinä tapauksessa, että äskettäinen päivitys on rikkonut jotain.NaN"+t.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":if("googleDrive"==t.service&&(QV("p2ServerActionsGoogleBackup",t.state>0),QV("p2ServerActionsGoogleBackupCheck",t.state>2),miscState.googleDrive={state:t.state},2==t.state)){i='<img style=float:right src="images/googledrive-48.png" /><div>Suurenna alla olevaan URL-osoitteeseen, myönnä käyttöoikeus ja kopioi tunnuskoodi takaisin.</div><br />';i+=addHtmlValue("Aktivointi",'<a href="'+t.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'),setModalContent("xxAddAgent","Google Drive -varmuuskopio",i+=addHtmlFormFloating("Koodi","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1)}break;case"pluginError":setModalContent("xxAddAgent","Laajennuksen virhe",t.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null==pluginHandler||"string"!=typeof t.plugin)break;try{pluginHandler[t.plugin][t.method](e,t)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(t.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=t.userid&&":"+t.userid;i="",te="BBB";var ve="";if(0==t.events.length)i+="No previous login.";else{for(var a in i+='<div class="backgroundContainer" style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>',t.events){107==(d=t.events[a].m)?(d="Kelvollinen kirjautuminen",te="BBD1BB",ve="",null!=t.events[a].tn&&(d=format("Tunnus: {0}",t.events[a].tn),te="88D188")):108==d?(d="Virheellinen 2FA",te="DD9DC3",ve="x"):109==d?(d="Lukittu tili",te="E1BBBB",ve="x"):110==d&&(d="Väärä salasana",te="E1BBBB",ve="x"),i+="<tr><td><img src=images/user-32"+ve+'.png height=32 width=32 style=float:left srcset="images/user-64'+ve+'.png 2x"><td><div style=width:350px;background-color:#'+te+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(t.events[a].t))+", <b>"+EscapeHtml(d)+"</b></div><div style=font-size:x-small>"+EscapeHtml(t.events[a].a.join(", "))+"</div></div></tr>"}i+="</table></div>"}setModalContent("xxAddAgent","Edelliset kirjautumiset",i),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([t.data],{type:"application/octet-stream"}),"laiteluettelo."+t.type);break;case"createLoginToken":if(xxdialogMode)return;i="Muista tämä käyttäjätunnus ja salasana, salasanaa ei voida näyttää uudelleen.<br /><br />";i+=addHtmlValue("Nimi",EscapeHtml(t.name)),0!=t.expire&&(i+=addHtmlValue("Mennä umpeen",EscapeHtml(printDateTime(new Date(t.expire))))),i+=addHtmlValue("Käyttäjätunnus",'<i class="fa-regular fa-copy" title="Kopioi linkki leikepöydälle" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenUser)+"</div>"),setModalContent("xxAddAgent","Luo kirjautumistunnus",i+=addHtmlValue("Salasana",'<i class="fa-regular fa-copy" title="Kopioi linkki leikepöydälle" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=t.loginTokens,mainUpdate(65536);break;case"report":renderReport(t.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var n in nodes)nodes[n].name==args.gotodevicename&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodevicername){t=null;if(null!=nodes)for(var n in nodes)nodes[n].rname==args.gotodevicername&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var n in nodes)nodes[n].ip==args.gotodeviceip&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var i=args.gotouser;if(args.gotouser.indexOf("/")<0&&(i="user/"+domain+"/"+args.gotouser),null==users||null==users[i])return;gotoUser(encodeURIComponentEx(i)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){var a=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(a="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[a])return;gotoUserGroup(a),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){if(null==devicePagingState||devicePagingState.total<=devicePagingState.limit)QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1);else{var e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit);QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t)}}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),n=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:t>1&&meshserver.send({action:"nodes",skip:0});break;case 2:t>1&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<n&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<n&&meshserver.send({action:"nodes",skip:(n-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){if(!xxdialogMode){null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]);var e="";e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agtype")>=0?" checked":"")+">Agentin tyyppi</label><br />",e+='<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agver")>=0?" checked":"")+">Agentin versio</label><br />",e+='<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("desc")>=0?" checked":"")+">Laitekuvaus</label><br />",e+='<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("os")>=0?" checked":"")+">Käyttöjärjestelmä</label><br />",e+='<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("tags")>=0?" checked":"")+">Tunnisteet</label><br />",e+='<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsav")>=0?" checked":"")+">Windows AV</label><br />",e+='<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsupdate")>=0?" checked":"")+">Windows Update</label><br />",e+='<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0?" checked":"")+">Windows Firewall</label><br />",e+='<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0?" checked":"")+">Last Boot Up Time</label><br />",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("links")>=0?" checked":"")+">MeshCentral -reitittimen linkit</label><br />",e+='<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("user")>=0?" checked":"")+">Kirjautuneet käyttäjät</label><br />",e+='<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("ip")>=0?" checked":"")+">Agentin IP -osoite</label><br />",e+='<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("conn")>=0?" checked":"")+">Palvelinyhteydet</label><br />",e+='<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amthost")>=0?" checked":"")+">Intel&reg; AMT hostname</label><br />",e+='<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amtstate")>=0?" checked":"")+">Intel&reg; AMT state</label><br />",setModalContent("xxAddAgent","Laitteenäkymän sarakkeet",e+='<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastseen")>=0?" checked":"")+">Viimeksi nähty</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx())}}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var n=0;if(e.key){if(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,n=1),8==e.keyCode&&0==userSearchFocus){var i=Q("UserSearchInput").value;Q("UserSearchInput").value=i.substring(0,i.length-1),n=1}27==e.keyCode&&(Q("UserSearchInput").value="",n=1)}else 0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),n=1);if(n>0)return 1==n&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView){if(1==e.ctrlKey&&96==e.charCode)return showRealNames=!showRealNames,Q("RealNameCheckBox").value=showRealNames,putstore("showRealNames",showRealNames?1:0),void mainUpdate(6);if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){n=0;if(e.key){if(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,n=1),8==e.keyCode&&0==searchFocus){i=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=i.substring(0,i.length-1),n=1}27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1)}else 0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),n=1);if(n>0)return 1==n&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,n=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),n=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode),n=1))}}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),e.keyCode>=37&&e.keyCode<=40&&haltEvent(e)),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(8===e.keyCode&&0==userSearchFocus){var n=Q("UserSearchInput").value;Q("UserSearchInput").value=n.substring(0,n.length-1),i=1}if(27===e.keyCode&&(Q("UserSearchInput").value="",i=1),i>0)return 1==i&&mainUpdate(5),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var i=0;if(Q("viewselect").value<4){if(8===e.keyCode&&0==searchFocus){n=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),i=1}if(27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",i=1),i>0)return 1==i&&mainUpdate(5),haltEvent(e)}if(4==Q("viewselect").value){if(8===e.keyCode&&0==mapSearchFocus){n=Q("mapSearchLocation").value;Q("mapSearchLocation").value=n.substring(0,n.length-1),i=1}27===e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),i=1)}}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1==e.shiftKey&&27==e.keyCode?(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1)):xxdialogMode||0!=xxcurrentView||1==e.ctrlKey||1==e.altKey||1==e.metaKey?void 0:Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode)?haltEvent(e):void 0):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;var n=e.children[1].children[1];n.children[0].classList.remove("g1s"),n.children[1].classList.remove("e2s"),n.children[2].classList.remove("g2s"),1==t&&(n.children[0].classList.add("g1s"),n.children[1].classList.add("e2s"),n.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var n=Q("viewselect").value;if(1==n)(i=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),i.children[2].classList.remove("e2s"),i.children[3].classList.remove("g2s"),1==t&&(i.children[1].classList.add("g1s"),i.children[2].classList.add("e2s"),i.children[3].classList.add("g2s"));else if(2==n){var i;(i=e).children[2].classList.remove("g1s"),i.children[4].classList.remove("e2s"),i.children[3].classList.remove("g2s"),1==t&&(i.children[2].classList.add("g1s"),i.children[4].classList.add("e2s"),i.children[3].classList.add("g2s"))}}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,n=null,i={},a=Q("viewselect").value,o={},s={};if(QV("xdevices",4!=a),QV("xdevicesmap",4==a),QVH("devListToolbar",a<3),QVH("kvmListToolbar",3==a||5==a),QVH("devMapToolbar",4==a),QV("devListToolbarSize",3==a||5==a),QV("devListToolbarSettings",2==a),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",nodes.length>0),QV("devListToolbarSort",nodes.length>0&&4!=a),0==nodes.length&&(a=1,sort=0),4==a)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderId=0,deviceHeaderCount={},deviceHeaderTotal=0,deviceHeaders={},deviceHeadersTitles={};var l=[];0==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&deviceViewSettings.devsCols.indexOf("lastseen")>=0||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort));var r=Q("column_l").clientWidth-60,d=Math.floor(r/301);d=301+Math.floor((r-301*d)/d);var u=4;for(var c in deviceViewSettings&&deviceViewSettings.devsCols&&(u=deviceViewSettings.devsCols.length+1,deviceViewSettings.devsCols.indexOf("desc")>=0&&u--),nodes){if(0!=(H=nodes[c]).v){var p=meshes[H.meshid],m=GetNodeRights(H);if(0==sort){if((meshes[H.meshid]?H.meshid:"*")!=n){1!=a&&3!=a&&5!=a||null==n||(e+="</div>"),deviceHeaderSet();var g="";if(2==a&&(e+="<tr><td colspan="+u+">"),meshes[H.meshid]&&1==meshes[H.meshid].mtype&&(g="<span class=devHeaderx>, vain Intel&reg; AMT</span>"),meshes[H.meshid]&&3==meshes[H.meshid].mtype&&(g=meshes[H.meshid].relayid?"<span class=devHeaderx>, välitetyt laitteet</span>":"<span class=devHeaderx>, Paikalliset laitteet</span>"),1==a&&null!=n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==a&&(e+="<div>"),e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>",e+="<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+g,e+="</span>",1==a||2==a||3==a||5==a){var v=CollapsedGroups[H.meshid];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+H.meshid+'",'+a+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}meshes[H.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+H.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+H.meshid+"')\">"+EscapeHtml(meshes[H.meshid].name)+"</span>"+getMeshActions(p,m)+"</div>",n=H.meshid):(e+="<span id=MxMESH><i>Yksittäiset laitteet</i></span></div>",n="*"),2==a&&(e+="</div>"),i[n]=1,t=0,1!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else if(1==sort){var h=H.pwr?H.pwr:0;if(h!==n){if(1!=a&&3!=a&&5!=a||null==n||(e+="</div>"),deviceHeaderSet(),1==a&&null!==n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==a&&(e+="<tr><td colspan="+u+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1==a||2==a||3==a||5==a){v=CollapsedGroups["pwr:"+h];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+h+'",'+a+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}e+="<span>"+PowerStateStr2(H.pwr)+"</span></div>",n=h,t=0,1!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else 2!=sort&&5!=sort||null==n&&(n="1");if(1==a)e+="<div name=xxdevice1 id=xv1"+H._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>";else if(2==a){var f=H.meshid;1==sort?f="pwr:"+(H.pwr?H.pwr:0):3!=sort&&4!=sort||(f="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+f+" style=height:20px"+((v=3!=sort&4!=sort&CollapsedGroups[f])?";display:none":"")+" id=xv2"+H._id+"></tr>"}else(3==a||5==a)&&1&H.conn&&0!=(8&m||256&m)&&H.agent&&1&H.agent.caps&&(0==Object.keys(checkedNodeids).length||checkedNodeids[H._id])&&(e+=updateDeviceViewHtml(a,null,H),l.push(H._id));if((3==sort||4==sort)&&""!=e){if(H.tags)for(var k in H.tags){var x=H.tags[k];4==sort&&(x=p?p.name+" - "+H.tags[k]:"**INDV*~*DEVS** - "+H.tags[k]);v=CollapsedGroups["tag:"+encodeURIComponentEx(x)];var y=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(x)+(v?" style=display:none":""));if(null==o[x]?(o[x]=y,s[x]=1):(o[x]+=y,s[x]+=1),3==a||5==a)break}else if(4==sort&&null!=p&&(null==H.tags||0==H.tags.length)){x=p.name,v=CollapsedGroups["tag:"+encodeURIComponentEx(x)],y=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(x)+(v?" style=display:none":""));null==o[x]?(o[x]=y,s[x]=1):(o[x]+=y,s[x]+=1)}e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[H.state]?deviceHeaderCount[H.state]=1:deviceHeaderCount[H.state]++}}if(1==a&&null!=n&&(e+="</div>"),l.length>=32&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",l.length<32),3==sort||4==sort){var b=[],w=0;for(var c in o)b.push(c);for(var k in b.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),b){c=b[k];if(2==a){e+="<tr><td colspan="+u+"><div class=DevSt style=width:100%;padding-top:4px>";v=CollapsedGroups["tag:"+encodeURIComponentEx(c)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(c)+'",2) class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span class=devHeaderx style=float:right>"+s[c]+" node"+(s[c]>1?"s":"")+"</span><span>"+EscapeHtml(c).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Yksittäiset laitteet</i>")+"</span></div>"+o[c]}else{e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(s[c]>1?"{0} nodes":"{0} node",s[c])+"</span>";v=CollapsedGroups["tag:"+encodeURIComponentEx(c)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(c)+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span>"+EscapeHtml(c).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Yksittäiset laitteet</i>")+"</span></div>",e+="<div id=DevxCol"+w+(!0===v?" style=display:none":"")+">"+o[c]+"</div>"}w++}}var M=!1;if(""==e&&nodes.length>0&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(M=!0,e=3==sort?'<div style="margin:30px">Laitteita ei sisälly mihinkään ryhmään. Napsauta laitteen "Ryhmät" lisätäksesi ryhmän.</div>':'<div style="margin:30px">Ei hakua vastaavia laitteita. <a onclick=clearDeviceSearch()>Tyhjennä hakusuodatin</a></div>'),1==a&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&a<3){var S=deviceHeaderId,C=[];for(var c in meshes)C.push(meshes[c]);for(var c in C.sort(nameSort),C){var A=C[c];m=GetMeshRights(A);if(null==i[A._id]){""!=n&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",S++;v=CollapsedGroups[A._id];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+S+'","'+A._id+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+S+'"></i>',e+='<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>",e+=getMeshActions(A,m),e+="</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>Ei Intel&reg; AMT -laitteita tässä laiteryhmässä",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>lisää yksi</a>")):2==A.mtype?(e+="<td><div id=DevxCol"+S+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Tässä laiteryhmässä ei ole laitteita",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>lisää yksi</a>")):3==A.mtype?(e+="<td><div id=DevxCol"+S+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Tässä laiteryhmässä ei ole paikallisia laitteita",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>lisää yksi</a>")):4==A.mtype&&(e+="<td><div id=DevxCol"+S+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Tässä laiteryhmässä ei ole laitteita"),e+=".</i></div></td>",e+="</div>",n=A._id}}}if(""!=e&&0==M){if(e+="</table>",2==a){var T="";null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(T+="<th style=width:100px>Agentin tyyppi"),deviceViewSettings.devsCols.indexOf("agver")>=0&&(T+="<th style=width:100px>Agentin versio"),deviceViewSettings.devsCols.indexOf("os")>=0&&(T+="<th style=width:160px>Käyttöjärjestelmä"),deviceViewSettings.devsCols.indexOf("tags")>=0&&(T+="<th style=width:120px>Tunnisteet"),deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(T+="<th style=width:100px>Windows AV"),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(T+="<th style=width:120px>Windows Update"),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(T+="<th style=width:120px>Windows Firewall"),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(T+="<th style=width:120px>Last Boot Up Time"),deviceViewSettings.devsCols.indexOf("links")>=0&&(T+="<th style=width:120px>Linkit"),deviceViewSettings.devsCols.indexOf("user")>=0&&(T+="<th style=width:120px>Käyttäjä"),deviceViewSettings.devsCols.indexOf("ip")>=0&&(T+="<th style=width:120px>Osoite"),deviceViewSettings.devsCols.indexOf("conn")>=0&&(T+="<th style=width:100px>Liitettävyys"),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(T+="<th style=width:100px>AMT Host"),deviceViewSettings.devsCols.indexOf("amtstate")>=0&&(T+="<th style=width:100px>AMT State"),deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(T+="<th style=width:120px>Viimeksi nähty",0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"}))),e="<table style=width:100%;margin-top:4px;table-layout:fixed cellpadding=0 cellspacing=0><th>"+T+e+"</tr></table><div style=height:1px></div>"}}else e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Tageja sisältäviä laitteita ei löytynyt.</i></div>');for(var c in e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",!(a<3&&0==sort&&Object.keys(meshes).length>0)||4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin||(e+='<a href=# onclick="return account_createMesh()" title="Luo uusi laiteryhmä." style=cursor:pointer>Lisää laiteryhmä</a>&nbsp'),4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Lataa MeshCmd, komentorivityökalu, joka suorittaa monia toimintoja.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Lataa MeshCentral Reititin, TCP-porttien tunnelointi työkalu.\">Reititin</a>&nbsp")),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(c,deviceHeaders[c]);for(var c in deviceHeadersTitles)Q(c).title=deviceHeadersTitles[c];if(p1updateInfo(),3!=a&&5!=a||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var D=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];if(3==a){var E=D.x+2,N=r-5,I=Math.floor(N/E);I=E+Math.floor((N-I*E)/I),D.y=D.y*(I/D.x),D.x=I}for(var c in multiDesktop)multiDesktop[c].xxdelete=!0;for(var c in l){var V=l[c],_=V.split("/")[2],U=multiDesktop[V];if(null!=U){var R=5==a?U.m.width*D.y/U.m.height:D.x;U.m.CanvasId.setAttribute("style","background-color:black;width:"+R+"px;height:"+D.y+"px"),Q("xkvmid_"+_).appendChild(U.m.CanvasId),delete U.xxdelete,QH("skvmid_"+_,["Yhteys katkaistu","Yhdistetään...","Asennus...","",""][null==U.m.State?U.m.state:U.m.State])}else{var H=getNodeFromId(V);if(desktopNode==H&&null!=desktop){t=desktop.m.CanvasId,R=5==a?desktop.m.width*D.y/desktop.m.height:D.x;t.setAttribute("id","kvmid_"+_),t.setAttribute("style","background-color:black;width:"+R+"px;height:"+D.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+V+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+_).appendChild(t),QH("skvmid_"+_,["Yhteys katkaistu","Yhdistetään...","Asennus...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=_,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[V]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+_),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+D.x+"px;height:"+D.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+V+"')");try{Q("xkvmid_"+_).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(H,1)},100)}}}for(var c in multiDesktop)1==multiDesktop[c].xxdelete?(multiDesktop[c].Stop(),delete multiDesktop[c]):debugmode&&multiDesktop[c].m&&multiDesktop[c].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[c].m,multiDesktop[c].m.ScreenWidth,multiDesktop[c].m.ScreenHeight,multiDesktop[c].m.CanvasId);deskAdjust()}}oldviewmode=a,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){void 0===e&&(e=!1),e&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&(onDevicesTouchActive=e,0==e&&onDevicesScrollEx())}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e=Q("xdevices").scrollTop-200,t=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,n=Q("viewselect").value,i=document.getElementsByName("xxdevice"+n),a=0;a<i.length;a++)if(i[a].offsetTop>=e&&i[a].offsetTop<t){var o=getNodeFromId(i[a].id.substring(3));null!=o?updateDeviceViewHtml(n,i[a],o):i[a].innerHTML=""}else i[a].innerHTML=""}function updateDeviceViewDevice(e){var t=Q("viewselect").value;if(1==t||2==t){if("string"==typeof e&&(e=getNodeFromId(e)),null!=e){var n=Q("xv"+t+e._id);null!=n&&""!=n.innerHTML&&updateDeviceViewHtml(t,n,e)}}else mainUpdate(4)}function updateDeviceViewHtml(e,t,n){var i=EscapeHtml(n.name);0==i.length&&(i="<i>Ei mitään</i>"),null!=n.rname&&n.rname.length>0&&(i+=" / "+EscapeHtml(n.rname));var a=EscapeHtml(n.name);if(1==showRealNames&&null!=n.rname&&(a=EscapeHtml(n.rname)),0==a.length&&(a="<i>Ei mitään</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var o="",s="";if(1==stars[n._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=n.sessions&&(null!=n.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(n.sessions.msg).length+"</div>"),null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=n.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=n.sessions.battery&&1==e)){var l=n.sessions.battery,r="";"ac"==l.state&&(r="Laite on kytketty"),"dc"==l.state&&(r="Laite on akkukäyttöinen");var d="",u=-1;"number"==typeof l.level&&l.level>=0&&l.level<=100&&(d=l.level+"%",(u=Math.floor((l.level+10)/25)+1)>5&&(lvl=5),"ac"==l.state&&(100==l.level?u=11:u+=5)),u>0&&(o+='<div class="deviceBatterySmall deviceBatterySmall'+u+'" title="'+(null!=r?r+", "+d:d)+'"></div>')}""!=s&&(o+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>");var c=n.icon;if(n.conn&&0!=n.conn||3==n.mtype||(c+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+n._id+" type=checkbox "+(checkedNodeids[n._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+n._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+'\',null,null,event)"><div class="i'+c+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+i+'">'+a+"</div><div>"+NodeStateStr(n)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+o;else if(2==e){var p=[];if(n.conn&&(1&n.conn&&(4==n.mtype?"PDU"==n.porttype?p.push('<span title="Kytkinportti on käyttövalmis.">Vaihtaa</span>'):p.push('<span title="IP-KVM-portti on kytketty ja valmis käytettäväksi.">IP-KVM</span>'):p.push('<span title="Mesh agentti on yhdistetty ja käyttövalmis.">Agentti</span>')),2&n.conn?p.push('<span title="Intel&reg; AMT CIRA yhdistetty ja valmis käytettäväksi.">CIRA</span>'):4&n.conn&&p.push('<span title="Intel&reg; AMT on reititettävä.">AMT</span>'),8&n.conn&&p.push('<span title="Verkkoagentti on tavoitettavissa käyttämällä toista ainetta releenä.">Rele</span>'),16&n.conn&&p.push('<span title="MQTT-yhteys laitteeseen on aktiivinen.">MQTT</span>')),3==n.mtype){var m=meshes[n.meshid];m&&m.relayid?p.push('<span title="Paikallinen verkkoyhteys välitysagentin kautta.">Rele</span>'):p.push('<span title="Paikallinen verkkoyhteys.">Paikallinen</span>')}n.desc&&deviceViewSettings.devsCols.indexOf("desc")>=0&&(a='<div class="flex-grow-1">'+a+"</div><div style=float:right"+(1==stars[n._id]?";padding-right:15px":"")+">"+EscapeHtml(n.desc)+"</div>");var g=n.meshid;1==sort?g="pwr:"+(n.pwr?n.pwr:0):3!=sort&&4!=sort||(g="tag:**xx**xx*TaG*xx**xx**");CollapsedGroups[g];var v="<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',null,null,event)\">";if(v+='<div class=deviceBarCheckbox><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+n._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[n._id]?" checked":"")+"></div>",v+="<div class=deviceBarIcon onmouseup=gotoDevice('"+n._id+"',null,null,event)><div class=\"j"+c+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>',v+="<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>",v+='<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+i+"\" onmouseup=gotoDevice('"+n._id+"',null,null,event)>"+a+"</div></div>"+o+"</td>",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"")+'">'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("agver")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"")+'">'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("os")>=0)if(3==n.mtype){var h="";4==n.agent.id&&(h="Windows"),6==n.agent.id&&(h="Linux"),29==n.agent.id&&(h="MacOS"),v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(h)+'">'+EscapeHtml(h)}else v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(n.osdesc?n.osdesc:"")+'">'+EscapeHtml(n.osdesc?n.osdesc:"");if(deviceViewSettings.devsCols.indexOf("tags")>=0){v+="<td style=text-align:center;font-size:x-small>";var f="";if(null!=n.tags)for(var k in n.tags)f+="<span class=tagSpan>"+EscapeHtml(n.tags[k])+"</span> ";v+="<span style=line-height:20px>"+f+"</span>"}if(deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.antiVirus?"OK"==n.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>HUONO</span>":"")),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.autoUpdate?"OK"==n.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>HUONO</span>":"")),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(v+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.firewall?"OK"==n.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>HUONO</span>":"")),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+(null!=n.lastbootuptime?printDateTime(new Date(n.lastbootuptime)):"")),deviceViewSettings.devsCols.indexOf("links")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(n)),deviceViewSettings.devsCols.indexOf("user")>=0&&(v+="<td style=text-align:center>"+getUserShortStr(n)),deviceViewSettings.devsCols.indexOf("ip")>=0){var x="";3==n.mtype?x=n.host:n.ip&&(x=n.ip),v+='<td style=text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis title="'+EscapeHtml(x)+'">'+EscapeHtml(x)}if(deviceViewSettings.devsCols.indexOf("conn")>=0&&(v+="<td style=text-align:center>"+p.join("&nbsp;+&nbsp;")),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(v+="<td style=text-align:center>"+(null==n.intelamt||null==n.intelamt.host?"":EscapeHtml(n.intelamt.host))),deviceViewSettings.devsCols.indexOf("amtstate")>=0){var y="";n.intelamt&&(0==n.intelamt.state&&(y=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==n.intelamt.state&&(y=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==n.intelamt.state&&n.intelamt.flags&&(2&n.intelamt.flags?y=' <span title="Intel&reg; AMT on aktivoitu asiakasohjaustilassa">CCM</span>':4&n.intelamt.flags&&(y+=' <span title="Intel&reg; AMT on aktivoitu Järjestelmänvalvojan ohjaustilassa">ACM</span>'))),v+="<td style=text-align:center>"+y}deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(v+="<td style=text-align:center;font-size:x-small>",n.conn>0?v+="Yhdistetty":null!=n.lastconnect&&(v+=printDateTime(new Date(n.lastconnect)))),t.innerHTML=v}else if(3==e||5==e){v="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+n._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',11,null,event)\">"+o;return v+='<div class="j'+c+'" style=width:16px;float:left></div>&nbsp;'+a+"</div>",v+="<span onmouseup=gotoDevice('"+n._id+"',null,null,event)></span><div id=xkvmid_"+n._id.split("/")[2]+"><div id=skvmid_"+n._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+n._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+n._id+"')\">Yhteys katkaistu</div></div>",v+="</div>"}}}function getShortRouterLinks(e){var t="",n=GetNodeRights(e);if((1&e.conn||3==e.mtype)&&e.agent&&8&n&&14!=e.agent.id&&(0!=webRelayPort&&(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport?e.httpport:80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;",t+='<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport?e.httpsport:443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),e.agent.id>0&&e.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),e.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport?e.sshport:22)+")>SSH</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport?e.sshport:22)+")>SCP</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var i in serverinfo.devicemeshrouterlinks.extralinks){var a=serverinfo.devicemeshrouterlinks.extralinks[i],o='"'+a.protocol+'"';if(doesDeviceMatchFilterTags(e,a.filter)){if(3==e.mtype&&("mcrdesktop"==a.protocol||"mcrfiles"==a.protocol))continue;"number"==typeof a.protocol?o=a.protocol:"http"==a.protocol?o=1:"https"==a.protocol?o=2:"rdp"==a.protocol?o=3:"ssh"==a.protocol?o=4:"scp"==a.protocol?o=5:"mcrdesktop"==a.protocol?o=6:"mcrfiles"==a.protocol&&(o=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+o+","+a.port+(a.ip?',"'+a.ip+'"':",null")+","+(a.localport?a.localport:0)+")>"+a.name+"</a>&nbsp;"}}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(!Array.isArray(t))return!1;if(t.indexOf(e.meshid)>=0)return!0;if(t.indexOf(e._id)>=0)return!0;if(Array.isArray(e.tags))for(var n in e.tags)if(t.indexOf("tag:"+e.tags[n])>=0)return!0;return!1}function showDeviceHelpRequests(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var i=null,a="";if(null==(i=null==e?currentNode:getNodeFromId(e))||null==i.sessions)return setDialogMode(0),!1;if(null!=i.sessions.help)for(var o in i.sessions.help)a+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(o)+'","'+encodeURIComponentEx(i._id)+'")>Hylkää</a><div style=margin-bottom:6px><b>'+EscapeHtml(o)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(i.sessions.help[o])+"</div></div>";return""!=a&&(xxdialogTag="HELPREQ-"+i._id,setModalContent("xxAddAgent","Apupyynnöt - "+EscapeHtml(i.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var i=null,a="";if(null==(i=null==e?currentNode:getNodeFromId(e))||null==i.sessions)return setDialogMode(0),!1;for(var o in i.sessions)if("kvm"==o&&null==i.sessions.multidesk)for(var s in a+="<u>Etätyöpöytä</u>",i.sessions.kvm)if(s.startsWith("user/")){var l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger" ></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.kvm[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.kvm[s])))+l)}else"busy"==s&&(a+=addHtmlValue2("Laite on varattu",1==i.sessions.kvm[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.kvm[s]))));else if("multidesk"==o)for(var s in a+="<u>Etätyöpöytä</u>",i.sessions.multidesk){l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.multidesk[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.multidesk[s])))+l)}else if("terminal"==o)for(var s in a+="<u>Pääte</u>",i.sessions.terminal){l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.terminal[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.terminal[s])))+l)}else if("files"==o)for(var s in a+="<u>Tiedostot</u>",i.sessions.files){l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.files[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.files[s])))+l)}else if("tcp"==o)for(var s in a+="<u>TCP-reititys</u>",i.sessions.tcp){l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.tcp[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.tcp[s])))+l)}else if("udp"==o)for(var s in a+="<u>UDP-reititys</u>",i.sessions.udp){l="";s!=userinfo._id&&4294967295!=GetNodeRights(i)||(l=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(i._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Katkaise tämän istunnon yhteys" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==i.sessions.udp[s]?"1 istunto":nobreak(format("{0} istuntoa",i.sessions.udp[s])))+l)}return""!=a?(xxdialogTag="SESSIONS-"+i._id,setModalContent("xxAddAgent","Istuntoja - "+EscapeHtml(i.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0),!1}function endDeviceSession(e,t,n){var i=decodeURIComponent(n).split("/"),a=i[0]+"/"+i[1]+"/"+i[2],o=null;4==i.length&&i[3].startsWith("guest:")&&(o=atob(i[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:a,guestname:o,guestname:o}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:a,guestname:o,guestname:o,protocol:e})}function showDeviceMessages(e,t,n){if(n&&haltEvent(n),xxdialogMode&&!t)return!1;var i=null,a="<div style=max-height:200px;overflow-y:auto>",o=0;if(null==(i=null==e?currentNode:getNodeFromId(e))||null==i.sessions||null==i.sessions.msg)return setDialogMode(0),!1;for(var s in i.sessions.msg){var l=s,r=5;"string"==typeof i.sessions.msg[s].msg&&(l=i.sessions.msg[s].msg),"number"==typeof i.sessions.msg[s].msgid&&null!=eventsMessageId[i.sessions.msg[s].msgid]&&(l=eventsMessageId[i.sessions.msg[s].msgid]),"number"==typeof i.sessions.msg[s].icon&&(r=i.sessions.msg[s].icon),(r<1||r>9)&&(r=5),a+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+r+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(l)+"</div></table>",o++}return a+="</div>",o>0&&(xxdialogTag="MESSAGES-"+i._id,setModalContent("xxAddAgent","Agenttiviestit - "+EscapeHtml(i.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function toggleCollapseGroup(e,t,n){if(2==n){var i,a=document.getElementsByName("xxdevice2");if(0==a.length)return;for(var o=[],s=0;s<a.length;s++)a[s].attributes.colname.value.substring(7)==t&&o.push(a[s]);(i="none"==o[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<o.length;s++)o[s].style.display=i?"":"none"}else(i="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,i);i?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){"string"==typeof e&&(e=getNodeFromId(e));var t=GetNodeRights(e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){if(null==e||null==e.users||!Array.isArray(e.users)||0==e.users.length)return"";if(e.users.length>1)return'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} käyttäjää",e.users.length))+"</span>";var t=e.users[0],n=t,i=t.indexOf("\\");return i>0&&(n=t.substring(i+1)),(n=EscapeHtml(n)).length>15&&(n=n.substring(0,14)+"&#8230;"),e.lusers&&e.lusers.length>0?addKeyLinkConditional(n,EscapeHtml(t)+" (Lukittu)",e.lusers&&e.lusers.indexOf(t)>=0):'<span title="'+EscapeHtml(t)+'">'+n+"</span>"}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var t=0;for(var n in nodes){var i=nodes[n],a=nodes[n]._id;if(null==multiDesktop[a]&&(0==Object.keys(checkedNodeids).length||checkedNodeids[a])){var o=GetNodeRights(i);(8&o||256&o)&&1&i.conn&&1==i.v&&t++}}if(t>8){setModalContent("xxAddAgent","Yhdistä kaikkiin",format("Haluatko varmasti muodostaa yhteyden {0} laitteeseen?",t));var s=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",s),Q("autoConnectDesktopCheckbox").checked=!1};return document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",s),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",s),connectAllKvmFunction(!0)})}}for(var n in nodes)1!=nodes[n].v||null!=multiDesktop[nodes[n]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[n]._id]||toggleKvmDevice(nodes[n]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Yhteys katkaistu","Yhdistetään...","Asennus...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),!(268435456&features)&&xxcurrentView>0)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Etätyöpöydän asetukset",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var n=e._id,i=n.split("/")[2],a=multiDesktop[n];if(null==a){if(null==Q("kvmid_"+i))return;if(2==t){if(null==e.intelamt.user||""==e.intelamt.user)return;(a=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+i),authCookie)).shortid=i,a.onStateChanged=onMultiDesktopStateChange,a.m.bpp=1,a.m.useZRLE=!0,a.m.showmouse=!0,a.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},a.m.onScreenSizeChange=mdeskAdjust,a.Start(n,16994,"*","*",0),a.contype=2,multiDesktop[n]=a}else 1==t&&((a=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+i),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,a.m.mouseCursorActive(11==xxcurrentView),a.shortid=i,a.attemptWebRTC=attemptWebRTC,a.webrtcconfig=webrtcconfiguration,a.onStateChanged=onMultiDesktopStateChange,a.m.ImageType=multidesktopsettings.agentencoding,a.m.CompressionLevel=multidesktopsettings.quality,a.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(a.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(a.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(a.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(a.m.remoteKeyMap=multidesktopsettings.remotekeymap),a.m.onScreenSizeChange=mdeskAdjust,a.Start(n),a.contype=1,multiDesktop[n]=a)}else a.Stop(),delete multiDesktop[n]}function getMeshActions(e,t){if(!(4&t))return"";var n="";return 1==e.mtype&&(1&features||(n+=' <a href=# role="button" title="Lisää uusi Intel&reg; AMT-tietokone, joka sijaitsee lähiverkossa." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Lisää paikallinen</a>",n+=' <a href=# role="button" title="Lisää uusi Intel&reg; AMT-tietokone skannaamalla lähiverkko." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Skannaa verkko</a>"),e.amt&&e.amt.type>0&&(n+=' <a href=# role="button" title="Suorita Intel&reg; AMT -aktivointi ja -määritykset." onclick=\'return showAmtSetup("'+e._id+"\")'>Perustaa</a>")),2!=e.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(n+=' <a href=# role="button" title="Lisää uusi tietokone tähän laiteryhmään asentamalla MeshAgent." onclick=\'return addAgentToMesh("'+e._id+"\")'>Lisää agentti</a>",2&features||(n+=' <a href=# role="button" title="Kutsu joku asentamaan Mesh agentti tähän laiteryhmään." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Kutsu</a>")),3==e.mtype&&(n+=' <a href=# role="button" title="Lisää laite, joka sijaitsee paikallisessa verkossa." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Lisää Laite</a>"),n}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n=format('Lisää paikallinen laite laiteryhmään "{0}".',EscapeHtml(t.name))+"<br /><br />";n+=addHtmlFormFloating("Laitteen Nimi","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"),n+=addHtmlFormFloating("Isäntänimi",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Sama kuin laitteen nimi" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />'),setModalContent("xxAddAgent","Lisää paikallinen laite",n+=addHtmlFormFloating("Tyyppi","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH/SCP/VNC)</option><option value=29>macOS (SSH/SCP/VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0)}function addLocalDeviceToMeshEx(e,t){var n=Q("dp1hostname").value;""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n=format('Lisää uusi Intel&reg; AMT -laite laiteryhmään "{0}".',EscapeHtml(t.name))+"<br /><br />";return n+=addHtmlFormFloating("Laitteen Nimi",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Isäntänimi",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Sama kuin laitteen nimi" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Käyttäjätunnus",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="pääkäyttäjä" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),n+=addHtmlFormFloating("Salasana",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),setModalContent("xxAddAgent","Lisää Intel&reg; AMT laite",n+=addHtmlFormFloating("Turvallisuus",'<select id=dp1tls class="form-select"><option value=0>Ei TLS-suojausta</option><option value=1>TLS-suojaus vaaditaan</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus(),!1}function showAmtImport(e){if(!xxdialogMode){setModalContent("xxAddAgent","Intel&reg; AMT Device Import",'Create many Intel&reg; AMT device at once by importing a JSON file with the following format:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1)}}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,t){var n=new FileReader;n.onload=function(e){var n=null;try{n=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Intel&reg; AMT Device Import",format("JSON-tiedosto {0} on virheellinen.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=n?meshserver.send({action:"importamtdevices",meshid:t,amtdevices:n}):(setModalContent("xxAddAgent","Intel&reg; AMT Device Import","Virheellinen JSON-tiedostomuoto."),showModal("xxAddAgentModal","idx_dlgOkButton"))},n.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){if(xxdialogMode)return!1;var t=serverinfo.name,n=meshes[e];(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);var i;domainUrl.substring(0,domainUrl.length-1);1==serverinfo.https?i="wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:i="ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl;var a=format('Lisää, aktivoi ja määritä Intel&reg; AMT ryhmittelemään "{0}" suorittamalla ajoittain MeshCmd etälaitteen järjestelmänvalvojana.',EscapeHtml(n.name))+"<br /><br />";return a+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+i+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(a+="<div style=margin-top:8px>ACM-aktivointia varten Intel&reg; AMT on asetettava seuraavaan luotettavaan FQDN: ään: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Intel&reg; AMT -asennus",a),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus(),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Aktivoi Intel&reg; AMT järjestelmänvalvojan ohjaustilassa (ACM) FAT-muotoisella USB-avaimella. Aseta setup.bin siihen ja käynnistä yksi tai useampi tietokone tällä avaimella.</div><div style=margin-top:6px>Aloita kirjoittamalla vanha ja uusi MBEx-salasana.</div></table>";e+=addHtmlFormFloating("vanha salasana",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Uusi salasana*",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Uusi salasana*",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Käytä paljaalle metallille lähiverkkoaktivointiin.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 merkkiä, 1 ylempi, 1 alempi, 1 numeerinen, 1 ei-aakkosnumeerinen.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,n=Q("dp1password2").value,i=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(i=!1),t==n&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(i=!1),QE("idx_dlgOkButton",i)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){if(xxdialogMode)return!1;var t="Syötä IP-alue, josta etsitään Intel&reg; AMT-laitteita.<br /><br />";return t+=addHtmlValue("IP Alue",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Skannaa" onclick=addAmtScanToMeshButton()></input></tr></table>'),t+='<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>',t+='<input type=hidden id=amtScanMeshId value="'+e+'" />',xxdialogTag=e,setModalContent("xxAddAgent","Skannaa Intel&reg; AMT laitteita",t+='<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Peruuta" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Valitse kaikki" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Esimerkki IP-alueen arvoista<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp(),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",Q("dp1range").value.split(".").length>3),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t=document.getElementsByClassName("DevScanCheckbox"),n=0;n<t.length;n++)if(t[n].checked){var i=t[n].getAttribute("tag"),a=amtScanResults[i],o=a.hostname;"host"==a.hosttype&&(o=capitalizeFirstLetter(o.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:o,hostname:a.hostname,amtusername:"",amtpassword:"",amttls:a.tls})}}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");t.length>1&&(e=t[t.length-1]),""!=(e=e.trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Skannataan...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,n=0;n<e.length;n++)e[n].checked&&t++;QE("idx_dlgOkButton2",t>0)}function checkEmail(e){var t=e.split("@"),n=2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2;if(1==n){var i=t[1].split(".");for(var a in i)0==i[a].length&&(n=!1)}return n}function inviteAgentToMesh(e){if(xxdialogMode)return!1;var t="",n=meshes[e];return 64&features&&(t+=addHtmlFormFloating("Kutsutyyppi","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Kutsu linkillä</option><option value=1>Lähetä kutsu sähköpostitse</option></select>")+"<hr />",t+="<div id=emailInviteDiv style=display:none>"+format('Kutsu joku asentamaan verkkoagentti. Lähetettävä sähköposti ja linkki verkkoagenttiasennukseen laiteryhmälle "{0}".',EscapeHtml(n.name))+"<br /><br />",t+=addHtmlFormFloating("Nimi (valinnainen)",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'),t+=addHtmlFormFloating("Sähköposti",'<input id=agentInviteEmail placeholder="matti.meikäläinen@sahkoposti.fi" class="form-control" onkeyup=validateAgentInvite() />'),t+=addHtmlFormFloating("Käyttöjärjestelmä","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Lähetä asennus linkki</option><option value=0 selected>Kaikki tuetut</option><option value=1>Vain Windows</option><option value=3>Vain Apple macOS</option><option value=2>Vain Linux</option><option value=5>MeshCentral Assistant</option></select>"),t+="<div id=d2agentexpirediv>",t+=addHtmlFormFloating("Linkin vanheneminen","<select id=agentInviteExpire class=form-select><option value=1>1 tunti</option><option value=8>8 tuntia</option><option value=24>1 päivä</option><option value=168>1 viikko</option><option value=5040>1 kuukausi</option><option value=0>Rajoittamaton</option></select>"),t+="</div>",t+="<div id=d2agentInstallTypeDiv2>",t+=addHtmlFormFloating("Asennustyyppi","<select id=agentInviteType class=form-select><option value=0>Tausta ja vuorovaikutteinen</option><option value=2>Vain tausta</option><option value=1>Vain interaktiivinen</option></select>"),t+="</div>",t+=addHtmlFormFloating("Viesti (valinnainen)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>'),t+="</div>"),t+="<div id=urlInviteDiv>"+format('Kutsu joku asentamaan verkkoagentti jakamalla kutsulinkki. Tämä linkki ohjaa käyttäjän "{0}" laiteryhmän asennusohjeisiin. Linkki on julkinen, eikä tälle palvelimelle tarvita tiliä.',EscapeHtml(n.name))+"<br /><br />",t+=addHtmlFormFloating("Linkin vanheneminen","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 tunti</option><option value=8>8 tuntia</option><option value=24>1 päivä</option><option value=168>1 viikko</option><option value=5040>1 kuukausi</option><option value=0>Rajoittamaton</option></select>"),t+=addHtmlFormFloating("Agentit","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Kaikki käytettävissä olevat edustajat</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option><option value=16>Android MeshAgent</option></select>"),t+="<div id=d2agentInstallTypeDiv>",t+=addHtmlFormFloating("Asennustyyppi","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Tausta ja vuorovaikutteinen</option><option value=2>Vain tausta</option><option value=1>Vain interaktiivinen</option></select>"),t+="</div>",xxdialogTag=e,setModalContent("xxAddAgent","Kutsu",t+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Kopioi linkki leikepöydälle" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),64&features?(Q("d2InviteType").focus(),d2ChangedInviteType()):(Q("d2inviteExpire").focus(),validateAgentInvite()),d2RequestInvitationLink(),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],n="",i="",a="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Linux / BSD / macOS -binaariasennusohjelma</option><option value=2>Apple macOS</option>";2&features||(a+="<option value=6>Mobiililaite</option>"),a+="<option value=7>MeshCentral Assistant</option>",n+=addHtmlFormFloating("Käyttöjärjestelmä",a+="<option value=3>Windows (Poista asennus)</option><option value=4>Linux / BSD (Asennuksen poisto)</option><option value=8>Apple macOS (UnInstall)</option></select>");var o=serverinfo.name;(-1==o.indexOf(".")||2&features)&&(o=window.location.hostname);var s=domainUrl.substring(0,domainUrl.length-1),l="";l=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port;var r=[6,5,10005,25,26,28,30,32,36,37,40,41,45,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",45:"RISC-V 64bit",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(var u in r)i+='<option value="'+r[u]+'">'+d[r[u]]+"</option>";n+='<div id="aginsSysTypeDiv">',n+=addHtmlFormFloating("Järjestelmän tyyppi",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+i+"</select>"),n+="</div>",n+='<div id="aginsTypeDiv">',n+=addHtmlFormFloating("Asennustyyppi",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Tausta & vuorovaikutteinen</option><option value="2">Vain tausta</option><option value="1">Vain interaktiivinen</option></select>'),n+='</div><div id="asinsTypeDiv">',n+=addHtmlFormFloating("Asennustyyppi",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Sovellus, Yhdistä käyttäjän pyynnöstä</option><option value="3">Sovellus, aina yhteydessä</option><option value="0">Järjestelmälokero, yhdistä käyttäjän pyynnöstä</option><option value="1">Järjestelmälokero, aina kytketty</option><option value="4">Järjestelmälokero, vain näyttö</option></select>'),n+="</div><hr>";var c=t.name;return c=c.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join(""),n+="<div id=agins_windows>"+format('Jos haluat lisätä uuden tietokoneen laiteryhmään "{0}", lataa verkkoagentti ja asenna se tietokone hallittavaksi. Tällä agentilla on palvelimen ja laiteryhmän tietoja.',EscapeHtml(t.name))+"<br /><br />",n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),debugmode>0&&(n+=addHtmlValue("Asetukset-tiedosto",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} asetukset (.msh)",EscapeHtml(t.name))+"</a>")),n+="</div>",n+="<div id=agins_linux style=display:none>"+format('Lisää tietokone "{0}" suorittamalla seuraava komento. Tarvitaan juuretunnuksia.',EscapeHtml(t.name))+"<br />",n+="<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>",n+='<div style=font-size:x-small;float:right>* BSDtä käyttäessa suorita ensin "pkg install wget sudo bash"</div><a style=text-decoration:none title="Kopioi leikepöydälle" onclick=copyAgentIdValue("agins_linux_area")>Kopioi <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',n+="<div id=agins_osx style=display:none>"+format('Jos haluat lisätä uuden tietokoneen laiteryhmään "{0}", lataa verkkoagentti ja asenna se tietokone hallittavaksi. Tämä agentti-asennusohjelma sisältää palvelimen ja laiteryhmän tiedot.',EscapeHtml(t.name))+"<br /><br />",n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64-bittinen</a> <i class="fa-regular fa-clipboard" title="Kopioi macOS-agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64-bittinen)</a> <i class="fa-regular fa-clipboard" title="Kopioi macOS-agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <i class="fa-regular fa-clipboard" title="Kopioi macOS-agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+="</div>",n+='<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Jos haluat lisätä mobiililaitteen ryhmään "{0}", lataa MeshAgent -sovellus ja skannaa tämä QR -koodi.',EscapeHtml(t.name))+"</div>",n+="<table style=width:180px>",n+='<tr><td style=text-align:center><a title="Google Play Kauppa"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>',n+='<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>',n+="</table>",n+=addHtmlValue("Android APK",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Kopioi URL -osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'),n+="</div>",n+="<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('MeshCentral Assistant on Windows -työkalu, jonka avulla käyttäjät voivat pyytää apua. Lataa alla olevasta linkistä versio, joka muodostaa yhteyden laiteryhmään "{0}".',EscapeHtml(t.name))+"</div><div></div><br />",n+='<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant Windowsille">Assistant Windowsille (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopioi URL -osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',n+='</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>',n+="<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>MeshCentral Assistant on Windows -työkalu, jonka avulla käyttäjät voivat pyytää apua. Käytä alla olevaa linkkiä ladataksesi version, joka seuraa taustaagenttia.</div><div></div><br />",n+='<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant Windowsille">Assistant Windowsille (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopioi URL -osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',n+='</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>',n+='<div id=agins_windows_un style=display:none>Voit poistaa verkkoagentin lataamalla alla olevan tiedoston, suorittamalla sen ja napsauttamalla "Poista ".<br /><br />',n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+="</div>",n+="<div id=agins_linux_un style=display:none>Poista verkkoagentti suorittamalla seuraava komento. Tarvitaan juuretunnuksia.<br />",n+="<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>",n+='<a style=text-decoration:none title="Kopioi leikepöydälle" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',n+='<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />',n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Kopioi macOS-agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),n+="</div>",n+="<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />",n+=addHtmlValue("Mesh Agentti",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">meshagent</a> <i class="fa-regular fa-clipboard" title="Kopioi agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),n+=addHtmlValue('Komento&nbsp;<i class="fa-regular fa-clipboard" title="Kopioi agentin URL-osoite leikepöydälle" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(2147483648&features?" --no-check-certificate":"")+' "https://'+o+l+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"]),setModalContent("xxAddAgent","Lisää Mesh Agent",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),8192&features?(Q("agins_linux_area").value='wget "https://'+o+l+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+o+l+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+o+l+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+o+l+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+o+l+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+o+l+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='(wget "https://'+o+l+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+o+l+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+o+l+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+o+l+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+o+l+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+o+l+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+o+l+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+o+l+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick(),!1}function setModalContent(e,t,n,i=null){var a=document.getElementById("xxAddAgentModalConf"),o=document.getElementById(e+"Title");if(a&&o){if(o.innerHTML=t,"number"==typeof n){for(var s=1;s<24;s++)QV("dialog"+s,s==n);xxdialogMode=s}else if("string"==typeof n){Q("dialog2").innerHTML=n;for(s=1;s<24;s++)QV("dialog"+s,2==s);xxdialogMode=2}if(i)switch(a.classList.remove("modal-sm","modal-lg","modal-xl"),i){case"small":a.classList.add("modal-sm");break;case"large":a.classList.add("modal-lg");break;case"extra-large":a.classList.add("modal-xl")}else a.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(e,t,n,i=null,a=null){if(null==xxModal){["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(e));var o=function(t){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(e).removeEventListener("hidden.bs.modal",o)};document.getElementById(e).addEventListener("hidden.bs.modal",o)}xxModal.show(),document.getElementById(t).onclick=function(){"function"==typeof n&&n?(xxdialogMode=0,!1!==n(i,a)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,n,i,a,o,s,l){Swal.fire({position:e,title:t,text:n,icon:i,confirmButtonText:a,timer:o,width:s,showConfirmButton:null!==a})}function copyAgentUrl(e,t){var n=serverinfo.name;(-1==n.indexOf(".")||2&features)&&(n=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var i="https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e;1==t&&(i+=Q("aginsType").value),i+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(i+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(i+="&ac="+Q("asinsType").value),copyTextToClip(i)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},debugmode>0&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",Q("asinsType").value>=2))}function validateDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var n=Q("dp1username").value;""==n&&(n="admin");var i=Q("dp1hostname").value;""==i&&(i=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:i,amtusername:n,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0!=deviceHeaderId?(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 solmu":format("{0} solmua",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0):deviceHeaderId=1}var powerStateStrings=["",'<span title="Laite on päällä.">Käynnissä</span>','<span title="Laite on lepotilassa (S1).">Nukkumassa</span>','<span title="Laite on lepotilassa (S2).">Nukkumassa</span>','<span title="Laite on syvän unen tilassa (S3).">Syvä lepotila</span>','<span title="Laite on horros tilassa (S4).">Horroksessa</span>','<span title="Laite on pois päältä-tilassa (S5).">Pehmeä pois päältä</span>','<span title="Laite havaitaan, mutta virran tilaa ei voitu saada.">Läsnä</span>','<span title="Laitteen virta on katkaistu.">Vinossa</span>'],powerStateStrings2=["","Laite saa virtaa","Laite on lepotilassa (S1)","Laite on lepotilassa (S2)","Laite on syvän unen tilassa (S3)","Laite on horroksessa (S4)","Laite on pois päältä-tilassa (S5)","Laite on läsnä, mutta virran tilaa ei voida määrittää","Laitteesta on katkaistu virta"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return e.state>0&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(1&e.conn&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="Virtakytkin on käyttövalmis.">Vaihtaa</span>'):t.push('<span title="IP-KVM-portti on valmis ja valmis käytettäväksi.">IP-KVM</span>'):t.push('<span title="Mesh agentti on yhdistetty ja käyttövalmis.">Agentti</span>')),2&e.conn?t.push('<span title="Intel&reg; AMT CIRA yhdistetty ja valmis käytettäväksi.">CIRA</span>'):4&e.conn&&t.push('<span title="Intel&reg; AMT on reititettävä.">AMT</span>'),8&e.conn&&t.push('<span title="Verkkoagentti on tavoitettavissa käyttämällä toista ainetta releenä.">Rele</span>'),16&e.conn&&t.push('<span title="MQTT-yhteys laitteeseen on aktiivinen.">MQTT</span>')),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Tuntematon"}function updateCollapseAllButton(){var e=Object.keys(CollapsedGroups).length>0;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,n=0;n<e.length;n++)e[n].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};var i=document.getElementsByName("xxdevice"+Q("viewselect").value);for(n=0;n<i.length;n++)(null==i[n].parentElement.attributes.style||i[n].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[i[n].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(e>0?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Poista valinta",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Valitse kaikki",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,e>=1)}function groupActionFunction(){var e=[],t=getCheckedDevices(),n=0;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Tilin Turvallisuus",'Tätä ominaisuutta ei voi käyttää, ennen kuin kaksivaiheinen todennus on käytössä. Tätä tarvitaan ylimääräisen turvallisuuden takaamiseksi. Siirry "Oma tili" -välilehdelle ja katso "Tilin suojaus" -osio.'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(4194304&features)for(var i in t)if(16&getNodeFromId(t[i]).conn){e.push({v:103,name:"Lähetä MQTT Viesti"});break}for(var i in e.push({v:105,name:"Vie laitetiedot",s:!0}),t){var a=getNodeFromId(t[i]),o=GetNodeRights(a);1&o&&!(2&n)&&(n|=2,e.push({v:102,name:"Siirrä laiteryhmään"})),1&a.conn&&32768&o&&!(1&n)&&(n|=1,e.push({v:104,name:"Agentin asennuksen poistaminen"})),64&o&&!(8&n)&&(n|=8,e.push({v:100,name:"Herätä laitteet"})),262144&o&&!(4&n)&&(n|=4,e.push({v:4,name:"Lepotilat"}),e.push({v:3,name:"Nollaa laitteet"}),e.push({v:2,name:"Sammuta laitteet"})),131072&o&&!(16&n)&&(n|=16,e.push({v:106,name:"Suorita komentoja"})),16384&o&&!(32&n)&&(n|=32,e.push({v:108,name:"Laite-ilmoitus"})),4&o&&!(64&n)&&(n|=64,e.push({v:107,name:"Muokkaa tunnisteita"})),8&o&&!(256&n)&&(n|=256,e.push({v:109,name:"Lähetä tiedostoja"})),32768&o&&!(128&n)&&(n|=128,e.push({v:101,name:"Poista laitteet"})),null!=a.agent&&16&features2&&4294967295==o&&!(512&n)&&(n|=512,e.push({v:110,name:"Pakota agenttipäivitys"}),e.push({v:111,name:"Kirkas agenttiydin"}),e.push({v:112,name:"Lähetä palvelimen oletusydin"}))}var s="";for(var i in e.sort(nameSort),e)s+="<option value="+e[i].v+(e[i].s?" selected":"")+">"+e[i].name+"</option>";var l="Valitse suoritettava toiminto kaikille valituille laitteille. Toiminnot suoritetaan vain oikeilla oikeuksilla.<br /><br />";setModalContent("xxAddAgent","Ryhmätoiminta",l+=addHtmlFormFloating("Operaatio",'<select id=d2groupop class="form-select">'+s+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(u=getCheckedDevices()).length)return;if(1==u.length)t+="Vahvistetaanko valitun laitteen poisto?<br /><br />";else{t+=format("Vahvistetaanko {0} valitun laitteen poisto?<br />",u.length);var n=0,i=0;for(var a in u){null!=(c=getNodeFromId(u[a])).conn&&c.conn>0?n++:i++}var o="";1==n?o+=format("1 valittu laite on verkossa.<br />",n):n>1&&(o+=format("{0} valittua laitetta on verkossa.<br />",n)),1==i?o+=format("1 valittu laite on offline -tilassa.<br />",i):i>1&&(o+=format("{0} valittua laitetta on offline -tilassa.<br />",i)),t+=""!=o?"<div style=padding:8px>"+o+"</div>":"<br />"}setModalContent("xxAddAgent","Poista laitteet",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />Varmista</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Suorita komentoja valituilla laitteilla.",func:uncheckAllDevices});else if(107==e){t="Suorita erälaitetunniste<br /><br />";t+=addHtmlFormFloating("Operaatio",'<select id=d2deviceop class="form-select"><option value=1>Lisää tageja</option><option value=2>Aseta tunnisteet</option><option value=3>Poista tunnisteet</option></select>'),t+=addHtmlFormFloating("Tunnisteet",'<select id=dp10devicevalue multiple class="form-control" maxlength=4096>');var s=[];o="";for(var a in nodes)if(nodes[a].tags)for(var l in nodes[a].tags)-1==s.indexOf(nodes[a].tags[l])&&s.push(nodes[a].tags[l]);if(s.length>0)for(var a in s.sort(),s){EscapeHtml(s[a]);o+="<option>"+EscapeHtml(s[a])+"</option>"}setModalContent("xxAddAgent","Muokkaa laitetunnisteita",t+=o+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:"Tag1, Tag2, Tag3",closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0}),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){t="<div style=margin-bottom:4px>Suorita erälaite-ilmoitus</div>";t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Toast-ilmoitus</option><option value=1>Viestilaatikko</option><option value=3>Alert Box</option></select>',t+='<input id=dp2notifyTitle maxlength=256 placeholder="Otsikko" style=width:100%;box-sizing:border-box;margin-bottom:4px />',t+="<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>",t+="<select style=width:100% id=d2notifyTimeout>",t+='<option disabled value="">Only Applicable to Message Box Notifications</option>',t+="<option value=2 selected>Show for 2 Minutes (Default)</option>",t+="<option value=10>Show for 10 minutes</option>",t+="<option value=30>Show for 30 minutes</option>",t+="<option value=60>Show for 60 minutes</option>",t+="<option value=0>Näytä viesti, kunnes käyttäjä hylkäsi sen</option>",setModalContent("xxAddAgent","Laiteilmoitus",t+="</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var r=!1,d=!1,u=getCheckedDevices();for(var a in u){var c;(c=getNodeFromId(u[a])).agent&&(c.agent.id>0&&c.agent.id<5||34==c.agent.id?r=!0:d=!0)}t="Lähetä valitut tiedostot kaikkiin valittuihin laitteisiin<br /><br />";t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>",t+="<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+u.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />",t+='<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',r&&(t+=addHtmlFormFloating("Windowsin polku",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),d&&(t+=addHtmlFormFloating("Linux-polku",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),t+='<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />Luo kansio, jos sitä ei ole olemassa?</label><br />',setModalContent("xxAddAgent","Erätiedoston lataus",t+='<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />Korvataanko tiedosto olemassa?</label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e){setModalContent("xxAddAgent","Pakota agenttipäivitys",t="Pakotetaanko agenttipäivitys valituille laitteille?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec())}else if(111==e){setModalContent("xxAddAgent","Kirkas agenttiydin",t="Tyhjennätkö agentin ytimen valituilla laitteilla?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec())}else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent","Lähetä palvelimen oletusydin",t="Lähetetäänkö oletuspalvelinydin valituille laitteille?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,i=getCheckedDevices(),a=parseFloat(Q("d2notifyTimeout").value);if(0!=n.length)if(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(a)&&(a=2),1==e)for(var o=0;o<i.length;o++)meshserver.send({action:"msg",type:"messagebox",nodeid:i[o],title:t,msg:n,timeout:6e4*a});else if(2==e)meshserver.send({action:"toast",nodeids:i,title:t,msg:n});else if(3==e)for(o=0;o<i.length;o++)meshserver.send({action:"msg",type:"alertbox",nodeid:i[o],title:t,msg:n})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,n=[],i=$("#dp10devicevalue").select2("data");for(var a in i)n.push(i[a].text.trim());if(2==t)for(var a in e)meshserver.send({action:"changedevice",nodeid:e[a],tags:n.join(",")});else{var o=[];for(var a in n){var s=n[a].trim();s.length>0&&s.length<64&&-1==o.indexOf(s)&&o.push(s)}for(var a in e){var l=null,r=!1,d=getNodeFromId(e[a]);null!=d.tags&&(l=Clone(d.tags)),null==l&&(l=[]);for(var u=0;u<n.length;u++)if(1==t&&-1==l.indexOf(n[u])&&(l.push(n[u]),r=!0),3==t){var c=l.indexOf(n[u]);c>=0&&(l.splice(c,1),r=!0)}r&&meshserver.send({action:"changedevice",nodeid:e[a],tags:l.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e=getCheckedDevices(),t=!1;for(var n in e)null!=getNodeFromId(e[n]).intelamt&&(t=!0);var i="Lataa luettelo laitteista, jollakin alla olevista tiedostomuodoista.<br /><br />";i+=addHtmlValue("CSV muoto","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"),i+=addHtmlValue("JSON Muoto","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>"),t&&(i+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Laitetietojen vienti",i+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Sisällytä laitteen tiedot</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var n="id,nimi,rname,isäntä,kuvake,ip,osdesc,tila,ryhmänimi,conn,pwr,av,päivitys,palomuuri,bitlocker,avdetails,tags,lastbootuptime\r\n";for(var i in e){var a=getNodeFromId(e[i]);if(n+='"'+a._id.split(",").join("")+'","'+a.name.split(",").join("")+'","'+(a.rname?a.rname.split(",").join(""):"")+'","'+(a.host?a.host.split(",").join(""):"")+'","'+a.icon+'","'+(a.ip?a.ip:"")+'","'+(a.osdesc?a.osdesc.split(",").join(""):"")+'","'+a.state+'","'+meshes[a.meshid].name.split(",").join("")+'","'+(a.conn?a.conn:"")+'","'+(a.pwr?a.pwr:"")+'"',"object"==typeof a.wsc?n+=',"'+csvClean(a.wsc.antiVirus)+'","'+csvClean(a.wsc.autoUpdate)+'","'+csvClean(a.wsc.firewall)+'"':n+=",,,","object"==typeof a.volumes){var o="",s=!0;for(var l in a.volumes)void 0!==a.volumes[l].protectionStatus&&(s?s=!1:o+="|",o+=l+"/"+a.volumes[l].volumeStatus);n+=',"'+csvClean(o)+'"'}else n+=",";if("object"==typeof a.av){var r="",d=!0;for(var l in a.av)"string"==typeof a.av[l].product&&(d?d=!1:r+="|",r+=a.av[l].product+"/"+(a.av[l].enabled?"enabled":"disabled")+"/"+(a.av[l].updated?"updated":"notupdated"));n+=',"'+csvClean(r)+'"'}else n+=",";if("object"==typeof a.tags){var u="",c=!0;for(var l in a.tags)c?c=!1:u+="|",u+=a.tags[l];n+=',"'+csvClean(u)+'"'}else n+=",";"number"==typeof a.lastbootuptime&&(n+=',"'+a.lastbootuptime+'"'),n+="\r\n"}saveAs(stringToUtf8Blob(n),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e=getCheckedDevices(),t={webappversion:"0.9.0",computers:[]};for(var n in e){var i=getNodeFromId(e[n]);if(null!=i.intelamt){var a={name:i.name,host:i.host,user:i.intelamt.user,pass:"",tls:1==i.intelamt.tls?1:0,ver:i.intelamt.ver,pstate:i.intelamt.state};2==i.intelamt.state&&(a.pmode=1),i.intelamt.realm&&(a.digestrealm=i.intelamt.realm),i.intelamt.hash&&(a.tlscerthash=i.intelamt.hash),t.computers.push(a)}}saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var n=[];for(var i in e)n.push(getNodeFromId(e[i]));saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t=!1,n=!1,i=!1;for(var a in e.nodeids){var o=getNodeFromId(e.nodeids[a]);o.agent&&(24&~GetNodeRights(o)||(i=!0),o.agent.id>0&&o.agent.id<5?t=!0:n=!0)}if(1==t||1==n||1==i){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}if(e.selectedFile){var l=e.selectedFile.name.toLowerCase();console.log("filename",l),l.endsWith(".bat")&&(s.type=1),l.endsWith(".ps1")&&(s.type=2),l.endsWith(".sh")&&(s.type=3),l.endsWith(".agentconsole")&&(s.type=4)}var r="";e.title&&(r+=e.title+"<br />"),r+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==t&&(r+="<option value=1"+(1==s.type?" selected":"")+">Windowsin komentohehote</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==n&&(r+="<option value=3"+(3==s.type?" selected":"")+">Linux/BSD/macOS komentokehote</option>"),1==i&&(r+="<option value=4"+(4==s.type?" selected":"")+">Agentin konsoli</option>"),r+="</select>",r+="<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.runAs?" selected":"")+">Suorita agenttina</option><option value=1"+(1==s.runAs?" selected":"")+">Suorita käyttäjänä, agenttina, jos ei käyttäjää</option><option value=2"+(2==s.runAs?" selected":"")+">On suoritettava käyttäjänä</option></select>",null==e.selectedFile&&(r+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.source?" selected":"")+">Commands from text box</option><option value=1"+(1==s.source?" selected":"")+">Commands from file</option>",8&userinfo.siteadmin&&(r+="<option value=2"+(2==s.source?" selected":"")+">Commands from file on server</option>"),r+="</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):"")+"</textarea>",r+='<div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin&&(r+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>')),xxdialogTag=e,setModalContent("xxAddAgent","Suorita Komentoja",r),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles())),d2runCommandValidate()}}function d2runCommandValidate(){if(QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile){QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value);var e=!1;0==Q("d2cmdsource").value&&Q("d2runcmd").value.length>0&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)}else QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var n=3;try{n=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:n,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var i={action:"runcommands",nodeids:t.nodeids,type:n,runAsUser:parseInt(Q("d2cmduser").value)};if(t.selectedFile)(a=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},a.readAsText(t.selectedFile);else if(0==Q("d2cmdsource").value)i.cmds=Q("d2runcmd").value,meshserver.send(i),t.func&&t.func();else if(1==Q("d2cmdsource").value){var a;(a=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},a.readAsText(Q("d2runfileex").files[0])}else if(2==Q("d2cmdsource").value){var o=d3getFileSel();if(1!=o.length)return;i.cmdpath=d3filetreelocation.join("/")+"/"+o[0],meshserver.send(i),t.func&&t.func()}}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){var n=e.name.toLowerCase(),i=t.name.toLowerCase();return sortCollator.compare(n,i)}function meshSort(e,t){var n=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=n||0!=(n=sortCollator.compare(e.meshid,t.meshid))?n:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var n=e.pwr?e.pwr:0,i=t.pwr?t.pwr:0;return n>i?-1:n<i?1:n==i?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var n=e.lastconnect,i=t.lastconnect;return null==n&&(n=99999999999999),null==i&&(i=99999999999999),e.conn>0&&(n=99999999999998),t.conn>0&&(i=99999999999998),n==i?nameSort(e,t):n-i}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t=e.split(" ja "),n=null;for(var i in t){var a=getDevicesThatMatchFilter(t[i]);if(null==n)n=a;else{var o=[];for(var s in a)n.indexOf(a[s])>=0&&o.push(a[s]);n=o}}return n}function parseSearchOrInput(e){var t=e.split(" tai "),n=null;for(var i in t){var a=parseSearchAndInput(t[i]);if(null==n)n=a;else for(var o in a)n.indexOf(a[o]>=0)&&n.push(a[o])}return n}function getDevicesThatMatchFilter(e){var t=[],n=null,i=null,a=null,o=null,s=null,l=null,r=null,d=null,u=null,c=null;if(e.startsWith("käyttäjä:".toLowerCase())?n=e.substring(9):e.startsWith("u:".toLowerCase())?n=e.substring(2):e.startsWith("ip:".toLowerCase())?i=e.substring(3):e.startsWith("ryhmä:".toLowerCase())?a=e.substring(6):e.startsWith("g:".toLowerCase())?a=e.substring(2):e.startsWith("tag:".toLowerCase())?o=e.substring(4):e.startsWith("t:".toLowerCase())?o=e.substring(2):e.startsWith("atag:".toLowerCase())?s=e.substring(5):e.startsWith("a:".toLowerCase())?s=e.substring(2):e.startsWith("os:".toLowerCase())?r=e.substring(3):e.startsWith("amt:".toLowerCase())?d=e.substring(4):e.startsWith("kuvaus:".toLowerCase())?u=e.substring(7):e.startsWith("connectivity:".toLowerCase())?c=e.substring(13):e.startsWith("c:".toLowerCase())?c=e.substring(2):"wsc:ok"==e?l=1:"wsc:noav"==e?l=2:"wsc:noupdate"==e?l=3:"wsc:nofirewall"==e?l=4:"wsc:any"==e&&(l=5),""==e)for(var p in nodes)t.push(p);else if(null!=i)for(var p in nodes)null!=nodes[p].ip&&nodes[p].ip.toLowerCase().indexOf(i)>=0&&t.push(p);else if(null!=a)for(var p in nodes)meshes[nodes[p].meshid].name.toLowerCase().indexOf(a)>=0&&t.push(p);else if(null!=o){for(var p in nodes)if(null==nodes[p].tags&&""==o)t.push(p);else if(null!=nodes[p].tags)for(var m in nodes[p].tags)if(nodes[p].tags[m].toLowerCase().indexOf(o)>=0){t.push(p);break}}else if(null!=s)for(var p in nodes)(null!=nodes[p].agent&&null==nodes[p].agent.tag&&""==s||null!=nodes[p].agent&&null!=nodes[p].agent.tag&&nodes[p].agent.tag.toLowerCase().indexOf(s)>=0)&&t.push(p);else if(null!=n){for(var p in nodes)if(nodes[p].users&&nodes[p].users.length>0)for(var g in nodes[p].users)nodes[p].users[g].toLowerCase().indexOf(n)>=0&&t.push(p)}else if(null!=r)for(var p in nodes)null!=nodes[p].osdesc&&nodes[p].osdesc.toLowerCase().indexOf(r)>=0&&t.push(p);else if(null!=d)for(var p in nodes)null==nodes[p].intelamt||""!=d&&nodes[p].intelamt.state!=d||t.push(p);else if(null!=u)for(var p in nodes)null!=nodes[p].desc&&""!=nodes[p].desc&&(""==u||nodes[p].desc.toLowerCase().indexOf(u)>=0)&&t.push(p);else if(null!=l)for(var p in nodes)nodes[p].wsc&&(1==l&&"OK"==nodes[p].wsc.antiVirus&&"OK"==nodes[p].wsc.autoUpdate&&"OK"==nodes[p].wsc.firewall?t.push(p):(2!=l&&5!=l||"OK"==nodes[p].wsc.antiVirus)&&(3!=l&&5!=l||"OK"==nodes[p].wsc.autoUpdate)&&(4!=l&&5!=l||"OK"==nodes[p].wsc.firewall)||t.push(p));else if(null!=c){for(var p in nodes)if(nodes[p].conn&&(1&nodes[p].conn&&(4==nodes[p].mtype?("PDU"==nodes[p].porttype&&"switch"==c.toLowerCase()||"ipkvm"==c.toLowerCase())&&t.push(p):"agent"==c.toLowerCase()&&t.push(p)),(2&nodes[p].conn&&"cira"==c.toLowerCase()||4&nodes[p].conn&&"amt"==c.toLowerCase())&&t.push(p),8&nodes[p].conn&&"relay"==c.toLowerCase()&&t.push(p),16&nodes[p].conn&&"mqtt"==c.toLowerCase()&&t.push(p)),3==nodes[p].mtype){var v=meshes[nodes[p].meshid];(v&&v.relayid&&"relay"==c.toLowerCase()||v&&void 0===v.relayid&&"local"==c.toLowerCase())&&t.push(p)}}else if("*"==e)for(var p in nodes)1==stars[nodes[p]._id]&&t.push(p);else try{var h=e.split(/\s+/).join("|"),f=new RegExp(h);for(var p in nodes)32768&features2?268435456&features2?(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):268435456&features2?showRealNames?(null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):showRealNames?null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())&&t.push(p):f.test(nodes[p].name.toLowerCase())&&t.push(p)}catch(e){for(var p in nodes)t.push(p)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim();putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e);var t=parseSearchOrInput(e);for(var n in nodes)nodes[n].v=t.indexOf(n)>=0;var i=Q("DevFilterSelect").value;if(1==i)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn||3==nodes[n].mtype||(nodes[n].v=!1);if(2==i)for(var n in nodes){(null==(a=nodes[n]).sessions||null==a.sessions.kvm&&null==a.sessions.terminal&&null==a.sessions.files&&null==a.sessions.tcp&&null==a.sessions.udp)&&(a.v=!1)}if(3==i)for(var n in nodes)1!=stars[nodes[n]._id]&&(nodes[n].v=!1);if(4==i)for(var n in nodes)null==nodes[n].intelamt&&(nodes[n].v=!1);if(5==i)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn&&(nodes[n].v=!1);if(6==i)for(var n in nodes){null!=(a=nodes[n]).sessions&&null!=a.sessions.help||(a.v=!1)}if(7==i)for(var n in nodes){null!=(a=nodes[n]).tags&&0!=a.tags.length||(a.v=!1)}if(8==i)for(var n in nodes){var a;null!=(a=nodes[n]).tags&&a.tags.length>0&&(a.v=!1)}}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(serverinfo.linuxshell&&currentNode.agent.id>4)return;var n=e.target.nextElementSibling;if(n)for(var i=n.children,a=currentNode.agent.id>4&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,o=0;o<i.length;o++)i[o].style.display=a?i[o].classList.contains(a)?"block":"none":i[o].classList.contains("lin")||i[o].classList.contains("ass")?"none":"block"}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,i=document.elementFromPoint(e.pageX-t,e.pageY-n);i&&null!=i&&null==i.attributes.cmenu;)i=i.parentElement;if(null==i)return!0;var a=i.attributes.cmenu.value;if("devsContentMenu"===a){contextelement=i;var o,s=document.getElementById("contextMenu");showContextMenuDiv(s,e.pageX,e.pageY);var l=getNodeFromId((o=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,o.length-18)),r=GetNodeRights(l),d=!!(16&r),u=4294967295==r||!(65536&r),c=4294967295==r||!(512&r),p=4294967295==r||!(1024&r);QV("cxdesktop",!!(1&l.conn)&&4!=l.mtype&&(1==l.mtype||null==l.agent||null==l.agent.caps||!!(1&l.agent.caps)||l.intelamt&&2==l.intelamt.state)&&(8&r||256&r)&&u),QV("cxterminal",!!(1&l.conn)&&4!=l.mtype&&(1==l.mtype||null==l.agent||null==l.agent.caps||!!(2&l.agent.caps)||l.intelamt&&2==l.intelamt.state)&&8&r&&c),QV("cxfiles",4!=l.mtype&&2==l.mtype&&(null==l.agent||null==l.agent.caps||!!(4&l.agent.caps))&&8&r&&p),QV("cxevents",null!=l.intelamt&&(2==l.intelamt.state||2&l.conn)&&8&r),QV("cxdetails",l.mtype<3),QV("cxwebvnc",(!!(1&l.conn)||3==l.mtype)&&l.agent&&!!(8&r)&&!(536870912&features)),QV("cxwebrdp",(!!(1&l.conn)||3==l.mtype)&&l.agent&&!!(8&r)&&!(1073741824&features)),QV("cxwebssh",512&features2&&(!!(1&l.conn)||3==l.mtype)&&l.agent&&!!(8&r)),QV("cxconsole",d&&2==l.mtype&&(null==l.agent||null==l.agent.caps||!!(8&l.agent.caps))&&8&r),QV("cxrdp",!1),(1&l.conn||3==l.mtype)&&l.agent&&8&r&&l.agent.id>0&&l.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(s=document.getElementById(a)))return!0;contextelement=i,showContextMenuDiv(s,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,n){var i=document.documentElement.getBoundingClientRect(),a=i.height,o=i.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,t>o/2?e.style.right=o-event.pageX+"px":e.style.left=event.pageX+"px",n>a/2?e.style.bottom=a-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var n;if(n=(n=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,n.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),e>0&&e<9){var i=[0,10,12,11,13,16,17,15,19][e];if(t&&1==t.shiftKey)safeNewWindow(window.location.origin+"?node="+n.split("/")[2]+"&viewmode="+i+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+n);else{gotoDevice(n,i);var a=meshes[currentNode.meshid];1&currentNode.conn&&2==a.mtype&&(11==i&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==i&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==i&&null==files&&connectFiles(null))}}if(10==e){for(var o=document.getElementsByClassName("DeviceCheckbox"),s=[],l=0;l<o.length;l++)!0===o[l].checked&&s.push(o[l].defaultValue.substring(6));for(var l in 0==s.length&&s.push(n),s)null!=stars[s[l]]&&(delete stars[s[l]],delete s[l]);var r=Object.keys(stars).length;for(var l in s)r<200&&null==stars[s[l]]&&(stars[s[l]]=1,r++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(n),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(n):12==e?p10rfb(n):13==e?p10ssh(n):14==e&&p10MCRouter(n,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),n=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var i=0;i<n.length;i++)n[i].attributes&&n[i].attributes.class.value.split(" ")[0]==t&&(n[i].checked=1==e);if(1==e)for(var i in nodes)nodes[i].meshid==t&&1==nodes[i].v&&(checkedNodeids[nodes[i]._id]=1);else if(2==e)for(var i in checkedNodeids){var a=getNodeFromId(i);null!=a&&a.meshid==t&&1==a.v&&delete checkedNodeids[i]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","RDP Yhteys",'RDP-etäyhteysportti:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rdpport").value.length>0?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport)}}function cmsshportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","SSH -yhteys",'SSH -etäyhteysportti:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10sshport").value.length>0?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport)}}function cmrfbportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","VNC -liitäntä",'VNC -etäyhteysportti:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rfbport").value.length>0?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport)}}function cmhttpportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","HTTP-yhteys",'HTTP-etäyhteysportti:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpport").value.length>0?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport)}}function cmhttpsportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","HTTPS-yhteys",'HTTPS-etäyhteysportti:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpsport").value.length>0?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport)}}function cmfilesaction(e){if(!xxdialogMode){var t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)];1==e?(setModalContent("xxAddAgent","Nimeä uudelleen",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Tiedostoeditori","Vain alle 200 kt: n tiedostoja voidaan muokata."):3==e&&(setModalContent("xxAddAgent","Poista","Poista kohde?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t)))}}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes){if((i=nodes[t]).tags)for(var n in i.tags)CollapsedGroups["tag:"+encodeURIComponentEx(i.tags[n])]=!0}if(4==sort)for(var t in CollapsedGroups={},nodes){var i=nodes[t],a=meshes[i.meshid];if(a){if(CollapsedGroups["tag:"+encodeURIComponentEx(a.name)]=!0,i.tags)for(var n in i.tags)CollapsedGroups["tag:"+encodeURIComponentEx(a.name+" - "+i.tags[n])]=!0}else if(i.tags)for(var n in i.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+i.tags[n])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(32768&features){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t=null;for(var n in nodes)try{var i=map_parseNodeLoc(nodes[n]),a=xxmap.markersSource.getFeatureById(nodes[n]._id);if(null==i||nodes[n].meshid!=e&&null!=e)a&&xxmap.markersSource.removeFeature(a);else{var o=i[0],s=i[1];i[2];null==t?t=[o,s,o,s,0]:(o<t[0]&&(t[0]=o),s<t[1]&&(t[1]=s),o>t[2]&&(t[2]=o),s>t[3]&&(t[3]=s)),null==a?(addFeature(nodes[n]),t[4]=1):(updateFeature(nodes[n],a),a.setStyle(markerStyle(nodes[n],i[2])))}}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[n]))}return t}}}function stringToIntHash(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}function map_parseNodeLoc(e){var t=null,n=0;return e.iploc&&(t=e.iploc,n=1),e.wifiloc&&(t=e.wifiloc,n=2),e.gpsloc&&(t=e.gpsloc,n=3),e.userloc&&(t=e.userloc,n=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==n?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,n]:[parseFloat(t[0]),parseFloat(t[1]),n])}function loadmap(){if(32768&features&&null!=xxmap)if(32768&features){QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){var n=t.getId();if(null!=n)gotoDevice(n,10);else gotoDevice(getCorrespondingFeature(t).getId(),10)}}),xxmap.map.on("pointermove",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){xxmap.map.getTargetElement().style.cursor="pointer";var n=t.getGeometry().getCoordinates();if(map_cm_popup.setPosition(n),t.getId())QH("xmap-info-window",t.get("name"));else{var i=getCorrespondingFeature(t);QH("xmap-info-window",i.get("name"))}}else xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window","")});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(xxmap.contextmenu.clear(),t)if(t.getId())addContextMenuItems(t);else{var n=getCorrespondingFeature(t);n?addContextMenuItems(n):xxmap.contextmenu.extend(contextmenu_items)}else xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}else xxmap=null}function addFeature(e,t,n){var i=getModifiedFeature(e._id);if(i)xxmap.markersSource.addFeature(i);else{if(!t&&!n){var a=map_parseNodeLoc(e);t=a[0],n=a[1]}if(n>180&&(n=180-n,meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,n]})),t<90&&t>-90&&n<180&&n>-180){var o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:n});o.setId(e._id),o.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(o)}}}function removeFeature(e){var t=xxmap.markersSource.getFeatureById(e._id);t&&xxmap.markersSource.removeFeature(t)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var n=map_parseNodeLoc(e);if(null!=n){var i=n[0],a=n[1];if(i!=t.get("lat")||a!=t.get("lon")){t.set("lat",i),t.set("lon",a);var o=ol.proj.transform([parseFloat(a),parseFloat(i)],"EPSG:4326","EPSG:3857");t.getGeometry().setCoordinates(o)}}e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t=e.getId();if(t&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),!getActiveInteractions(e))){var n=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10});xxmap.activeInteractions.push({featureid:t,feature:e,interaction:n}),xxmap.map.addInteraction(n)}}function saveMarkerloc(e){var t=e.getId();if(t){var n=getActiveInteractions(e);if(n){xxmap.map.removeInteraction(n),removeInteraction(t);var i=e.getGeometry().getCoordinates(),a=ol.proj.transform(i,"EPSG:3857","EPSG:4326");a[0]>180&&(a[0]=180-a[0]);var o=[a[1],a[0]];meshserver.send({action:"changedevice",nodeid:t,userloc:o})}}}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc&&(t=4));var n=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:n,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(e){getActiveInteractions(e)?(map_cm_saveMarker.data=e,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=e,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(e.a).userloc&&(map_cm_clearMarker.data=e,xxmap.contextmenu.push(map_cm_clearMarker)));map_cm_nodemenu_items.forEach(function(t){"Lähennä laajuutta"==t.text||"Loitonna laajuudessa"==t.text?t.data=e:"-"!=t&&(t.data=e.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid==t)return xxmap.activeInteractions[n].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid===e){t=n;break}t>=0&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),n=0;n<xxmap.activeInteractions.length;n++){var i=xxmap.activeInteractions[n].feature,a=i.getGeometry().getCoordinates();if(a[0].toFixed(5)==t[0].toFixed(5)&&a[1].toFixed(5)==t[1].toFixed(5))return i}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);var n=updateMapMarkers();if(null!=n&&(t||1==n[4])){var i=(n[0]+n[2])/2,a=(n[1]+n[3])/2,o=Math.max(Math.abs(n[0]-n[2]),Math.abs(n[1]-n[3])),s=xxmap.map.getView();s.setCenter(ol.proj.transform([a,i],"EPSG:4326","EPSG:3857"));for(var l=360,r=-2;l>o;)r++,l/=2;s.setZoom(r)}}function placeNode(e){if(!xxdialogMode){var t='<div style=margin-bottom:6px><label for=selectnode-search>Etsi</label>&nbsp&nbsp<input type=text placeholder="Laitteen nimi" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Laitteita ei löytynyt.</div>';for(var n in nodes)t+="<div class=noselect id="+nodes[n]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[n]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[n]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />',t+="<div class=j"+nodes[n].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[n].name+"</div></div>";setModalContent("xxAddAgent","Valitse sijoitettava solmu",t+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var n=document.getElementsByName("PlaceMapDeviceCheckbox");for(var i in n)if(n[i].checked){var a=getNodeFromId(n[i].id.substring(0,n[i].id.length-8));if(a){var o=xxmap.markersSource.getFeatureById(i),s=ol.proj.transform(t,"EPSG:3857","EPSG:4326"),l=[s[1],s[0]];if(o)o.getGeometry().setCoordinates(t),getActiveInteractions(o)?saveMarkerloc(o):meshserver.send({action:"changedevice",nodeid:a._id,userloc:l});else meshserver.send({action:"changedevice",nodeid:a._id,userloc:l})}}}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t=0;for(var n in nodes){var i=nodes[n].namel.indexOf(e)>=0||""==e||null!=nodes[n].rnamel&&nodes[n].rnamel.indexOf(e)>=0;i&&t++,QV(nodes[n]._id+"-rowid",i)}QV("noNodesMapPlace",0==t)}function selectNodeToPlace(e,t){if("PlaceMapDeviceCheckbox"!=e.target.name){var n=Q(t+"-checkid");n.checked=!n.checked}var i=document.getElementsByName("PlaceMapDeviceCheckbox"),a=0;for(var o in i)i[o].checked&&a++;QE("idx_dlgOkButton",a>0)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e=Q("mapSearchLocation").value.trim();if(e.length>0){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&formatSearchData(t.responseText)},t.open("GET","https://nominatim.openstreetmap.org/search?q="+e+"&format=json",!0),t.send()}}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),n=0,i='<div class="xmapItem">',a=0;a<t.length;a++)if(t[a].display_name&&t[a].boundingbox[0]&&t[a].boundingbox[1]&&t[a].boundingbox[2]&&t[a].boundingbox[3]){n++;i+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[a].display_name+"</div><div style=display:none>"+t[a].boundingbox[0]+"!#!"+t[a].boundingbox[1]+"!#!"+t[a].boundingbox[2]+"!#!"+t[a].boundingbox[3]+"</div></div>"}if(i+="</div>",1==n)zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]);else 0==n&&(i="<div style=width:200px>Sijaintia ei löytynyt.<div>"),QV("xmapSearchResultsDlg",!0);QH("xmapSearchResults",i)}catch(e){}}function mapGotoSelectedLocation(e){var t=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(t[2]),parseFloat(t[0]),parseFloat(t[3]),parseFloat(t[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var n=xxmap.map.getView();n.setCenter(e),n.setZoom(t)}function zoomToFitExtent(){if(xxmap.markersSource.getFeatures().length>0){var e=xxmap.markersSource.getExtent();xxmap.map.getView().fit(e,xxmap.map.getSize())}}function zoomToExtent(e){var t=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(t,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Muokkaa solmun sijaintia",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Poista solmun sijainti",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Tallenna solmun sijainti",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Yleistä tietoa",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Työpöytä",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Pääte",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Lähennä laajuutta",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Loitonna laajuudessa",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Päivitä",callback:function(){refreshMap(!0,!0)}},{text:"Zoomaa sopivaksi",callback:function(){zoomToFitExtent()}},{text:"Keskitä kartta tähän",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Aseta solmu tähän",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,n,i){if(!i||3!=i.which&&2!=i.button){if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Tilin Turvallisuus",'Tätä ominaisuutta ei voi käyttää, ennen kuin sähköpostiosoite on vahvistettu. Tätä vaaditaan salasanan palauttamiseksi. Siirry "Oma tili" -välilehteen vaihtaaksesi ja vahvistaaksesi sähköpostiosoitteen.'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Tilin Turvallisuus",'Tätä ominaisuutta ei voi käyttää, ennen kuin kaksivaiheinen todennus on käytössä. Tätä tarvitaan ylimääräisen turvallisuuden takaamiseksi. Siirry "Oma tili" -välilehdelle ja katso "Tilin suojaus" -osio.'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(!i||1!=i.shiftKey&&2!=i.which&&1!=i.button){var a=getNodeFromId(e);if(null!=a){null!=currentNode&&currentNode._id==a._id&&1&a.conn||deviceDetailsStatsClear();var o=meshes[a.meshid],s=GetNodeRights(a),l=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=a._id||1==n){if(currentNode=a,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery){var r=currentNode.sessions.battery,d="";"ac"==r.state&&(d="Laite on kytketty"),"dc"==r.state&&(d="Laite on akkukäyttöinen");var u="",c=-1;"number"==typeof r.level&&r.level>=0&&r.level<=100&&(u=r.level+"%",(c=Math.floor((r.level+10)/25)+1)>5&&(lvl=5),"ac"==r.state&&(100==r.level?c=11:c+=5)),c>0&&(Q("p10deviceBattery").title=null!=d?d+", "+u:u,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+c)}else QV("p10deviceBattery",!1);var p,m=EscapeHtml(a.name);0==m.length&&(m="<i>Ei mitään</i>"),4&s&&(!o.flags||!(2&o.flags)||16&o.flags)&&(m='<span tabindex=0 title="Napsauta tätä muokataksesi palvelinpuolen laitteen nimeä" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+m+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),p=m,o&&(m+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(o.name)+"</span>"),QH("p10deviceName",m),QH("p11deviceName",m),QH("p12deviceName",m),QH("p13deviceName",m),QH("p14deviceName",m),QH("p15deviceName","Konsoli -"+m),QH("p16deviceName",m),QH("p17deviceName",m),QH("p19deviceName",m);var g="<table style=width:100%>";8&args.hide&&(g+="<br />"+addDeviceAttribute("Nimi",p)),o&&(g+=addDeviceAttribute('<span title="Laiteryhmän nimi, johon tämä tietokone kuuluu.">Ryhmä</span>','<a href=# title="Laiteryhmän nimi, johon tämä tietokone kuuluu" onclick=gotoMesh("'+a.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[a.meshid].name)+"</a>")),null!=a.rname&&a.name!=a.rname&&(g+=addDeviceAttribute('<span title="Tämän tietokoneen nimi käyttöjärjestelmässä määritetyllä tavalla">OS-nimi</span>','<span title="Tämän tietokoneen nimi käyttöjärjestelmässä määritetyllä tavalla">'+EscapeHtml(a.rname)+"</span>")),(1&features||4==a.mtype)&&3!=a.mtype||(g+=addDeviceAttribute("Isäntänimi",addLinkConditional(a.host?EscapeHtml(a.host):"<i>Ei mitään</i>","showEditNodeValueDialog(1)",4&s)));var v=a.desc?EscapeHtml(a.desc):"<i>Ei mitään</i>";if(g+=addDeviceAttribute("Kuvaus",4&s?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+v+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':v),4==a.mtype&&(null!=a.portnum&&(g+=addDeviceAttribute("Porttinumero",a.portnum)),null!=a.porttype&&(g+=addDeviceAttribute("Portin tyyppi",a.porttype))),null!=a.agent&&null!=a.agent.id&&3==a.mtype)4==a.agent.id&&(g+=addDeviceAttribute("Laitetyyppi","Windows")),6==a.agent.id&&(g+=addDeviceAttribute("Laitetyyppi","Linux")),29==a.agent.id&&(g+=addDeviceAttribute("Laitetyyppi","macOS"));else if(null!=a.agent&&null!=a.agent.id&&null!=a.agent.ver){var h="";h=a.agent.id<=agentsStr.length?agentsStr[a.agent.id]:agentsStr[0],0!=a.agent.ver&&(h+=" v"+a.agent.ver),14==a.agent.id&&(h=a.agent.core),!1===a.agent.root&&1&a.conn&&(h+=", Rajoitettu"),g+=addDeviceAttribute("Mesh Agentti",h)}if(null!=a.intelamt){h="";var f={0:nobreak("Ei aktivoitu (ennakko)"),1:nobreak("Ei aktivoitu (sisään)"),2:nobreak("Aktivoitu")};if(null!=a.intelamt.ver&&null==a.intelamt.state?h+="<i>Tuntematon tila</i>, v"+EscapeHtml(a.intelamt.ver):null==a.intelamt.ver&&2==a.intelamt.state?h+="<i>Aktivoitu</i>":null==a.intelamt.ver||null==a.intelamt.state?h+="<i>Tuntematon versio ja tila</i>":(h+=f[a.intelamt.state],2==a.intelamt.state&&a.intelamt.flags&&(2&a.intelamt.flags?h+=' <span title="Intel&reg; AMT on aktivoitu asiakasohjaustilassa">CCM</span>':4&a.intelamt.flags&&(h+=' <span title="Intel&reg; AMT on aktivoitu Järjestelmänvalvojan ohjaustilassa">ACM</span>')),h+=", v"+EscapeHtml(a.intelamt.ver)),2==a.intelamt.state){1==a.intelamt.tls&&(h+=', <span title="Intel&reg; AMT on määritetty TLS-verkon suojauksella">TLS</span>');var k=!1;if(null==a.intelamt.user||""==a.intelamt.user)4&s?(h+=', <i style=color:#FF0000;cursor:pointer title="Muokkaa Intel&reg; AMT -tilitietoja" onclick=editDeviceAmtSettings("'+a._id+'")>Ei tunnuksia</i>',k=!0):h+=", <i style=color:#FF0000>Ei tunnuksia</i>";else if(1&features2&&null!=a.intelamt.warn){var x=null;1&a.intelamt.warn&&(x="Virheelliset kirjautumistiedot"),8&a.intelamt.warn&&(x="Kokeillaan kirjautumistietoja"),null!=x&&(4&s?(h+=', <i style=color:#FF0000;cursor:pointer title="Muokkaa Intel&reg; AMT -tilitietoja" onclick=editDeviceAmtSettings("'+a._id+'")>'+x+"</i>",k=!0):h+=", <i style=color:#FF0000>"+x+"</i>")}4&s&&!(1&features2)&&(k=!0),h+=" ",k&&(h+='<img src=images/link4.png height=10 width=10 title="Muokkaa Intel&reg; AMT -tilitietoja" style=cursor:pointer onclick=editDeviceAmtSettings("'+a._id+'")>')}var y='<span title="Intel &reg; hallittavuusmoottori">Intel&reg; ME<span>';"number"==typeof a.intelamt.sku&&(8&a.intelamt.sku?y='<span title="Intel&reg; Active Management-tekniikka">Intel&reg; AMT<span>':16&a.intelamt.sku&&(y='<span title="Intel&reg; standardinhallinta">Intel&reg; SM<span>')),g+=addDeviceAttribute(y,h)}if(null!=a.agent&&null!=a.agent.tag)(b=EscapeHtml(a.agent.tag)).startsWith("mailto:")&&(b='<a href="'+EscapeHtml(b)+'">'+EscapeHtml(b.substring(7))+"</a>"),g+=addDeviceAttribute("Agentin lappu",b);else if(null!=a.intelamt&&null!=a.intelamt.tag){var b;(b=EscapeHtml(a.intelamt.tag)).startsWith("mailto:")&&(b='<a href="'+EscapeHtml(b)+'">'+EscapeHtml(b.substring(7))+"</a>"),g+=addDeviceAttribute("Intel&reg; AMT -tunniste",b)}if(a.osdesc&&(g+=addDeviceAttribute("Käyttöjärjestelmä",a.osdesc)),a.wsc){var w=[];null!=a.wsc.antiVirus&&("OK"==a.wsc.antiVirus?w.push("AV - <span style=color:green>OK</span>"):w.push("AV - <span style=color:red>HUONO</span>")),null!=a.wsc.autoUpdate&&("OK"==a.wsc.autoUpdate?w.push("Päivittää - <span style=color:green>OK</span>"):w.push("Päivittää - <span style=color:red>HUONO</span>")),null!=a.wsc.firewall&&("OK"==a.wsc.firewall?w.push("Palomuuri - <span style=color:green>OK</span>"):w.push("Palomuuri - <span style=color:red>HUONO</span>")),g+=addDeviceAttribute("Windowsin suojaus",w.join(", "))}if(a.defender){w=[];null!=a.defender.RealTimeProtection&&(1==a.defender.RealTimeProtection?w.push("RealTimeProtection - <span style=color:green>On</span>"):w.push("RealTimeProtection - <span style=color:red>Vinossa</span>")),null!=a.defender.TamperProtected&&(1==a.defender.TamperProtected?w.push("TamperProtection - <span style=color:green>On</span>"):w.push("TamperProtection - <span style=color:red>Vinossa</span>")),w.length>0&&(g+=addDeviceAttribute("Windows Defender",w.join(", ")))}if(a.av&&a.av.length>0){w=[];for(var M in a.av)if(a.av[M].product){var S=EscapeHtml(a.av[M].product);!0!==a.av[M].enabled&&(S+=" - <span style=color:red>Poistettu käytöstä</span>"),!0!==a.av[M].updated&&(S+=" - <span style=color:red>Vanhentunut</span>"),1==a.av[M].enabled&&1==a.av[M].updated&&(S+=" - <span style=color:green>OK</span>"),w.push(S)}g+=addDeviceAttribute("Antivirus",w.join("<br />"))}if(a.users&&a.users.length>0){var C=a.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Lukittu",a.lusers&&a.lusers.indexOf(e)>=0)}).join(", ");g+=addDeviceAttribute(a.users.length>1?"Aktiiviset käyttäjät":"Aktiivinen käyttäjä",C)}if(null!=a.agent&&14!=a.agent.id&&3!=a.mtype){var A=[],T=0;a.consent&&(T=a.consent),serverinfo.consent&&(T|=serverinfo.consent),64&T&&8&T?A.push("Työpöydän kehote+työkalurivi"):64&T?A.push("Työpöydän työkalurivi"):8&T?A.push("Työpöydän kehote"):1&T&&A.push("Työpöytä ilmoitus"),16&T?A.push("Terminaalikehote"):2&T&&A.push("Ilmoita terminaalista"),32&T?A.push("Tiedostot kysy"):4&T&&A.push("Tiedostot Ilmoita"),7==T&&(A=["Ilmoita aina"]),56&~T||(A=["Kysy Aina"]),""==(A=A.join(", "))&&(A="<i>Ei mitään</i>"),g+=addDeviceAttribute("Käyttäjän suostumus",addLinkConditional(A,"p20editmeshconsent(3)",1&s))}var D=[];if(null!=userinfo.notify&&null!=userinfo.notify[a._id]){var E=userinfo.notify[a._id];if(2&E&&D.push("Yhdistä"),4&E&&D.push("Katkaise yhteys"),null!=a.intelamt&&8&E&&D.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var N=0;16&E&&N++,32&E&&N++,64&E&&N++,N>0&&D.push(format("Email ({0})",N))}if(null!=userinfo.msghandle&&33554432&features2){N=0;128&E&&N++,256&E&&N++,512&E&&N++,N>0&&D.push(format("Messaging ({0})",N))}}""==(D=D.join(", "))&&(D="<i>Ei mitään</i>"),g+=addDeviceAttribute("Ilmoitukset",addLink(D,"p20editDeviceNotify()"));var I=a.conn;if(I&&I>1){var V=[];1&a.conn&&V.push('<span title="Mesh agentti on yhdistetty ja käyttövalmis.">Mesh Agentti</span>'),2&a.conn?V.push('<span title="Intel&reg; AMT CIRA yhdistetty ja valmis käytettäväksi.">Intel&reg; AMT CIRA</span>'):4&a.conn&&V.push('<span title="Intel&reg; AMT on reititettävä ja käyttövalmis.">Intel&reg; AMT</span>'),8&a.conn&&V.push('<span title="Verkkoagentti on tavoitettavissa käyttämällä toista ainetta releenä.">Mesh-rele</span>'),16&a.conn&&V.push('<span title="MQTT-yhteys laitteeseen on aktiivinen.">MQTT</span>'),g+=addDeviceAttribute("Liitettävyys",V.join(", "))}var _="<i>Ei mitään</i>";if(null!=a.tags)for(var M in _="",a.tags)_+="<span class=tagSpan>"+EscapeHtml(a.tags[M])+"</span> ";if(g+=addDeviceAttribute("Tunnisteet",4&s?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+_+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+_+"</span>"),null!=a.ssh||null!=a.rdp){w=[];4&s?(null!=a.ssh&&w.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==a.ssh?"SSH-käyttäjä+pass":2==a.ssh?"SSH-käyttäjä+avain+pass":"SSH-käyttäjä+avain")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=a.rdp&&w.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=a.ssh&&w.push(1==a.ssh?"SSH-käyttäjä+pass":2==a.ssh?"SSH-käyttäjä+avain+pass":"SSH-käyttäjä+avain"),null!=a.rdp&&w.push("RDP")),g+=addDeviceAttribute("Valtakirjat",w.join(", "))}var U=[];for(var M in meshes)meshes[M].relayid==a._id&&U.push('<a href=# onclick=gotoMesh("'+meshes[M]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[M].name)+"</a>");if(U.length>0&&(g+=addDeviceAttribute('<span title="Laiteryhmät, joille tämä laite on rele">Rele varten</span>',U.join(", "))),g+="</table><br />",262220&s&&a.mtype<3&&(null==a.agent||34!=a.agent.id)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Toiminnot" title="Virranhallintatoimintojen suorittaminen laitteessa" onclick=deviceActionFunction() />'),g+='<input type=button class="btn btn-primary btn-sm me-2" value="Muistiinpanot" title="Näytä tämän laitteen huomautukset" onclick=showNotes('+!(128&s)+',"'+encodeURIComponentEx(a._id)+'") />',g+='<input type=button class="btn btn-primary btn-sm me-2" value="Kirjaa tapahtuma" title="Kirjoita tapahtuma tälle laitteelle" onclick=writeDeviceEvent("'+encodeURIComponentEx(a._id)+'") />',2==a.mtype&&1&I&&131072&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Run" title="Suorita komentoja tässä laittessa." onclick=runDeviceCmd("'+encodeURIComponentEx(a._id)+'") />'),4!=a.mtype){if((8&s&&1&I&&16384&s||1==a.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Viesti" title="Näytä tekstiviesti etälaitteessa" onclick=deviceMessageFunction() />'),(8&s&&1&I&&16384&s||1==a.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Chat" title="Avaa chat-ikkuna tälle tietokoneelle" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&I)for(var M in serverinfo.altmessenging){var R=serverinfo.altmessenging[M];null!=R.type&&"device"!=R.type||(g+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[M].name)+'" onclick=altDeviceChat(event,'+M+") />")}!(!1!==serverinfo.guestdevicesharing&&null!=a.agent&&3&a.agent.caps&&1&I)||524296&~s||4294967295!=s&&4096&s?QV("DeskGuestShareButton",!1):(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Jaa" title="Luo linkki tämän laitteen jakamiseksi vieraan kanssa" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0))}if(4==a.mtype&&1&I&&("PDU"==a.porttype?1==a.pwr?262144&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Sammuttaa" title="Sammuttaa" onclick=setIpPduState(0) />'):8==a.pwr&&64&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Kiihottua" title="Kiihottua" onclick=setIpPduState(1) />'):8&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Etähallinta" title="Etähallinta" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(a._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var M in customui.devicebuttons)(null==customui.devicebuttons[M].showif||null!=o&&customui.devicebuttons[M].showif==o._id||customui.devicebuttons[M].showif==currentNode._id)&&(g+='<input id="cui:'+M+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[M].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",g),mainUpdate(256);var H=4294967295==s||!(65536&s),j=4294967295==s||!(512&s),F=4294967295==s||!(1024&s),L=4294967295==s||!(2048&s);if(g='<div class="p10html3right">',1&s&&4!=a.mtype&&(g+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+a._id+'"]) title="Siirrä tämä laite toiseen laiteryhmään">Vaihda Ryhmää</a>'),32768&s&&(g+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+a._id+'") title="Poista tämä laite">Poista laite</a>'),g+='</div><div class="p10html3left">',a.agent&&3!=a.mtype&&1048576&s&&(g+='<a href=# onclick=p10showNodeNetInfoDialog("'+a._id+'") title="Näytä laitteen verkkoliittymän tiedot">Liitennät</a>&nbsp;'),32768&features&&null!=xxmap&&(g+='<a href=# onclick=p10showNodeLocationDialog("'+a._id+'") title="Näytä laitteen sijaintitiedot">Sijainti</a>&nbsp;'),null==a.agent||14!=a.agent.id&&34!=a.agent.id){if(4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||j&&8&s&&null!=a.agent&&14!=a.agent.id&&(g+='<a href=# onclick=p10showMeshCmdDialog(1,"'+a._id+'") title="Liikennereititin, jota käytetään yhteyden muodostamiseen laitteeseen tämän palvelimen kautta.">MeshCmd</a>&nbsp;'),!(0===args.xterm&&a.agent&&2&a.agent.caps&&8&s)||4294967295!=s&&512&s||(g+='<a href=# onclick=p10openxterm(event,"'+a._id+'") title="Avaa XTerm-pääte">XTerm</a>&nbsp;'),(1&I||3==a.mtype)&&a.agent&&8&s&&(0!=webRelayPort&&(g+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+a._id+'",1,'+(a.httpport?a.httpport:80)+")>HTTP"+(a.httpport&&80!=a.httpport?"/"+a.httpport:"")+"</a>&nbsp;",g+='<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+a._id+'",2,'+(a.httpsport?a.httpsport:443)+")>HTTPS"+(a.httpsport&&443!=a.httpsport?"/"+a.httpsport:"")+"</a>&nbsp;"),a.agent.id>0&&a.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(g+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+a._id+'",3) title="Edellyttää MeshCentral-reitittimen asennusta.">RDP'+(a.rdpport&&3389!=a.rdpport?"/"+a.rdpport:"")+"</a>&nbsp;")),a.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",4,'+(a.sshport?a.sshport:22)+') title="Edellyttää MeshCentral-reitittimen asennusta.">SSH'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",5,'+(a.sshport?a.sshport:22)+') title="Edellyttää MeshCentral-reitittimen asennusta.">SCP'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var M in serverinfo.devicemeshrouterlinks.extralinks){var B=serverinfo.devicemeshrouterlinks.extralinks[M],P='"'+B.protocol+'"';if(doesDeviceMatchFilterTags(a,B.filter)){if("number"==typeof B.protocol?P=B.protocol:"http"==B.protocol?P=1:"https"==B.protocol?P=2:"rdp"==B.protocol?P=3:"ssh"==B.protocol?P=4:"scp"==B.protocol?P=5:"mcrdesktop"==B.protocol?P=6:"mcrfiles"==B.protocol&&(P=7),(6==P||7==P)&&2!=a.mtype)continue;g+='<a href=# onclick=p10MCRouter("'+a._id+'",'+P+","+B.port+(B.ip?',"'+B.ip+'"':",null")+","+(B.localport?B.localport:0)+') title="Edellyttää MeshCentral-reitittimen asennusta.">'+B.name+"</a>&nbsp;"}}(1&I||3==a.mtype)&&a.agent&&8&s&&!(536870912&features)&&(g+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+a._id+'") title="Käynnistä verkkopohjainen VNC-istunto tälle laitteelle.">Web-VNC</a>&nbsp;'),(1&I||3==a.mtype)&&a.agent&&8&s&&!(1073741824&features)&&(g+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+a._id+'") title="Käynnistä web-pohjainen RDP-istunto tähän laitteeseen.">Verkko-RDP</a>&nbsp;'),512&features2&&(1&I||3==a.mtype)&&a.agent&&8&s&&(g+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+a._id+'") title="Käynnistä verkkopohjainen SSH-istunto tälle laitteelle.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(g+='<a href=# onclick=p10showMqttLoginDialog("'+a._id+'") title="Hanki MQTT-kirjautumistiedot tälle laitteelle.">MQTT kirjautuminen</a>&nbsp;')}g+="</div><br>",3==a.mtype?(QH("p10html3",""),QH("p10html5",g)):(QH("p10html3",g),QH("p10html5",""));var O=PowerStateStr(a.state),K="";null!=a.agent&&!1===a.agent.root&&(K=', <span title="Agentti toimii etälaitteella, jolla on rajoitetut oikeudet.">Rajoitettu</span>'),1&I&&(O.length>0&&(O+="<br/>"),4==a.mtype?"PDU"==a.porttype?O+='<span style=font-size:12px title="Kytkimen portti kytketty">Kytkimen portti kytketty</span>'+K:O+='<span style=font-size:12px title="IP-KVM-portti kytketty">IP-KVM-portti kytketty</span>'+K:O+='<span style=font-size:12px title="Agentti yhdistetty">Agentti yhdistetty</span>'+K),2&I?(O.length>0&&(O+="<br/>"),O+='<span style=font-size:12px title="Intel&reg; AMT yhdistetty">Intel&reg; AMT yhdistetty</span>'):4&I&&(O.length>0&&(O+="<br/>"),O+='<span style=font-size:12px title="Intel&reg; AMT havaittu">Intel&reg; AMT havaittu</span>'),16&I&&(O.length>0&&(O+="<br/>"),O+='<span style=font-size:12px title="MQTT yhdistetty">MQTT kanava yhdistetty</span>'),""==O&&a.lastconnect?O="<span style=font-size:12px>Viimeksi nähty:<br />"+printDateTime(new Date(a.lastconnect))+"</span>":("PDU"==a.porttype||a.pwr>1&&7!=a.pwr)&&(O+="<br/>"+powerStateStrings[a.pwr]),QH("MainComputerState",O),Q("MainComputerImage").setAttribute("src","images/icons256-"+a.icon+"-1.png"),Q("MainComputerImage").className=a.conn&&0!=a.conn||3==a.mtype?"":"gray",3==a.mtype&&null!=a.agent&&a.agent.id>4&&512&features2&&(a.agent.caps=6),j&&setupTerminal(),F&&setupFiles();var z=!!(16&s);z?setupConsole():15==t&&(t=10),QV("MainDevDesktop",H&&(null==a.agent&&null!=a.intelamt&&("number"!=typeof a.intelamt.sku||!!(8&a.intelamt.sku))||null!=a.agent&&(null==a.agent.caps||!!(1&a.agent.caps)||a.intelamt&&2==a.intelamt.state)||3==a.mtype&&(3==a.agent.id||4==a.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==a.agent&&null!=a.intelamt||a.agent&&null==a.agent.caps||a.agent&&!!(2&a.agent.caps)||a.intelamt&&2==a.intelamt.state)&&8&s&&j),QV("MainDevFiles",null!=a.agent&&null!=a.agent.caps&&!!(4&a.agent.caps)&&8&s&&F),QV("MainDevInfo",a.mtype<3&&!!(1048576&s)),QV("MainDevAmt",null!=a.intelamt&&(2==a.intelamt.state||2&a.conn)&&8&s&&L),QV("MainDevConsole",z&&null!=a.agent&&null!=a.agent.caps&&!!(8&a.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=a.agent&&null!=a.agent.caps&&!!(16&a.agent.caps)),QH("p15coreName",null!=a.agent&&null!=a.agent.core?a.agent.core:""),null!=a.intelamt&&"number"==typeof a.intelamt.sku&&16&a.intelamt.sku?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT"));var W=Q("p14iframe").contentWindow.getCurrentMeshNode();null!=W&&W._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect();var G=!!(6&a.conn);if(Q("p14iframe").contentWindow.setConnectionState(G),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&xxcurrentView>=10&&xxcurrentView<20?currentNode.name+(o?" - "+o.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),l&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler){QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,n,i);var q=getstore("_curPluginPage",null);null!=q&&null!=Q("p19ph-"+q)&&pluginHandler.callPluginPage(q,Q("p19ph-"+q))}if(g="",7&s&&(g+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjä</button>',null!=usergroups)){var J=0,Y=!1;for(var M in usergroups)null==usergroups[M].membershipType&&usergroups[M]._id.split("/")[1]==e.split("/")[1]&&(J++,null!=currentNode.links&&null!=currentNode.links[M]||(Y=!0));J>0&&Y&&(g+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjä Ryhmä</a>')}g+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Käyttäjäluvat</th><th scope=col style=text-align:left></th></tr>';var $=1;if(null!=currentNode.links){var X=[];for(var M in currentNode.links)(M.startsWith("user/")||M.startsWith("ugrp/"))&&X.push(M);for(var M in X.sort(),X){var Z="",ee="",te=X[M],ne=currentNode.links[te].rights,ie=EscapeHtml(te.split("/")[2]),ae=(ee=makeUserDeviceRightsString(ne),!1);null!=currentNode.links[te].name&&(ie=EscapeHtml(currentNode.links[te].name)),te==userinfo._id&&(ie=EscapeHtml(userinfo.name)),null!=users&&null!=users[te]&&(ie=EscapeHtml(users[te].name)),null!=usergroups&&null!=usergroups[te]&&(ie=EscapeHtml(usergroups[te].name),ae=!0),2&s&&(ae?(Z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Poista käyttäjäryhmän oikeudet tähän laiteryhmään" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(Z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Posta käyttäjältä oikeudet tähän laiteryhmään" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),null!=users&&(ie=ae?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+ie+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+ie+"</a>"),g+="<tr "+(++$%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(ae?"Käyttäjäryhmä":"Käyttäjä")+'" class=m'+(ae?4:2)+"></div><div>&nbsp;"+ie+"<div></div></div></td><td style=width:70%><div style=float:right>"+Z+"</div><div>"+ee+"</div></td></tr>"}}if(1==$&&(g+="<tr><td><div style=padding:6px>&nbsp;<i>Ei käyttäjiä, joilla on erityiset laitteen käyttöoikeudet</i><div></div></div></td><td></td></tr>"),g+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&deviceShares.length>0){g+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktiivinen laitteen jakaminen</th><th scope=col style=text-align:left></th></tr>',$=1;for(M=0;M<deviceShares.length;M++){var oe=deviceShares[M];Z="";null!=oe.url&&(Z+='<a href="'+oe.url+'" rel="noreferrer noopener" target=_blank title="Laitteen jakolinkki" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),Z+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(oe.publicid)+'","'+encodeURIComponentEx(oe.guestName)+'")\' title="Poista laitteen jakaminen" class="fa-fw fa-solid fa-trash text-danger"></i>';var se="";oe.p<=7?se=["","Pääte","Työpöytä","Työpöytä + pääte","Tiedostot","Pääte + tiedostot","Työpöytä + tiedostot","Työpöytä + pääte + tiedostot"][oe.p]:8==oe.p?se="HTTP/"+oe.port:16==oe.p&&(se="HTTPS/"+oe.port);var le=se;null!=oe.startTime&&null!=oe.expireTime&&(le=format("{0}, {1} - {2}",se,printFlexDateTime(new Date(oe.startTime)),printFlexDateTime(new Date(oe.expireTime)))),null!=oe.startTime&&null!=oe.duration&&(le=(oe.duration,format("{0}, {1} {2} minuutin ajan",se,printFlexDateTime(new Date(oe.startTime)),oe.duration))),1==oe.recurring&&(le+=", Toistuu päivittäin"),2==oe.recurring&&(le+=", Toistuu viikoittain"),2&oe.p&&!0===oe.viewOnly&&(le+=", Näytä vain työpöytä"),null!=oe.consent&&(0==oe.consent?le+=", Ei suostumusta":(56&oe.consent&&(le+=", Pyydä suostumusta"),64&oe.consent&&(le+=", Työkalupalkki")));var re=EscapeHtml(oe.guestName);oe.publicid.startsWith("AS:node/")&&(re="<i>Agentin omavastuu</i>"),g+="<tr "+(++$%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+re+"<div></div></div></td><td style=width:70%><div style=float:right>"+Z+"</div><div>"+le+"</div></td></tr>"}g+="</tbody></table>"}QH("p10html4",g);var de="";if(!(268435456&features)&&xxcurrentView>=10&&xxcurrentView<=19&&null!=currentNode){for(var M in de="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)de+="&"+M+"="+urlargs[M];try{window.history.replaceState({},document.title,window.location.pathname+de)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),t||(t=10),go(t)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Virtakäyttö","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Virtakäyttö","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified?1:0;userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]);var n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Web-sivun ilmoitukset</div>';return n+='<div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Laiteyhteydet</label></div>',n+='<div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Laitteen irtikytkennät</label></div>',null!=currentNode.intelamt&&(t+=2,n+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Intel&reg; AMT työpöytä ja sarjaliikenne ilmoitukset</label></div>'),1&t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">sähköposti-ilmoitukset</div>',n+='<div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Laiteyhteydet</label></div>',n+='<div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Laitteen irtikytkennät</label></div>',n+='<div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',n+='<div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Laiteyhteydet</label></div>',n+='<div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Laitteen irtikytkennät</label></div>',n+='<div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),setModalContent("xxAddAgent","Ilmoitusasetukset",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editDeviceNotifyEx(e,t){var n=0;n+=Q("p20notifyIntelDeviceConnect").checked?2:0,n+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,2&t&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0,n+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,n+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(n+=Q("p20emsgDeviceConnect").checked?128:0,n+=Q("p20emsgDeviceDisconnect").checked?256:0,n+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:n})}function makeUserDeviceRightsString(e){if(57592==e)return"Laitteen täydet oikeudet";var t=[];if(8&e){var n=[];256&e&&n.push("Ei tuloa"),512&e&&n.push("Ei päätettä"),1024&e&&n.push("Ei tiedostoja"),2048&e&&n.push("Ei AMT"),4096&e&&n.push("Rajoitettu syöttö"),65536&e&&n.push("Ei työpöytää"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Vieraiden jakaminen"),n.length>0?t.push("Control ("+n.join(", ")+")"):t.push("Hallinta")}return 16&e&&t.push("Konsoli"),32&e&&t.push("Palvelimen Tiedostot"),64&e&&t.push("Herätä"),128&e&&t.push("Muistiinpanot"),8192&e&&t.push("Rajoita tapahtumia"),16384&e&&t.push("Chat"),32768&e&&t.push("Asennuksen poistaminen"),131072&e&&t.push("Komennot"),262144&e&&t.push("Nollaa / Pois"),524288&e&&t.push("Jakaminen"),1048576&e&&t.push("Tarkemmat tiedot"),2097152&e&&t.push("Rele"),0==t.length?"Ei oikeuksia":t.join(", ")}function makeDeviceGroupRightsString(e){if(4294967295==e)return"Täydet oikeudet";var t=[];if(1&e&&t.push("Muokkaa ryhmää"),2&e&&t.push("Hallitse käyttäjiä"),4&e&&t.push("Hallitse laitteita"),8&e){var n=[];256&e&&n.push("Ei tuloa"),512&e&&n.push("Ei päätettä"),1024&e&&n.push("Ei tiedostoja"),2048&e&&n.push("Ei AMT"),4096&e&&n.push("Rajoitettu syöttö"),65536&e&&n.push("Ei työpöytää"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Vieraiden jakaminen"),n.length>0?t.push("Control ("+n.join(", ")+")"):t.push("Hallinta")}return 16&e&&t.push("Konsoli"),32&e&&t.push("Palvelimen Tiedostot"),64&e&&t.push("Herätä"),128&e&&t.push("Muistiinpanot"),8192&e&&t.push("Rajoita tapahtumia"),16384&e&&t.push("Chat"),32768&e&&t.push("Asennuksen poistaminen"),131072&e&&t.push("Komennot"),262144&e&&t.push("Nollaa / Pois"),524288&e&&t.push("Jakaminen"),1048576&e&&t.push("Tarkemmat tiedot"),2097152&e&&t.push("Rele"),0==t.length?"Ei oikeuksia":t.join(", ")}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Lisää laitetapahtuma","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Tämä lisää merkinnän tämän laitteen tapahtumalokiin.<span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){if(!xxdialogMode){null==t&&(t=encodeURIComponentEx("p"+userinfo._id));var n="<textarea id=d2devNotes ro="+e+" noteid="+t+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>';t.startsWith("node%2F%2F")&&(n+="<span style=font-size:10px>Laiteryhmän muistiinpanoja voivat tarkastella ja muuttaa muut laiteryhmän järjestelmänvalvojat.<span>"),"true"===showNotesPanel&&(n+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Muistiinpanot",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)})}}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){if(!xxdialogMode){var t=decodeURIComponent(e).split("/")[2];safeNewWindow("/ipkvm.ashx/"+t+"/","ipkvm:"+t)}}function deviceChat(e){if(!xxdialogMode){var t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name;""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&2&features2&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)})}}function altDeviceChat(e,t){if(!xxdialogMode){var n=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),i=encodeURIComponentEx(userinfo._id.split("/")[2]),a=encodeURIComponentEx(userinfo._id.split("/").join("-")),o=i,s=a;null!=userinfo.realname&&(o=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-")));var l=n=n.split("{4}").join(i).split("{5}").join(a).split("{6}").join(o).split("{7}").join(s);"string"==typeof serverinfo.altmessenging[t].localurl&&(l=(l=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(i).split("{5}").join(a).split("{6}").join(o).split("{7}").join(s)),""!=n&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:n}),""!=l&&safeNewWindow(l,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560")}}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Avaa sivu laitteella",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&e.length>7||e.startsWith("https://")&&e.length>8)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Laiteviesti","<div style=margin-bottom:4px>Näytä viestiruutu etälaitteessa.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Näytä viesti, kunnes käyttäjä hylkäsi sen</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus()}}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){if(null!=desktop&&3==desktop.State)if(desktop.m.getClipboard){var e=desktop.m.getClipboard();null!=e&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})}else meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2})}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Etätulon lukitus",1==e?"Lukitaanko etäkäyttäjän hiiri ja näppäimistö?":"Avaa etäkäyttäjän hiiren ja näppäimistön lukitus?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Laiteilmoitus",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Toast-ilmoitus</option><option value=1>Viestilaatikko</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Otsikko" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Näytä viesti, kunnes käyttäjä hylkäsi sen</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus()}}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,i=parseFloat(Q("d2notifyTimeout").value);0!=n.length&&(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(i)&&(i=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:n,timeout:6e4*i}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:n}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:n}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Lukitse työpöytä","Lukitaanko käyttäjän työpöytä?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t="",n="Luo linkin, jonka avulla vieras, jolla ei ole tiliä, voi ohjata tätä laitetta rajoitetun ajan.<br /><br />";n+=addHtmlFormFloating("Vieraan nimi",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />');var i="<option value=2>Työpöytä</option>";4294967295!=e&&256&e&&(i="");var a="<option value=1>Pääte</option>";4294967295!=e&&512&e&&(a="");var o="<option value=4>Tiedostot</option>";4294967295!=e&&1024&e&&(o="");var s="<option value=5>Työpöytä + tiedostot</option>";4294967295!=e&&1280&e&&(s="");var l="<option value=6>Pääte + tiedostot</option>";4294967295!=e&&1536&e&&(l="");var r="<option value=7>Työpöytä + pääte + tiedostot</option>";4294967295!=e&&1792&e&&(r="");var d="";0!=webRelayPort&&(d="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=e&&8&e&&(d=""));t="";var u="";1&~currentNode.agent.caps||(t+=i+"<option value=3>Työpöytä, vain näkymä</option>"),2&~currentNode.agent.caps||(t+=a),4&~currentNode.agent.caps||(t+=o),5&~currentNode.agent.caps||(t+=s),6&~currentNode.agent.caps||(t+=l),7&~currentNode.agent.caps||(t+=r),n+=addHtmlFormFloating("Tyyppi",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(t+=d)+"</select>");var c={1:"1 minuutti",5:"5 minuuttia",10:"10 minuuttia",15:"15 minuuttia",30:"30 minuuttia",45:"45 minuuttia",60:"60 minuuttia",120:"2 tuntia",240:"4 tuntia",480:"8 tuntia",720:"12 tuntia",960:"16 tuntia",1440:"24 tuntia",2880:"2 päivää",5760:"4 päivää",0:"Rajoittamaton"};for(var p in t="",c)(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(t+="<option value="+p+">"+c[p]+"</option>"),p>0&&p<=720&&(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(u+="<option value="+p+">"+c[p]+"</option>");n+=addHtmlFormFloating("Voimassaolo",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>Alkaen nyt</option><option value=1>Aikahaarukka</option><option value=2>Toistuva päivittäin</option><option value=3>Toistuu viikoittain</option></select>'),n+="<div id=d2modenow>",n+=addHtmlFormFloating("Vanhentumisaika",'<select id=d2inviteExpire class="form-select">'+t+"</select>"),n+="</div><div id=d2moderange style=display:none>",n+=addHtmlFormFloating("Aika -alue alkaa",'<input id=d2timeRangeStartSelector class="flatpickr form-select" type="text" placeholder="Valitse päivämäärä ja aika..." data-id="altinput">'),n+=addHtmlFormFloating("Aikaväli",'<input id=d2timeRangeEndSelector class="flatpickr form-select" type="text" placeholder="Valitse päivämäärä ja aika..." data-id="altinput">'),n+="</div><div id=d2moderecurring style=display:none>",n+=addHtmlFormFloating("Käynnistys aika",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Valitse päivämäärä ja aika..." data-id="altinput">'),n+=addHtmlFormFloating("Kesto",'<select id=d2inviteDuration class="form-select">'+u+"</select>"),n+="</div>",1&currentNode.agent.caps&&(n+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Käyttäjän suostumus",'<select id=d2userConsent class="form-select"><option value=0>Ilmoita vain<option value=1>Kysy suostumusta</option><option value=2>No Consent</option></select>')+"</div>"),n+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>",n+="<div id=d2httpsPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>",xxdialogButtons=3,setModalContent("xxAddAgent","Jaa laite",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showShareDeviceEx("",xxdialogTag)),showShareDeviceValidate();var m=new Date;m.setDate(m.getDate()+1);var g=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,n){v.set("minDate",t),v.selectedDates[0]&&v.selectedDates[0]<e[0]&&v.clear()}}),v=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,minDate:m,defaultDate:m,minuteIncrement:1,plugins:[new confirmDatePlugin({})]}),h=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:g,rangeEnd:v,start:h}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",Q("d2timeRange").value>=2);var e=!0;if(8==Q("d2shareType").value){var t=parseInt(Q("d2httpPort").value);(Q("d2httpPort").value!=t||t<1||t>65535)&&(e=!1)}if(9==Q("d2shareType").value){t=parseInt(Q("d2httpsPort").value);(Q("d2httpsPort").value!=t||t<1||t>65535)&&(e=!1)}0==Q("d2inviteName").value.trim().length&&(e=!1),QE("idx_dlgOkButton",e)}function showShareDeviceEx(e,t){var n=0,i=parseInt(Q("d2shareType").value),a=!1,o=0;8!=i?9!=i?(3==i&&(a=!0),1&(o=[0,1,2,2,4,6,5,7][i])&&(n|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=16),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),2&o&&(n|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=8),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),4&o&&(n|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=32),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(n=0)),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,expire:parseInt(Q("d2inviteExpire").value),consent:n,viewOnly:a}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3),end:Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),consent:n,viewOnly:a}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:n,viewOnly:a})):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0})}function deviceActionFunction(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t=0,n="Valitse suoritettava toiminto tällä laitteella.<br /><br />",i="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",a="";null!=currentNode.agent&&14==currentNode.agent.id?1&currentNode.conn&&8&e&&(t++,i+="<option value=400>Salama</option>",i+="<option value=401>Värinä</option>",a+="<div id=d2devicetimediv>"+addHtmlFormFloating("Aika","<select id=d2devicetime class=form-select><option value=1000>1 sekunti</option><option value=5000>5 sekuntia</option><option value=10000>10 sekuntia</option></select>")+"</div>"):(64&e&&(t++,i+="<option value=100>Herätä</option>"),1&currentNode.conn&&131072&e&&(t++,i+="<option value=106>Suorita Komentoja</option>"),0!=currentNode.conn&&262144&e&&(t++,i+="<option value=4>Nukkua</option><option value=3>Nollaa</option><option value=2>Sammuta</option>"),16&currentNode.conn&&(t++,i+="<option value=103>Lähetä MQTT Viesti</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&262144&e&&(t++,i+="<option value=310>Intel&reg; AMT Reset</option>",i+="<option value=308>Intel&reg; AMT Katkaise virta</option>",11!=xxcurrentView&&12!=xxcurrentView||(i+="<option value=312>Intel&reg; AMT Reset to BIOS</option>",i+="<option value=311>Intel&reg; AMT Power on to BIOS</option>",i+="<option value=315>Intel&reg; AMT Power on to PXE</option>",i+="<option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&64&e&&(t++,i+="<option value=302>Intel&reg; AMT Virta päällä</option>"),(11==xxcurrentView||12==xxcurrentView)&&getNodeAmtVersion(currentNode)>=15&&2==currentNode.intelamt.state&&6&currentNode.conn&&4294967295==e&&!(1024&features)&&(t++,i+="<option value=107>Intel&reg; AMT yhden napsautuksen palautus</option>"),1&currentNode.conn&&32768&e&&(t++,i+="<option value=104>Agentin asennuksen poistaminen</option>")),n+=addHtmlFormFloating("Operaatio",i+="</select>"),0==t&&(n="Tällä laitteella ei ole tällä hetkellä käytettävissä toimintoja."),xxdialogButtons=0==t?2:3,xxdialogTag=n+a,setModalContent("xxAddAgent","Laitetoiminto",n),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),t>0&&deviceActionFunctionValidate()}}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t=!1,n=!1;if(currentNode.agent&&(currentNode.agent.id>0&&currentNode.agent.id<5?t=!0:n=!0),1==t||1==n){var i="Suorita komentoja valituilla laitteilla.<br />";1==t&&(i+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px>",i+="<option value=1>Windowsin komentohehote</option><option value=2>Windows PowerShell</option>",1==n&&(i+="<option value=3>Linux/BSD/macOS komentokehote</option>"),i+="</select>"),i+="<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Suorita agenttina</option><option value=1>Suorita käyttäjänä, agenttina, jos ei käyttäjää</option><option value=2>On suoritettava käyttäjänä</option></select>",setModalContent("xxAddAgent","Suorita Komentoja",i+="<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus()}}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Intel&reg; AMT yhden napsautuksen palautus",i),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Intel&reg; AMT -käyttö","Otetaanko Intel&reg; AMT käyttöön?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Intel&reg; AMT -käyttö","Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Intel&reg; AMT -käyttö","Suoritetaanko Intel&reg; AMT -nollaus?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(311==e)setModalContent("xxAddAgent","Intel&reg; AMT -käyttö","Perform Intel&reg; AMT power on to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})});else{if(312!=e)return 400==e||401==e?(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}),!0):(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0);setModalContent("xxAddAgent","Intel&reg; AMT -käyttö","Perform Intel&reg; AMT reset to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||xxcurrentView>19||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now();currentNode._id==powerTimelineNode&&(e=powerTimeline);var n=new Date;n.setHours(0,0,0,0);(n=new Date(n.getTime()-5184e5)).getTime();var i=[];if(null!=e&&e.length>1){i.push([0,e[1],e[0]]);for(var a=e[1],o=2;o<e.length;o+=2){var s=e[o],l=t;e.length>o+1&&(l=e[o+1]),i.push([a,a+l,s]),a+=l}}var r="",d=1,u=new Date,c=Q("column_l").offsetWidth-192;u.setHours(0,0,0,0);for(o=0;o<7;o++){var p="",m=u.getTime(),g=m+864e5;for(var v in i){var h=i[v];if(1==isTimeBlockInside(m,g,h[0],h[1])){var f=Math.max(m,h[0]),k=Math.min(Math.min(g,h[1]),t),x=Math.round((k-f)*c/864e5);if(x>0){var y=format("{0} välillä {1} - {2}.",powerStateStrings2[h[2]],printTime(new Date(f)),printTime(new Date(k)));p+='<div class="pwState '+powerColor(h[2])+'" title="'+y+'" style="width:'+x+'px;"></div>'}}}r+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(u)+"<div></div></div></td><td><div>"+p+"</div></td></tr>",++d,u=new Date(u.getFullYear(),u.getMonth(),u.getDate()-1)}var b="";try{b="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Päivä</th><th scope=col>7 päivän virtatila<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+b+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Lataa virtatapahtumat" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+r+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,n,i){return n<e&&i>t||(n>e&&n<t||i>e&&i<t)}function addDeviceAttribute(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${n[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,n){if(!xxdialogMode){var i="",a=getNodeFromId(e),o=3;4&GetNodeRights(a)&&(i+=addHtmlFormFloating("Käyttäjätunnus",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),i+=addHtmlFormFloating("Salasana",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),1&features2||(i+=addHtmlFormFloating("Turvallisuus",'<select id=dp10tls class="form-select"><option value=0>Ei TLS-suojausta</option><option value=1>TLS-suojaus vaaditaan</option></select>')),null!=a.intelamt.user&&""!=a.intelamt.user&&(o=7),setModalContent("xxAddAgent","Muokkaa Intel&reg; AMT -tilitietoja",i),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(o,{node:a,func:t,arg:n})),null!=a.intelamt.user&&""!=a.intelamt.user?Q("dp10username").value=a.intelamt.user:Q("dp10username").value="admin",1&features2||(Q("dp10tls").value=a.intelamt.tls),validateDeviceAmtSettings())}}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){if(2==e)meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}});else{var n=Q("dp10username").value;""==n&&(n="admin");var i=Q("dp10password").value;""==i&&(n="");var a={action:"changedevice",nodeid:t.node._id,intelamt:{user:n,pass:i}};1&features2||(a.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(a),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3)}}function p10showSendMqttMsgDialog(e){if(xxdialogMode)return!1;var t=addHtmlFormFloating("Aihe",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />');return setModalContent("xxAddAgent","Lähetä MQTT viesti",t+=addHtmlFormFloating("Viesti",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus(),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",Q("dp2topic").value.length>0&&Q("dp2msg").value.length>0)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){if(xxdialogMode)return!1;var t="";return t=e.length>1?format("Haluatko varmasti poistaa valitut {0} agenttia?",e.length):"Haluatko varmasti poistaa valitun agentin?",t+="<br /><br />",e.length>1?t+="Tämä ei poista laitteita palvelimelta, mutta laitteet eivät enää voi muodostaa yhteyttä palvelimeen. Kaikki laitteiden etäkäyttö menetetään. Laitteet on kytkettävä, jotta tämä komento toimisi.":t+="Tätä laitetta ei poisteta palvelimelta, mutta laite ei voi enää muodostaa yhteyttä palvelimeen. Kaikki laitteen etäkäyttö menetetään. Laitteen on oltava kytketty, jotta tämä komento toimisi.",setModalContent("xxAddAgent","Agentin asennuksen poistaminen",t+='<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Varmista</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog(),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(xxdialogMode)return!1;var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var n='<select id=p10newGroup class="form-select">',i=0,a=[];for(var o in meshes){var s=GetMeshRights(o);meshes[o]._id!=t&&4&s&&a.push(meshes[o])}for(var o in a.sort(nameSort),a)i++,n+="<option value='"+a[o]._id+"'>"+a[o].name+"</option>";if(n+="</select>",i>0){var l=1==e.length?"Valitse uusi ryhmä tälle laitteelle<br /><br />":"Valitse uusi ryhmä valituille laitteille<br /><br />";setModalContent("xxAddAgent","Vaihda Ryhmää",l+=addHtmlFormFloating("Uusi laiteryhmä",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))}else setModalContent("xxAddAgent","Vaihda Ryhmää","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton");return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){if(xxdialogMode)return!1;var t=format("Haluatko varmasti poistaa solmun {0}?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Varmista</label>';return xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Poista solmu",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog(),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,n,i){var a=null,o=getNodeFromId(e);if(3==o.mtype){var s=meshes[o.meshid];s&&s.relayid&&(a=s.relayid,i=o.host)}var l=serverinfo.name;(-1==l.indexOf(".")||2&features)&&(l=window.location.hostname),""!=webRelayDns&&(l=webRelayDns);var r="https://"+l+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+n+"&appid="+t+"&c="+authRelayCookie;return null!=i&&(r+="&addr="+i),null!=a&&(r+="&relayid="+a),safeNewWindow(r,"WebRelay"),!1}function p10MCRouter(e,t,n,i,a){var o=getNodeFromId(e),s=meshes[o.meshid];return 3==t&&null==n&&(n=null!=o.rdpport?o.rdpport:3389),3==o.mtype&&s&&s.relayid&&(e=s.relayid,i=o.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:n,ip:i,tag:"MCRouter",protocol:t,localport:a,name:s?s.name:null}),!1}function p10rfb(e,t){var n=getNodeFromId(e),i=null,a=meshes[n.meshid];null==t&&(t=null!=n.rfbport?n.rfbport:5900),3==n.mtype&&a&&a.relayid&&(e=a.relayid,i=n.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:i,tag:"novnc",name:a?a.name:null})}function p10mstsc(e,t){var n=getNodeFromId(e),i=meshes[n.meshid];null==t&&(t=null!=n.rdpport?n.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:i?i.name:null})}function p10ssh(e,t){var n=getNodeFromId(e),i=meshes[n.meshid];null==t&&(t=null!=n.sshport?n.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:i?i.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;var e=function(t){var n=[],i=["iploc","wifiloc","gpsloc","userloc"],a=null;for(var o in i)if(null!=currentNode[i[o]]){var s=currentNode[i[o]].split(","),l=parseFloat(s[0]),r=parseFloat(s[1]);if(l<90&&l>-90&&r<180&&r>-180){var d=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([r,l]))});d.setStyle(markerStyle(currentNode,parseInt(o)+1)),n.push(d),null==a?a=[l,r,l,r,0]:(l<a[0]&&(a[0]=l),r<a[1]&&(a[1]=r),l>a[2]&&(a[2]=l),r>a[3]&&(a[3]=r))}}var u=new ol.source.Vector({features:n}),c=new ol.layer.Vector({source:u}),p=0,m=0,g=8;if(null!=a){m=(a[0]+a[2])/2,p=(a[1]+a[3])/2;var v=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3])),h=360;for(g=-2;h>v;)g++,h/=2}1==n.length&&(g=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),c],view:new ol.View({center:ol.proj.fromLonLat([p,m]),zoom:g})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",e)};document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",e);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Laitteen sijainti","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Verkkoliitännät","<div id=d2netinfo>Ladataan...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){if(!xxdialogMode){var e="<div>MeshCentral Reititin on Windows-työkalu TCP-porttien tunneloimiseen. Voit esimerkiksi yhdistää etälaitteesi RDP:n tämän palvelimen kautta.</div><br />";e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>',e+='<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>';var t=serverinfo.name;(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);e+='<br /><div class="alert alert-info">Suorita MeshCentral Reititin ja napsauta "asenna", jotta se voidaan käynnistää selaimesta.</div>',e+='<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Käynnistä MeshCentral Reititin" class="btn btn-primary btn-block" /></a>',setModalContent("xxAddAgent","MeshCentral Reititin",e+='<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")})}}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var n="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",i=getNodeFromId(t);if(null!=i)return[1,2,3,4,21,22].indexOf(i.agent.id)>=0?n+="&os=win":n+="&os=linux",urlargs.key&&(n+="&key="+urlargs.key),safeNewWindow(n,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){if(!xxdialogMode){0;var n="";0==e&&(n+="<div>MeshCmd on komentorivityökalu, joka suorittaa paljon erilaisia ​​toimintoja. Toimintatiedosto voidaan valinnaisesti ladata ja muokata palvelintietojen ja tunnistetietojen tarjoamiseksi.<br /><br />"),1==e&&(n+='<div>Lataa "meshcmd", toimintotiedoston avulla liikenteen ohjaamiseksi palvelimelta tähän laitteeseen. Muista muokata meshaction.txt ja lisätä tilisi salasana tai tehdä tarvittavat muutokset.<br /><br />'),n+=addHtmlFormFloating("Käyttöjärjestelmä","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64-bittinen)</option><option value=29>macOS ARM (64-bittinen)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"),n+=addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(n+=addHtmlValue("Toimintotiedosto",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(n+=addHtmlValue("Toimintotiedosto",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Lataa MeshCmd",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick()}}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 executable)"),4==e&&(t="MeshCmd (Win x86-64 executable)"),43==e&&(t="MeshCmd (Win ARM-64 executable)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS, x86-64-bittinen)"),29==e&&(t="MeshCmd (macOS, ARM-64-bittinen)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){if(!xxdialogMode&&4&GetNodeRights(currentNode)){setModalContent("xxAddAgent","Kuvakkeen valinta",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0)}}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Muokkaa laitetta","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Muokkaa laitetta","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Laitteen Nimi","Isäntänimi","Kuvaus","Tunnisteet"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Tag1, Tag2, Tag3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",n="",i=currentNode[showEditNodeValueDialog_modes2[e]];if(null==i&&(i=""),3==e){t="<select id=dp10devicevalue multiple maxlength="+showEditNodeValueDialog_modes4[e]+" class=form-control>";var a=[];for(var o in nodes)if(nodes[o].tags)for(var s in nodes[o].tags)-1==a.indexOf(nodes[o].tags[s])&&a.push(nodes[o].tags[s]);if(a.length>0)for(var o in a.sort(),a)n+=Array.isArray(i)&&-1!==i.indexOf(a[o])?"<option selected=selected>"+EscapeHtml(a[o])+"</option>":"<option>"+EscapeHtml(a[o])+"</option>";setModalContent("xxAddAgent","Edit Tags",t+=n+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Muokkaa laitetta",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(i)&&(i=i.join(", ")),Q("dp10devicevalue").value=i;p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogEx(e,t){var n="",i={action:"changedevice",nodeid:currentNode._id};if(3==t){var a=$("#dp10devicevalue").select2("data");for(var o in a)n+=a[o].text.trim()+", ";i[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(n.slice(0,-2))}else i[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(i)}function p10editdevicevalueValidate(e,t){var n=e>1||Q("dp10devicevalue").value.length>0;QE("idx_dlgOkButton",n),null!=t&&1==n&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){if(desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktopNode=null,desktop=null),desktopNode!=currentNode||null==desktop){var e=multiDesktop[currentNode._id];if(null!=e){QH("DeskParent","");var t=e.m.CanvasId;t.setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},8192&features2&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]}else null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode;Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})}desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo,deskDisplayInfo(desktop.m,desktop.m.displays,desktop.m.selectedDisplay)),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0;null!=desktop&&(e=desktop.State);var t=GetNodeRights(currentNode),n=1==currentNode.agent?1:2;QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",!(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==n?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&!!(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&16&currentNode.intelamt.sku||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype));var i=!(8192&features2||null!=currentNode.agent&&14==currentNode.agent.id||4294967295!=t&&(!(8&t)||256&t||4096&t)),a=!!(1&currentNode.conn);QE("connectbutton1",a),QE("connectbutton1d",a),QE("connectbutton1r",a||3==currentNode.mtype),QE("connectbutton1rd",a||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport?currentNode.rdpport:3389)+"</a>"):QH("desktopCustomUpperRight","");var o=!!(6&currentNode.conn);QE("connectbutton1h",o),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",i&&currentNode.agent&&!!(6144&~features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&i),QE("DeskType",3==e),QV("DeskType",i),QE("DeskWD",3==e),QV("DeskWD",i),QV("deskkeys",i),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none";var s=desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard;QV("DeskClipboardOutButton",a&&i&&null!=desktop&&!(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=s||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&!(4096&features2)),QV("DeskClipboardInButton",a&&i&&null!=desktop&&!(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=s||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",!!(131072&t)&&a),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&!(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&!(1024&features2)),QV("DeskChatButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&a),QV("DeskNotifyButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&a),QV("DeskLockButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&i&&3==e),QV("DeskToolsButton",currentNode.agent&&a),QE("DeskToolsButton",i),QV("DeskOpenWebButton",0==browserfullscreen&&i&&currentNode.agent&&a),QV("DeskBackgroundButton",i&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&a),QV("DeskControlSpan",i),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==a&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){null==autoConnectDesktopTimer?autoConnectDesktopTimer=setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),autoConnectDesktopTimer=null)}var agentConsoleMessages=["","Odotetaan, että käyttäjä myöntää käyttöoikeuden...","Evätty","Etäpääteistunnon aloittaminen epäonnistui, {0} ({1})","Aikakatkaisu","Vastaanotettu virheellisiä verkkotietoja","Näytön kaappaus ei onnistu","Protokollaneuvottelu epäonnistui ({0})","NLA:ta ei tueta","Palvelimen vaatima SSL","Palvelin ei salli SSL:ää","SSL-varmenne ei ole palvelimella","Epäjohdonmukaiset liput","Palvelimen vaatima hybridi","Palvelimen vaatima SSL käyttäjän todennus"];function formatAgentConsoleMessage(e,t,n){for(null==n&&(n=[]);n.length<3;)n.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],n[0],n[1],n[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,n,i){if(!xxdialogMode)if(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop)if(desktopNode=currentNode,2==t){if(null==desktopNode.intelamt.user||""==desktopNode.intelamt.user)return void editDeviceAmtSettings(desktopNode._id,connectDesktop,2);(desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0!=e.length){var t=null;try{t=JSON.parse(e)}catch(e){}if(null!=t&&null!=t.action)if("restart"==t.action)webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}));else if("present"==t.action&&null==webRtcDesktop){webRtcDesktop={platform:t.platform};"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("Tietokanava",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}else"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset)}else desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})))},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2}else null==t||1==t||3==t&&currentNode.agent.id>4&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=n&&(desktop.options.tsid=n),null!=i&&(desktop.options.consent=i),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,8192&features2&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:i}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport?currentNode.rdpport:3389,n),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()});else desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")}function askRdpCredentials(){if(!xxdialogMode){var e="<div>";1==currentNode.rdp?(e+=addHtmlFormFloating("Valtakirjat",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Käytä palvelimen kirjautumistietoja</option><option value=2>Käytä uusia kirjautumistietoja</option></select>'),e+="<div id=d2cred style=display:none>"):e+="<div id=d2cred>",e+=addHtmlFormFloating("Verkkotunnus",'<input type=text id=d2domain class="form-control" maxlength=128 />'),e+=addHtmlFormFloating("Käyttäjätunnus",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'),e+=addHtmlFormFloating("Salasana",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),4194304&features2||(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Muista valtakirjat</label>')),e+="</div>",e+=MoreStart(),e+=addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'),e+=addHtmlFormFloating("Työskentely Dir",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'),setModalContent("xxAddAgent","RDP:n valtuustiedot",e+=MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx())}}function askRdpCredentialsValidate(){1!=currentNode.rdp||(QV("d2cred",2==Q("d2mode").value),1!=Q("d2mode").value)?QE("idx_dlgOkButton",""!=Q("d2user").value):QE("idx_dlgOkButton",!0)}function askRdpCredentialsEx(){var e=null,t=null;if(desktopsettings.rdpsize)if("browser"==desktopsettings.rdpsize)e=window.innerWidth,t=window.innerHeight;else if("screen"==desktopsettings.rdpsize)e=window.screen.width,t=window.screen.height;else if("canvas"==desktopsettings.rdpsize)e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;else{var n=desktopsettings.rdpsize.indexOf("x");n>=1&&(e=parseInt(desktopsettings.rdpsize.substring(0,n)),t=parseInt(desktopsettings.rdpsize.substring(n+1)))}else e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;if(1==currentNode.rdp&&1==Q("d2mode").value)connectDesktop(null,4,{servercred:!0,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value});else{var i=!1;4194304&features2||(i=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:i,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value})}}function updateMetadata(e,t){var n="",i=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var a in e.metadata.users)i+=e.metadata.users[a];i>1&&(n="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} katselee",i)+"</span>")}QH("deskmetadata",n),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=null;if(1==e&&(t=desktop),t&&t.metadata){var n="";if(t.metadata.startTime&&(n+=addHtmlValue4("Käynnistys aika",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var i in t.metadata.users){var a=1==t.metadata.users[i]?"1 yhteys":format("{0} yhteyttä",t.metadata.users[i]);n+=addHtmlValue2(getUserName(i),a)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Istunnon tiedot",n),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var n=t;3==n&&2==e.contype&&n++;var i=StatusStrs[n];switch(null!=desktop&&1==desktop.webRtcActive&&(i+=", WebRTC"),null!=desktop&&3==n&&4==desktop.contype&&(i+=", RDP"),QH("deskstatus",i),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Kaikki keskittyvät",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:default:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,deskLastClipboardSent=null,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&desktop.latency.current>=0&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&terminal.latency.current>=0&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){if(!xxdialogMode){applyDesktopSettings(),updateDesktopButtons();var e=!1;("none"!=QS("td7meshkvm").display&&Q("td7meshkvm").className.indexOf("active")>0||"none"!=QS("td7rdpkvm").display&&Q("td7rdpkvm").className.indexOf("active")>0||"none"!=QS("td7amtkvm").display&&Q("td7amtkvm").className.indexOf("active")>0)&&(e=!0),0==e&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Etätyöpöydän asetukset",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged)}}function changeDesktopSettingsTab(e,t){var n,i,a;for(i=document.getElementsByClassName("tabcontent"),n=0;n<i.length;n++)i[n].style.display="none";for(a=document.getElementsByClassName("tablinks"),n=0;n<a.length;n++)a[n].className=a[n].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,putstore("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh())),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Kaikki keskittyvät"),0!=desktop.State&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50))),4==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw))}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(var n in t)e+="<option value="+t[n]+">"+t[n]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,t.indexOf(parseInt(desktopsettings.quality))>=0&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(n=1;n<10;n++)5!=n&&(Q("d7rdp"+n).checked=!!(desktopsettings.rdpflags&1<<n-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);if(fullscreen=!fullscreen)QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("body")),browserfullscreen=!0);else{QC("body").remove("fulldesk");var n=args.hide;0==footerBar&&(n|=4);var i=(1&n?0:66)+(2&n?0:24)+(4&n?0:45)+(8&n?0:60);QS("deskarea3x").height="calc(100vh - "+(75+i)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+i)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+i)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+i)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)}deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Kaikki keskittyvät","Pieni tarkennus","Suuri tarkennus"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,n=Q("Desk").height,i=Q("Desk").width;if(2==deskAspectRatio)QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden";else if(1==deskAspectRatio)QS("Desk")["margin-top"]="0px",QS("Desk").height=n+"px",QS("Desk").width=i+"px",QS("DeskParent").overflow="scroll";else{if(e/t>n/i){var a=n*t/i+"px";QS("Desk").height=a,QS("Desk").width="100%"}else{var o=i*e/n+"px";QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=o}QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden"}}function mdeskAdjust(e,t,n,i){if(e&&t&&n&&i){var a=Q("viewselect").value;if(3==a||5==a)if("Desk"!=i.id){if(5==a){var o=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];QS(i.id).width=(0!=e.State?t*o.y/n:o.x)+"px"}QS(i.id)["margin-top"]=null,QS(i.id)["margin-bottom"]=null}else deskAdjust()}}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){if(haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length){var t=e.dataTransfer.files[0],n=t.name.toLowerCase();if(n.endsWith(".bat")||n.endsWith(".ps1")||n.endsWith(".sh")||n.endsWith(".agentconsole"))d2runCommandDialog({nodeids:[currentNode._id],selectedFile:t});else if(n.endsWith(".txt")){var i=new FileReader;i.onload=function(e){showDeskType(e.target.result)},i.readAsText(t)}}}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);var t=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",t),QV("p11bigfail",!t)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e="",t=parseInt(Q("deskkeys").value);for(var n in""==t&&deskKeyboardShortcuts.length>0&&(t=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)e+="<option value="+deskKeyboardShortcuts[n]+(t==deskKeyboardShortcuts[n]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[n])+"</option>";QH("deskkeys",e)}var keyStrings={8:"BackSpace",9:"Välilehti",13:"Tulla sisään",27:"Paeta",32:"Space",44:"Tulosta näyttö",45:"Lisää",46:"Del",36:"Koti",35:"Loppu",33:"Sivu ylös",34:"Sivu alas",37:"Vasen",38:"Ylös",39:"Aivan",40:"Alas",0:"Ei mitään"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Siirtää"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),(e&=65535)>=112&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';for(var t in e+='<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Siirtää</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>',e+=" <select id=d2keySelect>",keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";e+="</select> <input type=button value=Lisätä onclick=addDeskCustomizeKey() /></div>",setModalContent("xxAddAgent","Pikanäppäinten mukauttaminen",e+='<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e="";for(var t in deskKeyboardShortcuts){var n=keyShortcutTotext(deskKeyboardShortcuts[t]),i="";t!=deskKeyboardShortcuts.length-1&&(i+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[t]+")>"),0!=t&&(i+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[t]+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[t]+">"+n+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[t]+")>"+i+"</div>"}""==e&&(e="<i>Pikanäppäimiä ei ole määritetty</i>"),QH("d2shortcuts",e)}function deskCustomizeKeyDown(e){var t=deskKeyboardShortcuts.indexOf(e),n=deskKeyboardShortcuts[t+1];deskKeyboardShortcuts[t+1]=deskKeyboardShortcuts[t],deskKeyboardShortcuts[t]=n,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var t=deskKeyboardShortcuts.indexOf(e),n=deskKeyboardShortcuts[t];deskKeyboardShortcuts[t]=deskKeyboardShortcuts[t-1],deskKeyboardShortcuts[t-1]=n,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t=[];for(var n in deskKeyboardShortcuts)deskKeyboardShortcuts[n]!=e&&t.push(deskKeyboardShortcuts[n]);deskKeyboardShortcuts=t,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var t in e)""!=e[t]&&deskKeyboardShortcuts.push(parseInt(e[t]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),e>0&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){if(!xxdialogMode){var e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';e+=addHtmlFormFloating("Nimi",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),e+=addHtmlFormFloating("Arvo",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),setModalContent("xxAddAgent","Näppäimistön kielten mukauttaminen",e+=addHtmlFormFloating("",'<input id=d2addbutton type=button value=Lisätä onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate()}}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e="";for(var t in deskKeyboardStrings){var n="";t!=deskKeyboardStrings.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+t+")>"),0!=t&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+t+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(t+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[t].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+t+")>"+n+"</div>",e+="<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[t].v)+"</div>",e+="</div>"}""==e&&(e="<i>Näppäimistön merkkijonoja ei ole määritetty</i>"),QH("d2strings",e)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e="";for(var t in deskKeyboardStrings){e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(t)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[t].n)+"</div>"}""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu2",e)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406!=e){var t=(16711680&e)>>16,n=65535&e,i=[],a=[],o={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(i.push([65505,1]),a.push([65505,0])),2&t&&(i.push([65513,1]),a.push([65513,0])),8&t&&(i.push([65507,1]),a.push([65507,0])),16&t&&(i.push([65511,1]),a.push([65511,0])),o[n]&&(n=o[n]),n>=65&&n<=90&&(n+=32),0!=n&&(i.push([n,1]),a.push([n,0])),a.reverse();for(var s=0;s<a.length;s++)i.push(a[s]);desktop.m.sendkey(i)}else{1&t&&(i.push([desktop.m.KeyAction.DOWN,16]),a.push([desktop.m.KeyAction.UP,16])),2&t&&(i.push([desktop.m.KeyAction.EXDOWN,18]),a.push([desktop.m.KeyAction.EXUP,18])),8&t&&(i.push([desktop.m.KeyAction.EXDOWN,17]),a.push([desktop.m.KeyAction.EXUP,17])),16&t&&(i.push([desktop.m.KeyAction.EXDOWN,91]),a.push([desktop.m.KeyAction.EXUP,91])),0!=n&&(i.push([desktop.m.KeyAction.DOWN,n]),a.push([desktop.m.KeyAction.UP,n])),a.reverse();for(s=0;s<a.length;s++)i.push(a[s]);desktop.m.SendKeyMsgKC(i)}}else desktop.m.sendcad()}}function showDeskType(e){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskType").blur();var t="<div>Kirjoita teksti ja kirjoita se etänä napsauttamalla OK. Varmista, että asetat etäkohdistimen oikeaan kohtaan ennen kuin jatkat.<div>";setModalContent("xxAddAgent","Etänäppäimistön merkintä",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus()}}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,n,i=[],a=!1;if("string"==typeof e?(t=e,n=e.toUpperCase()):(t=Q("d2typeText").value,n=Q("d2typeText").value.toUpperCase()),2==desktop.contype){for(var o in t){var s=t.charCodeAt(o);i.push([s,1],[s,0])}AmtDeskTypeContent=i,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var o in t){s=t.charCodeAt(o);var l=n.charCodeAt(o);s>=65&&s<=90||s>=97&&s<=122?(s==l&&0==a&&(i.push([desktop.m.KeyAction.DOWN,16]),a=!0),s!=l&&1==a&&(i.push([desktop.m.KeyAction.UP,16]),a=!1)):s>=48&&s<=57?1==a&&(i.push([desktop.m.KeyAction.UP,16]),a=!1):DeskTypeTranslate[s]?(1==a&&(i.push([desktop.m.KeyAction.UP,16]),a=!1),l=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==a&&(i.push([desktop.m.KeyAction.DOWN,16]),a=!0),l=DeskTypeShiftTranslate[s]),i.push([desktop.m.KeyAction.DOWN,l],[desktop.m.KeyAction.UP,l])}1==a&&(i.push([desktop.m.KeyAction.UP,16]),a=!1),desktop.m.SendKeyMsgKC(i)}}function showDeskClip(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskClip").blur();var e="";2048&features2||(e+='<input id=dlgClipGet type=button value="Hanki leikepöytä" style=width:160px onclick=showDeskClipGet()>'),4096&features2||(e+='<input id=dlgClipSet type=button value="Aseta leikepöytä" style=width:160px onclick=showDeskClipSet()>'),e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>',e+='<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>',xxdialogTag="clipboard",setModalContent("xxAddAgent","Etä leikepöytä",e+='<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>Etäleikepöytä on voimassa 60 sekuntia.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus()}}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&currentNode.agent.id>4&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){var t=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==t&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==t&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(deskTools.msg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=n){for(var i in n)t.push({p:parseInt(i),c:n[i].cmd,d:n[i].cmd.toLowerCase(),u:n[i].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var a="";for(var o in t)if(0!=t[o].p){var s=t[o].c;a+="<div onclick=showProcessDetails("+t[o].p+') class="deskToolsBar d-flex">',a+='<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[o].p)+"</div>",a+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(s)+'">'+s+"</div>",a+='<div class="ms-auto">'+(t[o].u?EscapeHtml(t[o].u):""),a+='<i class="ps-1 fa-solid fa-trash-can" role="button" title="Pysäytä prosessi" onclick=\'return stopProcess('+EscapeHtml(t[o].p)+',"'+EscapeHtml(t[o].c)+"\")'></i></div>",a+="</div>"}QH("DeskToolsProcesses",a)}}}else QH("DeskToolsProcesses","")}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Prosessin tiedot, #{0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(deskTools.smsg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(deskTools.services=n,null!=n){for(var i in n)n[i].status?t.push({p:capitalizeFirstLetter(n[i].status.state.toLowerCase()),d:n[i].displayName,i:i}):n[i].serviceType&&t.push({p:n[i].serviceType,d:n[i].name,i:i});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var a="";for(var i in t)if(0!=t[i].p){var o=t[i].d,s=t[i].p;"Stopped"==s?s="Pysähtyi":"Running"==s&&(s="Juoksemassa"),a+="<div onclick=showServiceWaitDialog("+t[i].i+") class=deskToolsBar>",a+="<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(s)+"</div>",a+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+o+'">'+EscapeHtml(o)+"</div>",a+="</div>"}QH("DeskToolsServices",a)}}}else QH("DeskToolsProcesses","")}function showServiceDetailsDialog(e){if(xxdialogMode&&-1!=xxdialogTag.indexOf("service_")){var t=xxdialogTag.replace("service_",""),n=e.value?JSON.parse(e.value):deskTools.services[t];if(e.value&&(n.displayName=deskTools.services[t].displayName),null!=n){var i="";if(n.name&&(i+=addHtmlValue("Nimi",n.name)),n.displayName&&(i+=addHtmlValue("Näyttönimi",n.displayName)),n.status){var a=capitalizeFirstLetter(n.status.state.toLowerCase());"Stopped"==a?a="Pysähtyi":"Running"==a&&(a="Juoksemassa"),n.status.state&&(i+=addHtmlValue("Tila",a)),n.status.pid&&(i+=addHtmlValue("PID",n.status.pid));var o=[];!0===n.status.isFileSystemDriver&&o.push("TiedostojärjestelmänAjuri"),!0===n.status.isInteractive&&o.push("Interaktiivinen"),!0===n.status.isKernelDriver&&o.push("Ytimenohjain"),!0===n.status.isOwnProcess&&o.push("OmaProsessi"),!0===n.status.isSharedProcess&&o.push("Jaettu prosessi"),o.length>0&&(i+=addHtmlValue("Tyyppi",o.join(", ")))}if(n.startType&&(i+=addHtmlValue("Start Type",n.startType)),n.user&&(i+=addHtmlValue("Käyttäjä",n.user)),n.installedBy&&(i+=addHtmlValue("Installed By",n.installedBy)),n.installedDate&&(i+=addHtmlValue("Installed Date",printDateTime(new Date(n.installedDate)))),n.failureActions){if(n.failureActions.resetPeriod){var s=(n.failureActions.resetPeriod<86400?0:n.failureActions.resetPeriod)/86400;i+=addHtmlValue("Restart Fail Count After ",s+" Day"+(1!=s?"s":""))}n.failureActions.actions&&(n.failureActions.actions[0]&&(i+=addHtmlValue("First Failure",n.failureActions.actions[0].type)),n.failureActions.actions[1]&&(i+=addHtmlValue("Second Failure",n.failureActions.actions[1].type)),n.failureActions.actions[2]&&(i+=addHtmlValue("Subsequent Failures",n.failureActions.actions[2].type)))}xxdialogTag="service_"+t,setModalContent("xxAddAgent","Palvelun tiedot",i+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Sulje" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Käynnistä" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Pysäytä" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Käynnistä uudelleen" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function showServiceWaitDialog(e){if(xxdialogMode)return!1;var t=deskTools.services[e];return null!=t&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Palvelun tiedot","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){if(setDialogMode(0),0!=e){var n=deskTools.services[t];null!=n&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:n.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:n.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:n.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){if(null!=desktop)if(null==desktop.m.recordedData)Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording();else{Q("DeskRecordButtonImage").style.color="";var e=new Date,t="DesktopSession-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);saveAs(data2blob(desktop.m.StopRecording().join("")),t+".mcrec")}}function deskSaveImage(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){var e=new Date,t="Työpöytä-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);Q("Desk").toBlob(function(e){saveAs(e,t+".png")})}}function deskDisplayInfo(e,t,n){var i=0,a="";for(var o in t){i++;var s=t[o],l=1;"All Displays"==s&&(s="Kaikki näytöt",l=2),s.startsWith("Display ")&&(s=format("Näyttö {0}",s.substring(8)));var r="id=DeskMonitorSelectionX"+o+' title="'+EscapeHtml(s)+'" onclick=deskSetDisplay('+o+") role=button";a+=2==l?"<span "+r+' class="fa-layers fa-fw '+(n==o?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+r+' class="fa-fw fa-solid fa-desktop '+(n==o?"":" gray")+'"></i>',deskPreferedStickyDisplay==o&&n!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(o),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",a),QV("DeskMonitorSelectionSpan",i>1)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){var t=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=t<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){if(deskTools.resizing){var t=Q("DeskTools").getBoundingClientRect().right-e.clientX;t<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=t+"px")}});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){if(1==e.buttons){var t=Date.now();t-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY}}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked)&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),!0)}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Prosessinhallinta",format('Lopetetaanko prosessi #{0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminalNode=null,terminal=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state;3==terminalNode.mtype&&null!=terminalNode.agent&&terminalNode.agent.id>4&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&!(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH -portti {0}",terminalNode.sshport?terminalNode.sshport:22)+"</a>");var t=!!(1&terminalNode.conn)||3==terminalNode.mtype;QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t);var n=!!(6&terminalNode.conn);QE("connectbutton2h",n),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF");var i=!(0===args.xterm||null!=terminal&&null==xterm);QV("termarea3xdiv",i),QV("Term",!i),QV("bsbutton",!i),QV("pastebutton",!i),QV("devListToolbarViewIcons2",i),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var n=t;3==n&&2==e.contype&&n++;var i=StatusStrs[n];switch(3==n&&(3==e.contype&&(i+=", SSH"),1==e.webRtcActive&&(i+=", WebRTC")),QH("termstatus",i),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){null==autoConnectTerminalTimer?autoConnectTerminalTimer=setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),autoConnectTerminalTimer=null)}function CreateRemoteTunnel(e,t){var n={protocol:1};return null!=t&&"number"==typeof t.protocol&&(n.protocol=t.protocol),n.onTunnelUpdate=e,n.xxStateChange=function(e){},n.ProcessBinaryData=function(e){n.onTunnelUpdate(e)},n.ProcessData=function(e){n.onTunnelUpdate(e)},n.terminalEmulation=1,n.fxEmulation=0,n.lineFeed="\r\n",n}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){var n="";e.askkeypass?n+=addHtmlFormFloating("Todentaminen",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Tallennettu avain</option><option value=1>Käyttäjänimi Salasana</option><option value=2>Käyttäjätunnus ja avain</option></select>'):n+=addHtmlFormFloating("Todentaminen",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Käyttäjänimi Salasana</option><option value=2>Käyttäjätunnus ja avain</option></select>'),n+="<div id=d2userauth style=display:none>",n+=addHtmlFormFloating("Käyttäjätunnus",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),n+="</div>",n+="<div id=d2passauth style=display:none>",n+=addHtmlFormFloating("Salasana",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(n+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Muista valtakirjat</label>')),n+="</div><div id=d2keyauth style=display:none>",n+=addHtmlValue("Avaintiedosto",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Avaintiedoston on oltava OpenSSH -muodossa.</div>'),n+=addHtmlFormFloating("Avaimen salasana",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(n+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Muista käyttäjä ja avain</label>'),n+=addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Muista salasana</label>')),n+="</div>",e.askkeypass&&(n+="<div id=d2keyauth2 style=display:none>",n+=addHtmlFormFloating("Salasana",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),n+="</div>"),setModalContent("xxAddAgent","Todentaminen",n);var i=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),connectTerminal()};document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",i),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Yhteysvirhe",5e3);break;case"autherror":p12setConsoleMsg("Todennusvirhe",5e3);break;case"sessionerror":p12setConsoleMsg("Istunto päättyi",5e3);break;case"sessiontimeout":p12setConsoleMsg("Istunto vanhentunut",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){if(QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2user").value.length>0&&Q("dp2pass").value.length>0);else if(3==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2keypass2").value.length>0);else{if(QE("idx_dlgOkButton",!1),4194304&features2||QE("dp2keep2",Q("dp2keep1").checked),1==(Q("dp2user").value.length>0&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)){var t=new FileReader;t.onload=function(e){var t=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")>=0||e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END RSA PRIVATE KEY-----")>=0;QE("idx_dlgOkButton",t),QS("d2badkey").color=t?"#000":"#F00"},t.readAsText(Q("dp2key").files[0])}}e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id&&dialogclose(1))}function sshConnectEx(e){if(0==e)null!=terminal&&connectTerminal();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else if(3==Q("dp2authmethod").value)terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var n=new FileReader,i=Q("dp2user").value,a=Q("dp2keypass").value;n.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:i,keypass:a,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},n.readAsText(Q("dp2key").files[0])}}}function xTermSendResize(){xtermResizeTimer=null,null!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,n){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var i={};1==Q("termSizeList").value?(i.cols=80,i.rows=25):2==Q("termSizeList").value&&(i.cols=100,i.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",i),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{i={protocol:null!=n&&"number"==typeof n.protocol?n.protocol:1};n&&n.requireLogin&&(i.requireLogin=!0),n&&n.consent&&(i.consent=n.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(i.cols=80,i.rows=25,i.xterm=!0):2==Q("termSizeList").value?(i.cols=100,i.rows=30,i.xterm=!0):3==Q("termSizeList").value&&(i.cols=Math.floor((Q("column_l").clientWidth-60)/10),i.rows=Math.floor((Q("column_l").clientHeight-120)/20),i.xterm=!0)),e&&1==e.shiftKey&&(currentNode.agent.id>4?1==i.protocol&&(i.protocol=7):1==i.protocol&&(i.protocol=6)),null!=serverinfo.linuxshell&&currentNode.agent.id>4&&("root"==serverinfo.linuxshell&&(i.protocol=1,delete i.requireLogin),"user"==serverinfo.linuxshell&&(i.protocol=8,delete i.requireLogin),"login"==serverinfo.linuxshell&&(i.protocol=1,i.requireLogin=!0)),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),i.cols=xterm.cols,i.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,i),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.options=i,i.requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",i),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=i,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=[1,2,3,4,21,22].indexOf(currentNode.agent.id)>=0?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["UTF8-terminaali","Laajennettu ASCII","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC+[OM)","Vaihtoehtoinen (F10 = ESC + 0)","VT100 + (F10 = ESC + [OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Liitä",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),filesNode=null,files=null);var e=!!(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",!(!(512&features2)||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id||8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&!(8388608&features2)),QV("p13Disconnect",0!=t);var n=StatusStrs[t];switch(3==t&&(2==files.contype&&(n+=", SFTP"),1==files.webRtcActive&&(n+=", WebRTC")),Q("p13Status").textContent=n,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var i=[];try{i=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var a=0;a<i.length;a++)i[a].n==currentNode._id&&(p13targetpath=i[a].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){null==autoConnectFilesTimer?autoConnectFilesTimer=setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),autoConnectFilesTimer=null)}function connectFiles(e,t,n){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:n},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(e){if(e.length>0&&123!=e.charCodeAt(0))p13gotDownloadBinaryData(e);else{try{e=JSON.parse(decode_utf8(e))}catch(t){try{e=JSON.parse(e)}catch(t){return void console.log("Unable to parse: "+e)}}if("download"!=e.action)if("findfile"!=e.action)if(null!=e.action&&e.action.startsWith("upload"))p13gotUploadData(e);else{switch(e.action){case"sshauth":return void sshTunnelAuthDialog(e,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Todennusvirhe",5e3);case"connectionerror":return void p13setConsoleMsg("Yhteysvirhe",5e3);case"sessionerror":return void p13setConsoleMsg("Istunto päättyi",5e3);case"sessiontimeout":return void p13setConsoleMsg("Istunto vanhentunut",5e3)}if("dialogmessage"!=e.action)if("refresh"!=e.action){if(null!=e.path)if(null==e.dir)""!=p13targetpath&&p13folderup();else if(e.path=e.path.replace(/\//g,"\\"),null!=p13filetree&&e.path==p13filetree.path){var t=p13getCheckedNames();p13filetree=e,p13updateFiles(t)}else{for(var n=e.path.replace(/\//g,"\\"),i=p13targetpath.replace(/\//g,"\\");n.length>0&&"\\"==n[0];)n=n.substring(1);for(;i.length>0&&"\\"==i[0];)i=i.substring(1);(n==i||"\\"==e.path&&""==p13targetpath)&&(p13filetree=e,p13updateFiles())}}else p13folderup(9999);else null==e.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Tiedoston käyttö","<div style=margin:10px>"+EscapeHtml(e.file)+"</div><br /><progress value="+EscapeHtml(e.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Tiedoston käyttö","<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(e.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Tiedoston käyttö","<div style=margin:10px>Unzipping file...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Tiedoston käyttö","<div style=margin:10px>Pakataan tiedostoja ...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)))}else xxdialogTag==e.reqid&&(null==e.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Tiedostoja ei löytynyt</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(e.r)+"</div>"));else p13gotDownloadCommand(e)}}function p13sshConnectEx(e){if(0==e)null!=files&&connectFiles();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}));else if(3==Q("dp2authmethod").value)files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var n=new FileReader,i=Q("dp2user").value,a=Q("dp2keypass").value;n.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:i,keypass:a,key:e.target.result,keep:t}))},n.readAsText(Q("dp2key").files[0])}}}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);return e}function p13updateFiles(e){var t="",n="",i='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Root</a>';if(null!=p13filetree){var a=p13filetree.path.split("\\");for(var o in p13filetreelocation=[],a)""!=a[o]&&p13filetreelocation.push(a[o]);for(var o in p13filetreelocation)i+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(o)+1)+')">'+EscapeHtml(p13filetreelocation[o])+"</a>";var s=p13filetreelocation.join("/"),l=p13sort_files(p13filetree.dir);for(var o in l){var r,d=l[o],u=d.n;r=u.length>70?'<span title="'+EscapeHtml(u)+'">'+EscapeHtml(u.substring(0,70))+"...</span>":EscapeHtml(u);var c="";if(null!=d.d){var p=new Date(d.d);"number"==typeof d.d&&(p=new Date(1e3*d.d));c=printDateTime(p)+"&nbsp;"}var m="";if(null!=d.s){const e=["Bytes","KB","MB","GB","TB"],t=parseInt(Math.floor(Math.log(Math.abs(d.s))/Math.log(1024)),10),n=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex];m=0==Q("p13sizedropdown").value?0===d.s?"n/a":0===t?`${d.s} ${e[t]}`:`${(d.s/1024**t).toFixed(2)} ${e[t]}`:1==Q("p13sizedropdown").value?getFileSizeStr(d.s):`${(d.s/2**n.value).toFixed(2)} ${n.title}`}var g="";if(d.t<3){g="<div class=filelist file=999>",g+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+'\'>&nbsp;<span style=float:right title=""></span>',g+="<span><div class=fileIcon"+("REMOVABLE"==d.dt?5:"CDROM"==d.dt?6:d.t)+' onclick=p13folderset("'+encodeURIComponentEx(d.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(d.nx)+"\")'>",isWindowsNode(currentNode)&&d.dt&&currentNode.volumes&&currentNode.volumes[r.charAt(0).toUpperCase()]&&currentNode.volumes[r.charAt(0).toUpperCase()].name?g+=currentNode.volumes[r.charAt(0).toUpperCase()].name+" ("+r+")":g+=r,g+="</a></span></div>"}else{var v=r;d.s>0&&(v=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(s+"/"+u)+"','"+encodeURIComponentEx(u)+"',"+d.s+')">'+r+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(s+"/"+u)+'","'+encodeURIComponentEx(u)+'") style=cursor:pointer>'+r+"</a>"),g="<div id=fileEntry cmenu=filesContextMenu fileIndex="+o+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+"'>&nbsp;<span class=fsize>"+c+"</span><span style=float:right>"+EscapeHtml(m)+"</span><span><div class=fileIcon"+d.t+"></div>"+v+"</span></div>"}d.t<3?t+=g:n+=g}if(QH("p13files",t+n),QH("p13currentpath",i),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e){var h=document.getElementsByName("fd");for(o=0;o<h.length;o++)e.indexOf(p13filetree.dir[h[o].value].n)>=0&&(h[o].checked=!0)}p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open File/Folder","Are you sure you want to open this file/folder on the remote devices desktop?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[n].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Go To Folder",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],n=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var i=0;i<t.length;i++)t[i].n==currentNode._id&&(n=i);for(n>=0&&t.splice(n,1),t.push({n:currentNode._id,p:e});t.length>40;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){if(!xxdialogMode){var e=addHtmlFormFloating("Suodata",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>');e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>',e+="<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Sulje style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>",setModalContent("xxAddAgent","Etsi tiedostot",e+="<input id=filefind_dlgOkButton type=submit value=Etsi style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus()}}function p13findfileDown(e){"Tulla sisään"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",Q("d2findFilter").value.length>0)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){if(0!=Q("d2findFilter").value.length){var n=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,i=n?"\\":"/",a=p13filetreelocation.join(i)+i;n||(a=i+a),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:a,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1)}}function p13sort_filename(e,t){return e.ln>t.ln?1*p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?1*p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t=[],n=Q("p13sortdropdown").value;for(var i in e)e[i].nx=i,null==e[i].s&&(e[i].s=0),null==e[i].n&&(e[i].n=i),e[i].ln=e[i].n.toLowerCase(),t.push(e[i]);return p13sortorder=1,n>3&&(p13sortorder=-1,n-=3),1==n?t.sort(p13sort_filename):2==n?t.sort(p13sort_bysize):3==n&&t.sort(p13sort_timestamp),t}function p13setActions(){var e=null!=currentNode.agent&&14!=currentNode.agent.id;if(null==p13filetree)QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Valitse kaikki",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1);else{var t=p13getFileSelCount(),n=p13getFileCount(),i=p13getFileSelCount(!1),a=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id;QE("p13DeleteFileButton",t>0&&(p13filetreelocation.length>0||0==a)),QE("p13NewFolderButton",e&&(p13filetreelocation.length>0||0==a)),QE("p13UploadButton",p13filetreelocation.length>0||0==a||14==currentNode.agent.id),QE("p13RenameFileButton",e&&1==t&&(p13filetreelocation.length>0||0==a)),QE("p13ViewFileButton",e&&1==t&&1==i&&(p13filetreelocation.length>0||0==a)),QE("p13SelectAllButton",n>0),Q("p13SelectAllButton").value=t>0?"Poista valinta":"Valitse kaikki",QE("p13RefreshButton",!0),QE("p13FindButton",e&&(p13filetreelocation.length>0||0==a)),QE("p13CutButton",e&&t>0&&t==i&&(p13filetreelocation.length>0||0==a)),QE("p13CopyButton",e&&t>0&&t==i&&(p13filetreelocation.length>0||0==a)),QE("p13ZipButton",e&&t>0&&(p13filetreelocation.length>0||0==a)),QE("p13UnzipButton",e&&1==t&&1==i&&(p13filetreelocation.length>0||0==a)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",e&&(p13filetreelocation.length>0||0==a)&&null!=p13clipboard&&p13clipboard.length>0),QE("p13GoToFolderButton",e),QE("p13OpenButton",e&&1==t),QE("p13DownloadButton",t>0&&t==i&&(p13filetreelocation.length>0||0==a))}1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH -portti {0}",filesNode.sshport?filesNode.sshport:22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,n=document.getElementsByName("fd"),i=0;i<n.length;i++)!n[i].checked||0==e&&"3"!=n[i].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),n=0;n<t.length;n++)if(t[n].checked&&!p13filetree.dir[t[n].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Uusi kansio","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=p13getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Rekursiivinen poisto</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Poista",e>1?format("Poista {0} valittua kohdetta?",e)+t:"Poista valittu kohde?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Nimeä uudelleen",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Lataa tiedosto",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",Q("p13uploadinput").files.length>0)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Tiedostoeditori","Vain alle 200 kt: n tiedostoja voidaan muokata.");break}}function p13unzipFile(){for(var e,t,n=document.getElementsByName("fd"),i=0;i<n.length;i++)if(n[i].checked){var a=isWindowsNode(currentNode)?"\\":"/";e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(a)+a+p13filetree.dir[n[i].value].n.split(".zip")[0]+a,t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(a)+a+p13filetree.dir[n[i].value].n}setModalContent("xxAddAgent","Unzip To Folder",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:t})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Zip-tiedostonimi",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[n].value].n);p13updateClipview()}function p13pasteFile(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format("Haluatko varmasti kopioida {0} kojdetta tänne?",p13clipboard.length):format("Haluatko varmasti kopioida kohteen tänne?"):p13clipboard.length>1?format("Haluatko varmasti siirtää {0} kohdetta tänne?",p13clipboard.length):format("Haluatko varmasti siirtää kohteen tänne?")),setModalContent("xxAddAgent","Liitä",e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format('{0} kohdetta valittu kopiointia varten, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Tyhjennä</a>.',p13clipboard.length):format('Yksi valittu kopiointia varten, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Tyhjennä</a>.'):p13clipboard.length>1?format('{0} kohdetta valittu siirtoa varten, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Tyhjennä</a>.',p13clipboard.length):format('Yksi valittu siirtoa varten, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Tyhjennä</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t=[];for(var n in e.dataTransfer.files)null!=e.dataTransfer.files[n].size&&0!=e.dataTransfer.files[n].size&&t.push(e.dataTransfer.files[n]);0!=t.length&&p13doUploadFiles(t)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);var t=null!=p13filetree;QV("p13bigok",t),QV("p13bigfail",!t)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,n,i){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:n,tsize:0,data:"",state:0,id:Math.random(),tag:i},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Lataa tiedosto","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+n+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){if(gdownloadFile&&0!=gdownloadFile.state)if(e.length>4&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),1&ReadInt(e,0))if("viewer"==gdownloadFile.tag){setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large");var t=gdownloadFile.file;showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null}else saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0);else files.sendText({action:"download",sub:"ack",id:gdownloadFile.id})}function p13downloadButton(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){var n=p13filetree.dir[e[t].value],i="devicefile.ashx?c="+authCookie;i+="&m="+currentNode.meshid.split("/")[2],i+="&n="+currentNode._id.split("/")[2],downloadFile(i+="&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+n.n),encodeURIComponentEx(n.n))}}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Rivitä: PÄÄLLÄ","Rivitä: POIS PÄÄLTÄ"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Koko: 100%","Koko: 125%","Koko: 150%","Koko: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(Q("d4editorarea").value):encode_utf8(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Koodaus: RAW","Koodaus: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var n,i=Q("d4editorarea").value;i=0===d4EditLineBreakVal?i.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?i.replace(/\r\n|\n/g,"\r"):i.replace(/\r\n|\r/g,"\n"),p13uploadFileContinue(1,[{name:t,size:(n=1==d4EditEncodingVal?(new TextEncoder).encode(i):(new TextEncoder).encode(decode_utf8(i))).byteLength,type:"text/plain",xdata:n}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=[],i=0;for(var a in p13filetree.dir)t?n.push(p13filetree.dir[a].n.toLowerCase()):n.push(p13filetree.dir[a].n);for(a=0;a<e.length;a++)t?n.indexOf(e[a].name.toLowerCase())>=0&&i++:n.indexOf(e[a].name)>=0&&i++;0==i?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Lataa tiedosto",format(1==i?"Lataus korvaa 1 tiedoston. Jatkaa?":"Lataus korvaa {0} tiedostoa. Jatkaa?",i)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Lataa tiedosto","<div id=p13dfileName>Yhdistetään...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}const byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var n=new FileReader;n.onerror=function(e){t(null)},n.onload=function(){window.crypto.subtle.digest("SHA-384",n.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},n.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var e=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(e.name)),Q("d2progressBar").max=e.size,Q("d2progressBar").value=0,null==e.xdata){uploadFile.xfile=e;var t=null;for(var n in p13filetree.dir)p13filetree.dir[n].n==e.name&&(t=p13filetree.dir[n]);null!=t&&t.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(n){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,tag:{h:n.toUpperCase(),s:t.s,skip:t.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=e.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":uploadFile.xdataPriming=8,p13uploadNextPart(!1);break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile():p13uploadFileTransferDone();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,n=uploadFile.xptr;if(n>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;o=t.byteLength}var i=new Uint8Array(t.slice(n,o));if(123==i[0]||0==i[0]){var a=new Uint8Array(o-n+1);a.set(i,1),files.send(a)}else files.send(i);uploadFile.xptr=o,Q("d2progressBar").value=o}}else if(uploadFile.xfile){if(null!=uploadFile.xreader)return;if(uploadFile.xptr>=uploadFile.xfile.size)return;var o;if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;o=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e=uploadFile.xreader.result;if(delete uploadFile.xreader,null!=e){var t=new Uint8Array(e);if(123==t[0]||0==t[0]){var n=new Uint8Array(e.byteLength+1);n.set(t,1),files.send(n)}else files.send(t);uploadFile.xptr=o,Q("d2progressBar").value=o,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):uploadFile.xdataPriming>0&&(uploadFile.xdataPriming--,p13uploadNextPart(!0))}},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,o))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(var n in currentDeviceEvents){var i=currentDeviceEvents[n],a=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var o,s="fa-mobile-screen";if("user"==i.etype&&(s="fa-user"),"server"==i.etype&&(s="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])o="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{for(var n in o=eventsMessageId[i.msgid],i.msgArgs){var l=i.msgArgs[n];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),o=o.split("{"+n+"}").join(l)}o=EscapeHtml(o).split("(R)").join("&reg;")}if(i.username){var r="";i.guestname&&(r=' / <span title="Tämä on vieraiden jakamisistunto">'+EscapeHtml(i.guestname)+"</span>"),o=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+r+" &rarr; "+o:EscapeHtml(i.username)+r+" &rarr; "+o}"relay"!=i.etype&&"relaylog"!=i.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+o+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ei tapahtumia</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var n,i;for(var a in 1==t&&(n=currentDeviceEvents),2==t&&(n=events),3==t&&(n=currentUserEvents),n)if(n[a].h==e){i=n[a];break}if(i){var o="<div style=overflow-y:auto;max-height:300px>";for(var a in i)"h"!=a&&"_id"!=a&&"ids"!=a&&"domain"!=a&&null!=i[a]&&("object"==typeof i[a]?o+=addHtmlValue3(EscapeHtml(a),EscapeHtml(JSON.stringify(i[a]))):o+=addHtmlValue3(EscapeHtml(a),EscapeHtml(i[a])));setModalContent("xxAddAgent","Tapahtuman lisätiedot",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"Prosessori",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Muisti",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){"none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc()):deviceDetailsStatsClear()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;deviceDetailsStatsData.length>0&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var n=[],i=[];for(var a in deviceDetailsStatsData){var o=deviceDetailsStatsData[a];n.push({x:100-(o[0]-t),y:o[1]}),i.push({x:100-(o[0]-t),y:o[2]})}if(deviceDetailsConfig.data.datasets[0].data=n,deviceDetailsConfig.data.datasets[1].data=i,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&e.thermals.length>0){var s="&nbsp;";for(var a in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[a].InstanceName+'">'+parseFloat(e.thermals[a].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[a].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,n){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=e._id),null!=t&&(DeviceDetailsHardware=t),null!=n&&(DeviceDetailsNetwork=n),null==(t=DeviceDetailsHardware)&&(t={}),null==(n=DeviceDetailsNetwork)&&(n={});var i=[],a={},o="";if(e.rname&&(o+=addDetailItem("Nimi",EscapeHtml(e.rname),a)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(o+=addDetailItem("Kuvaus",EscapeHtml(t.windows.osinfo.Description),a)),e.osdesc&&(o+=addDetailItem("Versio",EscapeHtml(e.osdesc),a)),t.windows&&t.windows.osinfo)if((p=t.windows.osinfo).OSArchitecture&&(p.OSArchitecture.startsWith("32")?o+=addDetailItem("Arkkitehtuuri","32-bittinen",a):p.OSArchitecture.startsWith("64")?o+=addDetailItem("Arkkitehtuuri","64-bittinen",a):o+=addDetailItem("Arkkitehtuuri",EscapeHtml(p.OSArchitecture),a)),p.LastBootUpTime){var s={year:parseInt(p.LastBootUpTime.substring(0,4)),month:parseInt(p.LastBootUpTime.substring(4,6))-1,day:parseInt(p.LastBootUpTime.substring(6,8)),hours:parseInt(p.LastBootUpTime.substring(8,10)),minutes:parseInt(p.LastBootUpTime.substring(10,12)),seconds:parseInt(p.LastBootUpTime.substring(12,14))};o+=addDetailItem("Last Boot Up Time",printDateTime(new Date(s.year,s.month,s.day,s.hours,s.minutes,s.seconds)))}if(t.linux&&t.linux.LastBootUpTime){o+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))}if(t.darwin&&t.darwin.LastBootUpTime){o+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))}if(""!=o&&i.push({name:"Käyttöjärjestelmä",html:o,img:"software64.png"}),e.agent){o="";if(null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver){var l="";l=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(l+=" v"+e.agent.ver),14==e.agent.id&&(l=e.agent.core),o+=addDetailItem("Mesh Agentti",l)}if(1&e.conn?o+=addDetailItem("Agentin edellinen yhteys","Yhdistetty nyt"):e.lastconnect&&(o+=addDetailItem("Agentin edellinen yhteys",printDateTime(new Date(e.lastconnect)))),e.lastaddr){var r=e.lastaddr.split(":");r.length>2?o+=addDetailItem("Agentin edellinen osoite",'<a href="https://iplocation.com/?ip='+r.slice(0,-1).join(":")+'" rel="noreferrer noopener" target="MeshIPLoopup">'+r.slice(0,-1).join(":")+"</a>"):isPrivateIP(e.lastaddr)?o+=addDetailItem("Agentin edellinen osoite",r[0]):o+=addDetailItem("Agentin edellinen osoite",'<a href="https://iplocation.com/?ip='+r[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+r[0]+"</a>")}if(null!=t.agentvers&&t.agentvers.compileTime){var d=Date.parse(t.agentvers.compileTime);o+=addDetailItem("Käännä aika",isNaN(d)?t.agentvers.compileTime:printDateTime(new Date(d)))}""!=o&&i.push({name:"Mesh Agentti",html:o,img:"meshagent64.png"})}if(t.mobile){o="";t.mobile.brand&&t.mobile.model&&(o+=addDetailItem("Malli",EscapeHtml(t.mobile.brand+", "+t.mobile.model),a)),t.mobile.device&&(o+=addDetailItem("Laite",EscapeHtml(t.mobile.device),a)),t.mobile.bootloader&&(o+=addDetailItem("Käynnistyslatain",EscapeHtml(t.mobile.bootloader),a)),t.mobile.id&&(o+=addDetailItem("Tunniste",EscapeHtml(t.mobile.id),a)),t.mobile.host&&(o+=addDetailItem("Isäntänimi",EscapeHtml(t.mobile.host),a)),t.mobile.androidapi&&t.mobile.androidrelease&&(o+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),a)),""!=o&&i.push({name:"Mobiililaite",html:o,img:"mobile64.png"})}if(null!=n.netif){var u={};for(var c in n.netif){"string"==typeof(p=n.netif[c]).mac&&(null==u[p.mac]?(u[p.mac]=p,u[p.mac].ipv4layer=[{v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}]):u[p.mac].ipv4layer.push({v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}))}o="";for(var c in o+='<table class="table table-hover" style=width:100%>',u){var p=u[c];for(var m in o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.name+(p.dnssuffix?", "+p.dnssuffix:""))+"</b></div>",p.desc&&(o+=addDetailItem("Kuvaus",EscapeHtml(p.desc).split("(R)").join("&reg;"))),p.mac&&(p.gatewaymac?o+=addDetailItem("MAC Kerros",format("MAC: {0}, Yhdyskäytävä: {1}",EscapeHtml(p.mac),EscapeHtml(p.gatewaymac))):p.mac&&(o+=addDetailItem("MAC Kerros",format("MAC: {0}",EscapeHtml(p.mac))))),p.ipv4layer){var g=p.ipv4layer[m];g.v4gateway&&g.v4mask?o+=addDetailItem("IPv4 Kerros",format("IP: {0}, Peite: {1}, Yhdyskäytävä: {2}",EscapeHtml(g.v4addr),EscapeHtml(g.v4mask),EscapeHtml(g.v4gateway))):g.v4addr&&(o+=addDetailItem("IPv4 Kerros",format("IP: {0}",EscapeHtml(g.v4addr))))}o+="</div></td></tr>"}""!=(o+="</table>")&&i.push({name:"Verkko",html:o,img:"networking64.png"})}if(null!=n.netif2){o="";for(var c in o+='<table class="table table-hover" style=width:100%>',n.netif2){p=n.netif2[c];if(!(0==Array.isArray(p)||p.length<1||null==p[0]||"string"==typeof p[0].mac&&p[0].mac.startsWith("00:00:00:00"))){o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var v="";null!=c&&(v+=c),null!=p[0].fqdn&&""!=p[0].fqdn&&(v+=", "+p[0].fqdn),v.length>0&&(o+="<div style=margin-bottom:3px><b>"+EscapeHtml(v)+"</b></div>"),p.desc&&(o+=addDetailItem("Kuvaus",EscapeHtml(p.desc).split("(R)").join("&reg;"))),"string"==typeof p[0].mac&&(p[0].gatewaymac?o+=addDetailItem("MAC Kerros",format("MAC: {0}, Yhdyskäytävä: {1}",EscapeHtml(p[0].mac),EscapeHtml(p[0].gatewaymac))):o+=addDetailItem("MAC Kerros",format("MAC: {0}",EscapeHtml(p[0].mac))));for(m=0;m<p.length;m++){var h=p[m],f=[];h.address&&f.push(format("IP: {0}",EscapeHtml(h.address))),h.netmask&&f.push(format("Maski: {0}",EscapeHtml(h.netmask))),h.gateway&&f.push(format("Yhdyskäytävä: {0}",EscapeHtml(h.gateway))),f.length>0&&("IPv4"==h.family&&(o+=addDetailItem("IPv4 Kerros",f.join(", "))),"IPv6"==h.family&&(o+=addDetailItem("IPv6 Kerros",f.join(", "))))}o+="</div></td></tr>"}}t.network&&t.network.dns&&(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+=addDetailItem("<b>DNS Servers</b>",t.network.dns.join(", ")),o+="</div></td></tr>"),""!=(o+="</table>")&&i.push({name:"Verkko",html:o,img:"networking64.png"})}if(null!=e.intelamt){o="";o+=addDetailItem("Versio",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Tuntematon</i>",a);var k={0:nobreak("Ei aktivoitu"),1:nobreak("Esiaktivointi"),2:nobreak("Aktivoitu")},x="";2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?x=", Asiakasohjaustila (CCM)":4&e.intelamt.flags&&(x=", Järjestelmänvalvojan hallintatila (ACM)")),o+=addDetailItem("Valmistelutila",(e.intelamt.state?k[e.intelamt.state]:"<i>Tuntematon</i>")+x,a),o+=addDetailItem("Turvallisuus",1==e.intelamt.tls?"Suojattu TLS: llä":"TLS: ää ei ole määritetty",a),""!=(o+=addDetailItem("Järjestelmänvalvojan tunnukset",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&9&e.intelamt.warn?"Ei tunnettu":"Tunnettu",a))&&("number"==typeof e.intelamt.sku&&16&e.intelamt.sku?i.push({name:"Intel&reg; Standard Manageability (Intel&reg; SM)",html:o,img:"amt64.png"}):i.push({name:"Intel&reg; Active Management-tekniikka (Inter&reg; AMT)",html:o,img:"amt64.png"}))}if(t.identifiers){o="";var y=t.identifiers;if(y.bios_vendor&&(o+=addDetailItem("Valmistaja",EscapeHtml(y.bios_vendor),a)),y.bios_version&&(o+=addDetailItem("Versio",EscapeHtml(y.bios_version),a)),y.bios_serial&&(o+=addDetailItem("Sarja",EscapeHtml(y.bios_serial),a)),y.bios_mode&&(o+=addDetailItem("Mode",EscapeHtml(y.bios_mode),a)),""!=o&&i.push({name:"BIOS",html:o,img:"chip64.png"}),o="",y.board_vendor&&(o+=addDetailItem("Valmistaja",EscapeHtml(y.board_vendor),a)),y.board_name&&(o+=addDetailItem("Nimi",EscapeHtml(y.board_name),a)),y.board_serial&&""!=y.board_serial&&(o+=addDetailItem("Sarja",EscapeHtml(y.board_serial),a)),y.board_version&&(o+=addDetailItem("Versio",EscapeHtml(y.board_version),a)),y.product_uuid&&(o+=addDetailItem("Tunniste",EscapeHtml(y.product_uuid),a)),y.cpu_name&&(o+=addDetailItem("Prosessori",EscapeHtml(y.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a)),y.gpu_name)for(var c in y.gpu_name)o+=addDetailItem("GPU",EscapeHtml(y.gpu_name[c]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a);""!=o&&i.push({name:"Emolevy",html:o,img:"motherboard64.png"})}if(t.tpm){o="";var b=t.tpm;b.SpecVersion&&(o+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(b.SpecVersion)).toFixed(1),a)),b.ManufacturerId&&(o+=addDetailItem("ManufacturerId",EscapeHtml(b.ManufacturerId),a)),b.ManufacturerVersion&&(o+=addDetailItem("ManufacturerVersion",EscapeHtml(b.ManufacturerVersion),a)),null!=b.IsActivated&&(o+=addDetailItem("IsActivated",b.IsActivated?"Yes":"No",a)),null!=b.IsEnabled&&(o+=addDetailItem("IsEnabled",b.IsEnabled?"Yes":"No",a)),null!=b.IsOwned&&(o+=addDetailItem("IsOwned",b.IsOwned?"Yes":"No",a)),""!=o&&i.push({name:"TPM",html:o,img:"tpm64.png"})}if(t.windows&&t.windows.memory&&t.windows.memory.length>0){o="";for(var c in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),o+='<table class="table table-hover" style=width:100%>',t.windows.memory){p=t.windows.memory[c];o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.BankLabel?p.BankLabel:p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Capacity&&p.Speed?o+=addDetailItem("Kapasiteetti / Nopeus",format("{0} Mb, {1} MHz",p.Capacity/1024/1024,p.Speed),a):p.Capacity&&(o+=addDetailItem("Kapasiteetti",format("{0} Mb",p.Capacity/1024/1024),a)),p.PartNumber&&(o+=addDetailItem("Osa numero",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),o+="</div>"}""!=(o+="</table>")&&i.push({name:"Muisti",html:o,img:"ram64.png"})}if(t.linux&&t.linux.memory&&t.linux.memory.Memory_Device.length>0){o="";for(var c in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),o+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device){(p=t.linux.memory.Memory_Device[c]).Size&&"No Module Installed"==p.Size||(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Locator?p.Locator:"Unknown")+"</b></div>",p.Size&&p.Speed?o+=addDetailItem("Kapasiteetti / Nopeus",format("{0}, {1}",p.Size,p.Speed),a):p.Size&&(o+=addDetailItem("Kapasiteetti",format("{0}",p.Size),a)),p.PartNumber&&(o+=addDetailItem("Osa numero",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),o+="</div>")}""!=(o+="</table>")&&i.push({name:"Muisti",html:o,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&t.darwin.memory.length>0){o="";for(var c in o+='<table class="table table-hover" style=width:100%>',t.darwin.memory){(p=t.darwin.memory[c]).Size&&"No Module Installed"==p.Size||(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Size&&p.Speed?o+=addDetailItem("Kapasiteetti / Nopeus",format("{0}, {1}",p.Size,p.Speed),a):p.Size&&(o+=addDetailItem("Kapasiteetti",format("{0}",p.Size),a)),p.PartNumber&&(o+=addDetailItem("Osa numero",EscapeHtml(p.Manufacturer&&""!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),o+="</div>")}""!=(o+="</table>")&&i.push({name:"Muisti",html:o,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){o="";for(var c in y.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),o+="<table style=width:100%>",y.storage_devices){if((p=y.storage_devices[c]).Size){if(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Caption)+"</b></div>",p.Model&&p.Model!=p.Caption&&(o+=addDetailItem("Malli",EscapeHtml(p.Model),a)),p.Size&&("string"==typeof p.Size&&parseInt(p.Size)==p.Size&&(p.Size=parseInt(p.Size)),"number"==typeof p.Size&&(o+=addDetailItem("Kapasiteetti",format("{0} Mb",Math.floor(p.Size/1024/1024)),a)),"string"==typeof p.Size&&(o+=addDetailItem("Kapasiteetti",EscapeHtml(p.Size),a))),t.windows&&t.windows.drives&&p.Model){const e=t.windows.drives.find(e=>e.Model===p.Model);e&&e.Status&&(o+=addDetailItem("Tila",EscapeHtml(e.Status),a))}o+="</div>"}}""!=(o+="</table>")&&i.push({name:"Tallennustila",html:o,img:"storage64.png"})}if(t.windows&&t.windows.volumes){o="";for(var c in t.windows.volumes){if(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+c+":"+(null==(p=t.windows.volumes[c]).name||""==p.name?"":" - "+EscapeHtml(p.name))+"</b></div>",p.size){var w=["Bytes","KB","MB","GB","TB"],M=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;o+=addDetailItem("Kapasiteetti",EscapeHtml(M),a)}if(p.sizeremaining){w=["Bytes","KB","MB","GB","TB"],M=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.sizeremaining))/Math.log(1024)),10))?`${p.sizeremaining} ${w[m]}`:`${(p.sizeremaining/1024**m).toFixed(2)} ${w[m]}`;o+=addDetailItem("Capacity Remaining",EscapeHtml(M),a)}if(p.type)o+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Tuntematon":EscapeHtml(p.type)),a);if(p.protectionStatus||p.volumeStatus){var S=[];p.protectionStatus&&S.push("Käytössä"),p.volumeStatus&&"FullyDecrypted"==p.volumeStatus&&S.push("Fully Decrypted"),p.volumeStatus&&"EncryptionInProgress"==p.volumeStatus&&S.push("Encryption In Progress"),p.volumeStatus&&"FullyEncrypted"==p.volumeStatus&&S.push("Fully Encrypted"),S=S.join(" - "),p.recoveryPassword&&(S+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(c)+'","'+encodeURIComponentEx(p.identifier)+'","'+encodeURIComponentEx(p.recoveryPassword)+'")')),o+=addDetailItem("BitLocker",S,a)}o+="</div>"}""!=o&&i.push({name:"Storage Volumes",html:"<table style=width:100%>"+o+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){o="";for(var c in t.linux.volumes){if(!(p=t.linux.volumes[c]).mount_point.startsWith("/var/lib/docker/overlay2")){if(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size){w=["KB","MB","GB","TB"],M=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;o+=addDetailItem("Kapasiteetti",EscapeHtml(M),a)}if(p.available){if(0==Math.abs(p.available))M="0 KB";else w=["KB","MB","GB","TB"],M=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.available))/Math.log(1024)),10))?`${p.available} ${w[m]}`:`${(p.available/1024**m).toFixed(2)} ${w[m]}`;o+=addDetailItem("Capacity Remaining",EscapeHtml(M),a)}if(p.type)o+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Tuntematon":EscapeHtml(p.type)),a);o+="</div>"}}""!=o&&i.push({name:"Storage Volumes",html:"<table style=width:100%>"+o+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){o="";for(var c in t.darwin.volumes){if(!(p=t.darwin.volumes[c]).mount_point.startsWith("/var/lib/docker/overlay2")){var C;if(o+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",o+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size&&(o+=addDetailItem("Kapasiteetti",EscapeHtml(p.size),a)),p.available&&(o+=addDetailItem("Capacity Remaining",EscapeHtml(p.available),a)),p.type)o+=addDetailItem("File System",(""!=(C=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?C+" / ":"")+("Unknown"==p.type?"Tuntematon":EscapeHtml(p.type)),a);o+="</div>"}}""!=o&&i.push({name:"Storage Volumes",html:"<table style=width:100%>"+o+"</table>",img:"storage64.png"})}o="";for(var c in i)null==i[c].img?o+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+i[c].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+i[c].html+"</div>":(o+="<table style=width:100%><tr>",o+="<td style=width:64px;vertical-align:top><img src=images/details/"+i[c].img+" border=0 width=64 /></td>",o+="<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+i[c].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+i[c].html+"</div></td>",o+="</tr></table>");""==o?QH("p17info2","Tälle laitteelle ei ole tietoja."):QH("p17info2",o)}}function deviceDetailsShowBitlockerInfo(e,t,n){if(xxdialogMode)return!1;var i="<div><p>Tunniste</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Tuntematon")+"</p>";i+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(n?decodeURIComponent(n):"Tuntematon")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker Information",i),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){if(e.ctrlKey||e.altKey)return!0;var t=0,n=Q("p15consoleText");if(e.key)if(13==e.keyCode&&0==consoleFocus)p15consoleSend(e),t=1;else if(8==e.keyCode&&0==consoleFocus){var i=n.value;n.value=i.substring(0,i.length-1),t=1}else if(27==e.keyCode)n.value="",t=1;else if(38==e.keyCode||40==e.keyCode){var a=consoleHistory.indexOf(n.value);38==e.keyCode&&consoleHistory.length-1>a?n.value=consoleHistory[a+1]:40==e.keyCode&&a>0?n.value=consoleHistory[a-1]:40==e.keyCode&&0==a&&(n.value=""),t=1}else 1===e.key.length&&(insertTextAtCursor(n,e.key),t=1);else 0!=e.charCode&&0==consoleFocus&&(n.value=n.value+String.fromCharCode(e.charCode),t=1);return t>0?haltEvent(e):void 0}function insertTextAtCursor(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t;else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,i=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(i,e.value.length),e.setSelectionRange(i+1,i+1)}else e.value+=myValue}var consoleServerText="";function setupConsole(){if(115==xxcurrentView){var e="server"==consoleNode;consoleNode="server",QH("p15deviceName","Oma palvelinkonsoli"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)}else{e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid];if(16&GetNodeRights(currentNode)){null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight);1&consoleNode.conn||consoleNode.conn;var t=1&consoleNode.conn?"Agentti on online-tilassa":"Agentti on offline-tilassa";16&consoleNode.conn&&(t+=", MQTT on online-tilassa"),QH("p15statetext",t),QE("p15uploadCore",!!(1&consoleNode.conn)),QV("p15outputselecttd",!!(16&consoleNode.conn)||1==currentNode.pmt&&!!(4&features2)),QV("p15outputselect2",!!(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&!!(4&features2));var n=Q("p15outputselect").value;16&consoleNode.conn||2!=n||(n=1,Q("p15outputselect").value=1),1==currentNode.pmt&&4&features2||3!=n||(n=1,Q("p15outputselect").value=1);var i=!1;1&consoleNode.conn&&1==n&&(i=!0),16&consoleNode.conn&&2==n&&(i=!0),1==currentNode.pmt&&4&features2&&3==n&&(i=!0),QE("p15consoleText",i)}else QH("p15statetext","Pääsy Evätty"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1);QV("devListToolbarViewIcons3",!!(1&consoleNode.conn))}}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){if(!e||13==e.keyCode){var t=Q("p15consoleText").value,n="<div style=color:green>&gt; "+EscapeHtml(t)+"<br/></div>";if(115==xxcurrentView?(consoleServerText+=n,meshserver.send({action:"serverconsole",value:t})):16&consoleNode.conn&&2==Q("p15outputselect").value?(n="<div style=color:orange>MQTT&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=n,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:t})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&4&features2?(n="<div style=color:violet>TYÖNTÄÄ&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=n,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:t})):1&consoleNode.conn&&(consoleNode.consoleText+=n,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:t})),Q("p15agentConsoleText").innerHTML+=n,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",t.length>0){var i=consoleHistory.indexOf(t);i>=0&&consoleHistory.splice(i,1),consoleHistory.unshift(t),consoleHistory.splice(10)}}}function p15consoleReceive(e,t,n){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==n?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){if(!xxdialogMode)if(1==e.shiftKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"});else if(1==e.altKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"});else if(1==e.ctrlKey)p15uploadCore2();else{setModalContent("xxAddAgent","Suorita agenttitoiminto",addHtmlFormFloating("Toiminta",'<select id=d3coreMode class="form-select me-2"><option value=1>Lähetä palvelimen oletusydin</option><option value=2>Tyhjennä ydin</option><option value=3>Lataa ydintiedosto</option><option value=4>Pehmeä irrotusaine</option><option value=5>Kova irrota agentti</option><option value=6>Lataa palautusydin</option><option value=7>Lataa pieni ydin</option><option value=8>Restart agent service</option><option value=9>Pakota agenttipäivitys</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)}}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value?meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"}):9==Q("d3coreMode").value&&meshserver.send({action:"updateAgents",nodeids:[consoleNode._id]})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Lataa Mesh Agent Core",""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Edelliset kirjautumiset","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){if(!xxdialogMode){var t=0==e?userinfo:currentUser;setModalContent("xxAddAgent","Hallinnoi tilin kuvaa",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2);var n=Q("p2canvas").getContext("2d");null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random()));var i="";1==e&&(i="&id="+t._id.split("/")[2]);var a=new Image;a.onload=function(){n.clearRect(0,0,256,256),n.drawImage(a,0,0)},a.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+i:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1)}}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],t=new Image;t.onload=function(){var e=0,n=0,i=Math.min(t.width,t.height);t.width>i&&(e=(t.width-i)/2),t.height>i&&(n=(t.height-i)/2);var a=Q("p2canvas").getContext("2d");a.imageSmoothingEnabled=!0,a.webkitImageSmoothingEnabled=!0,a.mozImageSmoothingEnabled=!0,a.clearRect(0,0,256,256),a.drawImage(t,e,n,i,i,0,0,256,256),QE("idx_dlgOkButton",!0)},t.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){var e;!xxdialogMode&&33554432&features&&(null!=userinfo.phone?(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Vahvistettu puhelinnumero</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>",setModalContent("xxAddAgent","Puhelin ilmoitukset",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Poista puhelinnumero</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate()):(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td>Kirjoita tekstiviestihin pystyvä puhelinnumerosi. Kun numero on vahvistettu, sitä voidaan käyttää kirjautumisen varmentamiseen ja muihin ilmoituksiin.",xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Puhelin ilmoitukset",e+='<br /><br /><div style=width:100%;text-align:center>Puhelinnumero: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate()))}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);(i<48||i>57)&&32!=i&&45!=i&&46!=i&&(t=!1)}return t&&e.length>=10}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e;if(!xxdialogMode&&33554432&features2)if(null!=userinfo.msghandle)e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Verified handle</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>",setModalContent("xxAddAgent","Messaging Notifications",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remove messaging</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate();else{e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>',e+="<td>Enter your messaging service and handle. Once verified, this server can send you login verification and other notifications.<br /><br />";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>";1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate()}}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Aihe":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Käyttäjätunnus";var t=Q("d2handleinput").value.length>0;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){if(0!=Q("d2handleinput").value.length)return QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}),!1}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){if(!xxdialogMode&&8388608&features){var e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified;setModalContent("xxAddAgent","Sähköposti todennus",'Kun käytössä, jokaisessa kirjautumisessa, sinulle annetaan mahdollisuus saada kirjautumistunnus sähköpostiisi turvallisuuden lisäämiseksi.<br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+(e?"checked":"")+"/>Ota käyttöön kaksi vaihenen todennus sähköpostitse.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})})}}function account_manageAuthDuo(){!xxdialogMode&&536870912&features2&&(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo Authentication",'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo Authentication",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&4096&features)return 1==userinfo.otpsecret?account_removeOtp():account_addOtp(),!1}function account_addOtp(){!xxdialogMode&&1!=userinfo.otpsecret&&4096&features&&(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","Todennussovellus","<div id=d2optinfo>Ladataan...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){return meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value}),!1}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){!xxdialogMode&&1==userinfo.otpsecret&&4096&features&&(setModalContent("xxAddAgent","Todennussovellus","Haluatko varmasti poistaa kaksivaiheisen kirjautumisen todennussovelluksen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return!!(4096&features)&&(count2factoraAuths()>0&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1)}function account_managePushAuthDev(){if(!xxdialogMode&&64&features2){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Todennuslaite","Vahvistetaanko push -todennuslaitteen poisto?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(var t in nodes){var n=nodes[t];null!=n.agent&&14==n.agent.id&&1==n.pmt&&4294967295==GetNodeRights(n)&&e.push(n)}if(0==e.length)setModalContent("xxAddAgent","Todennuslaite","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var i="Valitse laite, joka rekisteröidään push -ilmoitusten todennusta varten. Kun laite on valittu, se pyytää vahvistusta.<br /><br />",a='<select id=d2devselect class="form-select">';for(var t in e)a+='<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>";setModalContent("xxAddAgent","Todennuslaite",i+=addHtmlFormFloating("Laite",a+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),!(xxdialogMode||!(4096&features))&&(meshserver.send({action:"otp-hkey-get"}),!1)}function account_addhkey(e){if(3==e){var t="Kirjoita lisättävän avaimen nimi.<br /><br />";t+=addHtmlFormFloating("Avaimen nimi",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Avaimeni" onkeyup=account_addhkeyValidate(event,2) />')}else if(2==e){t="Kirjoita avaimen nimi, valitse OTP-ruutu ja paina YubiKey &trade; -painiketta.<br /><br />";t+=addHtmlFormFloating("Avaimen nimi",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Avaimeni" onkeyup=account_addhkeyValidate(event,1) />'),t+=addHtmlFormFloating("YubiKey&trade; OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')}setModalContent("xxAddAgent","Lisää suojausavain",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var n=Q("dp1keyname").value;if(""==n&&(n="MyKey"),2==t)meshserver.send({action:"otp-hkey-yubikey-add",name:n,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Lisää suojausavain","<br />Tarkistetaan...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");else if(3==t)return meshserver.send({action:"webauthn-startregister",name:n}),!1}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"afrikaans",sq:"Albanialainen",ar:"Arabia (vakio)","ar-dz":"Arabia (Algeria)","ar-bh":"Arabia (Bahrain)","ar-eg":"Arabia (Egypti)","ar-iq":"Arabia (Irak)","ar-jo":"Arabia (Jordania)","ar-kw":"Arabia (Kuwait)","ar-lb":"Arabia (Libanon)","ar-ly":"Arabia (Libya)","ar-ma":"Arabia (Marokko)","ar-om":"Arabia (Oman)","ar-qa":"Arabia (Qatar)","ar-sa":"Arabia (Saudi-Arabia)","ar-sy":"Arabia (Syyria)","ar-tn":"Arabia (Tunisia)","ar-ae":"Arabia (U..E.)","ar-ye":"Arabia (Jemen)",an:"Aragonian",hy:"Armenian",as:"Assami",ast:"Asturian",az:"Azerbaidžanin",eu:"Baski",bg:"Bulgarialainen",be:"Valkovenäjä",bn:"Bengali",bs:"Bosnia",br:"Breton",my:"Burmalainen",ca:"Katalaani",ch:"Chamorro",ce:"Tšetšenian",zh:"Kiinalainen","zh-hk":"Kiinalainen (Hong Kong)","zh-cn":"Kiinalainen (PRC)","zh-sg":"Kiinalainen (Singapore)","zh-tw":"Kiinalainen (Taiwan)",cv:"Tšuvassi",co:"Korsikalainen",cr:"Cree",hr:"Kroatialainen",cs:"Tshekkiläinen",da:"Tanskalainen",nl:"Hollantilainen (standardi)","nl-be":"Hollantilainen (Belgialainen)",en:"Englanti","en-au":"Englanti (Australia)","en-bz":"Englanti (Belize)","en-ca":"Englanti (Kanada)","en-ie":"Englanti (Irlanti)","en-jm":"Englanti (Jamaika)","en-nz":"Englanti (Uusi-Seelanti)","en-ph":"Englanti (Filippiinit)","en-za":"Englanti (Etelä-Afrikka)","en-tt":"Englanti (Trinidad ja Tobago)","en-gb":"Englanti (Yhdistynyt kuningaskunta)","en-us":"Englanti (Yhdysvallat)","en-zw":"Englanti (Zimbabwe)",eo:"Esperanto",et:"Virolainen",fo:"Färsaarelainen",fa:"Persia (persia)",fj:"Fidzi",fi:"Suomalainen",fr:"Ranska (standardi)","fr-be":"Ranska (Belgia)","fr-ca":"Ranska (Kanada)","fr-fr":"Ranska (Ranska)","fr-lu":"Ranska (Luxemburg)","fr-mc":"Ranska (Monaco)","fr-ch":"Ranska (Sveitsi)",fy:"Friisiläinen",fur:"Friulilainen",gd:"Gaeli (Skotlantilainen)","gd-ie":"Gaeli (Irlantilainen)",gl:"Gaelinkielinen",ka:"Georgialainen",de:"Saksalainen (Standardi)","de-at":"Saksalainen (Itävalta)","de-de":"Saksalainen (Saksa)","de-li":"Saksalainen (Liechtenstein)","de-lu":"Saksalainen (Luxemburg)","de-ch":"Saksalainen (Sveitsi)",el:"Kreikkalainen",gu:"Gujurati",ht:"Haitilainen",he:"Heprealainen",hi:"Hindi",hu:"Unkarilainen",is:"Islantilainen",id:"Indonesialainen",iu:"Inuktitut",ga:"Irlantilainen",it:"Italialainen (Standardi)","it-ch":"Italialainen (Sveitsi)",ja:"Japanilainen",kn:"Kannada",ks:"Kashmiri",kk:"Kazakstan",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korealainen","ko-kp":"Korealainen (Pohjois-Korea)","ko-kr":"Korealainen (Etelä-Korea)",la:"Latinalainen",lv:"Latvialainen",lt:"Liettualainen",lb:"Luxemburgilainen",mk:"FYRO Makedonialainen",ms:"Malaiji",ml:"Malajalam",mt:"Maltalainen",mi:"Maori",mr:"Marathi",mo:"Moldovalainen",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norjalainen",nb:"Norjalainen (Bokmal)",nn:"Norjalainen (Nynorks)",oc:"Occitan",or:"Oriya",om:"Oromo","fa-ir":"Persia / Iran",pl:"Puolalainen",pt:"Portugalilainen","pt-br":"Portugalilainen (Brasilia)",pa:"Punjabi","pa-in":"Punjabi (Intia)","pa-pk":"Punjabi (Pakistan)",qu:"Ketšua",rm:"Retoromaani",ro:"Romania","ro-mo":"Romania (Moldova)",ru:"Venäläinen","ru-mo":"Venäläinen (Moldavia)",sz:"Saamen kieli",sg:"Sango",sa:"Sanskritin kieli",sc:"Sardinialainen",sd:"Sindhi",si:"Singhalese",sr:"Serbia",sk:"Slovakian",sl:"Sloveeni",so:"Somani",sb:"Sorbi",es:"Espanjalainen","es-ar":"Espanjalainen (Argentina)","es-bo":"Espanjalainen (Bolivia)","es-cl":"Espanjalainen (Chile)","es-co":"Espanjalainen (Kolumbia)","es-cr":"Espanjalainen (Costa Rica)","es-do":"Espanjalainen (Dominikaaninen tasavalta)","es-ec":"Espanjalainen (Ecuador)","es-sv":"Espanjalainen (El Salvador)","es-gt":"Espanjalainen (Guatemala)","es-hn":"Espanjalainen (Honduras)","es-mx":"Espanjalainen (Meksiko)","es-ni":"Espanjalainen (Nicaragua)","es-pa":"Espanjalainen (Panama)","es-py":"Espanjalainen (Paraguay)","es-pe":"Espanjalainen (Peru)","es-pr":"Espanjalainen (Puerto Rico)","es-es":"Espanjalainen (Espanja)","es-uy":"Espanjalainen (Uruguay)","es-ve":"Espanjalainen (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Ruotsalainen","sv-fi":"Ruotsalainen (Suomi)","sv-sv":"Ruotsalainen (Ruotsi)",ta:"Tamili",tt:"Tataari",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkkilainen",tk:"Turkmenia",uk:"Ukrainalainen",hsb:"Ylempi sorbi",ur:"Urdu",ve:"Venda",vi:"Vietnamilainen",vo:"Volapuk",wa:"Vallonia",cy:"Walesin",xh:"Xhosa",ji:"Jiddiš",zu:"Zulu"},loclistex={"zh-chs":"Kiinalainen (yksinkertaistettu)","zh-cht":"Kiinalainen perinteinen)"};function account_showLocalizationSettings(){if(xxdialogMode)return!1;var e=getstore("loctag",0),t="",n='<select id=d2locselect class="form-select"><option value="*">Käytä selaimen kieliasetusta</option>';for(var i in loclist)n+='<option value="'+i+'"'+(e==i?" selected":"")+">"+i+" - "+loclist[i]+"</option>";if(n+="</select>",serverinfo.languages&&serverinfo.languages.length>0){t+="Kielen vaihtaminen vaatii sivun päivittämisen.<br /><br />";var a='<select id=d2langselect class="form-select"><option value="*">Käytä selaimen kieliasetusta</option>';for(var i in serverinfo.languages){var o=serverinfo.languages[i];a+='<option value="'+o+'"'+(userinfo.lang==o?" selected":"")+">"+o+" - "+(loclist[o]?loclist[o]:loclistex[o])+"</option>"}t+=addHtmlFormFloating("Kieli",a+="</select>")}return t+=addHtmlFormFloating("Päivämäärät ja aika",n),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Auta MeshCentralin kääntämisessä</a>'),setModalContent("xxAddAgent","Lokalisointiasetukset",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx),!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),t=e?e.value:null;"*"==t&&null==userinfo.lang&&(t=userinfo.lang),t!=userinfo.lang&&meshserver.send({action:"changelang",lang:t});var n=getstore("loctag",0),i=Q("d2locselect").value;n!=i&&("*"!=i?args.locale=i:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e="",t="Luo väliaikainen käyttäjätunnus ja salasana, joita voidaan käyttää vaihtoehtoisena kirjautumisena tilillesi. Tästä on hyötyä, kun työkalut tai muut palvelut voivat käyttää tiliäsi.<br /><br />",n={0:"Rajoittamaton",1:"1 minuutti",5:"5 minuuttia",10:"10 minuuttia",15:"15 minuuttia",30:"30 minuuttia",45:"45 minuuttia",60:"60 minuuttia",120:"2 tuntia",240:"4 tuntia",480:"8 tuntia",720:"12 tuntia",960:"16 tuntia",1440:"24 tuntia",2880:"2 päivää",5760:"4 päivää",10080:"7 päivääs"};for(var i in n)e+="<option value="+i+">"+n[i]+"</option>";t+='<div class="form-floating mb-3">',t+='<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Tunnuksen nimi" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>',t+="<label for=d2tokenName>Tunnuksen nimi</label>",t+="</div>",setModalContent("xxAddAgent","Luo kirjautumistunnus",t+=addHtmlFormFloating("Vanhentumisaika",'<select class="boxsize form-select" id=d2tokenExpire>'+e+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",Q("d2tokenName").value.length>0)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){if(xxdialogMode)return!1;setModalContent("xxAddAgent","Ilmoitusasetukset",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Ilmoitusääni</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Näytä laiteryhmän nimi</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Laiteyhteydet</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Laitteen irtikytkennät</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT työpöytä ja sarjaliikenne ilmoitukset</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx);var e=getstore("notifications",0);return Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e,!1}function account_showAccountNotifySettingsEx(){var e=0;e+=Q("p2notifyPlayNotifySound").checked?1:0,e+=Q("p2notifyIntelDeviceConnect").checked?2:0,e+=Q("p2notifyIntelDeviceDisconnect").checked?4:0,e+=Q("p2notifyIntelAmtKvmActions").checked?8:0,putstore("notifications",e+=Q("p2notifyGroupName").checked?16:0)}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","Sähköpostivarmistus","Napsauta OK lähettääksesi varmennusviestin osoitteeseen:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Odota muutama minuutti saadaksesi vahvistuksen."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){if(xxdialogMode)return!1;return setModalContent("xxAddAgent","Sähköpostiosoitteen vaihto",'Vaihda tilisi sähköpostiosoite tästä.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus(),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){if(xxdialogMode)return!1;var e="Poista tämä tili kirjoittamalla tilin salasana molempiin alla oleviin ruutuihin ja painamalla ok.<br /><br />";return e+="<form method=post>",e+="<input type=hidden name=action value=deleteaccount />",e+='<input type=hidden name=authcookie value="'+authCookie+'" />',e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+='<label for="apassword1">Password</label>',e+="</div>",e+='<div class="form-floating mb-3">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+="<label for=apassword2>Confirm Password</label>",e+="</div>",e+="</div>",setModalContent("xxAddAgent","Poista Tili",e+="</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus(),!1}function account_showChangePassword(){if(xxdialogMode)return!1;var e="Vaihda tilisi salasana kirjoittamalla vanha ja uusi salasana kahdesti alla oleviin kenttiin.";if(e+="<br /><br />",e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword0>Old password</label>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword1>New password</label>",e+="<b><span id=dxPassWarn></span></b>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword2>Confirm new password</label>",e+="</div>",65536&features&&(e+='<div class="form-floating mb-2">',e+='<input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apasswordhint>Password hint</label>",e+="</div>"),e+="</div>",passRequirements){var t=[],n=0;for(var i in passRequirements)"reset"!=i&&"hint"!=i&&(t.push(i+":"+passRequirements[i]),n++);n>0&&(e+="<br /><span style=font-size:x-small>Vaatimukset: "+t.join(", ")+".</span>")}return setModalContent("xxAddAgent","Vaihda Salasana",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword(),!1}function account_showChangePasswordEx(){if(Q("apassword1").value==Q("apassword2").value){var e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value};65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e)}}function account_showThemesSwitcher(){if(xxdialogMode)return!1;var e=getstore("theme")||"default",t=JSON.parse(getstore("lastThemes")||"[]"),n=new Set(t),i='<div class="form-group"><label for="theme-switcher">Valitse teema:</label>';return i+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',t.length>0&&(i+='<optgroup label="Viimeaikaiset teemat"">',t.forEach(function(t){i+=`<option value="${t}"${t===e?" selected":""}>${t.charAt(0).toUpperCase()+t.slice(1)}</option>`}),i+="</optgroup>"),i+='<optgroup label="Kaikki teemat">',[{value:"default",label:"Oletus"},{value:"cerulean",label:"Cerulean"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Darkly"},{value:"flatly",label:"Flatly"},{value:"journal",label:"Journal"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(t){if(!n.has(t.value)){var a=t.value===e?" selected":"";i+=`<option value="${t.value}"${a}>${t.label}</option>`}}),i+="</optgroup>",setModalContent("xxAddAgent","Vaihda teema",i+="</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function account_switchThemeEx(){const e=document.getElementById("theme-switcher").value,t="default"!=e?encodeURIComponent(e):encodeURIComponent("..");document.getElementById("theme-stylesheet").href=`styles/themes/${t}/bootstrap-min.css`,putstore("theme",e);var n=JSON.parse(getstore("lastThemes")||"[]");n.includes(e)?(n=n.filter(t=>t!==e)).unshift(e):(n.length>=4&&n.pop(),n.unshift(e)),putstore("lastThemes",JSON.stringify(n))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin)return setModalContent("xxAddAgent","Uusi laiteryhmä","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Tilin Turvallisuus",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Tilin Turvallisuus",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;var e=[];if(!(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}var i="Luo uusi laiteryhmä käyttäen alla olevia vaihtoehtoja.<br /><br />",a="";if(i+=addHtmlFormFloating("Nimi",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),1&features||(a+="<option value=3>Paikalliset laitteet, ei agenttia</option>"),!(2&features)&&e.length>0&&(a+="<option value=103>Mitään agenttilaitteita ei välitetty agentin kautta</option>"),65536&features2&&(1&features||(a+="<option value=4>IP-KVM / Virtalaite</option>"),!(2&features)&&e.length>0&&(a+="<option value=104>IP-KVM / Virtalaite välitetty agentin kautta</option>")),i+=addHtmlFormFloating("Tyyppi","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Hallitse ohjelmistoagentilla</option><option value=1>Vain Intel&reg; AMT, ei agenttia</option>"+a+"</select>"),e.length>0){i+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var o=[];for(var t in e)o.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");i+=addHtmlFormFloating("Relelaite","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+o.join("")+"</select>"),i+="</div>"}return i+=addHtmlFormFloating("Kuvaus","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>"),i+="<div id=d2ipkvm style=display:none><hr />",i+=addHtmlFormFloating("Malli","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Raritan Dominion KX III</option><option value=2>Verkkovirtakytkin 7</option></select>"),i+=addHtmlFormFloating("Isäntänimi",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),i+=addHtmlFormFloating("Käyttäjätunnus",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),i+=addHtmlFormFloating("Salasana",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />'),setModalContent("xxAddAgent","Uusi laiteryhmä",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus(),!1}function account_validateMeshCreate(e,t){var n=parseInt(Q("dp2meshtype").value);1==t&&null!=e&&"Tulla sisään"==e.key&&Q("dp2meshname").value.length>0&&Q("dp2meshtype").focus(),2==t&&null!=e&&"Tulla sisään"==e.key&&Q("dp2meshdesc").focus();var i=Q("dp2meshname").value.length>0;QV("d2ipkvm",4==n||104==n);try{QV("d2devrelaydiv",n>100)}catch(e){}4==n&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(i=!1),QE("idx_dlgOkButton",i)}function account_createMeshEx(e,t){var n=parseInt(Q("dp2meshtype").value),i={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:n,desc:Q("dp2meshdesc").value};4!=n&&104!=n||(i.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),i.kvmhost=Q("dp2ipkvmhost").value,i.kvmuser=Q("dp2ipkvmuser").value,i.kvmpass=Q("dp2ipkvmpass").value),n>100&&(i.meshtype=n-100,i.relayid=Q("d2devrelay").value),meshserver.send(i)}function account_validateDeleteAccount(){QE("account_dlgOkButton",Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e="",t=Q("apassword0").value.length>0&&Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;if(65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(t=!1),""!=Q("apassword1").value)if(null==passRequirements||""==passRequirements){var n=checkPasswordStrength(Q("apassword1").value);e=n>=80?"<span style=color:green>Vahva<span>":n>=60?"<span style=color:blue>Hyvä<span>":"<span style=color:red>Heikko<span>"}else{0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(t=!1,e="<span style=color:red>Politiikka<span>")}QH("dxPassWarn",e),QE("idx_dlgOkButton",t)}function checkPasswordStrength(e){var t=0,n={},i=0,a={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var o=0;o<e.length;o++)n[e[o]]=(n[e[o]]||0)+1,t+=5/n[e[o]];for(var s in a)i+=1==a[s]?1:0;return parseInt(t+10*(i-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var n=0,i=0,a=0,o=0,s=0;s<e.length;s++)/\d/.test(e[s])&&n++,/[a-z]/.test(e[s])&&i++,/[A-Z]/.test(e[s])&&a++,/\W/.test(e[s])&&o++;return!(t.numeric&&n<t.numeric)&&(!(t.lower&&i<t.lower)&&(!(t.upper&&a<t.upper)&&!(t.nonalpha&&o<t.nonalpha)))}function updateMeshes(){var e='<div class="row">',t=0,n=0,a=[];for(i in meshes)a.push(meshes[i]);for(i in a.sort(nameSort),a){t>1&&(e+="</tr><tr>",t=0),t++,n++;var o=GetMeshRights(a[i]),s="Osittaiset oikeudet";4294967295==o?s="Täysi Järjestelmänvalvoja":0==o&&(s="Ei oikeuksia"),e+='\n                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"\n                            onclick="gotoMesh(\''+a[i]._id+"')\"\n                            onkeypress=\"if (event.key=='Enter') gotoMesh('"+a[i]._id+'\')"\n                            style="cursor:pointer;">\n                        <div class="card mb-3">\n                            <div class="row g-0">\n                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">\n                                    <i class="mi me-1"></i>\n                                </div>\n                                <div class="col-10 mx-auto" tabindex="0">\n                                    <div class="card-body" style=padding:0;>\n                                        <h5 class="card-title e1">'+EscapeHtml(a[i].name)+'</h5>\n                                        <p class="card-text">'+s+'</p>\n                                        <div class="g2"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    '}e+="</div>",meshcount=n,QH("p2meshes",e),QV("p2noMeshFound",0==n)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&loginTokens.length>0){e+='<p><strong>Aktiiviset kirjautumistunnukset</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Uusi</button></span></p>',e+='<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Nimi</th><th scope=col style=text-align:left>Käyttäjätunnus</th></tr>';for(var n=0;n<loginTokens.length;n++){var i=loginTokens[n],a="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(i.tokenUser)+'")\' title="Poista kirjautumistunnus" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',o="";0!=i.expire&&(o=EscapeHtml(format("Vanhenee {0}",printDateTime(new Date(i.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(i.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+o+a+"</div><div>"+EscapeHtml(i.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var n=null,i=0;i<loginTokens.length;i++)loginTokens[i].tokenUser==t&&(n=loginTokens[i]);if(null!=n){var a="Vahvista tämän kirjautumistunnuksen poisto?<br /><br />";a+=addHtmlValue("Nimi",EscapeHtml(n.name)),setModalContent("xxAddAgent","Poista kirjautumistunnus",a+=addHtmlValue("Käyttäjätunnus",EscapeHtml(n.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})})}}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e=miscState.googleDrive;if(e.state<3){var t='<img style=float:right src="images/googledrive-48.png" /><div>Määritä tämä palvelin lataamaan varmuuskopiot automaattisesti Google Driveen. Aloita luomalla ja syöttämällä Google Drive ClientID ja ClientSecret tilillesi.</div><br />';t+=addHtmlValue("Valtakirjat",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Google Drive Console</a>'),t+=addHtmlFormFloating("Asiakastunnus",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'),setModalContent("xxAddAgent","Google Drive -varmuuskopio",t+=addHtmlFormFloating("Asiakkaan salaisuus",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)}else if(3==e.state){t='<img style=float:right src="images/googledrive-48.png" /><div>Google Driven varmuuskopiointi on tällä hetkellä aktiivista.</div>';setModalContent("xxAddAgent","Google Drive -varmuuskopio",t+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Poista kokoonpano</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1)}}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",Q("gdclientid").value.length>0&&Q("gdclientsecret").value.length>0)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",Q("gdcode").value.length>0)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){if(xxdialogMode)return!1;var e="Palauta palvelin varmuuskopiosta, <span style=color:red>tämä poistaa nykyiset palvelintiedot.</span> Tee tämä vain, jos tiedät mitä teet.<br /><br />";return e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>',e+="<input type=hidden name=auth value="+authCookie+">",e+='<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>',setModalContent("xxAddAgent","Palauta palvelin",e+="</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore(),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","MeshCentral Versio","Ladataan..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Tuntematon"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Tuntematon"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Errors","Ladataan..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Ei mitään</i>"),1&e&&(t='<span role=button tabindex=0 title="Muokkaa laiteryhmän nimeä napsauttamalla tätä" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",t),QV("MeshSummary",4!=currentMesh.mtype);var n=format("Tuntematon #{0}",currentMesh.mtype);1==currentMesh.mtype&&(n="Vain Intel&reg; AMT, ei agenttia"),2==currentMesh.mtype&&(n="Hallinnoidaan ohjelmistoagentin avulla"),3==currentMesh.mtype&&(n=null==currentMesh.relayid?"Paikalliset laitteet, ei agenttia":"Mitään agenttilaitteita ei välitetty agentin kautta"),4==currentMesh.mtype&&(n=null==currentMesh.relayid?"IP-KVM-laite":"IP-KVM-laite välitetty agentin kautta",1==currentMesh.kvm.model&&(n+=", Raritan KX III"));var i="";if(8&args.hide&&(i+=addHtmlValue("Nimi",t)),i+=addHtmlValue("Kuvaus",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Ei mitään</i>","p20editmesh(2)",!!(1&e))),i+=addHtmlValue("Tyyppi",n),(3==currentMesh.mtype||4==currentMesh.mtype)&&null!=currentMesh.relayid){var a="<i>Tuntematon</i>",o=getNodeFromId(currentMesh.relayid);null!=o&&(a=EscapeHtml(o.name)+" ("+EscapeHtml(o.meshnamel)+")"),i+=addHtmlValue("Relelaite",addLinkConditional(a,"p20editmeshrelay()",!!(1&e)))}if(4==currentMesh.mtype&&(i+=addHtmlValue("Isäntänimi",currentMesh.kvm.host),i+=addHtmlValue("Käyttäjätunnus",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]){var s=users[currentMesh.creatorid];i+=addHtmlValue("Luoja",'<a href=# onclick=gotoUser("'+encodeURIComponentEx(s._id)+'",false,null)>'+EscapeHtml(s.name)+"</a>")}else null!=currentMesh.creatorname&&(i+=addHtmlValue("Luoja",EscapeHtml(currentMesh.creatorname)));if(null!=currentMesh.creation&&(i+=addHtmlValue("Luomisaika",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype){var l=[];currentMesh.flags&&(1&currentMesh.flags&&l.push("Automaattinen-Poisto"),2&currentMesh.flags&&l.push(4==currentMesh.mtype?"Portin nimen synkronointi":"Isäntänimen synkronointi"),8&currentMesh.flags&&l.push("prefer --agentname"),16&currentMesh.flags&&l.push("allow override"),1==serverinfo.devGroupSessionRecording&&4&currentMesh.flags&&l.push("Tallenna istunnot")),"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&l.push("Poista passiivinen"),""==(l=l.join(", "))&&(l="<i>Ei mitään</i>"),i+=addHtmlValue("Ominaisuudet",addLinkConditional(l,"p20editmeshfeatures()",1&e))}if(2==currentMesh.mtype){l=[];var r=0;currentMesh.consent&&(r=currentMesh.consent),serverinfo.consent&&(r|=serverinfo.consent),64&r&&8&r?l.push("Työpöydän kehote+työkalurivi"):64&r?l.push("Työpöydän työkalurivi"):8&r?l.push("Työpöydän kehote"):1&r&&l.push("Työpöytä ilmoitus"),16&r?l.push("Terminaalikehote"):2&r&&l.push("Ilmoita terminaalista"),32&r?l.push("Tiedostot kysy"):4&r&&l.push("Tiedostot Ilmoita"),7==r&&(l=["Ilmoita aina"]),56&~r||(l=["Kysy Aina"]),""==(l=l.join(", "))&&(l="<i>Ei mitään</i>"),i+=addHtmlValue("Käyttäjän suostumus",addLinkConditional(l,"p20editmeshconsent(1)",1&e))}if(!(3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&1024&userinfo.siteadmin)){var d=0,u=[];if(userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(d|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(d|=userinfo.notify[currentMesh._id]),2&d&&u.push("Yhdistä"),4&d&&u.push("Katkaise yhteys"),8&d&&u.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var c=0;16&d&&c++,32&d&&c++,64&d&&c++,c>0&&u.push(format("Email ({0})",c))}if(null!=userinfo.msghandle&&33554432&features2){c=0;128&d&&c++,256&d&&c++,512&d&&c++,c>0&&u.push(format("Messaging ({0})",c))}0==u.length&&u.push("<i>Ei mitään</i>"),i+=addHtmlValue("Ilmoitukset",addLink(u.join(", "),"p20editMeshNotify()"))}if(16777216&features&&2==currentMesh.mtype){var p="<i>Ei mitään</i>",m=!1;null!=currentMesh.invite&&(m=!0,p=currentMesh.invite.codes.join(", ")),i+=addHtmlValue("Kutsu koodit",addLinkConditional(p,"p20editmeshInviteCode()",1&e||m))}if(currentMesh.mtype<3&&1&features2){var g="Ei politiikkaa";currentMesh.amt&&(1==currentMesh.amt.type?g="Poista käytöstä":2==currentMesh.amt.type?(g="Yksinkertainen asiakkaan hallintatila (ACM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):3==currentMesh.amt.type?(g="Yksinkertainen järjestelmänvalvojan hallintatila (ACM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):4==currentMesh.amt.type&&(g="Täysin automaattinen")),i+=addHtmlValue("Intel&reg; AMT",addLinkConditional(g,"p20editMeshAmt()",1&e))}if(1&e&&(i+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Muistiinpanot title="Näytä tämän laiteryhmän huomautukset" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),i+="<br style=clear:both><br>",2&e&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjiä</button>',null!=usergroups)){var v=0,h=!1;for(var f in usergroups)null==usergroups[f].membershipType&&usergroups[f]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(v++,null!=currentMesh.links&&null!=currentMesh.links[f]||(h=!0));v>0&&h&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjä Ryhmä</button>')}1==currentMesh.mtype&&(1&e&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Import Intel&reg; AMT devices." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Import</button>'),null!=currentMesh.amt&&currentMesh.amt.type>0&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Suorita Intel&reg; AMT -aktivointi ja -määritykset." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Perustaa</button>')),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Lisää uusi tietokone tähän laiteryhmään asentamalla MeshAgent."><i class="fa-solid fa-circle-plus"></i> Lisää agentti</button>',i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Kutsu joku asentamaan Mesh agentti tähän laiteryhmään."><i class="fa-solid fa-user-plus"></i> Kutsu</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Lisää laite, joka sijaitsee paikallisessa verkossa."><i class="fa-solid fa-circle-plus"></i> Lisää Laite</button>'),!(currentMesh.amt&&currentMesh.amt.type>2)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Vaihda Intel AMT järjestelmänvalvojan ohjaustilaan (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),i+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Käyttäjäluvat</th><th scope=col></th></tr>';var k=1,x=[];for(var f in currentMesh.links){var y=f.split("/")[2];currentMesh.links[f].name&&(y=currentMesh.links[f].name),f==userinfo._id&&(y=userinfo.name),null!=usergroups&&null!=usergroups[f]&&(y=usergroups[f].name),x.push({id:f,name:y,rights:currentMesh.links[f].rights})}for(var f in x.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),x){var b="",w=makeDeviceGroupRightsString(x[f].rights),M="fa-user";x[f].id!=userinfo._id&&(4294967295==e||2&e)&&(4294967295!=e&&4294967295==currentMesh.links[x[f].id].rights||(b="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(x[f].id)+'")\' title="Posta käyttäjältä oikeudet tähän laiteryhmään"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),w='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(x[f].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(x[f].id)+"')\">"+w+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),x[f].id.startsWith("ugrp/")&&(M="fa-users");var S=EscapeHtml(decodeURIComponent(x[f].name));null!=usergroups&&x[f].id.startsWith("ugrp/")&&(S="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(x[f].id)+"\");haltEvent(event);'>"+S+"</a>"),null!=users&&x[f].id.startsWith("user/")&&(S="<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(x[f].id)+"\");haltEvent(event);'>"+S+"</a>"),i+="<tr style="+(k%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Käyttäjä" class="fa-solid fa-fw '+M+'"></i>&nbsp;'+S+"<div></div></div></td><td style=width:70%><div style=float:right>"+b+"</div><div>"+w+"</div></td></tr>",++k}if(i+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&deviceShares.length>0){i+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktiivinen laitteen jakaminen</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>',k=1;for(f=0;f<deviceShares.length;f++){var C=deviceShares[f];b="";null!=C.url&&(b+='<a href="'+C.url+'" rel="noreferrer noopener" target=_blank title="Laitteen jakolinkki" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),b+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(C.nodeid)+'","'+encodeURIComponentEx(C.publicid)+'","'+encodeURIComponentEx(C.guestName)+'")\' title="Poista laitteen jakaminen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>';var A="";C.p<=7?A=["","Pääte","Työpöytä","Työpöytä + pääte","Tiedostot","Pääte + tiedostot","Työpöytä + tiedostot","Työpöytä + pääte + tiedostot"][C.p]:8==C.p?A="HTTP/"+C.port:16==C.p&&(A="HTTPS/"+C.port);var Q=A;null!=C.startTime&&null!=C.expireTime&&(Q=format("{0}, {1} - {2}",A,printFlexDateTime(new Date(C.startTime)),printFlexDateTime(new Date(C.expireTime)))),null!=C.startTime&&null!=C.duration&&(Q=(C.duration,format("{0}, {1} {2} minuutin ajan",A,printFlexDateTime(new Date(C.startTime)),C.duration))),1==C.recurring&&(Q+=", Toistuu päivittäin"),2==C.recurring&&(Q+=", Toistuu viikoittain"),2&C.p&&!0===C.viewOnly&&(Q+=", Näytä vain työpöytä"),null!=C.consent&&(0==C.consent?Q+=", Ei suostumusta":(56&C.consent&&(Q+=", Pyydä suostumusta"),64&C.consent&&(Q+=", Työkalupalkki")));var T=EscapeHtml(C.guestName);if(C.publicid.startsWith("AS:node/")&&(T="<i>Agentin omavastuu</i>"),null!=(I=getNodeFromId(C.nodeid))){var D=I.conn>0?"":" gray";i+="<tr "+(++k%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+I._id+'",10);haltEvent(event);\' style=float:left class="j'+I.icon+D+'"></div>&nbsp;<a onclick=\'gotoDevice("'+I._id+"\",10);haltEvent(event);'>"+EscapeHtml(I.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+T+"<div></div></div></td><td style=width:70%><div style=float:right>"+b+"</div><div>"+Q+"</div></td></tr>"}}i+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));k=0,nodes.sort(deviceSort);var E="";1==currentMesh.mtype&&(E+='<a onclick=meshDownloadDeviceList()><img title="Lataa laiteluettelo" src="images/link4.png" /></a>',1&features||(E+=' <a onclick=meshImportDeviceList()><img title="Tuo laiteluettelo" src="images/link6.png" /></a>'));var N='<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Laitteet</th><th scope=col class="text-end">'+E+"</th></tr>";for(var f in nodes){var I;D=(I=nodes[f]).conn>0?"":" gray";currentMesh._id==I.meshid&&(N+="<tr><td style=width:30%><div onclick='gotoDevice(\""+I._id+'",10);haltEvent(event);\' style=float:left class="j'+I.icon+D+'"></div>&nbsp;<a onclick=\'gotoDevice("'+I._id+"\",10);haltEvent(event);'>"+EscapeHtml(I.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(I.pwr)+"&nbsp;</div><div>"+(I.osdesc?EscapeHtml(I.osdesc):"")+"</div></td></tr>",++k)}0==k&&(N+='<tr><td colspan="2"><i>Ei mitään</i></td></tr>'),N+="</tbody></table>",4294967295==e&&(N+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Poista Ryhmä</a></span></div>"),QH("p20info",i),QH("p20info2",N);var V="";if(!(268435456&features)&&xxcurrentView>=20&&xxcurrentView<=29&&null!=currentMesh){for(var f in V="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)V+="&"+f+"="+urlargs[f];try{window.history.replaceState({},document.title,window.location.pathname+V)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e={webappversion:"0.9.0",computers:[]};for(var t in nodes){var n=nodes[t];if(currentMesh._id==n.meshid&&null!=n.intelamt){var i={name:n.name,host:n.host,user:n.intelamt.user,pass:"",tls:1==n.intelamt.tls?1:0,ver:n.intelamt.ver,pstate:n.intelamt.state};2==n.intelamt.state&&(i.pmode=1),n.intelamt.realm&&(i.digestrealm=n.intelamt.realm),n.intelamt.hash&&(i.tlscerthash=n.intelamt.hash),e.computers.push(i)}}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(e,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){if(!xxdialogMode){setModalContent("xxAddAgent","Tuo Intel&reg; AMT -laitteet",'Tuo luettelo paikallisista Intel&reg; AMT -laitteista MeshCommander JSON -muodossa.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1)}}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Tuo Intel&reg; AMT -laitteet",format("JSON-tiedosto {0} on virheellinen.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var n=0;for(var i in t.computers){var a=t.computers[i];if("string"==typeof a.name&&"string"==typeof a.host&&"string"==typeof a.user&&"string"==typeof a.pass){var o={action:"addamtdevice",meshid:currentMesh._id,devicename:a.name,hostname:a.host,amtusername:a.user,amtpassword:a.pass,amttls:1==a.tls?1:0};"string"==typeof a.ver&&(o.ver=a.ver),"number"==typeof a.pstate&&(o.state=a.pstate),"string"==typeof a.digestrealm&&(o.realm=a.digestrealm),"string"==typeof a.tlscerthash&&(o.hash=a.tlscerthash),meshserver.send(o),n++}}0==n&&setModalContent("xxAddAgent","Käyttäjätilin tuonti","Unable to import any device.")}else setModalContent("xxAddAgent","Tuo Intel&reg; AMT -laitteet","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){if(!xxdialogMode){var e="",t="";1048576&features&&(t="<option value=3>Yksinkertainen järjestelmänvalvojan hallintatila (ACM)</option>"),e+=addHtmlFormFloating("Tyyppi",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Ei politiikkaa</option><option value=1>Poista käytöstä</option><option value=2>Yksinkertainen asiakkaan hallintatila (ACM)</option>'+t+"<option value=4>Täysin automaattinen</option></select>"),setModalContent("xxAddAgent","Intel&reg; AMT politiikka",e+="<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),1024&features||(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy()}}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t+=addHtmlFormFloating("Salasana",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Satunnaista salasana</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Säilytä nykyinen salasana</option>":"")+"<option value=2>Valitse uusi salasana</option></select>"),t+="<div id=dp20amtpassdiv style=display:none>",t+=addHtmlFormFloating("Uusi salasana*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+=addHtmlFormFloating("Uusi salasana*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+="</div>",3==e&&(t+=addHtmlFormFloating("CCM-tila",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Älä muuta, säilytä CCM, jos se on määritetty</option><option value=1>Poista CCM käytöstä, jos asennus on valmis</option><option value=2>Aktivoi CCM: ksi, jos ACM epäonnistuu</option></select>')),t+="<div id=dp20amtbadpassdiv style=display:none>",t+=addHtmlFormFloating("Tuntematon salasana",'<select id=dp20amtbadpass class="form-select"><option value=0>Älä tee mitään</option><option value=1>Jos olet CCM: ssä, aktivoi Intel&reg; AMT uudelleen</option></select>'),t+="</div>",1024&features||(t+=addHtmlFormFloating("CIRA-asetukset",'<select id=dp20amtcira class="form-select" title="Asiakkaan aloittama etäkäyttö"><option value=0>Älä tee mitään</option><option value=1>Älä muodosta yhteyttä palvelimeen</option><option value=2>Yhdistä palvelimeen</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 merkkiä, 1 ylempi, 1 alempi, 1 numeerinen, 1 ei-aakkosnumeerinen.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Tämä käytäntö ei vaikuta laitteisiin, joissa on Intel&reg; AMT ACM-tilassa.</span>'));0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Kun tämä käytäntö on valittu, tämä palvelin ei hallinnoi Intel&reg; AMT: tä. Intel AMT: tä voidaan edelleen käyttää aktivoimalla ja määrittämällä se manuaalisesti.</div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Kun tämä käytäntö on valittu, kaikki Intel&reg; AMT Client Control -tilassa (CCM) poistetaan käytöstä. Muissa laitteissa CIRA on tyhjennetty, ja niitä voidaan silti hallita manuaalisesti.</div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Tämä on suositeltava käytäntö. Intel&reg; AMT: n aktivointi ja hallinta on täysin automatisoitu, ja palvelin yrittää hyödyntää laitteiston hallintaa parhaalla mahdollisella tavalla.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e=!0,t=Q("dp20amtpolicy").value;if((2==t||3==t)&&2==Q("dp20amtpass").value){var n=Q("dp20amtpolicypass").value;e=n===Q("dp20amtpolicypass2").value&&passwordcheck(n)}QE("idx_dlgOkButton",e),2!=t&&3!=t||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==t||3==t)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==t||3==t&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},n=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(n=""),1==Q("dp20amtpass").value&&(n=null),2==Q("dp20amtpass").value&&(n=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):3==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){if(xxdialogMode)return!1;var e=format("Haluatko varmasti poistaa ryhmän {0}? Laiteryhmän poistaminen poistaa myös kaikki tämän ryhmän laitteiden tiedot.",EscapeHtml(currentMesh.name))+"<br /><br />";return setModalContent("xxAddAgent","Poista Ryhmä",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />Varmista</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog(),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(!(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}if(e.sort(nameSort),0==e.length)a="Relelaitteita ei ole saatavilla.",setModalContent("xxAddAgent","Muokkaa laiteryhmää","Relelaitteita ei ole saatavilla."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var i=[];for(var t in e)i.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");var a=addHtmlFormFloating("Relelaite",'<select id=d2devrelay class="form-select">'+i.join("")+"</select>");setModalContent("xxAddAgent","Muokkaa laiteryhmää",a),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){if(!xxdialogMode){setModalContent("xxAddAgent","Muokkaa laiteryhmää",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Nimi" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Nimi</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Kuvaus"></textarea><label for=dp20meshdesc>Kuvaus</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),2==e?Q("dp20meshdesc").focus():Q("dp20meshname").focus()}}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",Q("dp20meshname").value.length>0),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){if(!xxdialogMode){var t="",n=0,i="";1==e&&(n=currentMesh.consent?currentMesh.consent:0,i="Muokkaa laiteryhmän käyttäjän suostumusta"),2==e&&(n=currentUser.consent?currentUser.consent:0,i="Muokkaa käyttäjän suostumusta"),3==e&&(n=currentNode.consent?currentNode.consent:0,i="Muokkaa laitteen käyttäjän suostumusta"),4==e&&(n=currentUserGroup.consent?currentUserGroup.consent:0,i="Muokkaa käyttäjäryhmän käyttäjän suostumusta"),t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Työpöytä</b></div>',t+='<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&n?"checked":"")+">Ilmoita käyttäjälle</label></div>",t+='<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&n?"checked":"")+">Pyydä käyttäjän suostumusta</label></div>",t+='<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&n?"checked":"")+">Näytä yhteystyökalurivi</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Pääte</b></div>',t+='<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&n?"checked":"")+">Ilmoita käyttäjälle</label></div>",t+='<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&n?"checked":"")+">Pyydä käyttäjän suostumusta</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Tiedostot</b></div>',t+='<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&n?"checked":"")+">Ilmoita käyttäjälle</label></div>",setModalContent("xxAddAgent",i,t+='<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&n?"checked":"")+">Pyydä käyttäjän suostumusta</label></div>"),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent)))}}function p20editmeshconsentEx(e,t){var n=0;Q("d20flag1").checked&&(n+=1),Q("d20flag2").checked&&(n+=8),Q("d20flag3").checked&&(n+=2),Q("d20flag4").checked&&(n+=16),Q("d20flag5").checked&&(n+=4),Q("d20flag6").checked&&(n+=32),Q("d20flag7").checked&&(n+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:n}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:n}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:n}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:n})}function p20editmeshfeatures(){if(!xxdialogMode){var e=currentMesh.flags?currentMesh.flags:0,t="",n=0;"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&(n=currentMesh.expireDevs)>2e3&&(n=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Tallenna istunnot</label><br></div>"),2!=currentMesh.mtype&&4!=currentMesh.mtype||(t+='<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Synkronoi palvelimen laitteen nimi portin nimeen":"Synkronoi palvelimen laitteen nimi isäntänimeen")+"</label><br></div>",2==currentMesh.mtype&&(t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(8&e?"checked":"")+">Prefer value of --agentName</label><br></div>",t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag16 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(16&e?"checked":"")+">Allow to override server device name until next connection</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Poista laite kun yhteys kaitkaistaan</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(n>0?"checked":"")+">Poista passiiviset laitteet automaattisesti</label><br></div>",t+='<div style=margin-left:20px id=d20expireDeviceDev>Poista päivät käytöstä poistamisen jälkeen <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==n?30:n)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Oletuksena ei -aktiiviset laitteet poistetaan 1 päivän kuluttua.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Oletuksena ei -aktiiviset laitteet poistetaan {0} päivän kuluttua.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Muokkaa laiteryhmän ominaisuuksia",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate()}}function p20editmeshfeaturesValidate(){var e=0,t=!0;if(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),2==currentMesh.mtype){Q("d20flag2").checked&&(e+=2,"d20flag2"==event.currentTarget.id&&(Q("d20flag8").checked=!0,Q("d20flag16").checked=!0));for(const t of[8,16]){const n=Q("d20flag"+t);(n.checked=n.checked&&!(n.disabled=!(2&e)))&&(e+=t)}}QE("d20expireDevice",!(1&e));var n=!(1&e)&&Q("d20expireDevice").checked;if(QV("d20expireDeviceDev",n),n){var i=parseInt(Q("d20expireDeviceDays").value);(isNaN(i)||i<1||i>2e3||i!=Q("d20expireDeviceDays").value)&&(t=!1)}QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0;2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2),Q("d20flag8").checked&&(e+=8),Q("d20flag16").checked&&(e+=16)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4);var t=0;1&e||!Q("d20expireDevice").checked||(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(xxdialogMode)return!1;var n="";if(null==e||5==e)null==t&&(n+=null==e?"Salli käyttäjien hallita tätä laiteryhmää ja tämän ryhmän laitteita.":"Salli käyttäjien hallita tätä laitetta.",524288&features&&(n+=" Käyttäjien on kirjauduttava sisään tähän palvelimeen kerran, ennen kuin heidät voidaan lisätä laiteryhmään."),n+="<br /><br />"),n+="<div style='position:relative'>",n+=addHtmlFormFloating("Käyttäjätunnukset",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />'),n+="<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",n+="</div><br>";else if(1==e){var i="";if(null==t){var a=getOrderedList(meshes,"name");for(var o in a)null!=currentUser.links&&null!=currentUser.links[a[o]._id]||(i+="<option value="+encodeURIComponentEx(a[o]._id)+">"+EscapeHtml(a[o].name)+"</option>")}else i+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Laiteryhmä","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+i+"</select>")}else if(2==e){if(null==usergroups)return;i="";var s=getOrderedList(usergroups,"name");for(var o in s)currentMesh._id.split("/")[1]==s[o]._id.split("/")[1]&&(null!=currentMesh.links&&null!=currentMesh.links[s[o]._id]||(i+="<option value="+encodeURIComponentEx(s[o]._id)+">"+EscapeHtml(s[o].name)+"</option>"));n+=addHtmlFormFloating("Käyttäjäryhmä",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+i+"</select>")}else if(6==e){if(null==usergroups)return;i="";if(null==t){s=getOrderedList(usergroups,"name");for(var o in s)null==s[o].membershipType&&currentNode._id.split("/")[1]==s[o]._id.split("/")[1]&&(null!=currentNode.links&&null!=currentNode.links[s[o]._id]||(i+="<option value="+encodeURIComponentEx(s[o]._id)+">"+EscapeHtml(s[o].name)+"</option>"))}else i+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Käyttäjäryhmä","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+i+"</select>")}else if(3==e){i="";t&&(t=decodeURIComponent(t));a=getOrderedList(meshes,"name");for(var o in a)null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[a[o]._id]||(i+="<option value="+encodeURIComponentEx(a[o]._id)+(t==a[o]._id?" selected":" ")+">"+EscapeHtml(a[o].name)+"</option>");n+=addHtmlFormFloating("Laiteryhmä","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+i+"</select>")}else if(4==e||7==e){i="";var l=null,r=null;null!=t&&null!=(r=getNodeFromId(decodeURIComponent(t)))&&(l=r.meshid);a=getOrderedList(meshes,"name");for(var o in a)null!=a[o].links[userinfo._id]&&7&a[o].links[userinfo._id].rights&&(null==l&&(l=a[o]._id),i+="<option value="+encodeURIComponentEx(a[o]._id)+(l==a[o]._id?" selected":" ")+">"+EscapeHtml(a[o].name)+"</option>");n+=addHtmlFormFloating("Laiteryhmä","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+i+"</select>"),i="";var d=getOrderedList(nodes,"name");for(var o in d)d[o].meshid==l&&(i+="<option value="+encodeURIComponentEx(d[o]._id)+(r==d[o]?" selected":" ")+">"+EscapeHtml(d[o].name)+"</option>");n+=addHtmlFormFloating("Laite","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+i+"</select>")}else{var u=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(u=users[e].name),usergroups&&usergroups[e]&&(u=usergroups[e].name),userinfo._id==e&&(u=userinfo.name),e.startsWith("ugrp/")?n+=format("Ryhmän käyttöoikeudet {0}:lle.",u)+"<br /><br />":n+=format("Ryhmän käyttöoikeudet käyttäjälle {0}.",u)+"<br /><br />"}var c=-1,p=4!=e&&5!=e&&6!=e&&7!=e;if(n+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',p&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Täysi Järjestelmänvalvoja</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Muokkaa laiteryhmää</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Hallitse laiteryhmän käyttäjiä</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Hallitse laiteryhmän tietokoneita</label><br>'),n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Remote Control & Relay</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Vain etäkatselu</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Vain rajoitettu syöttö</label><br>',!1!==serverinfo.guestdevicesharing&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Vieraiden jakaminen</label><br>'),n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Ei työpöytä yhteyttä</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Ei pääsyä terminaaliin</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Ei tiedostojen käyttöä</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Ei Intel&reg; AMT</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Mesh Agentint pääte</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Palvelimen Tiedostot</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Herätä laitteet</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Muokkaa laitehuomautuksia</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Näytä vain omat tapahtumat</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Keskustele ja ilmoita</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Poista Agent / Poista laite</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Etäkomennot</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Nollaa / sammuta</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Laitteen tiedot</label><br>',n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Use as Relay</label><br>',n+="</div>",null==e)xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Lisää käyttäjiä laiteryhmään",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus();else if(1===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Lisää laiteryhmän käyttöoikeudet":"Muokkaa laiteryhmän käyttöoikeuksia",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(c=meshes[decodeURIComponent(t)].links[currentUser._id].rights),4294967295==c&&(Q("p20fulladmin").checked=!0,c=-1);else if(2===e)xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Lisää Käyttäjä Ryhmä",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh));else if(3===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Lisää laiteryhmä":"Muokkaa laiteryhmää",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),null!=t&&(c=currentUserGroup.links[decodeURIComponent(t)].rights),4294967295==c&&(Q("p20fulladmin").checked=!0,c=-1);else if(4===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Lisää laitteen käyttöoikeudet":"Muokkaa laitteen käyttöoikeuksia",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t);else if(7===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Lisää laitteen käyttöoikeudet":"Muokkaa laitteen käyttöoikeuksia",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(c=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1));else if(5===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Muokkaa käyttäjän laitteen käyttöoikeuksia":"Lisää käyttäjän laitteen käyttöoikeudet",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],c=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus();else if(6===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Muokkaa käyttäjäryhmän laiteoikeuksia":"Lisää käyttäjäryhmän laiteoikeudet",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(c=currentNode.links[decodeURIComponent(t)].rights);else{e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Muokkaa laiteryhmän käyttöoikeuksia",n)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Muokkaa käyttäjän laiteryhmän oikeuksia",n)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)});GetMeshRights(currentMesh);4294967295==(c=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,c=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))}return-1!=c&&(p&&(1&c&&(Q("p20editmesh").checked=!0),2&c&&(Q("p20manageusers").checked=!0),4&c&&(Q("p20managecomputers").checked=!0)),8&c&&(Q("p20remotecontrol").checked=!0,65536&c&&(Q("p20nodesktop").checked=!0),256&c&&(Q("p20remoteview").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&c&&(Q("p20noterminal").checked=!0),1024&c&&(Q("p20nofiles").checked=!0),2048&c&&(Q("p20noamt").checked=!0),4096&c&&(Q("p20remotelimitedinput").checked=!0)),16&c&&(Q("p20meshagentconsole").checked=!0),32&c&&(Q("p20meshserverfiles").checked=!0),64&c&&(Q("p20wakedevices").checked=!0),128&c&&(Q("p20editnotes").checked=!0),8192&c&&(Q("p20limitevents").checked=!0),16384&c&&(Q("p20chatnotify").checked=!0),32768&c&&(Q("p20uninstall").checked=!0),131072&c&&(Q("p20commands").checked=!0),262144&c&&(Q("p20resetoff").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&c&&(Q("p20details").checked=!0),2097152&c&&(Q("p20relay").checked=!0)),p20validateAddMeshUserDialog(e),!1}function p20changeMeshAddMeshUserDialog(e){var t="",n=decodeURIComponent(Q("dp2meshid").value);for(var i in nodes)nodes[i].meshid==n&&(t+="<option value="+encodeURIComponentEx(nodes[i]._id)+">"+EscapeHtml(nodes[i].name)+"</option>");QH("dp2nodeid",t),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t=Q("dp20username").value.split(",");for(var n in t)t[n]=t[n].trim();return t[t.length-1]=e,Q("dp20username").value=t.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,n=!0;if(4===e){var i=0,a=decodeURIComponent(Q("dp2nodeid").value);""!=a&&null!=currentUser.links&&null!=currentUser.links[a]&&(i=currentUser.links[a].rights),Q("p20remotecontrol").checked=!!(8&i),Q("p20meshagentconsole").checked=!!(16&i),Q("p20meshserverfiles").checked=!!(32&i),Q("p20wakedevices").checked=!!(64&i),Q("p20editnotes").checked=!!(128&i),Q("p20remoteview").checked=!!(256&i),Q("p20noterminal").checked=!!(512&i),Q("p20nofiles").checked=!!(1024&i),Q("p20noamt").checked=!!(2048&i),Q("p20remotelimitedinput").checked=!!(4096&i),Q("p20limitevents").checked=!!(8192&i),Q("p20chatnotify").checked=!!(16384&i),Q("p20uninstall").checked=!!(32768&i),Q("p20nodesktop").checked=!!(65536&i),Q("p20commands").checked=!!(131072&i),Q("p20resetoff").checked=!!(262144&i),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!!(524288&i)),Q("p20details").checked=!!(1048576&i),Q("p20relay").checked=!!(2097152&i),n=""!=a}if(Q("dp20username")){var o=Q("dp20username").value.split(",");for(var s in o){var l=o[s]=o[s].trim();(0==l.length||l.indexOf('"')>=0)&&(n=!1)}var r=!1,d=!1;if(null!=users){var u=o[o.length-1].trim(),c=u.toLowerCase(),p=[];if(u.length>0){for(var s in users){var m=users[s]._id.split("/");if((null==currentMesh||currentMesh.domain==m[1])&&(null==currentNode||currentNode.domain==m[1])){if(m[2]===c){d=!0;break}if(users[s].name.toLowerCase().indexOf(c)>=0&&(p.push([users[s]._id,users[s].name]),p.length>=8))break}}if(0==d&&p.length>0){var g="";for(var s in p){var v=p[s][0],h=p[s][1];v.split("/")[2]==h.toLowerCase()?g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'>"+EscapeHtml(h)+"</div>":g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'><div>"+EscapeHtml(h)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(v.split("/")[2])+"</div></div>"}QH("dp20usersuggest",g),r=!0}}}QV("dp20usersuggest",r)}QE("idx_dlgOkButton",n),null!=Q("p20fulladmin")?(t=!Q("p20fulladmin").checked,QE("p20editmesh",t),QE("p20manageusers",t),QE("p20managecomputers",t)):t=""!=a,QE("p20remotecontrol",t),QE("p20meshagentconsole",t),QE("p20meshserverfiles",t),QE("p20wakedevices",t),QE("p20editnotes",t),QE("p20limitevents",t),QE("p20remoteview",t&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",t&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",t&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",t&&Q("p20remotecontrol").checked),QE("p20noterminal",t&&Q("p20remotecontrol").checked),QE("p20nofiles",t&&Q("p20remotecontrol").checked),QE("p20noamt",t&&Q("p20remotecontrol").checked),QE("p20chatnotify",t),QE("p20uninstall",t),QE("p20commands",t),QE("p20resetoff",t),QE("p20details",t),QE("p20relay",t)}function p20showAddMeshUserDialogEx(e,t){var n=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?n=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(n+=1),1==Q("p20manageusers").checked&&(n+=2),1==Q("p20managecomputers").checked&&(n+=4)),1==Q("p20remotecontrol").checked&&(n+=8),1==Q("p20meshagentconsole").checked&&(n+=16),1==Q("p20meshserverfiles").checked&&(n+=32),1==Q("p20wakedevices").checked&&(n+=64),1==Q("p20editnotes").checked&&(n+=128),1==Q("p20remoteview").checked&&(n+=256),1==Q("p20nodesktop").checked&&(n+=65536),1==Q("p20noterminal").checked&&(n+=512),1==Q("p20nofiles").checked&&(n+=1024),1==Q("p20noamt").checked&&(n+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(n+=4096),1==Q("p20limitevents").checked&&(n+=8192),1==Q("p20chatnotify").checked&&(n+=16384),1==Q("p20uninstall").checked&&(n+=32768),1==Q("p20commands").checked&&(n+=131072),1==Q("p20resetoff").checked&&(n+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(n+=524288),1==Q("p20details").checked&&(n+=1048576),1==Q("p20relay").checked&&(n+=2097152)),8&n||(256&n&&(n-=256),512&n&&(n-=512),1024&n&&(n-=1024),2048&n&&(n-=2048),4096&n&&(n-=4096),65536&n&&(n-=65536)),1===t){var i=decodeURIComponent(Q("dp2groupid").value);null!=(o=meshes[i])&&meshserver.send({action:"addmeshuser",meshid:i,meshname:o.name,userids:[currentUser._id],meshadmin:n,remove:2==e})}else if(2===t){var a=decodeURIComponent(Q("dp2groupid").value);null!=(o=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:a,meshadmin:n,remove:2==e})}else if(3===t){var o;i=decodeURIComponent(Q("dp2groupid").value);null!=(o=meshes[i])&&meshserver.send({action:"addmeshuser",meshid:i,meshname:o.name,userids:[currentUserGroup._id],meshadmin:n,remove:2==e})}else if(4===t){null!=(u=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:u.name,userids:[currentUser._id],rights:n,remove:2==e})}else if(5===t){var s=Q("dp20username").value.split(","),l=[];for(var r in s)l.push(s[r].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:l,rights:n,remove:2==e})}else if(6===t){a=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[a],rights:n,remove:2==e})}else if(7===t){var d,u;null!=(u=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:u.name,userids:[currentUserGroup._id],rights:n,remove:2==e})}else if(null==t){s=Q("dp20username").value.split(","),l=[];for(var r in s)l.push(s[r].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:l,meshadmin:n,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:n,remove:2==e})}function p20viewuser(e){if(!xxdialogMode){var t=decodeURIComponent(e),n=GetMeshRights(currentMesh),i=GetMeshRights(currentMesh,t);if(userinfo._id!=t&&(4294967295==n||2&n&&4294967295!=i))p20showAddMeshUserDialog(e);else{var a=[];4294967295==i?a.push("Täysi Järjestelmänvalvoja (kaikki oikeudet)"):(1&i&&a.push("Muokkaa laiteryhmää"),2&i&&a.push("Hallitse laiteryhmän käyttäjiä"),4&i&&a.push("Hallitse laiteryhmän tietokoneita"),8&i&&a.push("Etähallinta"),16&i&&a.push("Agentin konsoli"),32&i&&a.push("Palvelimen Tiedostot"),64&i&&a.push("Herätä laitteet"),128&i&&a.push("Muokkaa muistiinpanoja"),8&i&&256&i&&a.push("Vain etäkatselu"),8&i&&65536&i&&a.push("Ei työpöytää"),8&i&&512&i&&a.push("Ei päätettä"),8&i&&1024&i&&a.push("Ei tiedostoja"),8&i&&2048&i&&a.push("Ei Intel&reg; AMT"),8&i&&4096&i&&!(256&i)&&a.push("Rajoitettu syöttö"),8192&i&&a.push("Vain itse tapahtumia"),16384&i&&a.push("Keskustele ja ilmoita"),32768&i&&a.push("Asennuksen poistaminen"),131072&i&&a.push("Komennot"),262144&i&&a.push("Nollaa / Pois"),524288&i&&a.push("Jakaminen"),1048576&i&&a.push("Tarkemmat tiedot"),2097152&i&&a.push("Rele")),0==a.length&&a.push("Ei oikeuksia");var o=t.split("/")[2];users&&users[t]&&(o=users[t].name),userinfo._id==t&&(o=userinfo.name);var s=1,l=addHtmlValue("Käyttäjänimi",EscapeHtml(decodeURIComponent(o)));t.split("/")[2]!=o&&(l+=addHtmlValue("Käyttäjätunnus",EscapeHtml(t.split("/")[2]))),l+=addHtmlValue("Käyttöoikeudet",a.join(", ")),userinfo._id!=t&&(4294967295==n||2&n&&4294967295!=i)&&(s+=4),setModalContent("xxAddAgent","Laiteryhmän käyttäjä",l),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(s,t))}}}function p20viewuserEx(e,t){if(2==e){var n=t.split("/")[2];users&&users[t]&&(n=users[t].name),usergroups&&usergroups[t]&&(n=usergroups[t].name),userinfo._id==t&&(n=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Poista käyttäjän oikeudet",format('Haluatko varmasti poistaa käyttäjän "{0}" oikeudet?',EscapeHtml(decodeURIComponent(n)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Poista käyttäjäryhmien käyttöoikeudet",format('Haluatko varmasti poistaa käyttäjäryhmän "{0}" oikeudet?',EscapeHtml(decodeURIComponent(n))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t))}}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),n=serverinfo.name;((-1==n.indexOf(".")||2&features)&&(n=window.location.hostname),1==serverinfo.https)?e="https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):e="http://"+n+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:"");if(1&t){var i="Kun tämä on käytössä, kuka tahansa voi käyttää kutsukoodeja laitteiden liittämiseen tähän laiteryhmään seuraavan julkisen linkin avulla:<br /><br />";i+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",i+='<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Ota kutsukoodit käyttöön</label></div>',i+=addHtmlFormFloating("Kutsu koodit",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'),i+=addHtmlFormFloating("Agentit",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Kaikki käytettävissä olevat edustajat</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option></select>'),i+="<div id=d2agentInstallTypeDiv>",i+=addHtmlFormFloating("Asennustyyppi",'<select id=agentInviteType class="form-select"><option value=0>Tausta ja vuorovaikutteinen</option><option value=2>Vain tausta</option><option value=1>Vain interaktiivinen</option></select>'),setModalContent("xxAddAgent","Kutsu koodit",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()}else{i="Kuka tahansa voi käyttää kutsukoodeja laitteiden liittämiseen tähän laiteryhmään seuraavan julkisen linkin avulla:<br /><br />";i+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",i+=addHtmlValue("Kutsu koodit",currentMesh.invite.codes.join(", ")),setModalContent("xxAddAgent","Kutsu koodit",i+=addHtmlValue("Asennustyyppi",["Tausta ja vuorovaikutteinen","Vain interaktiivinen","Vain tausta"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p20editmeshInviteCodeValidate(){var e=!0,t=Q("agentInviteCode").value.split(",");for(var n in t)t[n]=t[n].trim(),""==t[n]&&(e=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||e),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e=Q("agentInviteCode").value.split(",");for(var t in e)e[t]=e[t].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:e,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified;userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]);var n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Web-sivun ilmoitukset</div>';return n+='<div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Laiteyhteydet</label></div>',n+='<div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Laitteen irtikytkennät</label></div>',currentMesh.mtype<3&&(n+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT työpöytä ja sarjaliikenne ilmoitukset</label></div>'),t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">sähköposti-ilmoitukset</div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Laiteyhteydet</label></div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Laitteen irtikytkennät</label></div>',n+='<div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',n+='<div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Laiteyhteydet</label></div>',n+='<div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Laitteen irtikytkennät</label></div>',n+='<div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),setModalContent("xxAddAgent","Ilmoitusasetukset",n),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editMeshNotifyEx(e,t){var n=0;n+=Q("p20notifyIntelDeviceConnect").checked?2:0,n+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,currentMesh.mtype<3&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0,n+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,n+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(n+=Q("p20emsgDeviceConnect").checked?128:0,n+=Q("p20emsgDeviceDisconnect").checked?256:0,n+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:n})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Ei yhteyttä","Agentti","Intel&reg; AMT","Agentti + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Virustentorjunta ei ole aktiivinen","Ei automaattista päivitystä","Palomuuri ei ole aktiivinen","Useita kysymyksiä"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Ei mitään</i>"),1&e&&(t='<span tabindex=0 title="Muokkaa laiteryhmän nimeä napsauttamalla tätä" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",t);var n={},i={},a=[0,0,0,0],o=[0,0,0,0,0],s=!1,l=!1,r=!1,d=!1;for(var u in nodes)if(nodes[u].meshid==currentMesh._id&&(nodes[u].agent&&(s=!0,null==n[nodes[u].agent.id]?n[nodes[u].agent.id]=1:n[nodes[u].agent.id]++),nodes[u].pwr&&(l=!0,null==i[nodes[u].pwr]?i[nodes[u].pwr]=1:i[nodes[u].pwr]++),0==nodes[u].conn?(r=!0,a[0]++):6&nodes[u].conn?(r=!0,1&nodes[u].conn?a[3]++:a[2]++):1&nodes[u].conn&&(r=!0,a[1]++),nodes[u].wsc)){d=!0;var c=0;"OK"==nodes[u].wsc.antiVirus&&c++,"OK"==nodes[u].wsc.autoUpdate&&c++,"OK"==nodes[u].wsc.firewall&&c++,3==c?o[0]++:c<2?o[4]++:"OK"!=nodes[u].wsc.antiVirus?o[1]++:"OK"!=nodes[u].wsc.autoUpdate?o[2]++:"OK"!=nodes[u].wsc.firewall&&o[3]++}var p=[],m=[],g=[],v=[],h=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(var u in n)p.push(n[u]),m.push(h[u]);for(var u in i)g.push(i[u]),v.push(powerStatetable[u]);window.meshPowerChart.config.data.datasets[0].data=g,window.meshPowerChart.config.data.labels=v,window.meshPowerChart.update(),currentMesh.mtype>=2&&(window.meshOsChart.config.data.datasets[0].data=p,window.meshOsChart.config.data.labels=m,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=a,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=o,window.meshSecurityChart.update();var f="",k=0;if(g.length>0){var x=[];for(var u in i)x.push([powerStatetable[u],i[u]]);for(var u in x.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Virta tilat</th></tr>',x)f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[u][1]+" <td> "+x[u][0]+"</tr>";f+="</tbody></table>"}if(p.length>0&&currentMesh.mtype>=2){k=0;var y=[];for(var u in n)y.push([h[u],n[u]]);for(var u in y.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Agenttityypit</th></tr>',y)f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+y[u][1]+"<td> "+y[u][0]+"</tr>";f+="</tbody></table>"}if(r){k=0;var b=[];for(u=0;u<4;u++)b.push([["Ei yhteyttä","Agentti","Intel&reg; AMT","Agentti + Intel&reg; AMT"][u],a[u]]);b.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Liitettävyys</th></tr>';for(u=0;u<4;u++)b[u][1]>0&&(f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[u][1]+"<td> "+b[u][0]+"</tr>");f+="</tbody></table>"}if(d){k=0;var w=[];for(u=0;u<4;u++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Virustentorjunta ei ole aktiivinen','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Ei automaattista päivitystä','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Palomuuri ei ole aktiivinen','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Useita kysymyksiä'][u],o[u]]);w.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Turvallisuus</th></tr>';for(u=0;u<4;u++)w[u][1]>0&&(f+="<tr style="+(++k%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[u][1]+"<td> "+w[u][0]+"</tr>");f+="</tbody></table>"}""==f&&(f="<i>Ei laitteita tässä laiteryhmässä</i>"),QH("p21info",f);var M=(l?1:0)+(currentMesh.mtype>=2&&s?1:0)+(r?1:0)+(d?1:0);QS("meshPowerChartDiv").display=l?"inline-block":"none",QS("meshOsChartDiv").display=currentMesh.mtype>=2&&s?"inline-block":"none",QS("meshConnChartDiv").display=r?"inline-block":"none",QS("meshSecurityChartDiv").display=d?"inline-block":"none",QS("meshPowerChartDiv").width=M>3?"23%":"31%",QS("meshOsChartDiv").width=M>3?"23%":"31%",QS("meshConnChartDiv").width=M>3?"23%":"31%",QS("meshSecurityChartDiv").width=M>3?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",!(8&features)),!(8&features)){for(var e,t="",n="",i='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Root</a>',a="Root",o=filetree,s=1,l=[],r=filetreelinkpath,d=[],u=document.getElementsByName("fc"),c=0;c<u.length;c++)u[c].checked&&d.push(u[c].value);for(var c in filetreelinkpath="",filetreelocation){if(null==o.f||null==o.f[filetreelocation[c]])break;if(l.push(filetreelocation[c]),a+=" / "+filetreelocation[c],1==s){var p=filetreelocation[c].split("/");e=window.location.origin+domainUrl+p[0]+"files/"+p[2],filetreelinkpath+=filetreelocation[c]}else""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[c],s>2&&(e+="/"+filetreelocation[c]));o=o.f[filetreelocation[c]],i+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+s+')">'+EscapeHtml(null!=o.n?o.n:filetreelocation[c])+"</a>",s++}filetreelocation=l;var m=a.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(o.f);for(var c in g){var v,h=g[c],f=h.n;v=f.length>70?'<span title="'+EscapeHtml(f)+'">'+EscapeHtml(f.substring(0,70))+"...</span>":EscapeHtml(f);var k="";if(null!=h.d)k=printDateTime(new Date(h.d))+"&nbsp;";var x="";null!=h.s&&(x=getFileSizeStr(h.s));var y="";if(h.t<3||4==h.t){var b=1==h.t||4==h.t?p5getQuotabar(h):"";y='<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(f)+'">&nbsp;<span style=float:right title="">'+b+"</span><span><div class=fileIcon"+h.t+' onclick=p5folderset("'+encodeURIComponentEx(h.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(h.nx)+"\")'>"+v+"</a></span></div>"}else{var w=v,M="",S=urlargs.key?"&key="+urlargs.key:"";m&&(M='<i class="fa-regular fa-copy" style=cursor:pointer title="Näytä julkinen linkki" onclick=\'return p5showPublicLink("'+e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+S+'")\'></i> <i class="fa-regular fa-copy" title="Kopioi linkki leikepöydälle" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+S)+'")></i>'),h.s>0&&(w=M+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+h.nx)+'")>'+v+"</a>"),y='<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+h.nx+'">&nbsp;<span class=fsize>'+k+"</span><span style=float:right>"+x+"</span><span><div class=fileIcon"+h.t+"></div>"+w+"</span></div>"}h.t<3?t+=y:n+=y}if(QH("p5rightOfButtons",p5getQuotabar(o)),QH("p5files",t+n),QH("p5currentpath",i),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),r==filetreelinkpath){u=document.getElementsByName("fc");for(c=0;c<u.length;c++)u[c].checked=d.indexOf(u[c].value)>=0}p5setActions()}}function getNiceSize(e){return e<=0?"Tallennusraja ylitetty":e<2048?format("{0} tavua jäljellä",e):e<2097152?format("{0} kilotavua jäljellä",Math.round(e/1024)):e<2147483648?format("{0} megatavua jäljellä",Math.round(e/1024/1024)):format("{0} gigatavua jäljellä",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Ei mitään":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Ei mitään":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;e.t>1&&4!=e.t;)e=e.parent;if(1!=e.t&&4!=e.t||null==e.maxbytes)return"";var t=Math.floor(e.s/1024),n=e.maxbytes-e.s;return'<span title="'+(e.c>1?format("{0}k {1} tiedostossa.{2}k maksimi",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0}k yhdessä tiedostossa.{1}k maksimi",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(n)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>"}function p5showPublicLink(e){return setModalContent("xxAddAgent","Julkinen linkki",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Kopioi linkki leikepöydälle" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?1*sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?1*sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t=[],n=Q("p5sortdropdown").value;for(var i in e)e[i].nx=i,null==e[i].n&&(e[i].n=i),e[i].ln=e[i].n.toLowerCase(),t.push(e[i]);return sortorder=1,n>3&&(sortorder=-1,n-=3),1==n?t.sort(p5sort_filename):2==n?t.sort(p5sort_bysize):3==n&&t.sort(p5sort_timestamp),t}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),n=getFileSelCount(!1);QE("p5DeleteFileButton",e>0&&filetreelocation.length>0),QE("p5ViewFileButton",1==e&&1==n&&filetreelocation.length>0),QE("p5NewFolderButton",filetreelocation.length>0),QE("p5UploadButton",filetreelocation.length>0),QE("p5DownloadButton",e>0&&e==n&&filetreelocation.length>0),QE("p5RenameFileButton",1==e&&filetreelocation.length>0),QE("p5SelectAllButton",t>0),Q("p5SelectAllButton").value=e>0?"Poista valinta":"Valitse kaikki",QE("p5CutButton",n>0&&e==n),QE("p5CopyButton",n>0&&e==n),QE("p5PasteButton",null!=p5clipboard&&p5clipboard.length>0&&filetreelocation.length>0)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),i=0;i<n.length;i++)!n[i].checked||0==e&&"3"!=n[i].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t=0,n=0;for(var i in e.f)setupBackPointers(e.f[i]),e.f[i].parent=e,e.f[i].s&&(t+=e.f[i].s),e.f[i].c&&(n+=e.f[i].c),3==e.f[i].t&&n++;e.s=t,e.c=n}return e}function getFileSizeStr(e){return"number"!=typeof e&&(e=0),1==e?"1 tavu":format("{0} tavua",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Uusi kansio",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Rekursiivinen poisto</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Poista",e>1?format("Poista {0} valittua kohdetta?",e)+t:"Poista valittu kohde?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);setModalContent("xxAddAgent","Nimeä uudelleen",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=function(){var e=/^[^\\/:\*\?"<>\|]+$/,t=/^\./,n=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(i){return e.test(i)&&!t.test(i)&&!n.test(i)&&"."!=i[0]}}();function p5uploadFile(){setModalContent("xxAddAgent","Lataa tiedosto",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />Haluatko varmasti korvata olemassa olevan?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t=filetree;for(var n in filetreelocation)null!=t.f&&null!=t.f[filetreelocation[n]]&&(t=t.f[filetreelocation[n]]);return t.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(var n in e)null!=e[n].size&&0!=e[n].size&&t.push(e[n]);var i=filetree,a=[],o=0;for(var n in filetreelocation)null!=i.f&&null!=i.f[filetreelocation[n]]&&(i=i.f[filetreelocation[n]]);if(QE("idx_dlgOkButton",e.length>0),e.length>0){if(null!=i.f){for(var n in i.f)a.push(n);for(n=0;n<e.length;n++)a.indexOf(e[n].name)>=0&&o++}QV("p5confirmOverwriteSpan",o>0),o>0?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)if(e[t].checked){var n=p5GetFileInfo(e[t].value);if(null==n)return;return void(n.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:e[t].value,tag:"edit"}):messagebox("Tiedostoeditori","Vain alle 200 kt: n tiedostoja voidaan muokata."))}}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p5clipboard.push(t[n].value);p5updateClipview()}function p5pasteFile(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("Haluatko varmasti {0} {1} kohdetta tänne?",0==p5clipboardCut?"copy":"move",p5clipboard.length,p5clipboard.length>1?"s":"")),setModalContent("xxAddAgent","Liitä",e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("{0} kohde{1} valittu {2} varten",p5clipboard.length,p5clipboard.length>1?"s":"",0==p5clipboardCut?"kopiointia":"siirrä")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Tyhjennä</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(var n in e.dataTransfer.files)null!=e.dataTransfer.files[n].size&&0!=e.dataTransfer.files[n].size&&t.push(e.dataTransfer.files[n]);if(0!=t.length){var i=filetree,a=[],o=0;for(var n in filetreelocation)null!=i.f&&null!=i.f[filetreelocation[n]]&&(i=i.f[filetreelocation[n]]);if(null!=i.f){for(var n in i.f)a.push(n);for(n=0;n<e.dataTransfer.files.length;n++)a.indexOf(e.dataTransfer.files[n].name)>=0&&o++}0==o?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Lataa tiedosto",format(1==o?"Lataus korvaa 1 tiedoston. Jatkaa?":"Lataus korvaa {0} tiedostoa. Jatkaa?",o)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var n=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){n=1}if(0==n&&p5uploadFileEx(),setDialogMode(0),1==n){if(0==filetreelocation.length)return;for(var i=[],a=[],o=[],s=[],l=t.length,r=0,d=0;d<t.length;d++)r+=t[d].size;if(r>13e5)return void p5uploadFile();for(d=0;d<t.length;d++){var u=new FileReader,c=t[d];i.push(c.name),a.push(c.size),o.push(c.type),u.onload=function(e){s.push(e.target.result),0==--l&&(Q("p5fileDragName").value=i.join("*"),Q("p5fileDragSize").value=a.join("*"),Q("p5fileDragType").value=o.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},u.readAsDataURL(c)}}}var p5dragtimer=null;function p5fileDragOver(e){if(!xxdialogMode){haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null);var t=!0;0==filetreelocation.length&&(t=!1),QV("bigok",t),QV("bigfail",!t)}}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++){if(e[t].checked)downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}}var eventsMessageId={1:"Tilille kirjautuminen",2:"Tilin uloskirjautuminen",3:"Kieli vaihdettu kielestä {1} kieleksi {2}",4:"Liittyi työpöydän multiplex-istuntoon",5:"Poistu työpöydän multiplex-istunnosta",6:"Aloitettu työpöydän multipleksointiistunto",7:"Tallennusistunto valmis, {0} sekuntia",8:"Suljettu työpöydän multiplex-istunto, {0} sekuntia",9:'Välitysistunto "{0}" päättyi välillä {1} - {2}, {3} sekuntia',10:'Pääteistunto "{0}" päättyi välillä {1} - {2}, {3} sekuntia',11:'Työpöytäistunto "{0}" päättyi välillä {1} - {2}, {3} sekuntia',12:'Tiedostonhallintaistunto "{0}" päättyi välillä {1} - {2}, {3} sekuntia',13:'Aloitti välitysistunnon "{0}" välillä {1} - {2}',14:'Aloitettu pääteistunto "{0}" välillä {1} - {2}',15:'Aloitettu työpöytäistunto "{0}" välillä {1} - {2}',16:'Tiedostonhallintaistunto "{0}" aloitettu välillä {1} - {2}',17:'Käsitellään konsolikomentoa: "{0}"',18:'Näytetään viestiruutu, title = "{0}", message = "{1}"',19:"Tappamisprosessi {0}",20:"Avaaminen: {0}",21:"Haetaan leikepöydän sisältöä, {0} tavua",22:"Asetetaan leikepöydän sisältöä, {0} tavua",23:"Yritetään Intel (R) AMT ACM -tilan aktivointia",24:"Komentojen suorittaminen",25:"Suoritetaan tehotoimintaa = {0}, pakotettua = {1}",26:'Näytetään paahtoleipää, title = "{0}", message = "{1}"',27:"Paikallinen käyttäjä hyväksyi etäpäätepyynnön",28:"Paikallinen käyttäjä hylkäsi etäpäätepyynnön",29:"Paikallinen käyttäjä on sulkenut etätyöpöytäyhteyden voimakkaasti",30:"Aloitetaan etätyöpöytä sen jälkeen, kun paikallinen käyttäjä on hyväksynyt",31:"Etätyöpöytäyhteyspalkki aktivoitu / päivitetty",32:"Etätyöpöytäyhteyspalkki epäonnistui tai sitä ei tueta",33:"Paikallinen käyttäjä on sulkenut etätyöpöytäyhteyden voimakkaasti",34:"Etätyöpöydän käynnistäminen epäonnistui, kun paikallinen käyttäjä hylkäsi",35:"Aloitettiin etätyöpöytä paahtolehden ilmoituksella",36:"Aloitettiin etätyöpöytä ilman ilmoitusta",37:"Etätyöpöytäyhteyspalkki aktivoitu / päivitetty",38:"Etätyöpöytäyhteyspalkki epäonnistui tai sitä ei tueta",39:"Paikallinen käyttäjä on sulkenut etätyöpöytäyhteyden voimakkaasti",40:"Aloitetaan etätiedostot paikallisen käyttäjän hyväksynnän jälkeen",41:"Etätiedostojen käynnistäminen epäonnistui, kun paikallinen käyttäjä hylkäsi",42:"Aloitettiin etätiedostot paahtoleipää koskevalla ilmoituksella",43:"Aloitti etätiedostot ilman ilmoitusta",44:'Luo kansio: "{0}"',45:'Poista: "{0}"',46:'Poista rekursiivinen: "{0}", {1} elementti(ä) poistettu',47:'Poista: "{0}", {1} elementti (ä) poistettu',48:'Nimeä uudelleen: "{0}" muotoon "{1}"',49:'Lataa: "{0}"',50:'Lähetä: "{0}"',51:'Kopioi: "{0}" kansioon "{1}"',52:'Siirrä: "{0}" kohtaan "{1}"',53:"Etäkäyttäjän lukitseminen työpöydältä",54:"Agentin suljettu istunto, jossa {0}% agentti-palvelin-pakkaus. Lähetetty: {1}, Pakattu: {2}",55:"Luotu laiteryhmä: {0}",56:"Laiteryhmä kumottu: {0}",57:"Lisätty laite {0} laiteryhmään {1}",58:"Laite pyysi Intel (R) AMT ACM -aktivointia, FQDN: {0}",59:"Vaihdettu laite {0} ryhmästä {1}: {2}",60:"Poistettiin käyttäjän {0} käyttäjän laitteen oikeudet",61:"Muutti käyttäjän laitteen käyttöoikeuksia verkkotunnukselle {0}",62:"Poistettiin käyttäjä {0} käyttäjäryhmästä {1}",63:"Tili poistettu",64:"Tili luotu, käyttäjänimi on {0}",65:"Tili luotu, sähköpostiosoite on {0}",66:"Tili muutettu: {0}",67:"Käyttäjäryhmän jäsenyys muutettu: {0}",68:"Lisätty käyttäjäryhmä {0} laiteryhmään {1}",69:"Luotu käyttäjäryhmä: {0}",70:"Poistettiin käyttäjäryhmä {0} laiteryhmästä {1}",71:"Lisätty käyttäjä {0} käyttäjäryhmään {1}",72:"Poistettiin käyttäjä {0} käyttäjäryhmästä {1}",73:"Laiteryhmäilmoitus muutettu",74:"Tilin salasana vaihdettu: {0}",75:"Muutetut tilin tunnistetiedot",76:"Luotu laiteryhmä: {0}",77:"Laiteryhmä poistettu: {0}",78:"Laiteryhmän jäsenyys muutettu: {0}",79:"Muutettu käyttäjäryhmä: {0}",80:"Lisätty käyttäjä {0} käyttäjäryhmään {1}",81:"Poistettiin käyttäjän {0} käyttäjän laitteen oikeudet",82:"Muutti käyttäjän laitteen käyttöoikeuksia verkkotunnukselle {0}",83:"Poistettiin käyttäjä {0} laiteryhmästä {1}",84:"Lisätty laite {0} laiteryhmään {1}",85:"Siirretty laite {0} ryhmään {1}",86:"Poistettiin käyttäjän {0} käyttäjän laitteen oikeudet",87:"Poistettiin laite {0} laiteryhmästä {1}",88:"Otti käyttöön kaksivaiheisen todennuksen sähköpostilla",89:"Poistettu käytöstä kaksivaiheinen sähköpostitodennus",90:"Lisätty todennussovellus",91:"Poistettu todennussovellus",92:"Uudet 2FA-varmuuskopiokoodit luotu",93:"2FA-varmuuskopiokoodit tyhjennetty",94:"Poistettu suojausavain",95:"Lisätty suojausavain",96:"Vahvistettu käyttäjän {0} puhelinnumero",97:"Käyttäjän {0} puhelinnumero poistettu",98:"Apua pyydetään, käyttäjä: {0}, tiedot: {1}",99:"Komentojen suorittaminen käyttäjänä",100:"Suorita komennot käyttäjänä, jos mahdollista",101:"Laitteen jako {0} lisätty kohteesta {1} kansioon {2}",102:"Laitteen jakaminen poistettu {0}",103:"Erä lähetetään {0} tiedostoa kansioon {1}",104:'Agentin ydintiedoston automaattinen lataus: "{0}"',105:'Lähetys: "{0}", Koko: {1}',106:'Lataa: "{0}", koko: {1}',107:"Tilin kirjautuminen käyttäjiltä {0}, {1}, {2}",108:"Käyttäjän kirjautumisyritys, jonka toinen tekijä on virheellinen {0}, {1}, {2}",109:"Käyttäjän kirjautumisyritys lukitulle tilille: {0}, {1}, {2}",110:"Virheellinen käyttäjän kirjautumisyritys käyttäjiltä {0}, {1}, {2}",111:"Laite pyysi Intel (R) AMT ACM TLS -aktivointia, FQDN: {0}",112:'Messenger -istunto "{0}" päättyi {1} - {2}, {3} sekuntia',113:"Lisätty push -ilmoitusten todennuslaite",114:"Push -ilmoitusten todennuslaite poistettu",115:"Lisätty kirjautumistunnus",116:"Kirjautumistunnus poistettu",117:"Tämä on vanha agenttiversio, harkitse päivittämistä.",118:"Tällä agentilla on vanhentunut varmenteen vahvistusmekanismi, harkitse päivittämistä.",119:"Tämä agentti käyttää turvattomia tunneleita, harkitse päivittämistä.",120:'Alkoi paikallinen välitysistunto "{0}", protokolla {1} käyttäjälle {2}',121:'Paikallinen välitysistunto "{0}", protokolla {1} - {2}, {3} sekuntia',122:"Poistui työpöydän multipleksi-istunnosta {0} sekunnin kuluttua.",123:'Poistui Web-SSH-istunnosta "{1}" {0} sekunnin kuluttua.',124:'Poistui Web-SFTP-istunnosta "{1}" {0} sekunnin kuluttua.',125:'Poistui Web-RDP-istunnosta "{1}" {0} sekunnin kuluttua.',126:"Poistui Web-VNC-istunnosta {0} sekunnin kuluttua.",127:"Tilin näyttönimeksi vaihdettiin {0}.",128:"Tili luotu, nimi on {0}.",129:"Tilin näyttönimi poistettu.",130:"Käyttäjäilmoitukset muutettu",131:"Lisätty laitteen jako {0} rajoittamattomaksi ajaksi.",132:"Kiihottua.",133:"Sammuttaa.",134:"Käyttäjän {0} yhteys pakotettu katkaistiin",135:"Käyttäjän {0} väkisin katkaistu pääteistunto",136:"Käyttäjän {0} väkisin katkaistu tiedostoistunto",137:"Käyttäjän {0} yhteys pakotettu katkaistu reititysistuntoon",138:"Lisätty laitejako {0} toistuvasti päivittäin.",139:"Lisätty laitejako {0} toistuvasti viikoittain.",140:"Vaihdettu laite {0} ryhmästä {1}: {2}",141:"Intel(r) AMT -käytännön muutos",142:"Laiteryhmää {0} muutettiin: {1}",143:'Liittyi työpöydän multipleksointiistuntoon "{0}"',144:'Poistui työpöydän multipleksointiistunnosta "{0}" {1} sekunnin kuluttua.',145:'Aloitettu työpöytämultipleksiistunto "{0}"',146:'Tallennusistunto "{0}" valmis, {1} sekuntia',147:'Suljettu työpöydän multipleksointiistunto "{0}", {1} sekuntia',148:'Web-SSH-istunto "{0}" aloitettu.',149:'Web-SFTP-istunto "{0}" aloitettu.',150:'Web-RDP-istunto "{0}" aloitettu.',151:'Web-VNC-istunto "{0}" aloitettu.',152:'Ei enää rele kohteelle "{0}".',153:'On rele kohteelle "{0}".',154:"Account changed to sync with LDAP data.",155:"Denied user login from {0}, {1}, {2}",156:"Verified messaging account of user {0}",157:"Removed messaging account of user {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication",162:'Aloitti Messenger -istunto "{0}" välillä {1} - {2}'},eventsShortMessageId={1:"Ryhmän nimi",2:"Kuvaus",3:"Liput",4:"Suostumus",5:"Automaattinen-Poisto",6:"Kutsukoodi",7:"Rele laite"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(var n in events){var i=events[n],a=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var o,s="fa-mobile-screen";if("ugrp"==i.etype&&(s="fa-users"),"user"==i.etype&&(s="fa-user"),"server"==i.etype&&(s="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])o="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{if(o=eventsMessageId[i.msgid],null!=i.msgArgs)for(var n in i.msgArgs){var l=i.msgArgs[n];if(Array.isArray(l)){var r=[];for(var d in l)"number"==typeof l[d]&&eventsShortMessageId[l[d]]?r.push(eventsShortMessageId[l[d]]):r.push(l[d]);l=r.join(", ")}else"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9)))));o=o.split("{"+n+"}").join(l)}o=EscapeHtml(o).split("(R)").join("&reg;")}if(i.nodeid){var u=getNodeFromId(i.nodeid);if(null!=u){switch(u.icon){case 1:s="fa-computer";break;case 2:s="fa-laptop";break;case 8:s="fa-laptop-code"}o="<a href=# onclick='gotoDevice(\""+i.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(u.name)+"</a> &rarr; "+o}}if(i.username){var c="";i.guestname&&(c=' / <span title="Tämä on vieraiden jakamisistunto">'+EscapeHtml(i.guestname)+"</span>"),o=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+c+" &rarr; "+o:EscapeHtml(i.username)+c+" &rarr; "+o}i.remoteaddr&&(o+=" ("+i.remoteaddr+")"),"relay"!=i.etype&&"relaylog"!=i.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+o+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ei tapahtumia</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){if(!xxdialogMode){var e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>";e+=addHtmlFormFloating("Raporttityyppi",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Kaikki tapahtumat</option>'),e+=addHtmlFormFloating("Aikajänne",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Kaikki käytettävissä olevat</option><option value=2>Yksi päivä</option></select>'),e+="<div id=d2daySelector>"+addHtmlFormFloating("Raporttipäivä",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>",e+=addHtmlFormFloating("Ryhmittele",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Ei mitään</option><option value=2>Laiteryhmä</option><option value=3>Käyttäjä</option>'),e+=addHtmlFormFloating("Muoto",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>'),setModalContent("xxAddAgent","Lataa raportti",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus()}}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value;Q("d2reportGroupBy").value,Q("d2reportFormat").value;QV("d2daySelector",2==e);var n=!0;2==e&&""==t&&(n=!1),QE("idx_dlgOkButton",n)}function p3showDownloadEventsDialog(e){if(!xxdialogMode){var t="Lataa luettelo tapahtumista, jollakin alla olevista tiedostomuodoista.<br /><br />";t+=addHtmlValue("CSV muoto",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'),setModalContent("xxAddAgent","Tapahtumaluettelon vienti",t+=addHtmlValue("JSON Muoto",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p3downloadEventsDialogCSV(e){var t,n;for(var i in 1==e&&(n=currentDeviceEvents),2==e&&(n=events),3==e&&(n=currentUserEvents),t="utc, aika, tyyppi, toiminta, käyttäjä, laite, viesti\r\n",n){var a="";if(n[i].nodeid){var o=getNodeFromId(n[i].nodeid);o&&o.name&&(a=o.name)}t+='"'+n[i].time+'","'+printDateTime(new Date(n[i].time))+'","'+n[i].etype+'","'+(null!=n[i].action?n[i].action:"")+'","'+(null!=n[i].username?n[i].username:"")+'","'+EscapeHtml(a)+'","'+(null!=n[i].msg?n[i].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,n=[];for(var i in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),3==e&&(t=currentUserEvents),t)n.push(events[i]);return saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",!(4&features)&&0==serverinfo.domainauth),null==users||4&features)QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],n=e,i=0;for(var a in users)t.push(users[a]);t.sort(nameSort);var o=Q("UserSearchInput").value.toLowerCase(),s=o;o.startsWith("email:")?(o=null,s=s.substring(6)):o.startsWith("name:")?(s=null,o=o.substring(5)):o.startsWith("e:")?(o=null,s=s.substring(2)):o.startsWith("n:")&&(s=null,o=o.substring(2));var l='<table class="table table-hover" cellpadding=0 cellspacing=0>',r=!0;l+="<th>Nimi<th style=width:80px>Laiteryhmät<th style=width:120px>"+nobreak("Viimeisin käyttö")+"<th style=width:120px>Käyttöoikeudet";var d=[],u=document.getElementsByClassName("UserCheckbox");for(a=0;a<u.length;a++)u[a].checked&&d.push(u[a].value);for(var a in t){var c=t[a],p=null;null!=wssessions&&(p=wssessions[c._id]),null!=p&&(null!=o&&(""==o||c.name.toLowerCase().indexOf(o)>=0)||null!=s&&null!=c.email&&c.email.toLowerCase().indexOf(s)>=0)&&(n>0?(r&&(l+="<tr><td class=userTableHeader colspan=4>Online-tilassa olevat käyttäjät",r=!1),l+=addUserHtml(c,p),n--):i++)}for(var a in r=!0,t){c=t[a],p=null;null!=wssessions&&(p=wssessions[c._id]),null==p&&(null!=o&&(""==o||c.name.toLowerCase().indexOf(o)>=0)||null!=s&&null!=c.email&&c.email.toLowerCase().indexOf(s)>=0)&&(n>0?(r&&(l+="<tr><td class=userTableHeader colspan=4>Offline-tilassa olevat käyttäjät",r=!1),l+=addUserHtml(c,p),n--):i++)}l+="</table>",1==i?l+="<br />1 muuta käyttäjää ei näy, käytä hakukenttää etsiäksesi käyttäjiä ...<br />":i>1&&(l+="<br />"+format("{0} muuta käyttäjää ei näy, etsi käyttäjiä hakukentän avulla ...",i)+"<br />"),n==e&&(l+="<br />Käyttäjiä ei löytynyt.<br />"),QH("p3users",l),u=document.getElementsByClassName("UserCheckbox");var m=encodeURIComponentEx(userinfo._id);for(a=0;a<u.length;a++)u[a].checked=d.indexOf(u[a].value)>=0&&u[a].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var n="",i=" gray",a="",o=e._id!=userinfo._id,s="",l="";null!=t?(i="",o&&(a='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",a+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 istunto":format("{0} istuntoa",t))):e.access?s+='<span title="'+format("Viimeisin käyttöoikeus: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Edellinen kirjautuminen: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),o&&(l+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(l+="Lukittu,&nbsp;"),l+="<span title='Palvelimen oikeudet'>";var r=4294966047&e.siteadmin;null==e.siteadmin||0==r?l+="Käyttäjä":8==r?l+="Käyttäjä + tiedostot":4294967295==e.siteadmin?l+="Järjestelmänvalvoja":l+=2&r?"Johtaja":"Osittainen",null!=e.siteadmin&&4294967295!=e.siteadmin&&1216&e.siteadmin&&(l+="*"),l+="</span>",o&&(l+="</a>");var d=0;if(e.links)for(var u in e.links)u.startsWith("mesh/")&&d++;var c=EscapeHtml(e.name),p="";if(1==serverinfo.emailcheck&&(p=1!=e.emailVerified?' <b style=color:red title="Sähköposti osoitetta ei ole vahvistettu">&#x2717;</b>':' <b style=color:green title="Sähköposti on vahvistettu">&#x2713</b>'),null!=e.email&&(2097152&features&&e.email.toLowerCase()==e.name.toLowerCase()?c+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Lähetä käyttäjälle sähköposti" style="margin-top:2px" /></a>'+p:c+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+p),null!=serverinfo.crossDomain){var m=e._id.split("/")[1];""!=m&&(c+=", <span style=color:#26F>"+m+"</span>")}return(e.otpsecret>0||e.otphkeys>0||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(c+=' <i class="fa-solid fa-key" title="kaksivaiheinen todennus käytössä" style="margin-top:2px"></i>'),null!=e.phone&&(c+=' <i class="fa-solid fa-mobile-screen" title="Vahvistettu puhelinnumero" style="margin-top:2px"></i>'),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(c+=' <img src="images/padlock12.png" height=12 width=8 title="Tili on lukittu" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(c+=' <i class="fa-solid fa-comment fa-xs" title="Verified messaging account" style="margin-top:2px" />'),n+="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>",n+="<div>",n+='<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>',n+='<div class=baricon><i class="fa-fw fa-solid fa-user '+i+'"></i></div>',n+="<div>",n+="<div><span style=line-height:24px>"+c+"</span>"+a+"</div></div><td style=text-align:center>"+d+"<td style=text-align:center>"+s+"<td style=text-align:center>"+l}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupActionButton",t>0),Q("UsersSelectAllButton").value=t>0?"Poista valinta":"Valitse kaikki"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),n=0,i=0;i<t.length;i++)!0===t[i].checked&&n++;for(i=0;i<t.length;i++)t[i].checked=0==n&&t[i].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;if(0!=t){var i="";serverinfo.emailcheck&&(i+="<option value=4>Vahvista sähköposti</option><option value=5>Mitätöi sähköpostiosoite</option>");var a="Valitse kaikille valituille käyttäjille suoritettava toiminto.<br /><br />";setModalContent("xxAddAgent","Ryhmätoiminta",a+=addHtmlFormFloating("Operaatio","<select id=d3groupop class=form-select><option value=1>Lukitse tili</option><option value=2>Poista tilin lukitus</option>"+i+"<option value=3>Poista tili</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx)}}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));var i=Q("d3groupop").value;if(1==i)for(var n in t){32&(a=null==(o=users[t[n]]).siteadmin?0:o.siteadmin)||(a+=32,meshserver.send({action:"edituser",id:o._id,siteadmin:a}))}else if(2==i)for(var n in t){var a;32&(a=null==(o=users[t[n]]).siteadmin?0:o.siteadmin)&&(a-=32,meshserver.send({action:"edituser",id:o._id,siteadmin:a}))}else if(3==i){QE("idx_dlgOkButton",!1)}else if(4==i)for(var n in t){!0!==(o=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:o._id,emailVerified:!0})}else if(5==i)for(var n in t){var o;!0===(o=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:o._id,emailVerified:!1})}}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),n=[],i=0;i<t.length;i++)!0===t[i].checked&&n.push(decodeURIComponent(t[i].value));for(var i in n){var a=users[n[i]];meshserver.send({action:"deleteuser",userid:a._id,username:a.name})}}function userMouseHover(e,t){var n=e.children[0].children[0].children[1];n.children[1].classList.remove("g1s"),n.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var n=e.children[0].children[0];n.children[2].classList.remove("g1s"),n.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[2].classList.add("g1s"),n.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,n){if(!xxdialogMode){haltEvent(e);var i="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+n;return null!=authCookie&&""!=authCookie&&(i+="&auth="+authCookie),urlargs.key&&(i+="&key="+urlargs.key),safeNewWindow(i,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}}function altUserChat(e,t,n,i){if(!xxdialogMode){haltEvent(e);var a=serverinfo.altmessenging[i].url,o=decodeURIComponent(t),s=encodeURIComponentEx(o.split("/")[2]),l=encodeURIComponentEx(o.split("/").join("-")),r=s,d=l,u=users[o];return null!=u&&null!=u.realname&&(r=encodeURIComponentEx(u.realname.split(" ").join("")),d=encodeURIComponentEx(u.realname.split(" ").join("-"))),a=a.split("{0}").join(s).split("{1}").join(l).split("{2}").join(r).split("{3}").join(d),urlargs.key&&(a+="&key="+urlargs.key),safeNewWindow(a,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[i].name,msgid:11,url:a}),!1}}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","Lähetä tekstiviesti","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",Q("d2smsText").value.length>0)}function showSendSMSEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Send Message","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){if(!xxdialogMode){setModalContent("xxAddAgent","Lähetä Sähköposti",'<input id=d2emailSubject style=width:100% placeholder="Otsikko"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate()}}function showSendEmailValidate(){QE("idx_dlgOkButton",Q("d2emailSubject").value.length>0&&Q("d2emailText").value.length>0)}function showSendEmailEx(e,t){Q("d2emailText").value.length>0&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode){haltEvent(e);return setModalContent("xxAddAgent",format("Ilmoita {0}",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Lähetä tekstiviesti tälle käyttäjälle.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Näytä viesti, kunnes käyttäjä hylkäsi sen</option><option value=10>Näytä 10 sekuntia</option><option value=60>Näytä yhden minuutin ajan</option><option value=300>Näytä 5 minuuttia</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){if(!xxdialogMode){null==userViewSettings&&(userViewSettings={});var e="";setModalContent("xxAddAgent","Käyttäjien näkymä",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(userViewSettings.noViewLimit?"":" checked")+">Näytä vain ensimmäiset 100 käyttäjää</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx)}}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){if(!xxdialogMode){setModalContent("xxAddAgent","Käyttäjätilin tuonti",'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx)}}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){const a=e.target.result.split("\n"),o=a[0].trim().split(","),s=[];for(let e=1;e<a.length;e++){const t=a[e].trim();if(""===t)continue;const n=t.split(",");let i=!1;for(let e=0;e<n.length;e++)if(""!==n[e].trim()){i=!0;break}if(!i)continue;const l={};for(let e=0;e<o.length;e++){const t=n[e].trim();""!==o[e].trim()&&""!==t&&(l[o[e]]="true"===t.toLowerCase()||t)}s.push(l)}if(null!=(t=s)&&Array.isArray(t)){var n=!0;for(var i in t)("string"!=typeof t[i].user||t[i].user.length<1||t[i].user.length>64)&&(n=!1),("string"!=typeof t[i].pass||t[i].pass.length<1||t[i].pass.length>256)&&(n=!1),0==checkPasswordRequirements(t[i].pass,passRequirements)&&(n=!1),null!=t[i].email&&("string"!=typeof t[i].email||t[i].email.length<1||t[i].email.length>128)&&(n=!1);0==n?setModalContent("xxAddAgent","Käyttäjätilin tuonti","Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Käyttäjätilin tuonti","Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Käyttäjätilin tuonti",format("JSON-tiedosto {0} on virheellinen.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){n=!0;for(var i in t)("string"!=typeof t[i].user||t[i].user.length<1||t[i].user.length>64)&&(n=!1),("string"!=typeof t[i].pass||t[i].pass.length<1||t[i].pass.length>256)&&(n=!1),0==checkPasswordRequirements(t[i].pass,passRequirements)&&(n=!1),null!=t[i].email&&("string"!=typeof t[i].email||t[i].email.length<1||t[i].email.length>128)&&(n=!1);0==n?setModalContent("xxAddAgent","Käyttäjätilin tuonti","Virheellinen JSON-tiedostomuoto."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Käyttäjätilin tuonti","Virheellinen JSON-tiedostomuoto.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){if(!xxdialogMode){var e="Lataa luettelo käyttäjistä, jollakin alla olevista tiedostomuodoista.<br /><br />";e+=addHtmlValue("CSV muoto","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"),setModalContent("xxAddAgent","Käyttäjäluettelon vienti",e+=addHtmlValue("JSON Muoto","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p4downloadUserInfoCSV(){var e="id,nimi,sähköposti,luominen,viimeinen kirjautuminen,ryhmät,authfactors,siteadmin,useradmin,lukittu\r\n";for(var t in users){var n=!1,i=[];(users[t].otpsecret>0||users[t].otphkeys>0)&&(n=!0,users[t].otpsecret>0&&i.push("AuthApp"),users[t].otphkeys>0&&i.push("SecurityKey"),users[t].otpkeys>0&&i.push("BackupCodes")),e+='"'+users[t]._id+'","'+users[t].name+'","'+(users[t].email?users[t].email:"")+'","'+(users[t].creation?new Date(1e3*users[t].creation):"")+'","'+(users[t].login?new Date(1e3*users[t].login):"")+'","'+(users[t].groups?users[t].groups.join(","):"")+'","'+(n?i.join(","):"")+'"',e+=","+(4294967295==users[t].siteadmin?"1":"0"),e+=","+(2&users[t].siteadmin?"1":"0"),e+=","+(32&users[t].siteadmin?"1":"0"),e+="\r\n"}return saveAs(stringToUtf8Blob(e),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e=[];for(var t in users)e.push(users[t]);return saveAs(new Blob([JSON.stringify(e,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){if(!xxdialogMode){setModalContent("xxAddAgent","Lähetä viesti",'<div style=margin-bottom:6px>Lähetä viesti kaikille yhteydessä oleville käyttäjille.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Näytä viesti, kunnes käyttäjä hylkäsi sen</option><option value=10>Näytä 10 sekuntia</option><option value=60>Näytä yhden minuutin ajan</option><option value=300>Näytä 5 minuuttia</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus()}}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(var n in serverinfo.crossDomain)t+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Oletus":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";e+=addHtmlFormFloating("Verkkotunnus",t+="</select>")}if(2097152&features||(e+=addHtmlFormFloating("<span id=p4hname>Käyttäjätunnus</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e+=addHtmlFormFloating("<span id=p4hemail>Sähköposti",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+="",e+=addHtmlFormFloating("<span id=p4hp1>Salasana</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+=addHtmlFormFloating("<span id=p4hp2>Confirm Password</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+='<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Satunnaista salasana.</label></div>',e+='<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Poista kaikki tämän käyttäjätunnuksen aiemmat tapahtumat.</label></div>',e+='<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Pakota salasanan palautus seuraavan kirjautumisen yhteydessä.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Sähköposti osoite on vahvistettu.</label></div>',e+='<div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=Sähköposti osoite vahvistettu ja salasanan palautus pakotettu. />Lähetä kutsusähköposti.</label></div>'),passRequirements){var i=[],a=0;for(var n in passRequirements)"reset"!=n&&"hint"!=n&&(i.push(n+":"+passRequirements[n]),a++);a>0&&(e+="<div style=font-size:x-small;padding:6px>"+format("Vaatimukset: {0}.",i.join(", "))+"</div>")}setModalContent("xxAddAgent","Luo käyttäjätunnus",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),2097152&features?Q("p4email").focus():Q("p4name").focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,n=Q("p4pass1").value.length>0&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements);2097152&features||(t=!Q("p4name")||Q("p4name").value.length>0&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=n||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=n||Q("p4randomPassword").checked?"black":"#7b241c";var i=t&e;0==Q("p4randomPassword").checked&&(i&=n),QE("idx_dlgOkButton",i)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:2097152&features?Q("p4email").value:Q("p4name").value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n=users[t.toLowerCase()],i="";null!=n.groups&&(i=n.groups.join(", "));var a="Syötä pilkulla eroteltu luettelo hallinnollisten alueiden nimistä.<br /><br />";return setModalContent("xxAddAgent","Hallinnollinen alue",a+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${i}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,n)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}}function p4validateUserGroups(){var e=Q("dp4usergroups").value,t=0,n=e.indexOf('"')+e.indexOf("/")+e.indexOf(">")+e.indexOf("<")+e.indexOf("'"),i=e.split(",");for(var a in i)0==i[a].trim().length&&t++;QE("idx_dlgOkButton",""==e||-5==n&&t<1)}function showUserGroupDialogEx(e,t){var n=Q("dp4usergroups").value.split(","),i=[];for(var a in n){var o=n[a].trim();o.length>0&&i.push(o)}meshserver.send({action:"edituser",id:t._id,groups:i})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n=users[t];if(null!=n){var i=userinfo._id==n._id,a="";return a+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>Palvelimen Tiedostot</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, tyhjä oletuksena</div><br><hr/>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Täysi Järjestelmänvalvoja</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Palvelimen varmuuskopiointi</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Palvelimen Palautus</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Palvelimen päivitykset</label><br></div>',a+='<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Hallitse käyttäjiä</label><br></div>',a+='<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Hallitse käyttäjäryhmiä</label><br></div>',a+='<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Hallinnoi nauhoituksia</label><br></div>',""!=(a+='<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Näytä kaikki tapahtumat</label><br></div>')&&(a+="<hr/>"),a="<div><div id=d2AdminPermissions>"+a,a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Lukitse Tili</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>Ei uusia laiteryhmiä.</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>Ei uusia laitteita</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Estä työkalut (MeshCmd/Router)</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Lukitse tilin asetukset</label><br>',setModalContent("xxAddAgent","Palvelimen oikeudet",a+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(i?0:1),n)}),n.siteadmin&&0!=n.siteadmin&&(Q("ua_fulladmin").checked=4294967295==n.siteadmin,Q("ua_serverbackup").checked=4294967295!=n.siteadmin&&!!(1&n.siteadmin),Q("ua_serverrestore").checked=4294967295!=n.siteadmin&&!!(4&n.siteadmin),Q("ua_fileaccess").checked=4294967295!=n.siteadmin&&!!(8&n.siteadmin),Q("ua_serverupdate").checked=4294967295!=n.siteadmin&&!!(16&n.siteadmin),Q("ua_lockedaccount").checked=4294967295!=n.siteadmin&&!!(32&n.siteadmin),Q("ua_nonewgroups").checked=4294967295!=n.siteadmin&&!!(64&n.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=n.siteadmin&&!!(128&n.siteadmin),Q("ua_locksettings").checked=4294967295!=n.siteadmin&&!!(1024&n.siteadmin),Q("ua_nonewdevices").checked=4294967295!=n.siteadmin&&!!(4096&n.siteadmin)),2&userinfo.siteadmin&&(Q("ua_manageusers").checked=4294967295!=n.siteadmin&&!!(2&n.siteadmin),QE("ua_manageusers",!i&&2&userinfo.siteadmin)),256&userinfo.siteadmin&&(Q("ua_manageusergroups").checked=4294967295!=n.siteadmin&&!!(256&n.siteadmin),QE("ua_manageusergroups",!i&&256&userinfo.siteadmin)),512&userinfo.siteadmin&&(Q("ua_managerecordings").checked=4294967295!=n.siteadmin&&!!(512&n.siteadmin),QE("ua_managerecordings",!i&&512&userinfo.siteadmin)),2048&userinfo.siteadmin&&(Q("ua_allevents").checked=4294967295!=n.siteadmin&&!!(2048&n.siteadmin),QE("ua_allevents",!i&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!i&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!i&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!i&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!i&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!i&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!i&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",!!(2&userinfo.siteadmin)),QV("d2MngGrp",!!(256&userinfo.siteadmin)),QV("d2MngRec",!!(512&userinfo.siteadmin)),QE("ua_lockedaccount",!i&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewgroups",!i&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nomeshcmd",!i&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewdevices",!i&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_locksettings",!i&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),Q("ua_fileaccessquota").value=null!=n.quota?n.quota/1024:"",showUserAdminDialogValidate(),!1}}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var n=0,i=parseInt(Q("ua_fileaccessquota").value);1==Q("ua_fulladmin").checked?n=4294967295:(1==Q("ua_serverbackup").checked&&(n+=1),1==Q("ua_manageusers").checked&&(n+=2),1==Q("ua_serverrestore").checked&&(n+=4),1==Q("ua_fileaccess").checked&&(n+=8),1==Q("ua_serverupdate").checked&&(n+=16),1==Q("ua_lockedaccount").checked&&(n+=32),1==Q("ua_nonewgroups").checked&&(n+=64),1==Q("ua_nomeshcmd").checked&&(n+=128),1==Q("ua_manageusergroups").checked&&(n+=256),1==Q("ua_managerecordings").checked&&(n+=512),1==Q("ua_locksettings").checked&&(n+=1024),1==Q("ua_allevents").checked&&(n+=2048),1==Q("ua_nonewdevices").checked&&(n+=4096));var a={action:"edituser",id:t._id,siteadmin:n};0==isNaN(i)&&(a.quota=1024*i),meshserver.send(a)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",!!(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var n in usergroups)e.push(usergroups[n]);e.sort(nameSort);var i=[],a=document.getElementsByClassName("UserGroupCheckbox");for(n=0;n<a.length;n++)a[n].checked&&i.push(a[n].value);if(0==e.length)t+="<br />Ryhmiä ei löytynyt.<br />",QV("DuplicateUserGroupButton",!1);else{for(var n in t+='<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>',t+="<th>Nimi<th style=width:80px>Käyttäjät<th style=width:80px>Laiteryhmät<th style=width:80px>Laitteet",e)t+=addUserGroupHtml(e[n]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t),a=document.getElementsByClassName("UserGroupCheckbox");for(n=0;n<a.length;n++)a[n].checked=i.indexOf(a[n].value)>=0;p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,n=0,i=0;if(e.links)for(var a in e.links)a.startsWith("user/")&&t++,a.startsWith("mesh/")&&n++,a.startsWith("node/")&&i++;var o=EscapeHtml(e.name);if(null!=serverinfo.crossDomain){var s=e._id.split("/")[1];""!=s&&(o+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>")}var l="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>";return l+="<div style=width:100%>",l+='<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>",l+='<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>',l+='<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>',l+='<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+o+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+n+"<td style=text-align:center>"+i}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupsGroupActionButton",t>0),Q("UsersGroupsSelectAllButton").value=t>0?"Poista valinta":"Valitse kaikki"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),n=0,i=0;i<t.length;i++)!0===t[i].checked&&n++;for(i=0;i<t.length;i++)t[i].checked=0==n&&t[i].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;if(0!=t){var i="Valitse kaikille valituille käyttäjille suoritettava toiminto.<br /><br />";i+=addHtmlFormFloating("Operaatio","<select id=d50groupop class=form-select><option value=1>Poista ryhmä</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Ryhmätoiminta",i),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx)}}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));if(1==Q("d50groupop").value){setModalContent("xxAddAgent","Poista käyttäjäryhmät",'Haluatko varmasti poistaa valitut käyttäjäryhmät?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />Varmista</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)}}}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<t.length;n++)!0===t[n].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[n].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",n="";if(2==e){if(usergroups)for(var i in usergroups)n+="<option value="+encodeURIComponentEx(i)+">"+EscapeHtml(usergroups[i].name)+"</option>";t+=addHtmlFormFloating("Käyttäjäryhmä",'<select id=dp4groupid class="form-select">'+n+"</select>")}if(1==e&&serverinfo.crossDomain){n='<select id=p4domain class="form-select">';for(var i in serverinfo.crossDomain)n+="<option value="+i+">"+(""==serverinfo.crossDomain[i]?"Oletus":EscapeHtml(serverinfo.crossDomain[i]))+"</option>";t+=addHtmlFormFloating("Verkkotunnus",n+="</select>")}t+=addHtmlFormFloating("Nimi","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"),t+=addHtmlFormFloating("Kuvaus",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Luo käyttäjäryhmä":"Monista käyttäjäryhmä",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",Q("p4name").value.length>0)}function showCreateUserGroupDialogEx(e,t){var n={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(n.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(n.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(n)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){var n=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null!=n){var i=EscapeHtml(n.name);0==i.length&&(i="<i>Ei mitään</i>"),null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(i='<span role=button tabindex=0 title="Napsauta tätä muokataksesi käyttäjäryhmän nimeä" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+i+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",i);var a=0,o=0,s=0;if(n.links)for(var l in n.links)l.startsWith("user/")&&a++,l.startsWith("mesh/")&&o++,l.startsWith("node/")&&s++;var r=n.desc;r=null==r||""==r?"<i>Ei mitään<i>":EscapeHtml(r);var d="<div style=min-height:80px><table style=width:100%>";if(8&args.hide&&(d+="<br />"+addDeviceAttribute("Nimi",i)),null!=serverinfo.crossDomain||0!=debugmode){var u=n._id.split("/")[1];d+=addDeviceAttribute("Verkkotunnus",""!=u?EscapeHtml(u):"<i>Oletus</i>"),d+=addDeviceAttribute("Ryhmän tunniste",EscapeHtml(n._id))}if(null!=currentUserGroup.membershipType&&(d+=addDeviceAttribute("Group Type",EscapeHtml(currentUserGroup.membershipType))),256&userinfo.siteadmin?d+=addDeviceAttribute("Kuvaus","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+r+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):d+=addDeviceAttribute("Kuvaus",r),1==serverinfo.userGroupsSessionRecording){var c=[];n.flags&&2&n.flags&&c.push("Tallenna istunnot"),""==(c=c.join(", "))&&(c="<i>Ei mitään</i>"),d+=addDeviceAttribute("Ominaisuudet",addLink(c,"p51edituserGroupFeatures()"))}var p=[],m=0;n.consent&&(m=n.consent),serverinfo.consent&&(m|=serverinfo.consent),64&m&&8&m?p.push("Työpöydän kehote+työkalurivi"):64&m?p.push("Työpöydän työkalurivi"):8&m?p.push("Työpöydän kehote"):1&m&&p.push("Työpöytä ilmoitus"),16&m?p.push("Terminaalikehote"):2&m&&p.push("Ilmoita terminaalista"),32&m?p.push("Tiedostot kysy"):4&m&&p.push("Tiedostot Ilmoita"),7==m&&(p=["Ilmoita aina"]),56&~m||(p=["Kysy Aina"]),""==(p=p.join(", "))&&(p="<i>Ei mitään</i>"),d+=addDeviceAttribute("Käyttäjän suostumus",addLinkConditional(p,"p20editmeshconsent(4)",!0)),d+=addDeviceAttribute("Käyttäjät",a),d+=addDeviceAttribute("Laiteryhmät",o),d+=addDeviceAttribute("Laitteet",s),d+="</table></div><br />",256&userinfo.siteadmin&&(d+='<input type=button class="btn btn-primary btn-sm" value="Yleislähetys" title="Lähetä ilmoitus kaikille tämän ryhmän jäsenille." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(n._id)+'") />'),QH("p51group",d),d="<br />",null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjiä</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Ryhmän jäsenet</th><th scope=col></th></tr>';var g=1,v=[];for(var l in currentUserGroup.links)if(0!=l.startsWith("user/")){var h=l.split("/")[2];currentUserGroup.links[l].name&&(h=currentUserGroup.links[l].name),l==userinfo._id&&(h=userinfo.name),v.push({id:l,name:h,rights:currentUserGroup.links[l].rights})}for(var l in v.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),v){var f="";null==currentUserGroup.membershipType&&(f="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(v[l].id)+'")\' title="Posta käyttäjältä oikeudet tähän laiteryhmään" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>');var k=EscapeHtml(decodeURIComponent(v[l].name));null!=users&&(k="<a href=# onclick='gotoUser(\""+encodeURIComponentEx(v[l].id)+"\");haltEvent(event);'>"+k+"</a>"),d+="<tr "+(g%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Käyttäjä"></i>&nbsp;'+k+"</td><td><div style=float:right>"+f+"</div></td></tr>",++g}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ei jäseniä</i><div></div></div></td><td></td></tr>"),d+="</tbody></table><br />",g=1;var x=0,y=!1;for(var l in meshes)currentUserGroup._id.split("/")[1]==meshes[l]._id.split("/")[1]&&(x++,null!=currentUserGroup.links&&null!=currentUserGroup.links[l]||(y=!0));if(x>0&&y&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Lisää laiteryhmä</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Yleiset laiteryhmät</th><th scope=col></th></tr>',currentUserGroup.links){var b=[];for(var l in currentUserGroup.links)l.startsWith("mesh/")&&null!=meshes[l]&&b.push(meshes[l]);for(var l in b=getOrderedList(b,"name")){var w=0,M=b[l],S=(f="",makeDeviceGroupRightsString(currentUserGroup.links[M._id].rights));userinfo.links&&null!=userinfo.links[M._id]&&null!=userinfo.links[M._id].rights&&(w=userinfo.links[M._id].rights);var C="<i>Tuntematon laiteryhmä</i>";M&&(C="<a href=# onclick='gotoMesh(\""+M._id+"\");haltEvent(event);'>"+M.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(M._id)+'")\' title="Poista käyttäjäryhmän oikeudet tähän laiteryhmään" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',S='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(M._id)+'")>'+S+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Laiteryhmä" class=m99></div><div>&nbsp;'+C+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+S+"</div></td></tr>"}}if(1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ei yhteisiä laiteryhmiä</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",g=1,d+="<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Lisää Laite</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Yleiset laitteet</th><th scope=col></th></tr>',currentUserGroup.links){var A=[];for(var l in currentUserGroup.links){if(l.startsWith("node/"))null!=(Q=getNodeFromId(l))&&A.push(Q)}for(var l in A=getOrderedList(A,"name")){var Q=A[l],T=(f="",S=makeUserDeviceRightsString(currentUserGroup.links[Q._id].rights),w=GetNodeRights(Q),"<i>Tuntematon laite</i>");Q&&(T="<a href=# onclick='gotoDevice(\""+Q._id+"\");haltEvent(event);'>"+Q.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(Q._id)+'")\' title="Poista tämän laitteen käyttäjäryhmien oikeudet" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',S='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(Q._id)+'")>'+S+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Laiteryhmä" class=m99></div><div>&nbsp;'+T+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+S+"</div></td></tr>"}}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Ei yhteisiä laitteita</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",(null==currentUserGroup.membershipType||0==a)&&256&userinfo.siteadmin&&(d+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Poista käyttäjäryhmä</a></span></div>"),QH("p51group2",d),go(51);var D="";if(!(268435456&features)&&xxcurrentView>=51&&xxcurrentView<=59&&null!=currentUserGroup){for(var l in D="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)D+="&"+l+"="+urlargs[l];try{window.history.replaceState({},document.title,window.location.pathname+D)}catch(e){}}}else 51==xxcurrentView&&go(50)}}function p51edituserGroupFeatures(){if(!xxdialogMode){var e=currentUserGroup.flags?currentUserGroup.flags:0,t="";1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Tallenna istunnot</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Muokkaa käyttäjäryhmän ominaisuuksia",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx)}}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){if(!xxdialogMode){var n=getNodeFromId(decodeURIComponent(t));null!=n&&(setModalContent("xxAddAgent","Poista laitteen käyttöoikeudet",format('Haluatko varmasti poistaa laitteen "{0}" käyttöoikeudet?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,n._id)))}}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){if(!xxdialogMode){var n=meshes[decodeURIComponent(t)];null!=n&&(setModalContent("xxAddAgent","Poista laiteryhmän oikeudet",format('Haluatko varmasti poistaa laiteryhmän "{0}" käyttöoikeudet?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,n._id)))}}function p51editgroup(e,t){if(!xxdialogMode){var n=addHtmlFormFloating("Nimi",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>");n+=addHtmlFormFloating("Kuvaus",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Muokkaa käyttäjäryhmää",n),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),2==e?Q("dp51desc").focus():Q("dp51name").focus()}}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",Q("dp51name").value.length>0),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){if(xxdialogMode)return!1;var e=format("Poistetaanko käyttäjäryhmä {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />";return xxdialogButtons=3,setModalContent("xxAddAgent","Poista käyttäjäryhmä",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />Varmista</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog(),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){if(2==e){var n=t.split("/")[2];users&&users[t]&&(n=users[t].name),userinfo._id==t&&(n=userinfo.name),setModalContent("xxAddAgent","Poista käyttäjän jäsenyys",format('Haluatko varmasti poistaa käytäjän "{0}" jäsenyyden?',EscapeHtml(decodeURIComponent(n)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t))}}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){if(xxdialogMode)return!1;var e="Salli käyttäjien hallita tätä laiteryhmää ja tämän ryhmän laitteita.";return 524288&features&&(e+=" Käyttäjien on kirjauduttava sisään tähän palvelimeen kerran, ennen kuin heidät voidaan lisätä laiteryhmään."),e+="<br /><br /><div style='position:relative'>",e+=addHtmlFormFloating("Käyttäjätunnukset",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'),e+="<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",setModalContent("xxAddAgent","Lisää käyttäjät käyttäjäryhmään",e+="</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog(),!1}function p51setname(e){e=decodeURIComponent(e);var t=Q("dp51username").value.split(",");for(var n in t)t[n]=t[n].trim();return t[t.length-1]=e,Q("dp51username").value=t.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(var n in t){var i=t[n]=t[n].trim();(0==i.length||i.indexOf('"')>=0)&&(e=!1)}var a=!1,o=!1;if(null!=users){var s=t[t.length-1].trim(),l=s.toLowerCase(),r=[];if(s.length>0){for(var n in users){var d=users[n]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===l){o=!0;break}if(users[n].name.toLowerCase().indexOf(l)>=0&&currentUserGroup.domain==d[1]&&(r.push([users[n]._id,users[n].name]),r.length>=8))break}if(0==o&&r.length>0){var u="";for(var n in r){var c=r[n][0],p=r[n][1];c.split("/")[2]==p.toLowerCase()?u+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(c.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":u+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(c.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(c.split("/")[2])+"</div></div>"}QH("dp51usersuggest",u),a=!0}}}QV("dp51usersuggest",a)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var n=Q("dp51username").value.split(","),i=[];for(var a in n)i.push(n[a].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:i})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,n){if((!xxdialogMode||t)&&(null==n||null==n.originalTarget||null==n.originalTarget.href)){var i=currentUser=users[decodeURIComponent(e)];if(null!=i){QH("p30userName",EscapeHtml(i.name)),QH("p31userName",EscapeHtml(i.name));var a=i._id==userinfo._id,o=0;null!=wssessions&&wssessions[i._id]&&(o=wssessions[i._id]),null!=i.flags&&1&i.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==i.accountImageRnd&&(i.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+i._id.split("/")[2]+"&rnd="+i.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==o&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1));var s=i._id.split("/")[2];s.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):s.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):s.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):s.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):s.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):s.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):s.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):s.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1);var l=[],r="";null!=i.siteadmin&&32&i.siteadmin&&4294967295!=i.siteadmin&&(r='<img src="images/padlock12.png" height=12 width=8 title="Tili on lukittu" style="margin-top:2px" /> ',l.push("Lukittu tili")),null!=i.siteadmin&&4294966047&i.siteadmin?8==i.siteadmin?l.push("Pääsy palvelintiedostoihin"):4294967295==i.siteadmin?l.push("Täysi järjestelmänvalvoja"):l.push("Osittaiset oikeudet"):l.push("Ei palvelin oikeuksia"),null!=i.siteadmin&&4294967295!=i.siteadmin&&1216&i.siteadmin&&l.push("Rajoitukset");var d="<div style=min-height:80px><table style=width:100%>";8&args.hide&&(d+="<br />"+addDeviceAttribute("Nimi",i.name));var u=i.email?EscapeHtml(i.email):"<i>Ei asetettu</i>",c="",p=i.realname?EscapeHtml(i.realname):"<i>Ei asetettu</i>";if(serverinfo.emailcheck&&(c=1==i.emailVerified?'<b style=color:green;cursor:pointer title="Sähköposti on vahvistettu">&#x2713</b> ':'<b style=color:red;cursor:pointer title="Sähköposti osoitetta ei ole vahvistettu">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode){var m=i._id.split("/")[1];d+=addDeviceAttribute("Verkkotunnus",""!=m?EscapeHtml(m):"<i>Oletus</i>"),d+=addDeviceAttribute("Käyttäjätunnus",EscapeHtml(i._id))}else i.name.toLowerCase()!=i._id.split("/")[2]&&(d+=addDeviceAttribute("Käyttäjätunnus",EscapeHtml(i._id.split("/")[2])));var g="";i.email&&(g=' <a href="mailto:'+EscapeHtml(i.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),4294967295!=i.siteadmin||4294967295==userinfo.siteadmin?(d+=addDeviceAttribute("Sähköposti",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(i._id)+'")>'+c+u+g+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),d+=addDeviceAttribute("Oikea nimi",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(i._id)+'")>'+p+' <i class="fa-solid fa-pencil fa-xs"></i></span>')):(d+=addDeviceAttribute("Sähköposti",c+u+g),d+=addDeviceAttribute("Oikea nimi",p)),(33554432&features||null!=i.phone)&&(d+=addDeviceAttribute("Puhelinnumero","<span role=button onclick=p30editPhone()>"+(i.phone?i.phone:"<i>Ei mitään</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=i.msghandle)&&(d+=addDeviceAttribute("Messaging",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Messaging enabled" style="margin-top:2px"></i> '+(i.msghandle?i.msghandle:"<i>Ei mitään</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'));var v=[];1==serverinfo.usersSessionRecording&&i.flags&&2&i.flags&&v.push("Tallenna istunnot"),i.removeRights&&(8&i.removeRights?v.push("Ei kaukosäädintä"):(65536&i.removeRights?v.push("Ei työpöytää"):256&i.removeRights&&v.push("Vain työpöytänäkymä"),512&i.removeRights&&v.push("Ei päätettä"),1024&i.removeRights&&v.push("Ei tiedostoja")),16&i.removeRights&&v.push("Ei konsolia"),32768&i.removeRights&&v.push("Ei asennusta"),131072&i.removeRights&&v.push("Ei kauko-ohjausta"),64&i.removeRights&&v.push("Ei herätystä"),262144&i.removeRights&&v.push("Ei nollausta/pois")),""==(v=v.join(", "))&&(v="<i>Ei mitään</i>"),d+=addDeviceAttribute("Ominaisuudet",addLink(v,"p20edituserfeatures()")),d+=addDeviceAttribute("Palvelimen Oikeudet","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(i._id)+"\")'>"+r+l.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),i.quota&&(d+=addDeviceAttribute("Palvelimen kiintiö",EscapeHtml(parseInt(i.quota)/1024)+" k")),d+=addDeviceAttribute("Luotu",printDateTime(new Date(1e3*i.creation))),i.login&&(d+=addDeviceAttribute("Edellinen kirjautuminen",printDateTime(new Date(1e3*i.login)))),-1==i.passchange?d+=addDeviceAttribute("Salasana","Vaihdetaan seuraavan kirjautumisen yhteydessä"):i.passchange&&(d+=addDeviceAttribute("Salasana",format("Muutettu viimeksi: {0}",printDateTime(new Date(1e3*i.passchange)))));var h=0,f="<i>Ei mitään<i>";if(i.links){for(var k in i.links)k.startsWith("mesh/")&&h++;1==h?f="1 ryhmä":h>1&&(f=format("{0} ryhmää",h))}if(d+=addDeviceAttribute("Laiteryhmät",f),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var x="<i>Ei mitään</i>";if(i.groups)for(var k in x="",i.groups)x+='<span class="tagSpan">'+EscapeHtml(i.groups[k])+"</span>";d+=addDeviceAttribute("Pääkäyttäjän alueet",addLinkConditional(x,'showUserGroupDialog(event,"'+encodeURIComponentEx(i._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=i._id&&4294967295!=i.siteadmin))}var y=[],b=0;i.consent&&(b=i.consent),serverinfo.consent&&(b|=serverinfo.consent),64&b&&8&b?y.push("Työpöydän kehote+työkalurivi"):64&b?y.push("Työpöydän työkalurivi"):8&b?y.push("Työpöydän kehote"):1&b&&y.push("Työpöytä ilmoitus"),16&b?y.push("Terminaalikehote"):2&b&&y.push("Ilmoita terminaalista"),32&b?y.push("Tiedostot kysy"):4&b&&y.push("Tiedostot Ilmoita"),7==b&&(y=["Ilmoita aina"]),56&~b||(y=["Kysy Aina"]),""==(y=y.join(", "))&&(y="<i>Ei mitään</i>"),d+=addDeviceAttribute("Käyttäjän suostumus",addLinkConditional(y,"p20editmeshconsent(2)",!0));var w=0;if(i.otpsecret>0||i.otphkeys>0||i.otpekey>0||i.otpduo>0){w=1;var M=[];i.otpsecret>0&&M.push("Todennussovellus"),i.otphkeys>0&&M.push("Suojausavain"),i.otpekey>0&&M.push("Sähköposti"),i.otpduo>0&&M.push("Duo"),i.otpkeys>0&&M.push("Varmuuskoodit"),i.otpdev>0&&M.push("Laitteen työntö"),null!=i.phone&&67108864&features&&M.push("Tekstiviesti"),null!=i.msghandle&&67108864&features2&&M.push("Messaging"),d+=addDeviceAttribute("Turvallisuus",'<i class="fa-solid fa-key" title="kaksivaiheinen todennus käytössä" style="margin-top:2px"></i> '+M.join(", "))}if(d+="</table></div><br />",d+='<input type=button class="btn btn-primary btn-sm me-1" value="Muistiinpanot" title="Näytä tämän Käyttäjän huomautukset" onclick=showNotes(false,"'+encodeURIComponentEx(i._id)+'") />',i.phone&&33554432&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Tekstiviesti" title="Lähetä tekstiviesti tälle käyttäjälle" onclick=showSendSMS("'+encodeURIComponentEx(i._id)+'") />'),i.msghandle&&33554432&features2&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Viesti" title="Send a message to this user" onclick=showSendMessage("'+encodeURIComponentEx(i._id)+'") />'),"string"==typeof i.email&&!0===i.emailVerified&&64&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Sähköposti" title="Lähetä sähköposti tälle käyttäjälle" onclick=showSendEmail("'+encodeURIComponentEx(i._id)+'") />'),!a&&(o>0||8&features2&&i.webpush)&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Ilmoita" title="Lähetä käyttäjän ilmoitus" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(i._id)+'") />',d+='<input type=button class="btn btn-primary btn-sm me-1" value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(i._id)+'","'+encodeURIComponentEx(i.name)+'") />',o>0&&null!=serverinfo&&null!=serverinfo.altmessenging))for(var k in serverinfo.altmessenging){var S=serverinfo.altmessenging[k];null!=S.type&&"user"!=S.type||(d+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(S.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(i._id)+'","'+encodeURIComponentEx(i.name)+'",'+k+") />")}QH("p30html",d),drawUserPermissions();var C=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=i.siteadmin||4294967295==userinfo.siteadmin;d="<div style=float:right;font-size:small>",C&&userinfo._id!=i._id&&(d+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Poista tämä käyttäjä\">Poista Käyttäjä</a>"),d+="</div><div style=font-size:small>",!C||524288&features||"~"==i._id.split("/")[2][0]||(d+="<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+w+')\' title="Vaihda tämän käyttäjän salasana">Vaihda Salasana</a>',d+=" <a href=# style=cursor:pointer onclick='return p30viewPreviousLogins()' title=\"Näytä tämän käyttäjän aiemmat kirjautumistiedot\">Edelliset kirjautumiset</a>"),d+="</div><br>",QH("p30html3",d),d="",1==o?d="1 aktiivinen istunto":o>1&&(d=format("{0} aktiivista istuntoa",o)),QH("MainUserState",d),go(30),QH("p31events",""),refreshUsersEvents();var A="";if(!(268435456&features)&&xxcurrentView>=30&&xxcurrentView<=39&&null!=currentUser){for(var k in A="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)A+="&"+k+"="+urlargs[k];try{window.history.replaceState({},document.title,window.location.pathname+A)}catch(e){}}}else go(4)}}function p30editPhone(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>';e+="<td style=width:100%;text-align:center>SMS-yhteensopiva puhelinnumero tälle käyttäjälle.<br />Jätä tyhjäksi.",e+='<br /><br /><div style=width:100%;text-align:center>Puhelinnumero: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone?currentUser.phone:"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Puhelin ilmoitukset",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate()}}function p30editMessaging(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>';e+="<td style=width:100%>Messaging account for this user.";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Ei mitään</option>";if(1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle){if(currentUser.msghandle.startsWith("telegram:")&&1&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&4&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&8&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&16&serverinfo.userMsgProviders){Q("d2serviceselect").value=16;var n=currentUser.msghandle.substring(10).split("|");"signal"==n[0]&&3==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(n[1])+"&apikey="+decodeURIComponent(n[2])),"whatsapp"==n[0]&&3==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(n[1])+"&apikey="+decodeURIComponent(n[2])),"facebook"==n[0]&&2==n.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(n[1]))}currentUser.msghandle.startsWith("pushover:")&&32&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&64&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&128&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:")&&256&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6))}p30editMessagingValidate()}}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Aihe":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Käyttäjätunnus",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){if(!xxdialogMode){var e=currentUser.flags?currentUser.flags:0,t="",n=currentUser.removeRights?currentUser.removeRights:0;t="";1==serverinfo.usersSessionRecording&&(t+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Tallenna istunnot</label><br></div>"),t+='<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&n?"checked":"")+">Ei kaukosäädintä</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&n?"checked":"")+">Ei työpöytä yhteyttä</label><br></div>",t+='<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&n?"checked":"")+">Vain etäkatselu</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&n?"checked":"")+">Ei pääsyä terminaaliin</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&n?"checked":"")+">Ei tiedostojen käyttöä</label><br></div>",t+='<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&n?"checked":"")+">Ei agenttikonsolia</label><br></div>",t+='<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&n?"checked":"")+">Ei asennusta</label><br></div>",t+='<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&n?"checked":"")+">Ei kauko-ohjausta</label><br></div>",t+='<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&n?"checked":"")+">Ei herätystä</label><br></div>",setModalContent("xxAddAgent","Muokkaa käyttäjäominaisuuksia",t+='<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&n?"checked":"")+">Ei nollausta/pois</label><br></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate()}}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags?currentUser.flags:0);1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2);var t=0;Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){if(xxdialogMode)return!1;return xxdialogButtons=3,setModalContent("xxAddAgent",format("Vaihda Nimi käyttäjälle {0}",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname?currentUser.realname:"",!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){if(xxdialogMode)return!1;var t="";return t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Tila",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>Ei vahvistettu</option><option value=1>Vahvistettu</option></select>')),setModalContent("xxAddAgent",format("Vaihda sähköpostiosoite käyttäjälle {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email?currentUser.email:"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail(),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@");t=0==e.length||2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0)),QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Edelliset kirjautumiset","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t="";if(t+='<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>',t+='<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>',65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var n=[],i=0;for(var a in passRequirements)"reset"!=a&&"hint"!=a&&(n.push(a+":"+passRequirements[a]),i++);i>0&&(t+="<div style=font-size:x-small;padding:6px>"+format("Vaatimukset: {0}.",n.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Pakota salasanan palautus seuraavan kirjautumisen yhteydessä.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Poista kaikki toisen tekijän todennus.</label></div>'),setModalContent("xxAddAgent",format("Vaihda Salasana käyttäjälle {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var n=!1;if(1==t&&1==Q("p4twoFactorRemove").checked&&(n=!0),Q("p4pass1").value==Q("p4pass2").value){var i={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:n,resetNextLogin:Q("p4resetNextLogin").checked};65536&features&&(i.hint=Q("p4hint").value),meshserver.send(i)}}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Poista Käyttäjä {0}",EscapeHtml(currentUser.name)),format("Haluatko varmasti poistaa käyttäjän {0}?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Varmista</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",n=0,i=!1;for(var a in meshes)meshes[a]._id.split("/")[1]==currentUser._id.split("/")[1]&&(n++,null!=currentUser.links&&null!=currentUser.links[a]||(i=!0));if(n>0&&i&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Lisää laiteryhmä</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Yleiset laiteryhmät</th><th scope=col></th></tr>',currentUser.links){var o=[];for(var a in currentUser.links)a.startsWith("mesh/")&&null!=meshes[a]&&o.push(meshes[a]);for(var a in o=getOrderedList(o,"name")){var s=0,l=o[a],r="",d=makeDeviceGroupRightsString(v=currentUser.links[l._id].rights);if(null!=l){userinfo.links&&null!=userinfo.links[l._id]&&null!=userinfo.links[l._id].rights&&(s=userinfo.links[l._id].rights);var u="<i>Tuntematon laiteryhmä</i>";l&&(u="<a href=# onclick='gotoMesh(\""+l._id+"\");haltEvent(event);'>"+EscapeHtml(l.name)+"</a>"),currentUser._id!=userinfo._id&&2&s&&(r="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(l._id)+'")\' title="Posta käyttäjältä oikeudet tähän laiteryhmään" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(l._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Laiteryhmä" class=m99></div><div>&nbsp;'+u+"<div></div></div></td><td style=width:70%><div style=float:right>"+r+"</div><div>"+d+"</div></td></tr>"}}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ei yhteisiä laiteryhmiä</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",256&userinfo.siteadmin){var c=0,p=!1;for(var a in usergroups)null==usergroups[a].membershipType&&usergroups[a]._id.split("/")[1]==currentUser._id.split("/")[1]&&(c++,null!=currentUser.links&&null!=currentUser.links[a]||(p=!0));c>0&&p&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Lisää Käyttäjä Ryhmä</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Käyttäjäryhmä jäsenyydet</th><th scope=col></th></tr>',currentUser.links){var m=[];for(var a in currentUser.links)a.startsWith("ugrp/")&&null!=usergroups[a]&&m.push(usergroups[a]);for(var a in m=getOrderedList(m,"name")){var g=m[a],v=currentUser.links[m[a]._id].rights,h=(r="","<i>Tuntematon käyttäjäryhmä</i>");null!=g&&(h=EscapeHtml(g.name),null!=usergroups&&(h="<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(m[a]._id)+"\");haltEvent(event);'>"+h+"</a>")),null==g.membershipType&&256&userinfo.siteadmin&&(r="<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(m[a]._id)+'")\' title="Poista käyttäjä ryhmästä" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>'),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Käyttäjäryhmä" class=m4></div><div>&nbsp;'+h+"<div></div></div></td><td><div style=float:right>"+r+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ei käyttäjäryhmien jäsenyyksiä</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Lisää Laite</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Yleiset laitteet</th><th scope=col></th></tr>',currentUser.links){var f=[];for(var a in currentUser.links){if(a.startsWith("node/"))null!=(k=getNodeFromId(a))&&f.push(k)}for(var a in f.sort(nameSort),f){var k=f[a];v=currentUser.links[k._id].rights,r="",s=GetNodeRights(k);userinfo.links&&null!=userinfo.links[a]&&null!=userinfo.links[a].rights&&(s=userinfo.links[a].rights);var x=k?EscapeHtml(k.name):"<i>Tuntematon laite</i>";2&s&&(r="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(k._id)+'")\' title="Posta käyttäjältä oikeudet tähän laiteryhmään" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(k._id)+'")>'+makeUserDeviceRightsString(v)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),x="<a href=# onclick='gotoDevice(\""+k._id+"\",10);haltEvent(event);'>"+x+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Laite" class=si'+k.icon+"></div><div>&nbsp;"+x+"<div></div></div></td><td style=width:70%><div style=float:right>"+r+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Ei yhteisiä laitteita</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,n,i){xxdialogMode||(setModalContent("xxAddAgent","Poista Device Share",format('Vahvistetaanko laitteen jakamisen "{0}" poisto?',decodeURIComponent(i))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(n)]))}function p30removeNodeFromUser(e,t){if(!xxdialogMode){var n=getNodeFromId(decodeURIComponent(t));setModalContent("xxAddAgent","Poista laitteen käyttöoikeudet",format('Haluatko varmasti poistaa laitteen "{0}" käyttöoikeudet?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,n)}}function p30removeUserFromNode(e,t){if(!xxdialogMode){var n=null,i="";t=decodeURIComponent(t),xxdialogButtons=3,xxdialogTag=n,t.startsWith("user/")?(users&&null!=(n=users[t])&&(i=n.name),setModalContent("xxAddAgent","Poista käyttäjän oikeudet",i?format('Haluatko varmasti poistaa käyttäjän "{0}" käyttöoikeudet?',i):"Haluatko varmasti poistaa käyttöoikeudet?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,n){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})})):t.startsWith("ugrp/")&&(usergroups&&null!=(n=usergroups[t])&&(i=n.name),setModalContent("xxAddAgent","Poista käyttäjäryhmien käyttöoikeudet",i?format('Haluatko varmasti poistaa käyttäjäryhmän "{0}" käyttöoikeudet?',i):"Haluatko varmasti poistaa käyttöoikeudet?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,n){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})}))}}function p30RemoveUserGroup(e,t){if(!xxdialogMode&&null!=usergroups){var n=decodeURIComponent(t),i=usergroups[n];setModalContent("xxAddAgent","Poista käyttäjä ryhmästä",format('Haluatko varmasti poistaa käyttäjäryhmän "{0}" jäsenyyden?',null!=i?EscapeHtml(i.name):"<i>Tuntematon</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,n)})}}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e="";for(var t in usergroups)null==usergroups[t].membershipType&&usergroups[t]._id.split("/")[1]==currentUser._id.split("/")[1]&&(null!=currentUser.links&&null!=currentUser.links[t]||(e+="<option value="+encodeURIComponentEx(t)+">"+EscapeHtml(usergroups[t].name)+"</option>"));var n=addHtmlFormFloating("Käyttäjäryhmä",'<select id=dp2groupid class="form-select">'+e+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","Lisää jäsenyys",n),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){if(!xxdialogMode){var n=meshes[decodeURIComponent(t)];null!=n&&(setModalContent("xxAddAgent","Poista laiteryhmän oikeudet",format('Haluatko varmasti poistaa laiteryhmän "{0}" käyttöoikeudet?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,n._id)}))}}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(var n in currentUserEvents){var i=currentUserEvents[n],a=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var o,s="fa-mobile-screen";if("user"==i.etype&&(s="fa-user"),"server"==i.etype&&(s="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])o="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{for(var n in o=eventsMessageId[i.msgid],i.msgArgs){var l=i.msgArgs[n];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),o=o.split("{"+n+"}").join(l)}o=EscapeHtml(o).split("(R)").join("&reg;")}if(i.nodeid){var r=getNodeFromId(i.nodeid);null!=r&&(s="si"+r.icon,o="<a href=# onclick='gotoDevice(\""+i.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(r.name)+"</a> &rarr; "+o)}if(i.username&&i.username!=currentUser.name){var d="";i.guestname&&(d=' / <span title="Tämä on vieraiden jakamisistunto">'+EscapeHtml(i.guestname)+"</span>"),o=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+d+" &rarr; "+o:EscapeHtml(i.guestname)+" &rarr; "+o}else i.guestname&&(o='<span title="Tämä on vieraiden jakamisistunto">'+EscapeHtml(i.guestname)+"</span> &rarr; "+o);"relay"!=i.etype&&"relaylog"!=i.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+o+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Ei tapahtumia</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),n="",i=0;i<t.length;i++)t[i].checked&&e.push(t[i].value);if(null==p52recordings)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Ladataan...</i></div>";else if("number"==typeof p52recordings)n+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to read from the recordings folder.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to get recordings from the database.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>An unknown error occured.</i></div>";else if(0==p52recordings.length)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Ei tallenteita.</i></div>";else{if(n+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>',n+="<th>Istunto</th><th style=width:110px>"+nobreak("Käynnistys aika")+"</th><th style=width:110px>Kesto</th><th style=width:110px>Koko</th></tr></thead><tbody>",null!=p52recordings){var a=null;for(var i in p52recordings){var o=p52recordings[i],s=printDate(new Date(o.startTime));s!=a&&(a=s,n+="<tr><td class=userTableHeader colspan=4>"+s),n+=addRecordingHtml(i,o)}}n+="</tbody></table>"}QH("p52recordings",n),t=document.getElementsByClassName("RecordingCheckbox");for(i=0;i<t.length;i++)t[i].checked=e.indexOf(t[i].value)>=0;p52updateInfo()}function addRecordingHtml(e,t){var n="";t.lengthTime&&(n=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60)));var i=printTime(new Date(t.startTime));t.sessionStart&&(i=printTime(new Date(t.sessionStart)));var a="";t.size&&(a=format("{0} Kb",Math.round(t.size/1024)));var o="<i>Tuntematon</i>";t.name&&t.meshname&&(o=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name));if(null!=t.userids&&t.userids.length>0)if(t.userids.length>1)o+=" - "+format("{0} users",t.userids.length);else{var s=null;null!=users&&(s=users[t.userids[0]]),o+=null!=s?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])}1==t.protocol&&(o+=" - Pääteistunto"),2==t.protocol&&(o+=" - Työpöytäistunto"),5==t.protocol&&(o+=" - Tiedostonsiirto"),6==t.protocol&&(o+=" - Järjestelmänvalvojan PowerShell"),8==t.protocol&&(o+=" - Käyttäjän kuori"),9==t.protocol&&(o+=" - Käyttäjä PowerShell"),100==t.protocol&&(o+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(o+=" - Intel&reg; AMT Uudelleenohjaus"),200==t.protocol&&(o+=" - sanansaattaja");var l="",r="fa-circle-xmark text-danger";1==t.present&&(r="fa-circle-check text-success",l='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',l+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>');var d="<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>";return d+="<div class=bar style=width:100%>",d+="<div></div>",d+='<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+r+'"></i></div>',d+='<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>',d+='<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+l+"<div style=font-size:16px>"+o+"</div></div></div><td style=text-align:center>"+i+"<td style=text-align:center>"+n+"<td style=text-align:center>"+a}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var n=p52recordings[t],i="";if(n.protocol){var a="Tuntematon";1==n.protocol&&(a="Pääte"),2==n.protocol&&(a="Työpöytä"),5==n.protocol&&(a="Tiedostot"),6==n.protocol&&(a="Järjestelmänvalvojan PowerShell"),8==n.protocol&&(a="Käyttäjän kuori"),9==n.protocol&&(a="Käyttäjä PowerShell"),100==n.protocol&&(a="Intel&reg; AMT WSMAN"),101==n.protocol&&(a="Intel&reg; AMT Uudelleenohjaus"),200==n.protocol&&(a="sanansaattaja"),i+=addHtmlValue4("Protokolla",a)}if(i+=addHtmlValue4("Tila",1==n.present?"Läsnä palvelimella":"Ei palvelimella"),n.name&&(i+=addHtmlValue4("Laitteen Nimi",EscapeHtml(n.name))),n.meshname&&(i+=addHtmlValue4("Laiteryhmä",EscapeHtml(n.meshname))),n.size&&(i+=addHtmlValue4("Koko",format("{0} tavua",n.size))),n.startTime&&(i+=addHtmlValue4("Käynnistys aika",printTime(new Date(n.startTime)))),n.startTime&&n.lengthTime&&(i+=addHtmlValue4("päättymisaika",printTime(new Date(n.startTime+1e3*n.lengthTime)))),n.lengthTime&&(i+=addHtmlValue4("Kesto",pad2(Math.floor(n.lengthTime/3600))+":"+pad2(Math.floor(n.lengthTime%3600/60))+":"+pad2(Math.floor(n.lengthTime%60)))),1==n.multiplex&&(i+=addHtmlValue4("Multipleksori","Käytössä")),n.userids)for(var t in n.userids)i+=addHtmlValue4("Käyttäjä",n.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Tallennustiedot",i),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),1==e?d3setActions():d3updatefiles()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e="",t="",n=filetree,i=1,a="",o=[],s=[],l=document.getElementsByName("fc"),r=0;r<l.length;r++)l[r].checked&&s.push(l[r].value);for(var r in d3filetreelinkpath="",d3filetreelocation){if(null==n.f||null==n.f[d3filetreelocation[r]])break;if(o.push(d3filetreelocation[r]),1==i){var d=d3filetreelocation[r].split("/");window.location.origin+domainUrl+d[0]+"files/"+d[2],d3filetreelocation[r]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=d[0]+"/"+d[2]}else""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[r],i>2&&"/"+d3filetreelocation[r]);a=(n=n.f[d3filetreelocation[r]]).n,i++}d3filetreelocation=o;var u=p5sort_files(n.f),c="";for(var r in d3fileoptions.filter&&(c=Q(d3fileoptions.filter).value),u){var p,m=u[r],g=m.n;if(3!=m.t||""==c||0!=m.nx.toLowerCase().endsWith(c)){p=g.length>70?'<span title="'+EscapeHtml(g)+'">'+EscapeHtml(g.substring(0,70))+"...</span>":EscapeHtml(g);var v="";null!=m.s&&(v=getFileSizeStr(m.s));var h="";if(3!=m.t){h='<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+m.t+' onclick=d3folderset("'+encodeURIComponentEx(m.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(m.nx)+"\")'>"+p+"</a></span></div>"}else{var f=p;h='<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+m.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(v)+"</span><span><div class=fileIcon"+m.t+"></div>"+f+"</span></div>"}m.t<3?e+=h:t+=h}}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,a),QH(d3fileoptions.files,e+t),QE(d3fileoptions.folderup,d3filetreelocation.length>0),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",Q("d3localFile").value.length>0):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",n=JSON.parse(getstore("_ReportSettings","{}")),i={1:"Etäistunnot",2:"Käyttäjäliikenteen käyttö",3:"Käyttäjien kirjautumiset"};for(var a in 4294967295==userinfo.siteadmin&&(i[4]="Database Records"),i)e+="<option value="+a+(n.type==a?" selected":"")+">"+i[a]+"</option>";t+=addHtmlFormFloating("Tyyppi",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="<div id=d2GroupByDiv style=display:none>",e="";i={1:"Käyttäjä",2:"Laite",3:"Päivä"};for(var a in i)e+="<option value="+a+(n.groupBy==a?" selected":"")+">"+i[a]+"</option>";t+=addHtmlFormFloating("Ryhmittele",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2GroupByDiv2 style=display:none>",e="";i={1:"Käyttäjä",3:"Päivä"};for(var a in i)e+="<option value="+a+(n.groupBy2==a?" selected":"")+">"+i[a]+"</option>";t+=addHtmlFormFloating("Ryhmittele",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==n.devGroup?" selected":"")+">Kaikki</option>";var o=getOrderedList(meshes,"name");for(var a in o)e+="<option value="+encodeURIComponentEx(o[a]._id)+(n.devGroup==o[a]._id?" selected":"")+">"+EscapeHtml(o[a].name)+"</option>";t+=addHtmlFormFloating("Laiteryhmä",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"),t+="</div>",t+="<div id=d2timeBackDiv style=display:none>",e="",null==n.timeRange&&(n.timeRange=1);i={1:"Viimeinen päivä",7:"Viimeiset 7 päivää",30:"Viimeiset 30 päivää",0:"Aikahaarukka"};for(var a in i)e+="<option value="+a+(n.timeRange==a?" selected":"")+">"+i[a]+"</option>";t+=addHtmlFormFloating("Aika",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2timeRangeDiv style=display:none>",t+=addHtmlFormFloating("Aika -alue alkaa",'<input id=d2timeRangeStartSelector class="flatpickr form-control" type="text" placeholder="Valitse päivämäärä ja aika..." data-id="altinput">'),t+=addHtmlFormFloating("Aikaväli",'<input id=d2timeRangeEndSelector class="flatpickr form-control" type="text" placeholder="Valitse päivämäärä ja aika..." data-id="altinput">'),t+="</div>",t+="<div id=d2showTrafficDiv style=display:none>",t+=addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(n.showTraffic?"checked":"")+">Näytä liikenne</label><div>"),setModalContent("xxAddAgent","Luo raportti",t+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>generateReportDialogEx("",xxdialogTag)),generateReportDialogValidate();var s=new Date;s.setDate(s.getDate()-7);var l=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,maxDate:new Date,defaultDate:s,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,n){r.set("minDate",t),r.selectedDates[0]&&r.selectedDates[0]<e[0]&&r.clear()}}),r=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,maxDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:l,rangeEnd:r}}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var n,i;0==Q("d2timeRange").value?(i=Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),n=Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3)):(i=Math.floor(new Date/1e3),n=new Date,n=Math.floor(n.setDate(n.getDate()-Q("d2timeRange").value)/1e3));var a=null;try{a=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var o=decodeURIComponent(Q("d2groupId").value);0==o&&(o=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:o,showTraffic:Q("d2showTraffic").checked}));var s=parseInt(Q("d2groupBy").value);3==Q("d2reportType").value&&(s=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:s,start:n,end:i,tz:a,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:o,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Aika",device:"Laite",session:"Istunto",user:"Käyttäjä",devgroup:"Laiteryhmä",guest:"Vieras",length:"Pituus",bytesin:"Tavua sisään",bytesout:"Bytes Out",os:"Käyttöjärjestelmä",ip:"IP-osoite",browser:"Selain",msg:"Viesti",twofactor:"2. tekijä"},n='<table class="table table-hover">',i=null,a=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),n+="<tr><td style=text-align:center;padding-top:32px>Raportti ei palauttanut kokonaisia.</tr></td>";else{for(var o in reportCSV='"Ryhmä"',n+="<tr>",e.columns){var s;s=null!=t[e.columns[o].title]?t[e.columns[o].title]:EscapeHtml(e.columns[o].title);var l="";e.columns[o].align?l+=";text-align:"+EscapeHtml(e.columns[o].align):l+=";text-align:left",0!=o||"datetime"!=e.columns[o].format&&"time"!=e.columns[o].format||(l+=";width:1%"),n+="<th style="+l+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var o in n+="</tr>",reportCSV+="\r\n",e.groups)for(var r in n+="<tr style=height:8px></tr>",n+="<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>',0!=o&&(n+=renderReportFormat(o,e.groupFormat)),n+="</b></td></tr>",e.groups[o].entries){var d=e.groups[o].entries[r];for(var u in n+="<tr>",reportCSV+=0!=o?'"'+csvClean(renderReportFormatCSV(o,e.groupFormat))+'"':'""',e.columns){l="";if(null!=e.columns[u].format&&(l="white-space:nowrap;"),e.columns[u].align&&(l="text-align:"+EscapeHtml(e.columns[u].align)),null!=d[e.columns[u].id]?(n+='<td style="'+l+'">'+renderReportFormat(d[e.columns[u].id],e.columns[u].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(d[e.columns[u].id],e.columns[u].format))+'"'):(n+="<td></td>",reportCSV+=","),null!=e.columns[u].sumBy){var c=d[e.columns[u].sumBy];!0===e.columns[u].sumBy&&(c=!0);var p=d[e.columns[u].id];i=e.columns[u].sumBy,null!=p&&(-1==a.indexOf(c)&&a.push(c),null==e.columns[u].subtotals&&(e.columns[u].subtotals={},e.columns[u].totals={}),null==e.columns[u].subtotals[c]?e.columns[u].subtotals[c]=p:e.columns[u].subtotals[c]+=p,null==e.columns[u].totals[c]?e.columns[u].totals[c]=p:e.columns[u].totals[c]+=p)}}n+="</tr>",reportCSV+="\r\n"}if(null!=i){var m=-1;if(!0===i)m=99999;else for(var o in e.columns)e.columns[o].id==i&&(m=o);if(m>=0){a.sort();var g=!0;for(var r in n+="<tr style=height:8px></tr>",a){for(var o in n+="<tr>",e.columns)if(o==m){l="";e.columns[u].align&&(l+=";text-align:"+EscapeHtml(e.columns[u].align)),g&&(l+=";border-top:1pt solid #777"),n+='<td style="color:#777'+l+'">'+renderReportFormat(a[r],e.columns[o].format)}else if(null!=e.columns[o].totals){l="";e.columns[u].align&&(l+=";text-align:"+EscapeHtml(e.columns[u].align)),g&&(l+=";border-top:1pt solid #777"),n+='<td style="color:#777'+l+'">'+renderReportFormat(e.columns[o].totals[a[r]],e.columns[o].format)}else n+="<td></td>";n+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}n+="</table>",QH("p60report",n)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Pääte":2==e?"Työpöytä":5==e?"Tiedostot":6==e?"Järjestelmänvalvojan PowerShell":8==e?"Käyttäjän kuori":9==e?"Käyttäjä PowerShell":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"sanansaattaja":201==e?"Verkko-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Tuntematon ("+e+")";if("seconds"==t){var n=e%60,i=Math.floor(e/60)%60,a=Math.floor(e/3600);return zeroPad(a,2)+":"+zeroPad(i,2)+":"+zeroPad(n,2)}if("node"==t)return null!=(o=getNodeFromId(e))?"<div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name):"<i>Tuntematon</i>";if("mesh"==t)return null!=(u=meshes[e])?"<div onclick='gotoMesh(\""+u._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(u.name):"<i>Tuntematon</i>";if("nodemesh"==t){var o,s=null,l=null,r=e.split("/"),d="<table><tr>";if(r.length>=3&&(s=r[0]+"/"+r[1]+"/"+r[2]),r.length>=6&&(l=r[3]+"/"+r[4]+"/"+r[5]),null!=l){var u;if(null==(u=meshes[l]))return"<i>Tuntematon</i>";d+="<td><div onclick='gotoMesh(\""+u._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(u.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(o=getNodeFromId(s))?"<i>Tuntematon</i>":(d+="<td><div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name)+"</td>",d+="</tr></table>")}if("user"==t){var c=null;if(e==userinfo._id?c=userinfo:null!=users&&(c=users[e]),null!=c){var p=c.name;return null!=c.realname&&(p+=", "+c.realname),"<div onclick='gotoUser(\""+c._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(p)}return"<i>Tuntematon käyttäjä</i>"}if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Onnistunut kirjautuminen';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>Väärä 2. tekijä';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Lukittu tili';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Virheellinen kirjautumisyritys'}if("2fa"==t){if(""==e)return"Ei mitään";if("backup"==e)return"Varmuuskoodit";if("fido"==e)return"FIDO avain";if("sms"==e)return"SMS viesti";if("hwotp"==e)return"Laitteiston OTP";if("messenger"==e)return"Messenging";if("push"==e)return"Push-ilmoitus";if("otp"==e)return"Kertakäyttöinen salasana";if("cookie"==e)return"Muista laite";if("tokenlogin"==e)return"Kirjautumistunnus";if("ipaddr"==e)return"IP-osoite";if("sso"==e)return"Kertakirjautuminen"}if("records"==t){var m={node:"Device record",mesh:"Device group record",user:"User records",sysinfo:"Device information records",iploc:"IP location information records",note:"Text notes records",ifinfo:"Network interface information records",cfile:"Configuration file records",lastconnect:"Last connection time records",power:"Device power transition records",events:"Event records",serverstats:"Server statistics records",ugrp:"User group records",deviceshare:"Device sharing records",logintoken:"Account login token records",smbios:"Device SMBIOS record",pmt:"Device Push Notification Record",meshcentral:"Device, users, groups and other records"};return null!=m[e]?m[e]:e}return EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Pääte":2==e?"Työpöytä":5==e?"Tiedostot":6==e?"Järjestelmänvalvojan PowerShell":8==e?"Käyttäjän kuori":9==e?"Käyttäjä PowerShell":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"sanansaattaja":201==e?"Verkko-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Tuntematon ("+e+")";if("node"==t){var n=getNodeFromId(e);if(null!=n)return n.name}if("mesh"==t){var i=meshes[e];if(null!=i)return i.name}if("user"==t){var a=null;if(e==userinfo._id?a=userinfo:null!=users&&(a=users[e]),null!=a){var o=a.name;return null!=a.realname&&(o+=" - "+a.realname),o}return"Tuntematon käyttäjä"}if("msg"==t){if(107==e)return"Onnistunut kirjautuminen";if(108==e)return"Väärä 2. tekijä";if(109==e)return"Lukittu tili";if(110==e)return"Virheellinen kirjautumisyritys"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",e>0))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Tällä hetkellä ei ole ilmoituksia</div>";else for(var n in notifications){var i=notifications[n],a="",o=new Date(i.time),s=0;if(null!=i.title&&(a="<b>"+EscapeHtml(i.title)+"</b>: "),null!=i.nodeid){var l=getNodeFromId(i.nodeid);null!=l&&(s=l.icon,a=16&e?"<b>"+EscapeHtml(meshes[l.meshid].name)+" / "+EscapeHtml(l.name)+"</b>: ":"<b>"+EscapeHtml(l.name)+"</b>: ")}t+='<div title="'+format("Tapahtui {0}",printDateTime(o))+'" id="notifyx'+i.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+i.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+i.id+')" class=unselectable title="Kuittaa tämä ilmoitus" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+i.id+')" style=margin:5px>'+a+EscapeHtml(i.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(o)+"</div></div>"}var r="";notifications.length>1&&(r='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Tyhjennä kaikki</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+r+"</div>")}function notificationSelected(e,t){var n=-1;for(var i in notifications)notifications[i].id==e&&(n=i);-1!=n&&(notificationSelectedEx(notifications[n],e),t&&notifications[n]&&(notifications[n].notification&&(notifications[n].notification.close(),delete notifications[n].notification),notificationDelete(e)))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,n=Q("notifyx"+e);if(null!=n){for(var i in notifications)notifications[i].id==e&&(t=i);if(-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),n.parentNode.removeChild(n),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),notifications.length>0&&0==t)){var a=notifications[0];QS("notifyx"+a.id)["border-top"]="1px solid transparent"}}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Uusi tili","Palvelinraja","Turvallisuusvaroitus","Tilin asetukset","Laiteryhmä","Kutsu koodit"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Lupa kielletty","Virheellinen käyttäjätunnus","Väärä salasana","Virheellinen sähköpostiosoite","Virheellinen verkkotunnus","Virheelliset sivuston käyttöoikeudet","Käyttäjä on jo olemassa","Käyttäjää ei voi lisätä tässä tilassa","Vahvistuspoikkeus","Tiliraja saavutettu.","Chat -pyyntö, hyväksy napsauttamalla tätä.","Tällä tilillä on {0} epäonnistunutta kirjautumisyritystä viimeisen kirjautumisen jälkeen.","Sähköpostiosoitteen vaihtaminen epäonnistui, toinen tili jo käyttää: {0}.","Sähköposti lähetetty.","Käyttäjää {0} ei löydy.","Käyttäjiä {0} ei löydy.","Virhe, ei voi vaihtaa aiemmin käytettyyn salasanaan.","Virhe, ei voi vaihtaa yleisesti käytettyyn salasanaan.","Virhe, salasanaa ei muutettu.","Salasana vaihdettu.","Nykyinen salasana ei ole oikea.",'Virhe, kutsukoodi "{0}" on jo käytössä.',"SMS -yhdyskäytävä ei ole käytössä","Ei käyttäjänhallintaoikeuksia","Virheellinen tekstiviesti","Tällä käyttäjällä ei ole puhelinnumeroa","SMS succesfully sent.","SMS -virhe","SMS -virhe: {0}",'Sähköpostin verkkotunnus "{0}" ei ole sallittu. Vain ({1}) ovat sallittuja',"Invalid message","Message succesfully sent.","Message error","Message error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t=getstore("notifications",0);1&t&&Q("chimes").play();var n=null;if(Notification&&"granted"==Notification.permission){var i=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n");if(e.nodeid){var a=getNodeFromId(e.nodeid);a&&(n=16&t?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[a.meshid].name+" - "+a.name,{tag:e.tag,body:i,icon:"/images/notify/icons128-"+a.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+a.name,{tag:e.tag,body:i,icon:"/images/notify/icons128-"+a.icon+".png"}))}else{null==e.icon&&(e.icon=0);var o=e.title;o=null==o?"":" - "+e.title,n=new Notification(decodeURIComponent("{{{extitle}}}")+o,{tag:e.tag,body:i,icon:"/images/notify/icons128-"+e.icon+".png"})}n.id=e.id,n.xtag=e.tag,n.url=e.url,n.nodeid=e.nodeid,n.username=e.username,n.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=n}if("number"==typeof e.maxtime&&e.maxtime>0){var s=function e(){notificationDelete(e.xid)};s.xid=e.id,setTimeout(s,1e3*e.maxtime)}}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Käytetty","Vapaata"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Käytetty","Vapaata"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t={ServerState:"Palvelimen Tila",AgentErrorCounters:"Agentin virhe laskurit",UnknownGroup:"Tuntematon ryhmä",InvalidPKCSsignature:"Virheellinen PKCS-allekirjoitus",InvalidRSAsignature:"Virheellinen RSA-allekirjoitus",InvalidJSON:"Virheellinen JSON",UnknownAction:"Tuntematon toimenpide",BadWebCertificate:"Huono Web-varmenne",BadSignature:"Huono allekirjoitus",MaxSessionsReached:"Istuntojen enimmäismäärä saavutettu",UnknownDeviceGroup:"Tuntematon laiteryhmä",InvalidDeviceGroupType:"Virheellinen laiteryhmän tyyppi",DuplicateAgent:"Monista Agentti",ConnectedIntelAMT:"Yhdistetyt Intel&reg; AMT",ConnectedIntelAMTCira:"Yhdistetyt Intel&reg; AMT CIRA",RelayErrors:"Releen virheet",UserAccounts:"Käyttäjätilit",DeviceGroups:"Laiteryhmät",AgentSessions:"Agenttien istunnot",ConnectedUsers:"Yhdistetyt käyttäjät",UsersSessions:"Käyttäjien istuntoja",RelaySessions:"Viestiistunnot",RelayCount:"Viesti"};if(setupGeneralServerStats(),"object"==typeof e.cpuavg){var n=Math.min(e.cpuavg[0],1);window.serverStatCpu.config.data.datasets[0].data=[n,1-n],QH("serverCpuChartText",'<div style=margin-bottom:5px>Prosessori kuorma</div><div><b title="Prosessorin kuorma viimeisen minuutin aikana">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="Prosessorin kuorma viimeisen 5 minuutin aikana">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="Prosessorin kuorma viimeisen 15 minuutin aikana">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()}"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Käytettävissä oleva muisti</div><div><b>"+getNiceSize3(e.availablemem)+"</b> vapaata, <b>"+getNiceSize3(e.totalmem)+"</b> yhteensä</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Muisti</div><div><b>"+getNiceSize3(e.freemem)+"</b> vapaata, <b>"+getNiceSize3(e.totalmem)+"</b> yhteensä</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update());var i="<div style=width:100% cellpadding=0 cellspacing=0>";if("object"==typeof e.values)for(var a in e.values)for(var o in i+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(t[a]?t[a]:a)+"</div>",e.values[a])i+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(t[o]?t[o]:o)+"</span><span style=float:right>"+e.values[a][o]+"</span></td><td></td></tr></table></div>";i+="</div>",QH("serverStatsTable",i)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){if(null!=serverTimelineStats){var t=null;if(null!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t){serverTimelineStats.push(e);var n=Q("p40type").value;0==n?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am}),null!=e.conn.amc&&serverTimelineConfig.data.datasets[5].data.push({x:e.time,y:e.conn.amc})):1==n?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==n||4==n?updateServerTimelineStats():5==n&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours()}}}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}const trafficSeriesNames=["Agentti","CIRA","AMT-OS","HTTP","Rele","Pääte","Työpöytä","Tiedostot","WebRDP","WebSSH","WebVNC","Multiplex -pöytäkone"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e,t=Q("p40type").value,n=pastDate(Q("p40time").value),i=[],a=null,o=!1,s=!0;if(null!=Q("p40server").value&&(""==(a=decodeURIComponent(Q("p40server").value))&&(a=null),s=!1),serverTimelineConfig.options.scales.x.min=n,serverTimelineConfig.options.scales.y.stacked=3==t||4==t,0==t){serverTimelineConfig.options.scales.y.title.text="Yhteysmäärä",e={labels:[pastDate(0),n],datasets:[{label:"Agentit",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Käyttäjät",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Käyttäjäistunnot",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Viestiistunnot",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0},{label:"Intel AMT CIRA",data:[],backgroundColor:"rgba(255, 155, 0, .1)",borderColor:"rgb(255, 155, 0)",fill:!0}]};for(var l=0;l<serverTimelineStats.length;l++){new Date(serverTimelineStats[l].time);null!=serverTimelineStats[l].s&&-1==i.indexOf(serverTimelineStats[l].s)&&(i.push(serverTimelineStats[l].s),s&&(a=serverTimelineStats[l].s,s=!1)),null==serverTimelineStats[l].s&&(o=!0),serverTimelineStats[l].s==a&&(1==serverTimelineStats[l].first&&(e.datasets[0].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[4].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[5].data.push({x:serverTimelineStats[l].time-1,y:NaN})),serverTimelineStats[l].conn&&(e.datasets[0].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.ca}),e.datasets[1].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.cu}),e.datasets[2].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.us}),e.datasets[3].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.rs}),e.datasets[4].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.am}),null!=serverTimelineStats[l].conn.amc&&e.datasets[5].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].conn.amc})))}}else if(1==t){serverTimelineConfig.options.scales.y.title.text="Megatavua",e={labels:[pastDate(0),n],datasets:[{label:"Ulkoinen",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Pinoa käytetty",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Pino yhteensä",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(l=0;l<serverTimelineStats.length;l++)null!=serverTimelineStats[l].s&&-1==i.indexOf(serverTimelineStats[l].s)&&(i.push(serverTimelineStats[l].s),s&&(a=serverTimelineStats[l].s,s=!1)),null==serverTimelineStats[l].s&&(o=!0),serverTimelineStats[l].s==a&&(1==serverTimelineStats[l].first&&(e.datasets[0].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[l].time-1,y:NaN})),e.datasets[0].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].mem.external/1048576}),e.datasets[1].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].mem.heapUsed/1048576}),e.datasets[2].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].mem.heapTotal/1048576}),e.datasets[3].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].mem.rss/1048576}))}else if(3==t||4==t){serverTimelineConfig.options.scales.y.title.text="Megatavua",e={labels:[pastDate(0),n],datasets:[]};var r=0;for(l=0;l<serverTimelineStats.length;l++)null!=serverTimelineStats[l].traffic&&(null!=serverTimelineStats[l].s&&-1==i.indexOf(serverTimelineStats[l].s)&&(i.push(serverTimelineStats[l].s),s&&(a=serverTimelineStats[l].s,s=!1)),null==serverTimelineStats[l].s&&(o=!0),serverTimelineStats[l].s==a&&serverTimelineStats[l].traffic&&(serverTimelineStats[l].traffic.AgentCtrlIn>0&&(r|=1),serverTimelineStats[l].traffic.CIRAIn>0&&(r|=2),serverTimelineStats[l].traffic.LMSIn>0&&(r|=4),serverTimelineStats[l].traffic.httpIn>0&&(r|=8),serverTimelineStats[l].traffic.relayIn&&(serverTimelineStats[l].traffic.relayIn[0]>0&&(r|=16),serverTimelineStats[l].traffic.relayIn[1]>0&&(r|=32),serverTimelineStats[l].traffic.relayIn[2]>0&&(r|=64),serverTimelineStats[l].traffic.relayIn[5]>0&&(r|=128),serverTimelineStats[l].traffic.relayIn[10]>0&&(r|=256),serverTimelineStats[l].traffic.relayIn[11]>0&&(r|=512),serverTimelineStats[l].traffic.relayIn[12]>0&&(r|=1024)),serverTimelineStats[l].traffic.desktopMultiplex&&serverTimelineStats[l].traffic.desktopMultiplex.in>0&&(r|=2048)));for(l=0;l<13;l++)r&1<<l&&e.datasets.push({label:trafficSeriesNames[l],data:[],backgroundColor:seriesColor1(l),borderColor:seriesColor2(l),fill:!0,steppedLine:!0});for(l=0;l<serverTimelineStats.length;l++)if(null!=serverTimelineStats[l].traffic&&(null!=serverTimelineStats[l].s&&-1==i.indexOf(serverTimelineStats[l].s)&&(i.push(serverTimelineStats[l].s),s&&(a=serverTimelineStats[l].s,s=!1)),null==serverTimelineStats[l].s&&(o=!0),serverTimelineStats[l].s==a)){if(1==serverTimelineStats[l].first)for(var d=1;d<61440;d<<=1)r&d&&e.datasets[0].data.push({x:serverTimelineStats[l].time-1,y:NaN});var u=0;3==t?(1&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.AgentCtrlIn?serverTimelineStats[l].traffic.AgentCtrlIn/1048576:0}),2&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.CIRAIn?serverTimelineStats[l].traffic.CIRAIn/1048576:0}),4&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.LMSIn?serverTimelineStats[l].traffic.LMSIn/1048576:0}),8&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.httpIn?serverTimelineStats[l].traffic.httpIn/1048576:0}),16&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[0]?serverTimelineStats[l].traffic.relayIn[0]/1048576:0}),32&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[1]?serverTimelineStats[l].traffic.relayIn[1]/1048576:0}),64&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[2]?serverTimelineStats[l].traffic.relayIn[2]/1048576:0}),128&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[5]?serverTimelineStats[l].traffic.relayIn[5]/1048576:0}),256&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[10]?serverTimelineStats[l].traffic.relayIn[10]/1048576:0}),512&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[11]?serverTimelineStats[l].traffic.relayIn[11]/1048576:0}),1024&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayIn&&serverTimelineStats[l].traffic.relayIn[12]?serverTimelineStats[l].traffic.relayIn[12]/1048576:0}),2048&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.desktopMultiplex&&serverTimelineStats[l].traffic.desktopMultiplex.in?serverTimelineStats[l].traffic.desktopMultiplex.in/1048576:0})):4==t&&(1&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.AgentCtrlOut?serverTimelineStats[l].traffic.AgentCtrlOut/1048576:0}),2&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.CIRAOut?serverTimelineStats[l].traffic.CIRAOut/1048576:0}),4&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.LMSOut?serverTimelineStats[l].traffic.LMSOut/1048576:0}),8&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.httpOut?serverTimelineStats[l].traffic.httpOut/1048576:0}),16&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[0]?serverTimelineStats[l].traffic.relayOut[0]/1048576:0}),32&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[1]?serverTimelineStats[l].traffic.relayOut[1]/1048576:0}),64&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[2]?serverTimelineStats[l].traffic.relayOut[2]/1048576:0}),128&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[5]?serverTimelineStats[l].traffic.relayOut[5]/1048576:0}),256&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[10]?serverTimelineStats[l].traffic.relayOut[10]/1048576:0}),512&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[11]?serverTimelineStats[l].traffic.relayOut[11]/1048576:0}),1024&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.relayOut&&serverTimelineStats[l].traffic.relayOut[12]?serverTimelineStats[l].traffic.relayOut[12]/1048576:0}),2048&r&&e.datasets[u++].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].traffic.desktopMultiplex&&serverTimelineStats[l].traffic.desktopMultiplex.out?serverTimelineStats[l].traffic.desktopMultiplex.out/1048576:0}))}}else if(5==t){serverTimelineConfig.options.scales.y.title.text="Käyttö",e={labels:[pastDate(0),n],datasets:[{label:"Prosessori",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(l=0;l<serverTimelineStats.length;l++)if("object"==typeof serverTimelineStats[l].cpu&&"number"==typeof serverTimelineStats[l].cpu[0]){if(null!=serverTimelineStats[l].s&&-1==i.indexOf(serverTimelineStats[l].s)&&(i.push(serverTimelineStats[l].s),s&&(a=serverTimelineStats[l].s,s=!1)),null==serverTimelineStats[l].s&&(o=!0),serverTimelineStats[l].s!=a)continue;1==serverTimelineStats[l].first&&e.datasets[0].data.push({x:serverTimelineStats[l].time-1,y:NaN}),e.datasets[0].data.push({x:serverTimelineStats[l].time,y:serverTimelineStats[l].cpu[0]})}}if(serverTimelineConfig.data=e,window.serverMainStats.update(),i.length>0){var c="";for(l=0;l<i.length;l++)c+='<option value="'+encodeURIComponentEx(i[l])+'"'+(a==i[l]?" selected":"")+">"+EscapeHtml(i[l])+"</option>";o&&(c+='<option value=""'+(null==a?" selected":"")+">Tyhjä</option>"),QH("p40server",c)}QV("p40server",i.length>0)}}function p40downloadEvents(){for(var e="aika, yhteyshenkilö, yhteyskäyttäjät, yhteyskäyttäjät, yhteysviestien välitys, yhteysosoitteet, ulkoiset muistit, muistiaheapused, muistiasetukset, muistit\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am?serverTimelineStats[t].conn.am:"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e="",t=parseInt(Q("p41limitdropdown").value);for(var n in serverTrace.length>t&&serverTrace.splice(t),serverTrace){var i=[];for(var a in serverTrace[n].args)"object"==typeof serverTrace[n].args[a]?i.push(JSON.stringify(serverTrace[n].args[a])):i.push(serverTrace[n].args[a]);e+="<div class=traceEvent onclick=showTraceEvent("+n+")>"+EscapeHtml(new Date(serverTrace[n].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[n].source.toUpperCase())+"</b>: "+EscapeHtml(i.join(", "))+"</div>"}QH("p41events",e)}function showTraceEvent(e){var t=serverTrace[e],n="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?n+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":n+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Palvelimen jäljitystapahtuma","<div class=selecttext style=max-height:300px;overflow-y:auto>"+n+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Ydin palvelin</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(serverTraceSources.indexOf("cookie")>=0?"checked":"")+">Evästekooderi</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(serverTraceSources.indexOf("dispatch")>=0?"checked":"")+">Viestin lähettäjä</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(serverTraceSources.indexOf("main")>=0?"checked":"")+">Pääpalvelimen viestit</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(serverTraceSources.indexOf("peer")>=0?"checked":"")+">MeshCentral Server -vertailu</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(serverTraceSources.indexOf("agent")>=0?"checked":"")+">MeshAgent liikenne</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(serverTraceSources.indexOf("agentupdate")>=0?"checked":"")+">MeshAgent päivitys</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(serverTraceSources.indexOf("cert")>=0?"checked":"")+">Palvelimen sertifikaatti</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(serverTraceSources.indexOf("db")>=0?"checked":"")+">Palvelimen tietokanta</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(serverTraceSources.indexOf("email")>=0?"checked":"")+">Sähköposti/tekstiviesti/push -liikenne</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Web-palvelin</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(serverTraceSources.indexOf("web")>=0?"checked":"")+">Web-palvelin</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(serverTraceSources.indexOf("webrequest")>=0?"checked":"")+">Web-palvelimen pyynnöt</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(serverTraceSources.indexOf("relay")>=0?"checked":"")+">Web Socket Relay</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(serverTraceSources.indexOf("httpheaders")>=0?"checked":"")+">Verkkopalvelimen HTTP -otsikot</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(serverTraceSources.indexOf("authlog")>=0?"checked":"")+">User Authentication Log</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(serverTraceSources.indexOf("amt")>=0?"checked":"")+">Intel AMT -päällikkö</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(serverTraceSources.indexOf("webrelay")>=0?"checked":"")+">Yhteysrele</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(serverTraceSources.indexOf("mps")>=0?"checked":"")+">CIRA-Palvelin</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(serverTraceSources.indexOf("mpscmd")>=0?"checked":"")+">CIRA-palvelimen komennot</label></div>",setModalContent("xxAddAgent","Palvelimen jäljitys",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],n=1;n<22;n++)try{Q("p41c"+n).checked&&e.push(t[n-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e="aika, lähde, viesti\r\n";for(var t in serverTrace)e+='"'+new Date(serverTrace[t].time).toLocaleTimeString()+'","'+serverTrace[t].source+'","'+serverTrace[t].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(e),"servertrace.csv"),!1}function setupServiceWorker(){8&features2&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,n,i,a,o){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=i,xxdialogButtons=n,xxdialogTag=o,QV("id_dialogclose",2&n||8&n),QV("idx_dlgDeleteButton",4&n),QV("idx_dlgButtonBar",7&n),QV("idx_dlgMoreButtons",16&n),t&&QH("xxAddAgentTitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),a&&(2==e?QH("id_dialogOptions",a):QH("id_dialogMessage",a)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity();(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0!=backStack.length){var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||userinfo.otphkeys>0||userinfo.otpkeys>0||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Tilin Turvallisuus",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.');go(5)}"server"==t&&go(6)}else go(2)}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&e>2&&(e=2,setModalContent("xxAddAgent","Tilin Turvallisuus",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&!(2&userinfo.siteadmin)||4&features)&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var n=0;n<61;n++)QV("p"+n,n==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),!(268435456&features)&&xxcurrentView>0){var i="";for(var n in xxcurrentView>=10&&xxcurrentView<=19?null!=currentNode&&(i="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):xxcurrentView>=20&&xxcurrentView<=29?null!=currentMesh&&(i="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):xxcurrentView>=30&&xxcurrentView<=39?null!=currentUser&&(i="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):xxcurrentView>=51&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(i="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):xxcurrentView>1&&(i="?viewmode="+xxcurrentView),urlargs)i+=(""==i?"?":"&")+n+"="+urlargs[n];try{window.history.replaceState({},document.title,window.location.pathname+i)}catch(e){}}var a=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(var n in a)QC(a[n]).remove("fullselect"),QC(a[n]).remove("semiselect");var o=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(var n in o)QC(o[n]).remove("lbbuttonsel"),QC(o[n]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",l=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",r=0;goBackStack.length>0&&(r=goBackStack[goBackStack.length-1]),1==e||1==r||0==r&&e>=10&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(l)):2==e||2==r||0==r&&e>=20&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(l)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(l)):4==e||e>=30&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(l)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(l)):(6==e||115==e||e>=40&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(l)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&e>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",e>=10&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",e>=20&&e<30),QV("UserSubMenuSpan",e>=30&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e);var d={3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"};for(var n in d)QC(d[n]).remove("style3x"),QC(d[n]).remove("style3sel"),QC(d[n]).add(e==n?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&!(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&e>=10&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=[11,12].indexOf(e)>=0?"hidden":null}}else e>=10&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):e>=20&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):e>=30&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):e>=50&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(o=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(o))o[t].parentNode.removeChild(o[t]);var n={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},i={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},a=Q("p42tbl");installedPluginList.forEach(function(e){var t=[];if(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=n[e.status].text,e.statusColor=n[e.status].color,null==e.versionHistoryUrl&&t.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Tarkistetaan...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]){var o=installedPluginList.version_info[e._id];o.hasUpdate?e.upgradeAvail='<a title="Näytä muutosloki" rel="noreferrer noopener" target="_blank" href="'+o.changelogUrl+'">'+o.version+"</a>":(t.push("upgrade"),e.status?e.upgradeAvail="Ajantasalla":e.upgradeAvail='<a title="Näytä muutosloki" rel="noreferrer noopener" target="_blank" href="'+o.changelogUrl+'">'+o.version+"</a>"),o.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Versio yhteensopimaton, päivitä ensin MeshCentral-asennus\" style=\"cursor: pointer; color:red;\"> ! </span> ]",t.push("install"),t.push("upgrade"))}e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>';var s=Object.entries(i[e.status]);for(var l in s)-1===t.indexOf(s[l][0])&&(e.actions+='<option value="'+s[l][0]+'">'+s[l][1]+"</option>");e.actions+="</select>";var r="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",d=a.insertRow(-1);d.innerHTML=r,d.classList.add("p42tblRow"),d.setAttribute("data-id",e._id),d.setAttribute("id","pluginRow-"+e._id)})}else{var o=Q("p42tbl").querySelectorAll(".p42tblRow");for(var t in Object.values(o))o[t].parentNode.removeChild(o[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,n=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==n&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:n}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var n=null;for(var i in installedPluginList)installedPluginList[i]._id==t&&(n=installedPluginList[i]);setModalContent("xxAddAgent","Laajennuksen toiminto",format("Haluatko varmasti {0} laajennuksen: {1}",e.value,n.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){if(t!=userinfo._id||null==userinfo.removeRights)return e;var n=0,i=0;return 8&userinfo.removeRights&&(i+=8),65536&userinfo.removeRights&&(n+=65536),256&userinfo.removeRights&&(n+=256),512&userinfo.removeRights&&(n+=512),1024&userinfo.removeRights&&(n+=1024),16&userinfo.removeRights&&(i+=16),32768&userinfo.removeRights&&(i+=32768),131072&userinfo.removeRights&&(i+=131072),64&userinfo.removeRights&&(i+=64),262144&userinfo.removeRights&&(i+=262144),4294967295!=e?(e|=n,e&=4294967295-i):(e=2015471,e|=n,e&=4294967295-i),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var n=0,i=e.links[t];if(null!=i){if(4294967295==i.rights)return removeUserRights(4294967295,t);n=i.rights}var a=null;if(t==userinfo._id?a=userinfo:null!=users&&(a=users[t]),null!=a)for(var o in a.links)if(o.startsWith("ugrp/")&&null!=(i=e.links[o])){if(4294967295==i.rights)return removeUserRights(4294967295,t);n|=i.rights}return removeUserRights(n,t)}function IsMeshViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return!1;if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var i in n.links)if(i.startsWith("ugrp/")&&null!=e.links[i])return!0;return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var n=GetMeshRights(e.meshid,t);if(4294967295==n)return removeUserRights(n,t);if(null!=e.links&&null!=e.links[t]&&(n|=e.links[t].rights),null!=e.links&&null!=userinfo.links)for(var i in e.links)i.startsWith("ugrp/")&&null!=userinfo.links[i]&&null!=e.links[i].rights&&(n|=e.links[i].rights);return removeUserRights(n,t)}function IsNodeViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return!1;if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var n in e.links)if(n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights)return!0;return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t=e.length,n=-1,i="undefined"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),a=0,o=0,s=0;s!==t;){if(a=e.charCodeAt(s),s+=1,a>=55296&&a<=56319){if(s===t){i[n+=1]=239,i[n+=1]=191,i[n+=1]=189;break}if(!((o=e.charCodeAt(s))>=56320&&o<=57343)){i[n+=1]=239,i[n+=1]=191,i[n+=1]=189;continue}if(s+=1,(a=1024*(a-55296)+o-56320+65536)>65535){i[n+=1]=240|a>>>18,i[n+=1]=128|a>>>12&63,i[n+=1]=128|a>>>6&63,i[n+=1]=128|63&a;continue}}a<=127?i[n+=1]=0|a:a<=2047?(i[n+=1]=192|a>>>6,i[n+=1]=128|63&a):(i[n+=1]=224|a>>>12,i[n+=1]=128|a>>>6&63,i[n+=1]=128|63&a)}return"undefined"!=typeof Uint8Array?i.subarray(0,n+1):(i.length=n+1,i)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n.charCodeAt(a);return i}function joinPaths(){var e=[];for(var t in arguments){var n=arguments[t];if(null!=n&&""!=n){for(;n.endsWith("/")||n.endsWith("\\");)n=n.substring(0,n.length-1);for(;n.startsWith("/")||n.startsWith("\\");)n=n.substring(1);e.push(n)}}return e.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var n={};try{for(var i=0,a=localStorage.length;i<a;++i){var o=localStorage.key(i);"_"!=o[0]&&(n[o]=localStorage.getItem(o),"desktopsettings"!=o&&"stars"!=o&&"deskKeyShortcuts"!=o&&"deskStrings"!=o&&"cmdopt"!=o&&"string"==typeof n[o]&&n[o].length>64&&delete n[o])}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(n)})}}function stringToUtf8Blob(e){const t=(new TextEncoder).encode(e);var n=new Uint8Array(3+t.length);n[0]=239,n[1]=187,n[2]=191;for(var i=0;i<t.length;i++)n[i+3]=t[i];return new Blob([n],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){if(null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver)return 0;var t=e.intelamt.ver.split(".");return t.length<2?0:parseInt(t[0])+parseInt(t[1])/100}function getstore(e,t){try{if("undefined"==typeof localStorage)return t;var n=localStorage.getItem(e);return null==n||null==n?t:n}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,n){return n?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,n){return n?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,n){var i=document.createElement("option");i.text=t,i.value=n,Q(e).add(i)}function passwordcheck(e){return e.length>7&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr)&&(messagebox("Soitto virhe",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),!0)}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var n=TableStart();for(i in e)i&&e[i]&&(n+=TableEntry(i,e[i]));return n+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,n=[],i=0,a=e.options.length;i<a;i++)(t=e.options[i]).selected&&n.push(t.value);return n}function getInstance(e,t){for(var n in e)if(e[n].InstanceID==t)return e[n];return null}function getItem(e,t,n){for(var i in e)if(e[i][t]==n)return e[i];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<n.length;i++)(e=n[i].indexOf("="))>0&&(t[n[i].substring(0,e)]=n[i].substring(e+1,n[i].length));return t}function addHtmlValue(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${n[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,n=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${n[0]||"col-md-12"}">${t}<label class="${n[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(navigator.userAgent.indexOf("Chrome/")>0||navigator.userAgent.indexOf("Firefox/")>0||navigator.userAgent.indexOf("Opera/")>0||navigator.userAgent.indexOf("Safari/")>0)}function findOne(e,t){return null!=e&&null!=t&&t.some(function(t){return e.indexOf(t)>=0})}function copyTextToClip(e){var t=document.createElement("DIV");t.textContent=e,document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function copyTextToClip2(e){var t=document.createElement("DIV");t.textContent=decodeURIComponent(e),document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return printDate(new Date)==printDate(e)?printTime(e):printDateTime(e)}function addDetailItem(e,t,n,i=[]){return`<div class="row mb-1"><div class="${i[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${i[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}function addTextLink(e,t,n){var i=t.toLowerCase().indexOf(e.toLowerCase());return-1==i?t:t.substring(0,i)+'<a href="'+n+'">'+e+"</a>"+t.substring(i+e.length)}function getOrderedList(e,t){var n=[];for(var i in e)n.push(e[i]);return n.sort(function(e,n){var i=e[t].toLowerCase(),a=n[t].toLowerCase();return i>a?1:i<a?-1:0}),n}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){var t="00"+e;return t.substr(t.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),n=t[0]+"/"+t[1]+"/"+t[2],i="";if(4==t.length&&t[3].startsWith("guest:")&&(i=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[n])return null!=users[n].realname?users[n].realname+i:users[n].name+i;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+i;if(e==userinfo._id)return userinfo.name+i;if(nodes)for(var a in nodes)if(nodes[a].links)for(var o in nodes[a].links)if(nodes[a].links[o].name&&o==e)return nodes[a].links[o].name+i;if(meshes)for(var a in meshes)if(meshes[a].links)for(var o in meshes[a].links)if(meshes[a].links[o].name&&o==e)return meshes[a].links[o].name+i;return t[2]+i}function round(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n}function safeNewWindow(e,t){var n=window.open(e,t,"noopener,noreferrer");n&&(n.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)>=0}function downloadFile(e,t,n){var i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("rel","noreferrer noopener"),i.setAttribute("target","fileDownloadFrame"),i.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(i),i.click(),document.body.removeChild(i),n&&setDialogMode(0)}function dialogBoxDrag(){var e=Q("xxAddAgentModal"),t=0,n=0,i=0,a=0;function o(o){(o=o||window.event).preventDefault(),t=i-o.clientX,n=a-o.clientY,i=o.clientX,a=o.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function s(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,a=e.clientY,document.onmouseup=s,document.onmousemove=o}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>