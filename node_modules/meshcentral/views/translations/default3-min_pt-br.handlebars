<!doctypehtml><html lang=pt-br dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link type=text/css href=styles/custom.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Informação</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Área de Trabalho</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminal</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Arquivos</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Eventos</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Detalhes</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Console</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Plugins</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Alternar Favorito</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi-Desktop</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Selecionar tudo</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Selecione nenhum</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Alternar Porta</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Alternar Porta</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Alternar Porta</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Alternar Porta</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Alternar Porta</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Renomear</div><div class=cmtext onclick=cmfilesaction(2,event)>Editar</div><div class=cmtext onclick=cmfilesaction(3,event)>Excluir</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Expandir todos</div><div class=cmtext onclick=cmexpandaction(2,event)>Recolher todos</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Abrir player ...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Customizar...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Customizar...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Clique para ver as notificações atuais">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Experimente a nova interface do usuário do MeshCentral</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Seleção da interface do usuário"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Interface da barra esquerda"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Interface da barra superior"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Interface de largura fixa"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Notas Pessoais"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Alternar modo noturno"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Alternar barra de rodapé"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Meus Dispositivos<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Minha conta<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Meus Eventos<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Meus Arquivos<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Meus Usuários<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Meu Servidor<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Geral<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Área de Trabalho<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminal<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Arquivos<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Eventos<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Detalhes<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Console<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Geral<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Resumo<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Eventos</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Relatório</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Geral<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Eventos<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Usuários<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Grupos<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Gravações<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Geral<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Estatísticas<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Console<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Rastrear<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Servidor desconectado</span>,<href onclick=reload() style=cursor:pointer><u>Clique para reconectar</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>Meus Dispositivos</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Go to first page"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Go to previous page"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Go to next page"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Go to last page"style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Colunas><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Lista><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Desktops><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Desktops><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Mapa style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Recolher todos"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Expandir todos"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Selecionar tudo"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value="Ação do Grupo"onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll To Top"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Filtro onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: usuário: xxx ou u:xxx ip:xxx grupo:xxx ou g:xxx tag:xxx ou t: xxx atag:xxx ou a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc:noupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title="Filtro de Dispositivo"><option value=0 selected>Tudo<option value=1>On-line<option value=5>Desconectado<option value=2>Sessões<option value=3>Favoritos<option value=4>Intel® AMT<option value=6>Ajuda<option value=7>Etiquetado<option value=8>Sem etiqueta</select><div class=form-check title="Mostrar o nome do sistema operacional dos dispositivos"><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>Nome do SO</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Mostrar apenas dispositivos que estão online">On-line</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Recolher todos"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Expandir todos"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Conectar tudo"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Desconectar tudo"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll To Top"><div class="form-check me-1"title="Conexão automática"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Auto</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=Configurações> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Filtro onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: usuário: xxx ou u:xxx ip:xxx grupo:xxx ou g:xxx tag:xxx ou t: xxx atag:xxx ou a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc:noupdate wsc:nofirewall wsc:any connectivity:xxx c:xxx"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Localização de pesquisa"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Procurar title="Pesquise por localização"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Redefinir a visualização do mapa"value=Reiniciar onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Visualizar <select id=viewselect onchange=onDeviceViewChange()><option value=1>Colunas<option value=2>Lista<option value=3>Largura fixa de desktops<option id=viewselectmapoption value=4 style=display:none>Mapa<option value=5>Desktops</select></div><div style=display:none id=devListToolbarSize>Tamanho <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Pequeno<option value=1>Médio<option value=2>Grande</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Ordenar <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Grupo<option>Ligar<option>Dispositivo<option>Etiqueta<option>Groupo-Etiquetas<option>Visto pela última vez</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Para começar, <a href=# onclick="return account_createMesh()"><strong>Clique aqui para criar um grupo de dispositivos</strong></a>.</div><div id=getStarted2>Nenhum grupo de dispositivos.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Resultados de localização</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Minha conta</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Alterar a imagem</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Segurança da conta</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Gerenciar número de telefone</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Gerenciar autenticação de e-mail</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Gerenciar aplicativo autenticador</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Gerenciar chaves de segurança</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Gerenciar autenticação push</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Gerenciar códigos de backup</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Ver logins anteriores</a><br></span></div></div><div id=p2AccountActions><p><strong>Ações da conta</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Gerenciar número de telefone</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Verificar e-mail</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Habilitar notificações da web</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Configurações de idioma</a><br><a href=# onclick="return account_showAccountNotifySettings()">Configurações de notificação</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Altere o endereço de email</a><br></span><a href=# onclick="return account_showChangePassword()">Alterar senha</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Deletar conta</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Criar token de login</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Mudar tema</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Grupos de Dispositivos</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Novo</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Nenhum grupo de dispositivos.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>Comece aqui!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Meus Eventos</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Filtro</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p3limitdropdown class=me-1>Mostrar</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000<option notransval=1 value="">Sem limite</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Baixar eventos"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Meus Usuários</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Selecionar tudo"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Ação do Grupo"onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Nova conta..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Filtro onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value="Notificar Todos"> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Baixar informações do usuário"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Criação em lote de várias contas de usuário"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=Configurações onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Meus Arquivos</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Cima> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Selecionar tudo"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value=Renomear onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Excluir onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=Editar onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Nova pasta"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value=Carregar onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Baixar onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Recortar onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Copiar onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value=Colar onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Classificar por nome<option value=2>Ordenar por tamanho<option value=3>Classificar por data<option value=4>Decrescente pelo nome<option value=5>Decrescente por tamanho<option value=6>Decrescente por data</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Esses arquivos são compartilhados publicamente, clique em "link" para obter o url público.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Meu Servidor</h1></div><div id=p2ServerActions><p><strong>Ações do servidor</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Baixar backup do servidor</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Restaurar servidor com backup</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Backup do Google Drive</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Verifique a versão do servidor</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Mostrar log de erro do servidor</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Carga do servidor</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Avisos de servidor</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Em geral - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Notas<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title=Favoritos role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Lista de sessões remotas ativas neste computador."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Ajuda Solicitada"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Área de Trabalho - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Tela cheia. Segure a tecla shift para tela inteira do navegador."></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>A porta de redirecionamento ou o recurso KVM estão desabilitados<span id=p11warninga>, clique aqui para habilitar.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>O computador remoto não está ligado, clique aqui para emitir um comando de ligar.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>CÁPSULAS</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>ROLAGEM</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUM</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value=AutoConnect onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Peça Autorização + Bar</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Peça autorização</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Barra de Privacidade</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Conecte-se usando RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>Conexão RDP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Alternar Porta</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Conecte-se usando KVM de hardware"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Desconectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Desconectar e bloquear</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Desconectar</a></ul></div><span id=deskstatus style=line-height:22px>Desconectado</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Alterar o estado de funcionamento da máquina remota"onkeypress=return!1 onkeydown=return!1 value="Ações de energia ..."onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Execute ações de energia no dispositivo"onkeypress=return!1 onkeydown=return!1 value=Ações onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=Configurações title="Editar configurações de área de trabalho remota"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Alternar o modo de foco, quando ativo, apenas a região ao redor do mouse é atualizada"onkeypress=return!1 onkeydown=return!1 value="Focar tudo"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="O servidor está gravando esta sessão"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Gire para direita"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Gire para esquerda"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Alternar modo de visualização"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>Atualizar</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Processos</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Serviços</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Classificar por id de processo"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Classificar por nome"onclick=sortProcess(1)>Nome</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Classificar por estado"onclick=sortService(0)>Estado</a> <a class=colmn2 title="Classificar por nome"onclick=sortService(1)>Nome</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Enviar onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value="Área de Transferência"onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Tipo onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Alternar entrada de mouse e teclado"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Entrada</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Latência da sessão da área de trabalho"></span> <span id=DeskTimer style=width:70px class=text-center title="Tempo de sessão"></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Ferramentas title="Alternar visualização de ferramentas"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Compartilhar dispositivo com convidado"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="A entrada remota está desbloqueada"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="A entrada remota está bloqueada"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Atualize a área de trabalho"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Carregue a área de transferência local para um dispositivo remoto"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Baixe a área de transferência remota para a área de transferência local"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Gravar sessão de desktop remoto em arquivo"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Salve uma captura de tela da área de trabalho remota"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Alternar plano de fundo da área de trabalho remota"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Abra um endereço da web no computador remoto"role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Bloqueie o computador remoto"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Exibir uma notificação no computador remoto"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Abra a janela de bate-papo neste computador"role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Run a script on this computer"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Terminal - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Tela cheia. Segure a tecla shift para tela inteira do navegador."></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>A porta de redirecionamento ou o recurso KVM estão desabilitados<span id=p12warninga>, clique aqui para habilitar.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>O computador remoto não está ligado, clique aqui para emitir um comando de ligar.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> AutoConnect</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Admin Shell</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Admin PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell do usuário</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>PowerShell do usuário</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Pergunte ao shell do administrador</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Pergunte ao administrador do PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Pergunte ao Shell do Usuário</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Pergunte ao usuário PowerShell</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Shell do usuário</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>PowerShell do usuário</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Root Shell</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell do usuário</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Shell de login</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Conexão SSH</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternar Porta</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Conecte-se usando KVM de hardware Intel® AMT"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Desconectar</button></span> <span id=termstatus style=line-height:22px>Desconectado</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="O servidor está gravando esta sessão"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Execute ações de energia no dispositivo"onkeypress=return!1 onkeydown=return!1 value=Ações class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctrl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value=Backspace onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value=Colar title="Cole o texto no terminal"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title="Tempo de sessão"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="CR + LF"title="Alterne o que a tecla de retorno enviará"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC + [OM)"title="Alternar o tipo de emulação das teclas F1 a F10"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Ascii estendido"title="Alternar tipo de emulação de terminal"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Enviar title="Envie a chave especial selecionada"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Arquivos - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> AutoConnect</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Peça autorização</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Desconectar</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Conecte-se usando a área de trabalho remota do MeshAgent"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>Conexão SFTP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternar Porta</a></ul></div><span id=p13Status>Desconectado</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Execute ações de energia no dispositivo"value=Ações onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="O servidor está gravando esta sessão"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Cima onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Selecionar tudo"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value=Renomear onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Excluir onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=Editar onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Nova pasta"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value=Carregar onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Baixar onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Recortar onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Copiar onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value=Colar onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value=Zip onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Unzip onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=Atualizar onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=Encontrar onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabytes<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Classificar por nome<option value=2>Ordenar por tamanho<option value=3>Classificar por data<option value=4>Decrescente pelo nome<option value=5>Decrescente por tamanho<option value=6>Decrescente por data</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Tela cheia. Segure a tecla shift para tela inteira do navegador."></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Informações sobre o \&quot;Core\&quot; atual em execução neste agente"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Ação do Agente"onclick=p15uploadCore(event) title="Alterar o módulo Java Script do agente"> <i onclick=p15downloadConsoleText() title="Baixar o texto do console"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agente<option id=p15outputselect3 value=3>Push<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Apagar onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventos - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Filtro</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label class=me-1 for=p16limitdropdown>Mostrar</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Baixar eventos"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Detalhes - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Mostra o uso da CPU e da memória do dispositivo."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Gráfico em tempo real</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Plugins - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Em geral - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Resumo - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Estados de energia</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Tipos de agente</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Conectividade</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Segurança</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Em geral - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventos - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Filtro</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p31limitdropdown class=me-1>Mostrar</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000<option notransval=1 value="">Sem limite</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Baixar eventos"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Estatísticas do Meu servidor</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Atualizar type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Log-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Conexões<option value=1>Memória<option value=5>CPU<option value=3>Tráfego de entrada<option value=4>Tráfego de saída</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Últimas 3 horas<option value=8>Últimas 8 horas<option value=24>Último dia<option value=168>Semana Anterior<option value=720>Últimos 30 dias</select> <i class="fa-solid fa-download"title="Baixar pontos de dados (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Meus Rastreamentos</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Rastreamento type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Nenhum</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Mostrar</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Últimos 100<option value=250>Últimos 250<option value=500>Últimos 500<option value=1000>Últimos 1000</select> <input value=Apagar type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Baixar rastreamento (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Plugins do Meu Servidor</h1><div class=areaHead><div class=toright2></div><div><input value="Baixe o plugin"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Atualizar \&quot;Core\&quot; do agente"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Aviso:</b> Os plug-ins foram alterados; isso pode exigir a atualização do \"Core\" do agente.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Nome<th class=chDescription>Descrição<th class=chSite style=text-align:center>Link<th class=chVersion style=text-align:center>Versão<th class=chUpgradeAvail style=text-align:center>Mais recente<th class=chStatus style=text-align:center>Status<th class=chAction style=text-align:center>Açao<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Nenhum plug-in no servidor.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Voltar onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Plugins do Meu Servidor - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Meus Grupos de Usuários</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Selecionar tudo"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Ação do Grupo"onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Novo grupo..."> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value="Duplicar Grupo..."></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Voltar onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Grupo de usuários - <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Minhas gravações de usuário</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=Atualizar></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Abrir player ..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Meus Relatórios</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Baixar relatório"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Gerar relatório...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Verificar e-mail</a> &nbsp;<a id=termsLinkFooter href=terms>Termos e Privacidade</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Seleção de arquivo</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Carregar Arquivo Local<option value=2>Seleção de arquivo do servidor</select></div><div id=d3localmode style=display:none><div>Carregar Arquivo</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Cima>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value=Embrulhar onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Pequeno onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Cru onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agente</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Qualidade</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Dimensionamento</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87,5%<option value=768>75%<option value=640>62,5%<option value=512>50%<option value=384>37,5%<option value=256>25%<option value=128>12,5%</select></div><div><div>Taxa de quadros</div><select id=d7framelimiter dir=rtl><option selected value=50>Rápido<option value=100>Médio<option value=400>Lento<option value=1000>Muito lento</select></div><div><div>Codificação</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Outros ajustes</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Trocar botões do mouse</label> <label style=display:block><input type=checkbox id=d7deskrmw>Roda reversa do mouse</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Use o mapa do teclado remoto</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Área de Transferência Automática</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Bloquear ao Desconectar</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Codificação de imagem</div><select id=d7desktopmode><option value=1>RLE8, mais rápido<option value=2>RLE16, recomendado<option value=3>RAW8, lento<option value=4>RAW16, muito lento</select></div><div><div>Outros ajustes</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Mostrar ferramenta de foco</label> <label style=display:block><input type=checkbox id=d7showcursor>Mostrar o cursor do mouse local</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Mapa de teclado local</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Roda reversa do mouse</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Tamanho de exibição</div><select id=d7rdpsize><option notransval=1 value=canvas>Tamanho da tela<option notransval=1 value=browser>Tamanho do navegador<option notransval=1 value=screen>Tamanho da tela<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Opções</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Desativar papel de parede</label> <label style=display:block><input type=checkbox id=d7rdp2>Desabilitar arrastar janela cheia</label> <label style=display:block><input type=checkbox id=d7rdp3>Desativar animações de menu</label> <label style=display:block><input type=checkbox id=d7rdp4>Desativar temas</label> <label style=display:block><input type=checkbox id=d7rdp6>Desativar sombra do cursor</label> <label style=display:block><input type=checkbox id=d7rdp7>Desabilitar as configurações do cursor</label> <label style=display:block><input type=checkbox id=d7rdp8>Ativar suavização de fonte</label> <label style=display:block><input type=checkbox id=d7rdp9>Ativar composição da área de trabalho</label> <label style=display:block><input type=checkbox id=d7rdpclip>Área de Transferência Automática</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Trocar botões do mouse</label> <label style=display:block><input type=checkbox id=d7rdprmw>Roda reversa do mouse</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Cancelar</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Excluir</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Meus Dispositivos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Minha conta</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>Meus Eventos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>Meus Arquivos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>Meus Usuários</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Meu Servidor</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Sair</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>"use strict";var args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(var i in""!=webState&&(webState=JSON.parse(decodeURIComponent(webState))),null!=webState&&"object"==typeof webState||(webState={}),webState)if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Ligado","Hibernar","Hibernar","Hibernar","Hibernando","Desligar","Presente"],StatusStrs=["Desconectado","Conectando ...","Configurando...","Conectado","Intel&reg; AMT conectado"],agentsStr=["Desconhecido","Console do Windows 32 bits","Console do Windows 64 bits","Serviço Windows 32 bits","Serviço Windows 64 bits","Linux 32 bits","Linux 64 bits","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Console Windows MinCore","Serviço Windows MinCore","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64 bits","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Desconhecido","Linux ARM de 64 bits (glibc / 2.24 NOKVM)","Alpine Linux x86 de 64 bits (MUSL)","Assistente (Windows)","Armada370 - ARM32 / HF (libc / 2.26)","OpenWRT x86-64","OpenBSD x86-64","Desconhecido","Desconhecido","MIPSEL24KC (OpenWRT)","ARMADA / CORTEX-A53 / MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service","ARMVIRT32 (OpenWRT)","RISC-V 64bit"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Maçã"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=!!(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui="{{{customui}}}";customui=""!=customui?JSON.parse(decodeURIComponent(customui)):null;var deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null;null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder);var installedPluginList=null,goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(!(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}(null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodevicername,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale)||null!=(s=getstore("loctag",0))&&"*"!=s&&(args.locale=s);debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var t=0,o=parseInt("{{{hide}}}");(o||args.hide)&&(args.hide&&(t=parseInt(args.hide)),o&&(t|=o)),args.hide=t,QV("uiViewButton5",!(4&args.hide)),adjustPanels();var n="";logoutControls&&(null!=logoutControls.name&&(n='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Bem-vindo(a) {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl&&(n+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Sair</a>'))),1&args.hide?QH("logoutControlSpan2",n):QH("logoutControlSpan",n),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",!!(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",!(2097152&features)),mainUpdate(3);for(var a=1;a<5;a++)Q("devViewButton"+a).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);var i=null;try{i=localStorage.getItem("desktopsettings")}catch(e){}null!=i&&(desktopsettings=JSON.parse(i)),i=null;try{i=localStorage.getItem("multidesktopsettings")}catch(e){}null!=i&&(multidesktopsettings=JSON.parse(i)),applyDesktopSettings();for(var s="",r=1;r<27;r++)s+="<option value='"+r+"'>Ctrl-"+String.fromCharCode(64+r)+" ("+r+")</option>";QH("specialkeylist",s),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",!(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var l=document.getElementsByClassName("topbar_td");for(var d in l)l[d].innerHTML&&(l[d].innerHTML=l[d].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){s="";for(var d in customui.devicesbarbuttons){var c="one"==customui.devicesbarbuttons[d].selection||"many"==customui.devicesbarbuttons[d].selection?"disabled":"";s+='<input id="cui:'+d+'" type="button" value="'+customui.devicesbarbuttons[d].name+'" '+c+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",s)}if(customui.desktopbuttons){s="";for(var d in customui.desktopbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.desktopbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",s)}if(customui.terminalbuttons){s="";for(var d in customui.terminalbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.terminalbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",s)}if(customui.filesbuttons){s="";for(var d in customui.filesbuttons)s+='<input id="cui:'+d+'" type="button" value="'+customui.filesbuttons[d].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",s)}}sessionTime>=10&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var u=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var d in u)""!=u[d]&&deskKeyboardShortcuts.push(parseInt(u[d]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",!(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Digite"),QV("ScrollToTopButton",!!(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){var o=e.srcElement.id;if(0!=o.startsWith("cui:")){var n=customui[t][o.substring(4)];if(null!=n){if("devicesbarbuttons"==t){for(var a=document.getElementsByClassName("DeviceCheckbox"),i=[],s=0;s<a.length;s++)!0===a[s].checked&&i.push(a[s].defaultValue.substring(6));if("string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:o.substring(4),selectedDevices:i,logmsg:n.logmsg}),n.action.startsWith("dialog:")&&showCustomUiDialog(n.action.substring(7),{section:t,element:o.substring(4),selectedDevices:i}),n.deselectdevices)){for(s=0;s<a.length;s++)a[s].checked=!1;checkedNodeids={},p1updateInfo()}}if("devicebuttons"==t||"desktopbuttons"==t||"terminalbuttons"==t||"filesbuttons"==t){i=[currentNode._id];"string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:o.substring(4),selectedDevices:i,logmsg:n.logmsg}),n.action.startsWith("dialog:")&&showCustomUiDialog(n.action.substring(7),{section:t,element:o.substring(4),selectedDevices:i}))}}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var o="",n=customui.dialogs[e];if("string"==typeof n.text&&(o+="<div style=margin-bottom:8px>"+n.text+"</div>"),"number"==typeof n.buttons&&n.buttons,"object"==typeof n.elements)for(var a in n.elements){var i=n.elements[a];if("text"==i.type&&(o+=addHtmlFormFloating(i.name,"<input id=cui:"+a+" class=form-control autocomplete=off />")),"textarea"==i.type&&(null==i.name?o+="<textarea id=cui:"+a+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":o+=addHtmlFormFloating(i.name,"<textarea id=cui:"+a+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==i.type){var s="";for(var r in i.options)s+='<option value="'+r+'">'+EscapeHtml(i.options[r])+"</option>";o+=addHtmlFormFloating(i.name,'<select id="cui:'+a+'" class=form-select autocomplete=off />'+s+"</select>")}}setModalContent("xxAddAgent",n.title,o),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:n.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var o=customui.dialogs[t.element];if("object"==typeof o.elements)for(var n in o.elements){var a=o.elements[n];"droplist"!=a.type&&"textarea"!=a.type&&"text"!=a.type||(t.values[n]=Q("cui:"+n).value)}if(meshserver.send(t),o.deselectdevices){var i=document.getElementsByClassName("DeviceCheckbox");for(n=0;n<i.length;n++)i[n].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide;0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px"));var t=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),o=uiMode>1?24:0;QS("p2info").height="calc(100vh - "+(20+t+o)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+t)+"px)",QS("p3events").height="calc(100vh - "+(50+t)+"px)",QS("p5filetable").height="calc(100vh - "+(99+t)+"px)",QS("p13filetable").height="calc(100vh - "+(127+t+o)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+t+o)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+t+o)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+t)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+t+o)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+t+o)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+t+o)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+t+o)+"px)";var n=!(0===args.xterm||null!=terminal&&null==xterm);fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,n&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+t+o)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+t+o)+"px)",QS("p14iframe").height="calc(100vh - "+(23+t+o)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+t+o)+"px)",n&&(QS("termarea3x").height="calc(100vh - "+(74+t+o)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+t+o)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+t)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+t)+"px)",QS("p6info").height="calc(100vh - "+(-50+t+o)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(-50+t+o)+"px)",QS("p10info").height="calc(100vh - "+(20+t+o)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p17info").height="calc(100vh - "+(20+t+o)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p20main").height="calc(100vh - "+(-50+t+o)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(-50+t+o)+"px)",QS("p21main").height="calc(100vh - "+(20+t+o)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p30info").height="calc(100vh - "+(20+t+o)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p51info").height="calc(100vh - "+(20+t+o)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+t+o)+"px)",QS("p16events").height="calc(100vh - "+(50+t+o)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+t+o)+"px)",QS("p31events").height="calc(100vh - "+(50+t+o)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+t+o)+"px)",QS("p41events").height="calc(100vh - "+(48+t+o)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+t+o)+"px)",QS("p52recordings").height="calc(100vh - "+(48+t+o)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+t+o)+"px)",QS("p60report").height="calc(100vh - "+(48+t+o)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+t+o)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),xxcurrentView>=10&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=uiMode>1,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&xxcurrentView>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){if(!xxdialogMode){var e=getstore("nightMode","0"),t="<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Navegador padrão</label><br>";t+="<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Modo claro</label><br>",xxdialogButtons=3,setModalContent("xxAddAgent","Modo noturno",t+="<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Modo escuro</label><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1)}}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),Q("night2").checked&&(e="2"),putstore("nightMode",e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,1048576&features2&&(e="1"),2097152&features2&&(e="2"),"1"==e?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){const t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),xxcurrentView>=10&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),xxcurrentView>=10&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;if(Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e){putstore("uiViewMode",e);var t=new URL(window.location.href);t.searchParams.has("sitestyle")&&(t.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,t.toString())),reload()}}function toggleBootstrapUIMode(){if(!xxdialogMode){var e=getstore("uiViewMode",3),t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==e?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>";setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1)}}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;e.endsWith("/#")&&(e=e.substring(0,e.length-2)),e.endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,o,n){if(0==t){if(setDialogMode(0),go(0),powerTimeline=null,powerTimelineReq=null,powerTimelineNode=null,powerTimelineUpdate=null,deviceShares=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==n)return void QH("p0span","Não foi possível realizar autenticação");if("invalidorigin"==n)return void QH("p0span","Invalid origin in HTTP request");2==o?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Não foi possível conectar web socket"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null)}else 2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView&&refreshServerTimelineStats())}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}e||(e=new XMLHttpRequest),e.open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return e.indexOf("WINDOWS")>=0||e.indexOf("WIN32")>=0||e.indexOf("WIN64")>=0}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,o=4294967295!=t&&!!(1024&t)||!!(256&features2);QV("p2AccountSecurity",!(4&features||0!=serverinfo.domainauth||!(4096&features)||0!=o)),QV("p2AccountActions",!o),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",!(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!o),QV("p2ServerActions",21&t&&!!(143&e)),QV("LeftMenuMyServer",21&t&&!!(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&!!(1&e)),QV("p2ServerActionsRestore",4&t&&!!(2&e)),QV("p2ServerActionsVersion",16&t&&!!(4&e)),QV("p2ServerActionsErrors",16&t&&!!(8&e)),QV("p2ServerActionsConfig",16&t&&!!(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),8&t||5!=xxcurrentView||(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",2&userinfo.siteadmin?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(users=null,wssessions=null,mainUpdate(16384),(4==xxcurrentView||xxcurrentView>=30&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&!!(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&!!(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6!=xxcurrentView||21&userinfo.siteadmin||go(1),21&t&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){webpSupport=t,t||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView&&p21updateMesh()),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){if(null==userinfo)return-1;var e=0;return 1==userinfo.otpsecret&&e++,1==userinfo.otpduo&&e++,1==userinfo.otpdev&&e++,userinfo.otphkeys>0&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,e>0&&userinfo.otpkeys>0&&!(262144&features2)&&e++,e}var backupCodesWarningDone=!1;function updateSelf(){var e=count2factoraAuths(),t=4294967295!=userinfo.siteadmin&&!!(1024&userinfo.siteadmin);QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==t),QV("manageOtp",1!=serverinfo.lock2factor&&e>0&&!(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&!!(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",!(1==serverinfo.lock2factor||1!=userinfo.otpsecret&&131072&features2)),QV("manageDuoApp",1!=serverinfo.lock2factor&&!!(536870912&features2)),QV("authKeySetupCheck",userinfo.otphkeys>0),QV("authPushAuthDevCheck",userinfo.otpdev>0&&!!(64&features2)),QV("authCodesSetupCheck",userinfo.otpkeys>0),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&e>0),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0!=backupCodesWarningDone||1!=e||524288&features2||(addNotification({text:"Por favor, adicione códigos de backup par 2FA. Se o 2FA for perdido, não há como recuperar essa conta.",title:"Autenticação de dois fatores",tag:"backupcodes"}),backupCodesWarningDone=!0);var o=4294967295==userinfo.siteadmin||!(64&userinfo.siteadmin);if(QV("p2createMeshLink1",o),QV("p2createMeshLink2",o),QV("getStarted1",o),QV("getStarted2",!o),"number"==typeof userinfo.passchange)if(-1==userinfo.passchange)QH("p2nextPasswordUpdateTime"," - Reinicie no próximo login.");else if(null!=passRequirements&&"number"==typeof passRequirements.reset){var n=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3);if(n<0)QH("p2nextPasswordUpdateTime"," - Reinicie no próximo login.");else if(n<3600){var a=Math.floor(n/60);QH("p2nextPasswordUpdateTime",format(1==a?" - Reinicie em 1 minuto.":" - Reinicie em {0} minutos.",a))}else if(n<86400){var i=Math.floor(n/3600);QH("p2nextPasswordUpdateTime",format(1==i?" - Reinicie em 1 hora.":" - Reinicie em {0} horas.",i))}else{var s=Math.floor(n/86400);QH("p2nextPasswordUpdateTime",format(1==i?" - Reinicie em 1 dia.":" - Reinicie em {0} dias.",s))}}QV("MainMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("LeftMenuMyUsers",null!=users&&!(4&features)||!!(512&userinfo.siteadmin)&&!!(134217728&features)),QV("UsersGeneral",null!=users&&!(4&features)),QV("UsersGroups",null!=users&&!(4&features)),QV("UsersRecordings",!!(512&userinfo.siteadmin)&&!!(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;if(e>serverinfo.timeout)null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutonidlesessiontimeout&&(window.location.href="logout");else{var t=Math.round((serverinfo.timeout-e)/1e3),o=null!=desktop||null!=terminal||null!=files,n=serverinfo.logoutonidlesessiontimeout||o,a=serverinfo.logoutonidlesessiontimeout,i="";t<=60?i=a?1==t?"1 segundo até o logout":"{0} segundos até o logout":1==t?"1 segundo até desconectar":"{0} segundos até desconectar":(t=Math.round(t/60))<=5&&(i=a?1==t?"1 minuto até o logout":"{0} minutos até o logout":1==t?"1 minuto até desconectar":"{0} minutos até desconectar"),QH("idleTimeoutNotify",n&&i?"<br />"+format(i,t):"")}}function onMessage(e,t){switch(t.action){case"trace":serverTrace.unshift(t),displayServerTrace();break;case"intersession":"removeNotify"==t.subaction&&notificationDelete(t.id);break;case"traceinfo":"object"==typeof t.traceSources&&(null!=t.traceSources&&t.traceSources.length>0?(serverTraceSources=t.traceSources,QH("p41traceStatus",EscapeHtml(t.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nenhum")));break;case"serverstats":updateGeneralServerStats(t);break;case"serverwarnings":if(null!=t.warnings&&t.warnings.length>0){var o={1:"",2:"Parâmetros WebDAV ausentes.",3:'Opção de configuração "{0}". não reconhecida ',4:"Compressão WebSocket desabilitada, este recurso está com falha no NodeJS v11.11 ao v12.15 e v13.2",5:"Incapaz de carregar o certificado raiz para o domínio padrão do Intel AMT TLS",6:"Incapaz de carregar o certificado raiz para o domínio {0} do Intel AMT TLS",7:"FQDN CIRA local ignorado quando o servidor estiver nos modos Lan-only ou Wan-only",8:"Não pode ter mais que 4 FQDN CIRA locais. Ignorando valores.",9:"O hash do agent foi ignorado, falha de segurança.",10:"Endereço de e-mail Let's Encrypt ausente.",11:"Nome do host Let's Encrypt inválido.",12:"Nomes Let's Encrypt inválidos, não pode contar um *.",13:"Incapaz de configurar o módulo Let's Encrypt.",14:"Nomes Let's Encrypt inválidos, incapaz de resolver: {0}",15:"Endereço de e-mail do Let's Encrypt inválido, incapaz de resolver: {0}",16:"Incapaz de carregar a lista de endereços do proxy confiável IPv6 da CloudFlare",17:"O servidor SendGrid tem uso limitado no modo LAN.",18:"O servidor SMTP tem uso limitado em modo LAN",19:"O gateway SMS tem uso limitado em modo LAN.",20:'"LoginCookieEncryptionKey" inválido no config.json.',21:"O caminho do backup não pode ser definido dentro da pasta meshcentral-data, configuração de Backup ignorada.",22:"Falha ao assinar o agente {0}: {1}",23:"Unable to load agent icon file: {0}.",24:"Unable to load agent logo file: {0}.",25:"This NodeJS version does not support OpenID.",26:"This NodeJS version does not support Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},n="";for(var a in t.warnings){if("string"==typeof(s=t.warnings[a]))n+="<div style=color:red;padding-bottom:6px><b>AVISO:"+s+"</b></div>";else null==(l=o[s.id])?l=s.msg:null!=s.args&&(l=format(l,...s.args)),n+="<div style=color:red;padding-bottom:6px><b>AVISO:"+l+"</b></div>"}QH("serverWarnings",n),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(t.events);break;case"authcookie":authCookie=t.cookie,authRelayCookie=t.rcookie;break;case"serverinfo":if((serverinfo=t.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire){var i=Math.floor((serverinfo.certExpire-Date.now())/864e5);i>=0&&i<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>AVISO:"+format("O certificado expira em {0} dia (s)",i)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("O certificado expira em {0} dia (s)",i)}))}if(serverinfo.preConfiguredRemoteInput){n="";for(var a in serverinfo.preConfiguredRemoteInput)n+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+a+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[a].name)+"</div>";""!=n&&(n+="<hr />"),QH("deskPreConfigShortcutContextMenu1",n)}if(serverinfo.preConfiguredScripts){n="";var s="";for(var a in serverinfo.preConfiguredScripts){var r=serverinfo.preConfiguredScripts[a],l='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+a+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[a].name)+"</div>";3!=r.type&&(n+=l),r.type>=3&&(s+=l)}QH("deskPreConfigScriptContextMenu1",n),QH("deskPreConfigScriptContextMenu2",s)}break;case"userinfo":userinfo=t.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var d in users={},t.users)users[t.users[d]._id]=t.users[d];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=t.wssessions,mainUpdate(16384);break;case"meshes":for(var d in meshes={},t.meshes)meshes[t.meshes[d]._id]=t.meshes[d];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var c=0;if(Array.isArray(t.ugroups)){for(var a in usergroups={},t.ugroups)c++,usergroups[t.ugroups[a]._id]=t.ugroups[a];0==c&&(usergroups=null)}else{for(var a in usergroups=t.ugroups,t.ugroups)c++,t.ugroups[a]._id=a;0==c&&(usergroups=null)}mainUpdate(8192);break;case"files":filetree=setupBackPointers(t.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var d in nodes=[],t.nodes)for(var u in t.nodes[d])null!=t.nodes[d][u]._id?(null==t.nodes[d][u].name&&(t.nodes[d][u].name="???"),t.nodes[d][u].namel=t.nodes[d][u].name.toLowerCase(),t.nodes[d][u].rname?t.nodes[d][u].rnamel=t.nodes[d][u].rname.toLowerCase():t.nodes[d][u].rnamel=t.nodes[d][u].namel,t.nodes[d][u].meshnamel=meshes[d]?meshes[d].name.toLowerCase():"*",t.nodes[d][u].meshid=d,t.nodes[d][u].state=t.nodes[d][u].state?t.nodes[d][u].state:0,t.nodes[d][u].icon||(t.nodes[d][u].icon=1),t.nodes[d][u].ident=++nodeShortIdent,nodes.push(t.nodes[d][u])):console.log("Invalid node ("+u+"): "+JSON.stringify(t.nodes));for(var a in stars)null==getNodeFromId(a)&&delete stars[a];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==t.totalcount?null:{total:t.totalcount,skip:t.skip,limit:t.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(t.nodeid!=powerTimelineReq)break;for(var a in powerTimelineNode=t.nodeid,powerTimeline=t.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)a%2==1&&(powerTimeline[a]=1e3*powerTimeline[a]);currentNode._id==t.nodeid&&mainUpdate(256);break;case"deviceShares":if(t.nodeid!=deviceSharesReq)break;deviceSharesNode=t.nodeid,deviceShares=t.deviceShares,null!=currentNode&&currentNode._id==t.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":if(t.meshid!=deviceSharesReq)break;deviceSharesNode=t.meshid,deviceShares=t.deviceShares,null!=currentMesh&&currentMesh._id==t.meshid&&p20updateMesh();break;case"getsysinfo":if(t.nodeid!=powerTimelineReq)break;!0===t.noinfo?updateDeviceDetails(getNodeFromId(t.nodeid)):updateDeviceDetails(getNodeFromId(t.nodeid),t.hardware);break;case"lastconnect":null!=(ae=getNodeFromId(t.nodeid))&&(ae.lastconnect=t.time,ae.lastaddr=t.addr,currentNode._id==ae._id&&""==Q("MainComputerState").innerHTML&&null!=ae.lastconnect&&QH("MainComputerState","<span>Visto pela última vez:<br />"+printDateTime(new Date(ae.lastconnect))+"</span>"));break;case"lastconnects":var p=Object.keys(t.lastconnects);for(var a in p){var m=p[a];null!=(ae=getNodeFromId(m))&&(ae.lastconnect=t.lastconnects[m])}mainUpdate(4);case"msg":if(null!=t.nodeid){var g=-1;if(null!=nodes)for(var a in nodes)if(nodes[a]._id==t.nodeid){g=a;break}if(-1!=g)if("cpuinfo"===t.type&&null!=currentNode&&currentNode._id==t.nodeid){var v=Date.now()/1e3,h=0,f=0;"number"==typeof t.cpu.total&&(h=t.cpu.total),"number"==typeof t.memory.percentConsumed&&(f=t.memory.percentConsumed),deviceDetailsStatsData.push([v,h,f]),deviceDetailsStatsDraw(t)}else if("console"===t.type)p15consoleReceive(nodes[g],t.value,t.source);else if("notify"===t.type){if(!(8&(u=getstore("notifications",0)))&&null!=t.amtMessage)break;u={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.nodeid&&(u.nodeid=t.nodeid),null!=t.tag&&(u.tag=t.tag),null!=t.url&&(u.url=t.url),null!=t.username&&(u.username=t.username),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u)}else if("ps"===t.type)showDeskToolsProcesses(t);else if("services"===t.type)showDeskToolsServices(t);else if("service"===t.type)showServiceDetailsDialog(t);else if("getclip"===t.type&&null!=currentNode&&currentNode._id==t.nodeid)1==t.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=t.data:2===t.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(t.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===t.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==t.nodeid)QH("dlgClipStatus",t.success?"<span style=color:green>Sucesso</span>":"<span style=color:red>Fracassado</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===t.type&&null!=currentNode&&currentNode._id===t.nodeid&&null==desktop){var x=[];if(null!=t.data)for(var a in t.data)"Active"!=t.data[a].State&&"Connected"!=t.data[a].State&&"Console"!=t.data[a].StationName&&3!=debugmode||x.push(t.data[a]);if(0===x.length)connectDesktop(null,1,null,t.tag);else if(1===x.length)connectDesktop(null,1,x[0].SessionId,t.tag);else{n="";var k="{{{userSessionsSort}}}";for(var a in x.sort(function(e,t){return e[k]?t[k]?e[k]<t[k]?-1:e[k]>t[k]?1:0:1:-1}),x)n+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+x[a].SessionId+","+t.tag+")>"+x[a].State+(x[a].StationName?", "+x[a].StationName:""),x[a].Username&&(x[a].Domain?n+=" - "+x[a].Domain+"/"+x[a].Username:n+=" - "+x[a].Username),n+="</div>";QH("p11DeskSessionSelector",n),QV("p11DeskSessionSelector",!0)}}else if("psinfo"===t.type){if(xxdialogTag==="ps|"+t.nodeid+"|"+t.pid){n="<div style=max-height:200px;overflow-y:auto>";"object"==typeof t.value&&Object.keys(t.value).length>0?(t.value=jsonToCamel(t.value),!t.value.cmd&&t.value.path&&(t.value.cmd=t.value.path),!t.value.processUser&&t.value.userName&&(t.value.processUser=t.value.userName.split("\\")[1]),!t.value.processDomain&&t.value.userName&&(t.value.processDomain=t.value.userName.split("\\")[0]),t.value.processName&&(n+="<div style=padding:4px><div style=padding-bottom:4px>Nome do processo</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.processName+"</b></div></div>"),t.value.machineName&&(n+=addHtmlValue5("Nome da maquina",t.value.machineName)),t.value.cmd&&(n+="<div style=padding:4px><div style=padding-bottom:4px>Linha de comando</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.cmd+"</b></div></div>"),t.value.mainWindowTitle&&(n+="<div style=padding:4px><div style=padding-bottom:4px>Título da janela</div><div style=word-wrap:break-word;padding-left:6px><b>"+t.value.mainWindowTitle+"</b></div></div>"),t.value.processUser&&(n+=addHtmlValue5("Usuário",t.value.processUser)),t.value.processDomain&&(n+=addHtmlValue5("Domínio",t.value.processDomain)),t.value.startTime&&(n+=addHtmlValue5("Hora de início",t.value.startTime)),n+="<hr />",t.value.PriorityBoostEnabled&&(n+=addHtmlValue5("Aumento de prioridade",t.value.PriorityBoostEnabled?"Habilitado ":"Desabilitado")),t.value.sessionId&&(n+=addHtmlValue5("Identificação de sessão",t.value.sessionId)),t.value.handleCount&&(n+=addHtmlValue5("Contador de Gerencia",t.value.handleCount)),t.value.privilegedProcessorTime&&(n+=addHtmlValue5("Tempo privilegiado do processador",format("{0} segundos",t.value.privilegedProcessorTime))),t.value.totalProcessorTime&&(n+=addHtmlValue5("Tempo total do processador",format("{0} segundos",t.value.totalProcessorTime))),t.value.userProcessorTime&&(n+=addHtmlValue5("Tempo do processador do usuário",format("{0} segundos",t.value.userProcessorTime))),t.value.nonpagedSystemMemorySize&&(n+=addHtmlValue5("Memória Não Paginada",getNiceSize2(t.value.nonpagedSystemMemorySize))),t.value.pagedMemorySize&&(n+=addHtmlValue5("Memória Paginada",getNiceSize2(t.value.pagedMemorySize))),t.value.privateMemorySize&&(n+=addHtmlValue5("Memória Privada",getNiceSize2(t.value.privateMemorySize))),t.value.virtualMemorySize&&(n+=addHtmlValue5("Memória virtual",getNiceSize2(t.value.virtualMemorySize))),t.value.workingSet&&(n+=addHtmlValue5("Conjunto de trabalho",getNiceSize2(t.value.workingSet))),t.value.peakWorkingSet&&(n+=addHtmlValue5("Pico de Trabalhos",getNiceSize2(t.value.peakWorkingSet))),t.value.peakPagedMemorySize&&(n+=addHtmlValue5("Pico de memória paginada",getNiceSize2(t.value.peakPagedMemorySize))),t.value.peakVirtualMemorySize&&(n+=addHtmlValue5("Pico de Memória Virtual",getNiceSize2(t.value.peakVirtualMemorySize)))):n+="Nenhuma informação fornecida",n+="</div>",QH("id_dialogOptions",n)}}else"deskBackground"===t.type&&(""!=t.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else if("notify"===t.type){u={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.tag&&(u.tag=t.tag),null!=t.url&&(u.url=t.url),null!=t.username&&(u.username=t.username),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u)}break;case"getnetworkinfo":if(currentNode._id!=t.nodeid)return;if(updateDeviceDetails(getNodeFromId(t.nodeid),null,t),2==xxdialogMode&&xxdialogTag=="if"+t.nodeid){n="<div class=dialogText>";if(currentNode.lastconnect&&(n+=addHtmlValue2("Última conexão do agente",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr){var b=currentNode.lastaddr.split(":");b.length>2?n+=addHtmlValue2("Último endereço do agente",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?n+=addHtmlValue2("Último endereço do agente",b[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(b[0])+'")></i>'):n+=addHtmlValue2("Último endereço do agente",'<a href="https://iplocation.com/?ip='+b[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+b[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(b[0])+'")></i>')}if(null!=t.updateTime&&(n+=addHtmlValue2("Última atualização de interfaces",printDateTime(new Date(t.updateTime)))),null!=t.netif)for(var a in t.netif){n+="<hr />",(y=t.netif[a]).name&&(n+=addHtmlValue2("Nome","<b>"+EscapeHtml(y.name)+"</b>")),y.desc&&(n+=addHtmlValue2("Descrição",EscapeHtml(y.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),y.dnssuffix&&(n+=addHtmlValue2("Sufixo DNS",EscapeHtml(y.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar o nome para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.dnssuffix)+'")></i>')),y.mac&&(n+=addHtmlValue2("Endereço MAC",'<a href="https://maclookup.app/search/result?mac='+y.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copie o endereço MAC para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.mac.toLowerCase())+'")></i>')),y.v4addr&&(n+=addHtmlValue2("Endereço IPv4",EscapeHtml(y.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4addr)+'")></i>')),y.v4mask&&(n+=addHtmlValue2("Máscara IPv4",EscapeHtml(y.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4mask)+'")></i>')),y.v4gateway&&(n+=addHtmlValue2("Gateway IPv4",EscapeHtml(y.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.v4gateway)+'")></i>')),y.gatewaymac&&(n+=addHtmlValue2("Gateway MAC",'<a href="https://maclookup.app/search/result?mac='+y.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copie o endereço MAC para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y.gatewaymac.toLowerCase())+'")></i>'))}else if(null!=t.netif2)for(var a in t.netif2){var y=t.netif2[a];if(!(0==Array.isArray(y)||y.length<1||null==y[0]||"string"==typeof y[0].mac&&y[0].mac.startsWith("00:00:00:00"))){n+="<hr />",n+=addHtmlValue2("Nome","<b>"+EscapeHtml(a)+"</b>"),"string"==typeof y[0].mac&&(n+=addHtmlValue2("Endereço MAC",'<a href="https://maclookup.app/search/result?mac='+y[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(y[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copie o endereço MAC para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(y[0].mac.toLowerCase())+'")></i>')),y[0].fqdn&&(n+=addHtmlValue2("FQDN",y[0].fqdn));for(var w=0;w<y.length;w++){var C=y[w];"IPv6"==C.family?(C.address&&(n+=addHtmlValue2("Endereço IPv6",EscapeHtml(C.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.address)+'")></i>')),C.netmask&&(n+=addHtmlValue2("Máscara IPv6",EscapeHtml(C.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.netmask)+'")></i>')),C.gateway&&(n+=addHtmlValue2("Gateway IPv6",EscapeHtml(C.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.gateway)+'")></i>'))):"IPv4"==C.family&&(C.address&&(n+=addHtmlValue2("Endereço IPv4",EscapeHtml(C.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.address)+'")></i>')),C.netmask&&(n+=addHtmlValue2("Máscara IPv4",EscapeHtml(C.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.netmask)+'")></i>')),C.gateway&&(n+=addHtmlValue2("Gateway IPv4",EscapeHtml(C.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar endereço para a área de transferência" onclick=copyTextToClip2("'+encodeURIComponentEx(C.gateway)+'")></i>')))}}}else n+="<hr />",n+="Nenhuma informação de interface de rede disponível para este dispositivo.";n+="</div>",QH("d2netinfo",n)}break;case"serverversion":if(2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag){n="<div class=dialogText>";t.tags.current||(t.tags.current="Desconhecido"),t.tags.stable||(t.tags.stable="Desconhecido"),t.tags.latest||(t.tags.latest="Desconhecido"),n+=addHtmlValue2("Versão Atual","<b>"+EscapeHtml(t.tags.current)+"</b>"),n+="<hr />",n+=addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Desconhecido"!=t.tags.stable&&t.tags.current!=t.tags.stable&&2048&features?"":" disabled")+" /> Versão estável</label>","<b>"+EscapeHtml(t.tags.stable)+"</b>"),n+=addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Desconhecido"!=t.tags.latest&&t.tags.current!=t.tags.latest&&2048&features?"":" disabled")+" /> Última versão</label>","<b>"+EscapeHtml(t.tags.latest)+"</b>"),n+="</div>",(t.tags.current!=t.tags.latest||t.tags.current!=t.tags.stable)&&2048&features?(n+="<hr />Marque e clique em OK para iniciar a atualização automática do servidor.",xxdialogTag=t.tags,setModalContent("xxAddAgent","Versão MeshCentral",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,t.tags)}),server_showVersionDlgUpdate()):(setModalContent("xxAddAgent","Versão MeshCentral",n),showModal("xxAddAgentModal","idx_dlgOkButton"))}break;case"servererrors":if(2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag)if(null==t.data)setModalContent("xxAddAgent","Server Errors","O servidor não tem log de erros."),showModal("xxAddAgentModal","idx_dlgOkButton");else{n='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(t.data)+"</pre></div>";n+='<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Baixar log de erros" onclick=d2CopyServerErrorsToClip()></i></div>',setModalContent("xxAddAgent","Erros do servidor MeshCentral",n+='<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Verifique e clique em OK para Apagar o log de erros.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()}break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==t.data?setModalContent("xxAddAgent","Server Configuration","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuration",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=t.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",t.value);break;case"events":null!=t.nodeid&&null!=currentNode&&t.nodeid==currentNode._id?(currentDeviceEvents=t.events,mainUpdate(1024)):null!=t.userid&&null!=currentUser&&t.userid==currentUser._id?(currentUserEvents=t.events,mainUpdate(2048)):(events=t.events,mainUpdate(32));break;case"recordings":p52recordings=t.events,null!=t.error&&(p52recordings=t.error),updateRecordings();break;case"getcookie":if("MCRouter"==t.tag){(-1==(ue=serverinfo.name).indexOf(".")||2&features)&&(ue=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var M="mcrouter://"+ue+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:"");null!=t.nodeid&&(M+="&nodeid="+t.nodeid),null!=t.tcpport&&(M+="&protocol=1&remoteport="+t.tcpport),t.localRelay&&(M+="&local=1"),t.localport&&(M+="&localport="+t.localport),null!=t.name&&(M+="&name="+encodeURIComponentEx(t.name)),null!=t.ip&&(M+="&remoteip="+t.ip),downloadFile(M+="&appid="+t.protocol+"&autoexit=1","")}else if("novnc"==t.tag){var S=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(t.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+t.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}";null!=(ae=getNodeFromId(t.nodeid))&&(S+="&name="+encodeURIComponentEx(ae.name)),safeNewWindow(S,"mcnovnc/"+t.nodeid)}else if("mstsc"==t.tag){var A=window.location.origin+domainUrl+"mstsc.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ae=getNodeFromId(t.nodeid))&&(A+="&name="+encodeURIComponentEx(ae.name)),t.localRelay&&(A+="&local=1"),safeNewWindow(A,"mcmstsc/"+t.nodeid)}else if("ssh"==t.tag){var D=window.location.origin+domainUrl+"ssh.html?ws="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");null!=(ae=getNodeFromId(t.nodeid))&&(D+="&name="+encodeURIComponentEx(ae.name)),t.localRelay&&(D+="&local=1"),safeNewWindow(D,"mcssh/"+t.nodeid)}break;case"getNotes":if((u=Q("d2devNotes"))&&t.id==decodeURIComponent(u.attributes.noteid.value))t.notes?QH("d2devNotes",decodeURIComponent(t.notes)):QH("d2devNotes",""),0==("true"==u.attributes.ro.value)&&(u.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"));else Q("notesPanelArea").innerHTML=t.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(t.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&t.notes?QV("notesPanel",!0):QV("notesPanel",!1);break;case"otpauth-request":if(2==xxdialogMode&&"otpauth-request"==xxdialogTag)if(null!=t.err){var T=["","2FA está bloqueado","Os códigos de backup estão bloqueados","Token de login em uso","OTP 2FA não permitido","Esta conta está bloqueada","Não foi possível carregar o OTPLIB"];t.err>0&&t.err<T.length?QH("d2optinfo",T[t.err]):QH("d2optinfo",format("Erro #{0}",t.err))}else{var E=t.secret;52==E.length?E=E.split(/(.............)/).filter(Boolean).join(" "):32==E.length&&(E=(E=E.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+E.substring(20)),QH("d2optinfo","<table><tr><td style=vertical-align:top>"+format('Instalar <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Autenticador Google</a> Autenticador Google </a> ou um aplicativo compatível e escaneie o código de barras, use <a href="{0}" rel="noreferrer noopener" target=_blank> este link </a> ou digite o segredo. Em seguida, insira o token de 6 dígitos atual abaixo para ativar o login em 2 etapas.',t.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+t.secret+'" style=font-size:12px>'+E+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+t.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Insira o token aqui para login em 2 etapas: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:t.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()}break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","App autenticador",t.success?"<b style=color:green>A ativação do aplicativo Authenticator foi bem-sucedida.</b> Agora você precisará de um token válido para fazer o login novamente.":"<b style=color:red>Falha na ativação do login em 2 etapas.</b> Apague o segredo do aplicativo e tente novamente. Você tem apenas alguns minutos para inserir o código adequado."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","App autenticador",t.success?"<b>O aplicativo do autenticador foi removido.</b> Você pode reativar esse recurso a qualquer momento.":"<b style=color:red>Falha na remoção da ativação do login em 2 etapas.</b> Tente novamente."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(2==xxdialogMode&&"otpauth-manage"!=xxdialogTag)return;n="Os tokens únicos podem ser usados ​​como autenticação secundária. Gere um conjunto, imprima-os e guarde-os em local seguro.";if(n+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',t.passwords){w=0;var N="";for(var a in t.passwords){++w%2&&(n+="<tr>");for(var I=""+t.passwords[a].p;I.length<8;)I="0"+I;!0===t.passwords[a].u?(n+="<td>"+I.substring(0,4)+"&nbsp;"+I.substring(4),""!=N&&(N+=" "),N+=I):n+="<td><strike style=color:#BBB>"+I.substring(0,4)+"&nbsp;"+I.substring(4)}}else n+="<tr><td>Sem Tokens Ativos";n+="</table></div></div><br />",n+='<div class="btn-group">',n+='<button type=button class="btn btn-warning" onclick="account_manageOtp(1);">Gerar novos tokens</input>',null!=t.passwords?(n+='<button type=button class="btn btn-danger" onclick="account_manageOtp(2);">Apagar Tokens</button></div>',n+='&nbsp;<i class="fa-regular fa-clipboard" title="Copie os códigos válidos para a área de transferência" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(N)+'")></i>'):n+="</div>",xxdialogTag="otpauth-manage",setModalContent("xxAddAgent","Gerenciar códigos de backup",n),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var _='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',V="</table></div></div>";n='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank"> Chaves de hardware </a> são usadas como autenticação de login secundária.';if(n+='<div class="backgroundContainer" style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',t.keys&&t.keys.length>0)for(var a in t.keys){var U=t.keys[a];n+=_+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(me=2==U.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+U.name+'<td style=text-align:right><button type=button class="btn btn-danger" onclick=account_removehkey('+U.i+")>Remover</button>"+V}else n+=_+"<tr style=text-align:center><td>Nenhuma chave configurada"+V;n+="</div>",n+="<div>";var R="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>R?(131072&features&&(n+='<button class="btn btn-primary" id=d2addkey3 type=button onclick="account_addhkey(3);">Adicionar chave</input>'),16384&features&&(n+='<button class="btn btn-primary" id=d2addkey2 type=button onclick="account_addhkey(2);">Adicionar YubiKey&reg; OTP</input>')):n+="Máximo de teclas atingido.",xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Gerenciar chaves de segurança",n+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Adicionar chave de segurança","<br />Erro, não foi possível adicionar a chave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==t.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Adicionar chave de segurança","<br />Erro, não foi possível adicionar a chave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Adicionar chave de segurança",n='Pressione o botão chave agora.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+t.name+" />");var F=t.request;t.request.challenge=Uint8Array.from(atob(t.request.challenge),function(e){return e.charCodeAt(0)}),t.request.user.id=Uint8Array.from(atob(t.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:F}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}})},function(e){console.log("ERRO:"+e),setModalContent("xxAddAgent","Adicionar chave de segurança","ERRO:"+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;n='<table><tr><td><img src="images/phone80.png" style=padding:8px>';n+="<td>Verifique seu telefone e insira o código de verificação.",setModalContent("xxAddAgent","Notificações por telefone",n+='<br /><br /><div style=width:100%;text-align:center>Código de verificação: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;n='<table><tr><td><img src="images/messaging40.png" style=padding:8px>';n+="<td>Check your messaging application and enter the verification code.",setModalContent("xxAddAgent","Messaging Notifications",n+='<br /><br /><div style=width:100%;text-align:center>Código de verificação: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,t.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(t.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){var o,n=Q("d4editorarea").value;n=0===d4EditLineBreakVal?n.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?n.replace(/\r\n|\n/g,"\r"):n.replace(/\r\n|\r/g,"\n"),o=1==d4EditEncodingVal?encode_utf8(n):n,meshserver.send({action:"fileoperation",fileop:"set",path:t.path,file:t.file,data:btoa(o)})}(0,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(t.data)):atob(t.data);break;case"event":if(!t.event.nolog){if(currentNode&&t.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(t.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(t.event);for(var H=parseInt(p16limitdropdown.value);currentDeviceEvents.length>H;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&t.event.userid==currentUser._id&&(t.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(t.event);for(H=parseInt(p31limitdropdown.value);currentUserEvents.length>H;)currentUserEvents.pop()}mainUpdate(2048)}if(t.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(t.event);for(H=parseInt(p3limitdropdown.value);events.length>H;)events.pop()}mainUpdate(32)}}if(t.event.noact)break;switch(t.event.action){case"serverinfochange":null!=t.event.lock2factor&&(serverinfo.lock2factor=t.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":if(t.event.nodeid!=deviceSharesReq)break;deviceSharesNode=t.event.nodeid,deviceShares=t.event.deviceShares,currentNode._id==deviceSharesNode&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":if(98==t.event.msgid&&GetNodeRights(t.event.nodeid)>0){u=getNodeFromId(t.event.nodeid);addNotification({text:format("Ajuda solicitada de {0}: {1}",t.event.msgArgs[0],t.event.msgArgs[1]),title:u.name,icon:u.icon,nodeid:t.event.nodeid})}break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(t.event),t.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var B=localStorage.getItem("showRealNames"),O=localStorage.getItem("uiMode"),P=localStorage.getItem("sort"),L=localStorage.getItem("loctag"),z=localStorage.getItem("nightMode"),G=localStorage.getItem("footerBar"),q=JSON.parse(t.event.state);for(var a in q)localStorage.setItem(a,q[a]);if(null!=q.showRealNames&&q.showRealNames!=B&&(showRealNames=Q("RealNameCheckBox").checked="1"==q.showRealNames,mainUpdate(6)),null!=q.uiMode&&q.uiMode!=O&&userInterfaceSelectMenu(parseInt(q.uiMode)),null!=q.sort&&q.sort!=P&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(q.sort),mainUpdate(6)),null!=q.loctag&&q.loctag!=L&&(null!=q.loctag?args.locale=q.loctag:delete args.locale,mainUpdate(4294967295)),null!=q.nightMode&&q.nightMode!=z&&(putstore("nightMode",q.nightMode),setNightMode()),null!=q.footerBar&&q.footerBar!=G&&(footerBar="1"==q.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=q.stars&&q.stars!=JSON.stringify(stars)&&(stars=JSON.parse(q.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode&&refreshDevice(currentNode._id)),null!=q.deskKeyShortcuts){deskKeyboardShortcuts=[];var W=q.deskKeyShortcuts.split(",");for(var a in W)""!=W[a]&&deskKeyboardShortcuts.push(parseInt(W[a]));updateDeskShortcutKeys()}if(null!=q.deskStrings){r=null;try{r=JSON.parse(q.deskStrings)}catch(e){}Array.isArray(r)&&(deskKeyboardStrings=r,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(t.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof t.event.account||null==t.event.account)return void console.log(t.event);if(userinfo._id==t.event.account._id){var j=t.event.account.siteadmin?t.event.account.siteadmin:0,K=userinfo.siteadmin?userinfo.siteadmin:0,J=t.event.account.removeRights?t.event.account.removeRights:0,$=userinfo.removeRights?userinfo.removeRights:0;(t.event.account.quota!=userinfo.quota||!(8&userinfo.siteadmin)&&8&t.event.account.siteadmin)&&meshserver.send({action:"files"});var X=userinfo.groups;if(userinfo=t.event.account,K==j&&$==J&&1!=t.event.accountImageChange||(1==t.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),2&userinfo.siteadmin){var Y=X||[],Z=userinfo.groups?userinfo.groups:[];Y.join(",")!=Z.join(",")&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"}))}t.event.nodeListChange==userinfo._id&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip})}if(currentNode&&refreshDevice(currentNode._id),null==users)break;null==userinfo.groups||0==userinfo.groups.length||1==findOne(t.event.account.groups,userinfo.groups)?users[t.event.account._id]=t.event.account:delete users[t.event.account._id],mainUpdate(16388);break;case"accountremove":if(null==users)break;delete users[t.event.userid],mainUpdate(16384);break;case"createusergroup":case"usergroupchange":null==usergroups&&(usergroups={});var ee=usergroups[t.event.ugrpid];null==ee?usergroups[t.event.ugrpid]={_id:t.event.ugrpid,name:t.event.name,desc:t.event.desc,domain:t.event.domain,links:t.event.links}:(ee.name=t.event.name,t.event.desc?ee.desc=t.event.desc:delete ee.desc,t.event.links?ee.links=t.event.links:delete ee.links,t.event.flags?ee.flags=t.event.flags:delete ee.flags,"number"==typeof t.event.consent&&(ee.consent=t.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[t.event.ugrpid]){delete usergroups[t.event.ugrpid];var te=0;for(var a in usergroups)te++;0==te&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[t.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==t.event.mesh.links[userinfo._id]||(meshes[t.event.meshid]=t.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[t.event.meshid]){var oe=!1;for(var a in null!=t.event.links[userinfo._id]&&(oe=!0),null!=userinfo.links[t.event.meshid]&&(oe=!0),userinfo.links)a.startsWith("ugrp/")&&null!=t.event.links[a]&&(oe=!0);oe&&(meshes[t.event.meshid]={_id:t.event.meshid,name:t.event.name,mtype:t.event.mtype,desc:t.event.desc,links:t.event.links,amt:t.event.amt,invite:t.event.invite,expireDevs:t.event.expireDevs,relayid:t.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=t.event.name)for(var a in meshes[t.event.meshid].name=t.event.name,nodes)nodes[a].meshid==t.event.meshid&&(nodes[a].meshnamel=t.event.name.toLowerCase());if(null!=t.event.desc&&(meshes[t.event.meshid].desc=t.event.desc),null!=t.event.flags&&(meshes[t.event.meshid].flags=t.event.flags),null!=t.event.consent&&(meshes[t.event.meshid].consent=t.event.consent),t.event.links&&(meshes[t.event.meshid].links=t.event.links),t.event.amt&&(meshes[t.event.meshid].amt=t.event.amt),null!=t.event.invite?meshes[t.event.meshid].invite=t.event.invite:delete meshes[t.event.meshid].invite,null!=t.event.expireDevs&&(t.event.expireDevs>0?meshes[t.event.meshid].expireDevs=t.event.expireDevs:delete meshes[t.event.meshid].expireDevs),null!=t.event.relayid&&(meshes[t.event.meshid].relayid=t.event.relayid),0==IsMeshViewable(t.event.meshid)){20==xxcurrentView&&currentMesh==meshes[t.event.meshid]&&go(2),delete meshes[t.event.meshid];var ne=[];for(var a in nodes)(nodes[a].meshid!=t.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[a]._id])&&ne.push(nodes[a]);nodes=ne,xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,xxcurrentView>=10&&xxcurrentView<20&&go(1)),20==xxcurrentView&&currentMesh._id==t.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[t.event.meshid]&&(delete meshes[t.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));ne=[];if(null!=nodes)for(var a in nodes)nodes[a].meshid!=t.event.meshid&&ne.push(nodes[a]);nodes=ne,mainUpdate(24580),xxcurrentView>=20&&xxcurrentView<30&&currentMesh._id==t.event.meshid&&(setDialogMode(0),go(2)),xxcurrentView>=10&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var ae=t.event.node;if(!meshes[ae.meshid])break;if(null!=getNodeFromId(ae._id))break;ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,ae.meshnamel=meshes[ae.meshid]?meshes[ae.meshid].name.toLowerCase():"*",ae.state=0,ae.icon||(ae.icon=1),ae.ident=++nodeShortIdent,nodes.push(ae),mainUpdate(23),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096);break;case"removenode":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g];currentNode==ae&&(xxcurrentView>=10&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(g,1),mainUpdate(20),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096)}break;case"changenode":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){if((ae=nodes[g]).name=t.event.node.name,ae.rname=t.event.node.rname,ae.lusers=t.event.node.lusers,ae.users=t.event.node.users,ae.host=t.event.node.host,ae.desc=t.event.node.desc,ae.ip=t.event.node.ip,ae.osdesc=t.event.node.osdesc,ae.publicip=t.event.node.publicip,ae.iploc=t.event.node.iploc,ae.wifiloc=t.event.node.wifiloc,ae.gpsloc=t.event.node.gpsloc,ae.tags=t.event.node.tags,ae.ssh=t.event.node.ssh,ae.rdp=t.event.node.rdp,ae.userloc=t.event.node.userloc,ae.rdpport=t.event.node.rdpport,ae.rfbport=t.event.node.rfbport,ae.sshport=t.event.node.sshport,ae.httpport=t.event.node.httpport,ae.httpsport=t.event.node.httpsport,ae.consent=t.event.node.consent,ae.pmt=t.event.node.pmt,null!=t.event.node.links?ae.links=t.event.node.links:delete ae.links,null!=t.event.node.agent&&(null==ae.agent&&(ae.agent={}),null!=t.event.node.agent.ver&&(ae.agent.ver=t.event.node.agent.ver),null!=t.event.node.agent.id&&(ae.agent.id=t.event.node.agent.id),null!=t.event.node.agent.caps&&(ae.agent.caps=t.event.node.agent.caps),null!=t.event.node.agent.root&&(ae.agent.root=t.event.node.agent.root),null!=t.event.node.agent.core?ae.agent.core=t.event.node.agent.core:ae.agent.core&&delete ae.agent.core,ae.agent.tag=t.event.node.agent.tag),null!=t.event.node.intelamt&&(null==ae.intelamt&&(ae.intelamt={}),null!=t.event.node.intelamt.state&&(ae.intelamt.state=t.event.node.intelamt.state),null!=t.event.node.intelamt.host&&(ae.intelamt.user=t.event.node.intelamt.host),null!=t.event.node.intelamt.user?ae.intelamt.user=t.event.node.intelamt.user:delete ae.intelamt.user,null!=t.event.node.intelamt.tls&&(ae.intelamt.tls=t.event.node.intelamt.tls),null!=t.event.node.intelamt.ver&&(ae.intelamt.ver=t.event.node.intelamt.ver),null!=t.event.node.intelamt.tag&&(ae.intelamt.tag=t.event.node.intelamt.tag),null!=t.event.node.intelamt.uuid&&(ae.intelamt.uuid=t.event.node.intelamt.uuid),null!=t.event.node.intelamt.realm&&(ae.intelamt.realm=t.event.node.intelamt.realm),null!=t.event.node.intelamt.flags&&(ae.intelamt.flags=t.event.node.intelamt.flags),null!=t.event.node.intelamt.warn?ae.intelamt.warn=t.event.node.intelamt.warn:delete ae.intelamt.warn),null!=t.event.node.av&&(ae.av=t.event.node.av),null!=t.event.node.wsc&&(ae.wsc=t.event.node.wsc),null!=t.event.node.volumes&&(ae.volumes=t.event.node.volumes),ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,t.event.node.icon&&(ae.icon=t.event.node.icon),null!=t.event.node.lastbootuptime&&(ae.lastbootuptime=t.event.node.lastbootuptime),t.event.node.meshid!=ae.meshid)if(null!=meshes[t.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[ae._id])ae.meshid=t.event.node.meshid,ae.meshnamel=meshes[t.event.node.meshid]?meshes[t.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==ae._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}nodes.splice(g,1),mainUpdate(20)}updateDeviceViewDevice(ae),mainUpdate(26),refreshDevice(ae._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096),currentNode==ae&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g];null!=meshes[t.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[ae._id]?(ae.meshid=t.event.newMeshId,ae.meshnamel=meshes[t.event.newMeshId]?meshes[t.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==ae._id&&xxcurrentView>=10&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(g,1),mainUpdate(20)),refreshDevice(t.event.nodeid)}else{ae=t.event.node;if(!meshes[ae.meshid])break;ae.namel=ae.name.toLowerCase(),ae.rname?ae.rnamel=ae.rname.toLowerCase():ae.rnamel=ae.namel,ae.meshnamel=meshes[ae.meshid]?meshes[ae.meshid].name.toLowerCase():"*",ae.state=0,ae.icon||(ae.icon=1),ae.ident=++nodeShortIdent,nodes.push(ae),mainUpdate(23)}break;case"nodeconnect":g=-1;for(var a in nodes)if(nodes[a]._id==t.event.nodeid){g=a;break}if(-1!=g){ae=nodes[g],u=getstore("notifications",0);if(t.event.meshid&&userinfo.links&&userinfo.links[t.event.meshid]&&userinfo.links[t.event.meshid].notify&&(u|=userinfo.links[t.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[t.event.meshid]&&(u|=userinfo.notify[t.event.meshid]),null!=userinfo.notify[t.event.nodeid]&&(u|=userinfo.notify[t.event.nodeid])),2&u){var ie="Agente conectado";null!=ae.agent&&!1===ae.agent.root&&(ie="Agente conectado com privilégios limitados");var se={title:ae.name,icon:ae.icon,nodeid:ae._id,id:t.event.id};!(1&ae.conn)&&1&t.event.conn&&(se.text=ie,addNotification(se)),!(2&ae.conn)&&2&t.event.conn&&(se.text="Intel AMT CIRA conectado",addNotification(se)),!(4&ae.conn)&&4&t.event.conn&&(se.text="Intel AMT conectado",addNotification(se)),!(16&ae.conn)&&16&t.event.conn&&(se.text="MQTT conectado",addNotification(se))}if(4&u){se={title:ae.name,icon:ae.icon,nodeid:ae._id,id:t.event.id};1&ae.conn&&!(1&t.event.conn)&&(se.text="Agente desconectado",addNotification(se)),2&ae.conn&&!(2&t.event.conn)&&(se.text="Intel AMT CIRA desconectado",addNotification(se)),4&ae.conn&&!(4&t.event.conn)&&(se.text="Intel AMT desconectado",addNotification(se)),16&ae.conn&&!(16&t.event.conn)&&(se.text="MQTT desconectado",addNotification(se))}ae.conn=t.event.conn,ae.pwr=t.event.pwr,ae.lastconnect=Date.now(),1&ae.conn||delete ae.sessions;var re=Q("DevFilterSelect").value;1==re||5==re?mainUpdate(21):(updateDeviceViewDevice(ae),mainUpdate(17)),refreshDevice(ae._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==ae.meshid&&mainUpdate(4096)}break;case"wssessioncount":null!=wssessions&&(0==t.event.count&&wssessions[t.event.userid]?delete wssessions[t.event.userid]:wssessions[t.event.userid]=t.event.count,mainUpdate(16384));break;case"login":null!=users&&users[t.event.userid]&&(users[t.event.userid].login=Math.floor(new Date(t.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+t.event.range)return;n="";if(null==t.event.results)n="<div style=width:100%;text-align:center;margin-top:12px>Não foi possível verificar este intervalo de endereços.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de amostra de intervalo de IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var a in amtScanResults=t.event.results,t.event.results){var le=t.event.results[a],de=le.hostname;"host"==le.hosttype&&(de=capitalizeFirstLetter(de.split(".")[0])),de.length>20&&(de=de.substring(0,20)+"...");var ce='<b title="'+EscapeHtml(le.hostname)+'">'+EscapeHtml(de)+"</b> - v"+le.ver;2==le.state?1==le.tls?ce+=" com TLS.":ce+=" sem TLS.":ce+=" not activated.",n+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(a)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+ce+"</div></div></div>"}""==n&&(n="<div style=width:100%;text-align:center;margin-top:12px>A varredura não retornou resultados.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de amostra de intervalo de IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",n),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":u={text:t.event.value,title:t.event.title,icon:t.event.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(u.id=t.id),null!=t.event.tag&&(u.tag=t.event.tag),"number"==typeof t.maxtime&&(u.maxtime=t.maxtime),addNotification(u);break;case"traceinfo":"object"==typeof t.event.traceSources&&(null!=t.event.traceSources&&t.event.traceSources.length>0?(serverTraceSources=t.event.traceSources,QH("p41traceStatus",EscapeHtml(t.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nenhum")));break;case"sysinfohash":null!=currentNode&&t.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:t.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==t.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null==(ae=getNodeFromId(t.event.nodeid)))break;if(ae.sessions=t.event.sessions,null!=ae.sessions){for(var a in ae.sessions)0==Object.keys(ae.sessions[a]).length&&delete ae.sessions[a];0==Object.keys(ae.sessions).length&&delete ae.sessions}updateDeviceViewDevice(ae),null!=currentNode&&currentNode._id==t.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+t.event.nodeid&&showDeviceSessions(t.event.nodeid,!0),xxdialogTag=="MESSAGES-"+t.event.nodeid&&showDeviceMessages(t.event.nodeid,!0),xxdialogTag=="HELPREQ-"+t.event.nodeid&&showDeviceHelpRequests(t.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1);break;case"loginTokenChanged":if(t.event.userid!=userinfo._id)return;loginTokens=t.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(t.event.userid!=userinfo._id)return;null==loginTokens&&(loginTokens=[]),loginTokens.push(t.event.newToken),mainUpdate(65536);break;case"stopped":default:break;case"updatePluginList":installedPluginList=t.event.list,updatePluginList();break;case"pluginStateChange":if(null==pluginHandler)break;pluginHandler.refreshPluginHandler();break;case"plugin":if(null==pluginHandler)break;try{pluginHandler[t.event.plugin][t.event.pluginaction](t)}catch(e){console.log("O PluginHandler não conseguiu, mensagem de evento:",e)}}break;case"createInviteLink":if(xxdialogTag!=t.meshid)break;var ue;(-1==(ue=serverinfo.name).indexOf(".")||2&features)&&(ue=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);if(1==serverinfo.https)M="https://"+ue+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");else M="http://"+ue+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+t.cookie+(urlargs.key?"&key="+urlargs.key:"");Q("agentInvitationLink").href=M;var pe=format(1==t.expire?"1 hora":"{0} horas",t.expire);24==t.expire&&(pe="1 dia"),168==t.expire&&(pe="1 semana"),5040==t.expire&&(pe="1 mês"),0==t.expire&&(pe="Ilimitado"),QH("agentInvitationLink",format("Link de convite ({0})",pe)),QV("agentInvitationLinkDiv",!0);break;case"createDeviceShareLink":if(xxdialogTag)break;n="";if(null==(ae=getNodeFromId(t.nodeid)))break;n+=addHtmlValue("Dispositivo",ae.name),n+=addHtmlValue("Nome do convidado",t.guestname),n+=addHtmlValue("Entrada do usuário",t.viewOnly?"Não permitido, apenas visualização":"Permitido"),t.start&&t.expire&&(t.recurring?(n+=addHtmlValue("Hora de início",printDateTime(new Date(t.start))),t.expire<2?n+=addHtmlValue("Duração",format("{0} minuto",t.expire)):n+=addHtmlValue("Duração",format("{0} minutos",t.expire))):(n+=addHtmlValue("Hora de início",printDateTime(new Date(t.start))),n+=addHtmlValue("Tempo de expiração",printDateTime(new Date(t.expire))))),1==t.recurring&&(n+=addHtmlValue("Recorrente","Diariamente")),2==t.recurring&&(n+=addHtmlValue("Recorrente","Semanalmente"));s=[];7&t.consent&&s.push("Notificar"),56&t.consent&&s.push("Prompt"),64&t.consent&&s.push("Barra de privacidade"),0==s.length&&s.push("Nenhum"),n+=addHtmlValue("Consentimento do usuário",s.join(", "));var me="";t.p<=7?me=["","Link do Terminal Remoto","Link de área de trabalho remota","Área de Trabalho Remota + Link do Terminal","Link de arquivos remotos","Terminal Remoto + Link de Arquivos","Área de Trabalho Remota + Link de Arquivos","Área de Trabalho Remota + Terminal + Link de Arquivos"][t.p]:8==t.p?me=format("HTTP/{0} link",t.port):16==t.p&&(me=format("HTTPS/{0}",t.port)),setModalContent("xxAddAgent","Compartilhar dispositivo",n+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+t.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+me+'</a> <i class="fa-regular fa-copy" title="Copiar link para a área de transferência" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getmqttlogin":if(null==currentNode||currentNode._id!=t.nodeid||null!=xxdialogMode)return;n="Essas configurações podem ser usadas para conectar MQTT para este dispositivo.<br /><br />";delete t.action,delete t.nodeid,setModalContent("xxAddAgent","Credenciais MQTT",n+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(t)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",t.msg);break;case"updatePluginList":installedPluginList=t.list,updatePluginList();break;case"pluginVersionsAvailable":if(null==pluginHandler)break;updatePluginList(t.list);break;case"downgradePluginVersions":var ge='<select id="lastPluginVersion">';t.info.versionList.forEach(function(e){ge+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),ge+="</select>",setModalContent("xxAddAgent","Ação do plugin",format("Select the version to downgrade the plugin: {0}",t.info.name)+"<hr />"+ge+"<hr />Esteja ciente de que o downgrade não é recomendado. Faça isso apenas no caso de alguma atualização recente ter quebrado alguma coisa.NaN"+t.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":if("googleDrive"==t.service&&(QV("p2ServerActionsGoogleBackup",t.state>0),QV("p2ServerActionsGoogleBackupCheck",t.state>2),miscState.googleDrive={state:t.state},2==t.state)){n='<img style=float:right src="images/googledrive-48.png" /><div>Acesse a URL abaixo, conceda acesso e copie o código do token de volta.</div><br />';n+=addHtmlValue("Ativação",'<a href="'+t.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'),setModalContent("xxAddAgent","Backup do Google Drive",n+=addHtmlFormFloating("Código","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1)}break;case"pluginError":setModalContent("xxAddAgent","Erro de Plugin",t.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null==pluginHandler||"string"!=typeof t.plugin)break;try{pluginHandler[t.plugin][t.method](e,t)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(t.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=t.userid&&":"+t.userid;n="",te="BBB";var ve="";if(0==t.events.length)n+="No previous login.";else{for(var a in n+='<div class="backgroundContainer" style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>',t.events){107==(d=t.events[a].m)?(d="Login válido",te="BBD1BB",ve="",null!=t.events[a].tn&&(d=format("Token: {0}",t.events[a].tn),te="88D188")):108==d?(d="2FA inválido",te="DD9DC3",ve="x"):109==d?(d="Conta bloqueada",te="E1BBBB",ve="x"):110==d&&(d="Senha inválida",te="E1BBBB",ve="x"),n+="<tr><td><img src=images/user-32"+ve+'.png height=32 width=32 style=float:left srcset="images/user-64'+ve+'.png 2x"><td><div style=width:350px;background-color:#'+te+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(t.events[a].t))+", <b>"+EscapeHtml(d)+"</b></div><div style=font-size:x-small>"+EscapeHtml(t.events[a].a.join(", "))+"</div></div></tr>"}n+="</table></div>"}setModalContent("xxAddAgent","Logins anteriores",n),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([t.data],{type:"application/octet-stream"}),"Lista de dispositivos."+t.type);break;case"createLoginToken":if(xxdialogMode)return;n="Anote este nome de usuário e senha, a senha não pode ser exibida novamente.<br /><br />";n+=addHtmlValue("Nome",EscapeHtml(t.name)),0!=t.expire&&(n+=addHtmlValue("Expirar",EscapeHtml(printDateTime(new Date(t.expire))))),n+=addHtmlValue("Nome do usuário",'<i class="fa-regular fa-copy" title="Copiar link para a área de transferência" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenUser)+"</div>"),setModalContent("xxAddAgent","Criar token de login",n+=addHtmlValue("Senha",'<i class="fa-regular fa-copy" title="Copiar link para a área de transferência" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(t.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(t.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=t.loginTokens,mainUpdate(65536);break;case"report":renderReport(t.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var o in nodes)nodes[o].name==args.gotodevicename&&(t=nodes[o]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodevicername){t=null;if(null!=nodes)for(var o in nodes)nodes[o].rname==args.gotodevicername&&(t=nodes[o]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var o in nodes)nodes[o].ip==args.gotodeviceip&&(t=nodes[o]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var n=args.gotouser;if(args.gotouser.indexOf("/")<0&&(n="user/"+domain+"/"+args.gotouser),null==users||null==users[n])return;gotoUser(encodeURIComponentEx(n)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){var a=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(a="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[a])return;gotoUserGroup(a),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){if(null==devicePagingState||devicePagingState.total<=devicePagingState.limit)QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1);else{var e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit);QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t)}}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),o=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:t>1&&meshserver.send({action:"nodes",skip:0});break;case 2:t>1&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<o&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<o&&meshserver.send({action:"nodes",skip:(o-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){if(!xxdialogMode){null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]);var e="";e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agtype")>=0?" checked":"")+">Tipo do Agente</label><br />",e+='<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("agver")>=0?" checked":"")+">Versão do Agente</label><br />",e+='<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("desc")>=0?" checked":"")+">Descrição do Dispositivo</label><br />",e+='<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("os")>=0?" checked":"")+">Sistema operacional</label><br />",e+='<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("tags")>=0?" checked":"")+">Etiqueta</label><br />",e+='<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsav")>=0?" checked":"")+">Windows AV</label><br />",e+='<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsupdate")>=0?" checked":"")+">Windows Update</label><br />",e+='<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0?" checked":"")+">Windows Firewall</label><br />",e+='<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0?" checked":"")+">Last Boot Up Time</label><br />",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("links")>=0?" checked":"")+">Links do MeshCentral Router</label><br />",e+='<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("user")>=0?" checked":"")+">Usuários conectados</label><br />",e+='<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("ip")>=0?" checked":"")+">Endereço IP do agente</label><br />",e+='<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("conn")>=0?" checked":"")+">Conectividade do servidor </label><br />",e+='<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amthost")>=0?" checked":"")+">Intel&reg; AMT hostname</label><br />",e+='<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("amtstate")>=0?" checked":"")+">Intel&reg; AMT state</label><br />",setModalContent("xxAddAgent","Colunas de visualização de dispositivos",e+='<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(deviceViewSettings.devsCols.indexOf("lastseen")>=0?" checked":"")+">Visto pela última vez</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx())}}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var o=0;if(e.key){if(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,o=1),8==e.keyCode&&0==userSearchFocus){var n=Q("UserSearchInput").value;Q("UserSearchInput").value=n.substring(0,n.length-1),o=1}27==e.keyCode&&(Q("UserSearchInput").value="",o=1)}else 0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),o=1);if(o>0)return 1==o&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView){if(1==e.ctrlKey&&96==e.charCode)return showRealNames=!showRealNames,Q("RealNameCheckBox").value=showRealNames,putstore("showRealNames",showRealNames?1:0),void mainUpdate(6);if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){o=0;if(e.key){if(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,o=1),8==e.keyCode&&0==searchFocus){n=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),o=1}27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1)}else 0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),o=1);if(o>0)return 1==o&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,o=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),o=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode),o=1))}}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),e.keyCode>=37&&e.keyCode<=40&&haltEvent(e)),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(8===e.keyCode&&0==userSearchFocus){var o=Q("UserSearchInput").value;Q("UserSearchInput").value=o.substring(0,o.length-1),n=1}if(27===e.keyCode&&(Q("UserSearchInput").value="",n=1),n>0)return 1==n&&mainUpdate(5),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var n=0;if(Q("viewselect").value<4){if(8===e.keyCode&&0==searchFocus){o=Q("SearchInput").value;Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),n=1}if(27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1),n>0)return 1==n&&mainUpdate(5),haltEvent(e)}if(4==Q("viewselect").value){if(8===e.keyCode&&0==mapSearchFocus){o=Q("mapSearchLocation").value;Q("mapSearchLocation").value=o.substring(0,o.length-1),n=1}27===e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),n=1)}}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==!(8192&features2||4294967295!=t&&(!(8&t)||256&t)))return!1;if(1==!(4294967295==t||!(8&t)||256&t||!(4096&t))&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||e.keyCode>90))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1==e.shiftKey&&27==e.keyCode?(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1)):xxdialogMode||0!=xxcurrentView||1==e.ctrlKey||1==e.altKey||1==e.metaKey?void 0:Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode)?haltEvent(e):void 0):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;var o=e.children[1].children[1];o.children[0].classList.remove("g1s"),o.children[1].classList.remove("e2s"),o.children[2].classList.remove("g2s"),1==t&&(o.children[0].classList.add("g1s"),o.children[1].classList.add("e2s"),o.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var o=Q("viewselect").value;if(1==o)(n=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),n.children[2].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("e2s"),n.children[3].classList.add("g2s"));else if(2==o){var n;(n=e).children[2].classList.remove("g1s"),n.children[4].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t&&(n.children[2].classList.add("g1s"),n.children[4].classList.add("e2s"),n.children[3].classList.add("g2s"))}}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,o=null,n={},a=Q("viewselect").value,i={},s={};if(QV("xdevices",4!=a),QV("xdevicesmap",4==a),QVH("devListToolbar",a<3),QVH("kvmListToolbar",3==a||5==a),QVH("devMapToolbar",4==a),QV("devListToolbarSize",3==a||5==a),QV("devListToolbarSettings",2==a),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",nodes.length>0),QV("devListToolbarSort",nodes.length>0&&4!=a),0==nodes.length&&(a=1,sort=0),4==a)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderId=0,deviceHeaderCount={},deviceHeaderTotal=0,deviceHeaders={},deviceHeadersTitles={};var r=[];0==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&deviceViewSettings.devsCols.indexOf("lastseen")>=0||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort));var l=Q("column_l").clientWidth-60,d=Math.floor(l/301);d=301+Math.floor((l-301*d)/d);var c=4;for(var u in deviceViewSettings&&deviceViewSettings.devsCols&&(c=deviceViewSettings.devsCols.length+1,deviceViewSettings.devsCols.indexOf("desc")>=0&&c--),nodes){if(0!=(F=nodes[u]).v){var p=meshes[F.meshid],m=GetNodeRights(F);if(0==sort){if((meshes[F.meshid]?F.meshid:"*")!=o){1!=a&&3!=a&&5!=a||null==o||(e+="</div>"),deviceHeaderSet();var g="";if(2==a&&(e+="<tr><td colspan="+c+">"),meshes[F.meshid]&&1==meshes[F.meshid].mtype&&(g="<span class=devHeaderx>, Intel&reg; apenas AMT</span>"),meshes[F.meshid]&&3==meshes[F.meshid].mtype&&(g=meshes[F.meshid].relayid?"<span class=devHeaderx>, Dispositivos retransmitidos</span>":"<span class=devHeaderx>, Dispositivos Locais</span>"),1==a&&null!=o&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==a&&(e+="<div>"),e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>",e+="<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+g,e+="</span>",1==a||2==a||3==a||5==a){var v=CollapsedGroups[F.meshid];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+F.meshid+'",'+a+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}meshes[F.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+F.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+F.meshid+"')\">"+EscapeHtml(meshes[F.meshid].name)+"</span>"+getMeshActions(p,m)+"</div>",o=F.meshid):(e+="<span id=MxMESH><i>Dispositivos Individuais</i></span></div>",o="*"),2==a&&(e+="</div>"),n[o]=1,t=0,1!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else if(1==sort){var h=F.pwr?F.pwr:0;if(h!==o){if(1!=a&&3!=a&&5!=a||null==o||(e+="</div>"),deviceHeaderSet(),1==a&&null!==o&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e&&(e+="</tr></table>")),2==a&&(e+="<tr><td colspan="+c+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1==a||2==a||3==a||5==a){v=CollapsedGroups["pwr:"+h];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+h+'",'+a+') class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'}e+="<span>"+PowerStateStr2(F.pwr)+"</span></div>",o=h,t=0,1!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===v?" style=display:none":"")+">")}}else 2!=sort&&5!=sort||null==o&&(o="1");if(1==a)e+="<div name=xxdevice1 id=xv1"+F._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>";else if(2==a){var f=F.meshid;1==sort?f="pwr:"+(F.pwr?F.pwr:0):3!=sort&&4!=sort||(f="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+f+" style=height:20px"+((v=3!=sort&4!=sort&CollapsedGroups[f])?";display:none":"")+" id=xv2"+F._id+"></tr>"}else(3==a||5==a)&&1&F.conn&&0!=(8&m||256&m)&&F.agent&&1&F.agent.caps&&(0==Object.keys(checkedNodeids).length||checkedNodeids[F._id])&&(e+=updateDeviceViewHtml(a,null,F),r.push(F._id));if((3==sort||4==sort)&&""!=e){if(F.tags)for(var x in F.tags){var k=F.tags[x];4==sort&&(k=p?p.name+" - "+F.tags[x]:"**INDV*~*DEVS** - "+F.tags[x]);v=CollapsedGroups["tag:"+encodeURIComponentEx(k)];var b=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(k)+(v?" style=display:none":""));if(null==i[k]?(i[k]=b,s[k]=1):(i[k]+=b,s[k]+=1),3==a||5==a)break}else if(4==sort&&null!=p&&(null==F.tags||0==F.tags.length)){k=p.name,v=CollapsedGroups["tag:"+encodeURIComponentEx(k)],b=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(k)+(v?" style=display:none":""));null==i[k]?(i[k]=b,s[k]=1):(i[k]+=b,s[k]+=1)}e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[F.state]?deviceHeaderCount[F.state]=1:deviceHeaderCount[F.state]++}}if(1==a&&null!=o&&(e+="</div>"),r.length>=32&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var y=[],w=0;for(var u in i)y.push(u);for(var x in y.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),y){u=y[x];if(2==a){e+="<tr><td colspan="+c+"><div class=DevSt style=width:100%;padding-top:4px>";v=CollapsedGroups["tag:"+encodeURIComponentEx(u)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(u)+'",2) class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span class=devHeaderx style=float:right>"+s[u]+" node"+(s[u]>1?"s":"")+"</span><span>"+EscapeHtml(u).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivos Individuais</i>")+"</span></div>"+i[u]}else{e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(s[u]>1?"{0} nodes":"{0} node",s[u])+"</span>";v=CollapsedGroups["tag:"+encodeURIComponentEx(u)];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+w+'","tag:'+encodeURIComponentEx(u)+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+w+'"></i>',e+="<span>"+EscapeHtml(u).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivos Individuais</i>")+"</span></div>",e+="<div id=DevxCol"+w+(!0===v?" style=display:none":"")+">"+i[u]+"</div>"}w++}}var C=!1;if(""==e&&nodes.length>0&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(C=!0,e=3==sort?'<div style="margin:30px">Nenhum dispositivo está incluído em nenhum grupo, clique em "Grupos" de um dispositivo para adicioná-lo a um grupo.</div>':'<div style="margin:30px">Nenhum dispositivo corresponde a esta pesquisa. <a onclick=clearDeviceSearch()>Apagar filtro de pesquisa</a></div>'),1==a&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&a<3){var M=deviceHeaderId,S=[];for(var u in meshes)S.push(meshes[u]);for(var u in S.sort(nameSort),S){var A=S[u];m=GetMeshRights(A);if(null==n[A._id]){""!=o&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",M++;v=CollapsedGroups[A._id];e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+M+'","'+A._id+'") class="fa-fw fa-solid '+(!0===v?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+M+'"></i>',e+='<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>",e+=getMeshActions(A,m),e+="</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>Nenhum dispositivo Intel&reg; AMT neste grupo de dispositivos",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>Adicione um</a>")):2==A.mtype?(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Nenhum dispositivo neste grupo de dispositivos",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>Adicione um</a>")):3==A.mtype?(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Nenhum dispositivo local neste grupo de dispositivos",!(4&m)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>Adicione um</a>")):4==A.mtype&&(e+="<td><div id=DevxCol"+M+(!0===v?" style=display:none":"")+">",e+="<div style=padding:10px><i>Nenhum dispositivo neste grupo de dispositivos"),e+=".</i></div></td>",e+="</div>",o=A._id}}}if(""!=e&&0==C){if(e+="</table>",2==a){var D="";null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(D+="<th style=width:100px>Tipo do Agente"),deviceViewSettings.devsCols.indexOf("agver")>=0&&(D+="<th style=width:100px>Versão do Agente"),deviceViewSettings.devsCols.indexOf("os")>=0&&(D+="<th style=width:160px>SO"),deviceViewSettings.devsCols.indexOf("tags")>=0&&(D+="<th style=width:120px>Etiqueta"),deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(D+="<th style=width:100px>Windows AV"),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(D+="<th style=width:120px>Windows Update"),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(D+="<th style=width:120px>Windows Firewall"),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(D+="<th style=width:120px>Last Boot Up Time"),deviceViewSettings.devsCols.indexOf("links")>=0&&(D+="<th style=width:120px>Links"),deviceViewSettings.devsCols.indexOf("user")>=0&&(D+="<th style=width:120px>Usuário"),deviceViewSettings.devsCols.indexOf("ip")>=0&&(D+="<th style=width:120px>Endereço"),deviceViewSettings.devsCols.indexOf("conn")>=0&&(D+="<th style=width:100px>Conectividade"),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(D+="<th style=width:100px>AMT Host"),deviceViewSettings.devsCols.indexOf("amtstate")>=0&&(D+="<th style=width:100px>AMT State"),deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(D+="<th style=width:120px>Visto pela última vez",0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"}))),e="<table style=width:100%;margin-top:4px;table-layout:fixed cellpadding=0 cellspacing=0><th>"+D+e+"</tr></table><div style=height:1px></div>"}}else e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Nenhum dispositivo com etiquetas foi encontrado.</i></div>');for(var u in e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",!(a<3&&0==sort&&Object.keys(meshes).length>0)||4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin||(e+='<a href=# onclick="return account_createMesh()" title="Crie um novo grupo de dispositivos." style=cursor:pointer>Adicionar Grupo de Dispositivos</a>&nbsp'),4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Baixe MeshCmd, uma ferramenta de linha de comando que executa muitas funções.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Baixe o MeshCentral Router, uma ferramenta de mapeamento de portas TCP.\">Router</a>&nbsp")),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(u,deviceHeaders[u]);for(var u in deviceHeadersTitles)Q(u).title=deviceHeadersTitles[u];if(p1updateInfo(),3!=a&&5!=a||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var T=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];if(3==a){var E=T.x+2,N=l-5,I=Math.floor(N/E);I=E+Math.floor((N-I*E)/I),T.y=T.y*(I/T.x),T.x=I}for(var u in multiDesktop)multiDesktop[u].xxdelete=!0;for(var u in r){var _=r[u],V=_.split("/")[2],U=multiDesktop[_];if(null!=U){var R=5==a?U.m.width*T.y/U.m.height:T.x;U.m.CanvasId.setAttribute("style","background-color:black;width:"+R+"px;height:"+T.y+"px"),Q("xkvmid_"+V).appendChild(U.m.CanvasId),delete U.xxdelete,QH("skvmid_"+V,["Desconectado","Conectando ...","Configurando...","",""][null==U.m.State?U.m.state:U.m.State])}else{var F=getNodeFromId(_);if(desktopNode==F&&null!=desktop){t=desktop.m.CanvasId,R=5==a?desktop.m.width*T.y/desktop.m.height:T.x;t.setAttribute("id","kvmid_"+V),t.setAttribute("style","background-color:black;width:"+R+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+_+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+V).appendChild(t),QH("skvmid_"+V,["Desconectado","Conectando ...","Configurando...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=V,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[_]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+V),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+T.x+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+_+"')");try{Q("xkvmid_"+V).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(F,1)},100)}}}for(var u in multiDesktop)1==multiDesktop[u].xxdelete?(multiDesktop[u].Stop(),delete multiDesktop[u]):debugmode&&multiDesktop[u].m&&multiDesktop[u].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[u].m,multiDesktop[u].m.ScreenWidth,multiDesktop[u].m.ScreenHeight,multiDesktop[u].m.CanvasId);deskAdjust()}}oldviewmode=a,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){void 0===e&&(e=!1),e&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&(onDevicesTouchActive=e,0==e&&onDevicesScrollEx())}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e=Q("xdevices").scrollTop-200,t=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,o=Q("viewselect").value,n=document.getElementsByName("xxdevice"+o),a=0;a<n.length;a++)if(n[a].offsetTop>=e&&n[a].offsetTop<t){var i=getNodeFromId(n[a].id.substring(3));null!=i?updateDeviceViewHtml(o,n[a],i):n[a].innerHTML=""}else n[a].innerHTML=""}function updateDeviceViewDevice(e){var t=Q("viewselect").value;if(1==t||2==t){if("string"==typeof e&&(e=getNodeFromId(e)),null!=e){var o=Q("xv"+t+e._id);null!=o&&""!=o.innerHTML&&updateDeviceViewHtml(t,o,e)}}else mainUpdate(4)}function updateDeviceViewHtml(e,t,o){var n=EscapeHtml(o.name);0==n.length&&(n="<i>Nenhum</i>"),null!=o.rname&&o.rname.length>0&&(n+=" / "+EscapeHtml(o.rname));var a=EscapeHtml(o.name);if(1==showRealNames&&null!=o.rname&&(a=EscapeHtml(o.rname)),0==a.length&&(a="<i>Nenhum</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var i="",s="";if(1==stars[o._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=o.sessions&&(null!=o.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+o._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+o._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(o.sessions.msg).length+"</div>"),null==o.sessions.kvm&&null==o.sessions.terminal&&null==o.sessions.files&&null==o.sessions.tcp&&null==o.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+o._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+o._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=o.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+o._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+o._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=o.sessions.battery&&1==e)){var r=o.sessions.battery,l="";"ac"==r.state&&(l="O dispositivo está conectado"),"dc"==r.state&&(l="O dispositivo é alimentado por bateria");var d="",c=-1;"number"==typeof r.level&&r.level>=0&&r.level<=100&&(d=r.level+"%",(c=Math.floor((r.level+10)/25)+1)>5&&(lvl=5),"ac"==r.state&&(100==r.level?c=11:c+=5)),c>0&&(i+='<div class="deviceBatterySmall deviceBatterySmall'+c+'" title="'+(null!=l?l+", "+d:d)+'"></div>')}""!=s&&(i+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>");var u=o.icon;if(o.conn&&0!=o.conn||3==o.mtype||(u+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+o.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+o._id+" type=checkbox "+(checkedNodeids[o._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+o._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+'\',null,null,event)"><div class="i'+u+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+n+'">'+a+"</div><div>"+NodeStateStr(o)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+i;else if(2==e){var p=[];if(o.conn&&(1&o.conn&&(4==o.mtype?"PDU"==o.porttype?p.push('<span title="Porta do switch está pronto para o uso.">Trocar</span>'):p.push('<span title="A porta IP KVM está conectada e pronta pro uso.">IP-KVM</span>'):p.push('<span title="O agente Mesh está conectado e pronto para uso.">Agente</span>')),2&o.conn?p.push('<span title="Intel&reg; AMT CIRA está conectado e pronto para uso.">CIRA</span>'):4&o.conn&&p.push('<span title="Intel&reg; AMT é roteável.">AMT</span>'),8&o.conn&&p.push('<span title="O agente Mesh pode ser acessado usando outro agente como retransmissor.">Retransmissão</span>'),16&o.conn&&p.push('<span title="A conexão MQTT com o dispositivo está ativa.">MQTT</span>')),3==o.mtype){var m=meshes[o.meshid];m&&m.relayid?p.push('<span title="Conexão de rede local através de um agente de retransmissão.">Retransmissão</span>'):p.push('<span title="Conexão de rede local.">Local</span>')}o.desc&&deviceViewSettings.devsCols.indexOf("desc")>=0&&(a='<div class="flex-grow-1">'+a+"</div><div style=float:right"+(1==stars[o._id]?";padding-right:15px":"")+">"+EscapeHtml(o.desc)+"</div>");var g=o.meshid;1==sort?g="pwr:"+(o.pwr?o.pwr:0):3!=sort&&4!=sort||(g="tag:**xx**xx*TaG*xx**xx**");CollapsedGroups[g];var v="<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+"',null,null,event)\">";if(v+='<div class=deviceBarCheckbox><input class="'+o.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+o._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[o._id]?" checked":"")+"></div>",v+="<div class=deviceBarIcon onmouseup=gotoDevice('"+o._id+"',null,null,event)><div class=\"j"+u+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>',v+="<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>",v+='<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+n+"\" onmouseup=gotoDevice('"+o._id+"',null,null,event)>"+a+"</div></div>"+i+"</td>",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),deviceViewSettings.devsCols.indexOf("agtype")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=o.mtype&&o.agent&&o.agent.id&&o.agent.id<=agentsStr.length?agentsStr[o.agent.id]:"")+'">'+EscapeHtml(3!=o.mtype&&o.agent&&o.agent.id&&o.agent.id<=agentsStr.length?agentsStr[o.agent.id]:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("agver")>=0&&(v+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(o.agent&&o.agent.core?o.agent.core:"")+'">'+EscapeHtml(o.agent&&o.agent.core?o.agent.core:"").replace(",","<br />")),deviceViewSettings.devsCols.indexOf("os")>=0)if(3==o.mtype){var h="";4==o.agent.id&&(h="Windows"),6==o.agent.id&&(h="Linux"),29==o.agent.id&&(h="MacOS"),v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(h)+'">'+EscapeHtml(h)}else v+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(o.osdesc?o.osdesc:"")+'">'+EscapeHtml(o.osdesc?o.osdesc:"");if(deviceViewSettings.devsCols.indexOf("tags")>=0){v+="<td style=text-align:center;font-size:x-small>";var f="";if(null!=o.tags)for(var x in o.tags)f+="<span class=tagSpan>"+EscapeHtml(o.tags[x])+"</span> ";v+="<span style=line-height:20px>"+f+"</span>"}if(deviceViewSettings.devsCols.indexOf("windowsav")>=0&&(v+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.antiVirus?"OK"==o.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>Ruim</span>":"")),deviceViewSettings.devsCols.indexOf("windowsupdate")>=0&&(v+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.autoUpdate?"OK"==o.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>Ruim</span>":"")),deviceViewSettings.devsCols.indexOf("windowsfirewall")>=0&&(v+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.firewall?"OK"==o.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>Ruim</span>":"")),deviceViewSettings.devsCols.indexOf("lastbootuptime")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+(null!=o.lastbootuptime?printDateTime(new Date(o.lastbootuptime)):"")),deviceViewSettings.devsCols.indexOf("links")>=0&&(v+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(o)),deviceViewSettings.devsCols.indexOf("user")>=0&&(v+="<td style=text-align:center>"+getUserShortStr(o)),deviceViewSettings.devsCols.indexOf("ip")>=0){var k="";3==o.mtype?k=o.host:o.ip&&(k=o.ip),v+='<td style=text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis title="'+EscapeHtml(k)+'">'+EscapeHtml(k)}if(deviceViewSettings.devsCols.indexOf("conn")>=0&&(v+="<td style=text-align:center>"+p.join("&nbsp;+&nbsp;")),deviceViewSettings.devsCols.indexOf("amthost")>=0&&(v+="<td style=text-align:center>"+(null==o.intelamt||null==o.intelamt.host?"":EscapeHtml(o.intelamt.host))),deviceViewSettings.devsCols.indexOf("amtstate")>=0){var b="";o.intelamt&&(0==o.intelamt.state&&(b=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==o.intelamt.state&&(b=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==o.intelamt.state&&o.intelamt.flags&&(2&o.intelamt.flags?b=' <span title="Intel&reg; AMT está ativado no modo de controle do cliente">CCM</span>':4&o.intelamt.flags&&(b+=' <span title="Intel&reg; AMT é ativado no modo de controle de administrador">ACM</span>'))),v+="<td style=text-align:center>"+b}deviceViewSettings.devsCols.indexOf("lastseen")>=0&&(v+="<td style=text-align:center;font-size:x-small>",o.conn>0?v+="Conectado":null!=o.lastconnect&&(v+=printDateTime(new Date(o.lastconnect)))),t.innerHTML=v}else if(3==e||5==e){v="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+o._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+"',11,null,event)\">"+i;return v+='<div class="j'+u+'" style=width:16px;float:left></div>&nbsp;'+a+"</div>",v+="<span onmouseup=gotoDevice('"+o._id+"',null,null,event)></span><div id=xkvmid_"+o._id.split("/")[2]+"><div id=skvmid_"+o._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+o._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+o._id+"')\">Desconectado</div></div>",v+="</div>"}}}function getShortRouterLinks(e){var t="",o=GetNodeRights(e);if((1&e.conn||3==e.mtype)&&e.agent&&8&o&&14!=e.agent.id&&(0!=webRelayPort&&(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport?e.httpport:80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;",t+='<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport?e.httpsport:443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),e.agent.id>0&&e.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),e.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport?e.sshport:22)+")>SSH</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport?e.sshport:22)+")>SCP</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var n in serverinfo.devicemeshrouterlinks.extralinks){var a=serverinfo.devicemeshrouterlinks.extralinks[n],i='"'+a.protocol+'"';if(doesDeviceMatchFilterTags(e,a.filter)){if(3==e.mtype&&("mcrdesktop"==a.protocol||"mcrfiles"==a.protocol))continue;"number"==typeof a.protocol?i=a.protocol:"http"==a.protocol?i=1:"https"==a.protocol?i=2:"rdp"==a.protocol?i=3:"ssh"==a.protocol?i=4:"scp"==a.protocol?i=5:"mcrdesktop"==a.protocol?i=6:"mcrfiles"==a.protocol&&(i=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+i+","+a.port+(a.ip?',"'+a.ip+'"':",null")+","+(a.localport?a.localport:0)+")>"+a.name+"</a>&nbsp;"}}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(!Array.isArray(t))return!1;if(t.indexOf(e.meshid)>=0)return!0;if(t.indexOf(e._id)>=0)return!0;if(Array.isArray(e.tags))for(var o in e.tags)if(t.indexOf("tag:"+e.tags[o])>=0)return!0;return!1}function showDeviceHelpRequests(e,t,o){if(o&&haltEvent(o),xxdialogMode&&!t)return!1;var n=null,a="";if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions)return setDialogMode(0),!1;if(null!=n.sessions.help)for(var i in n.sessions.help)a+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(i)+'","'+encodeURIComponentEx(n._id)+'")>Dispensar</a><div style=margin-bottom:6px><b>'+EscapeHtml(i)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(n.sessions.help[i])+"</div></div>";return""!=a&&(xxdialogTag="HELPREQ-"+n._id,setModalContent("xxAddAgent","Pedidos de ajuda - "+EscapeHtml(n.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,o){if(o&&haltEvent(o),xxdialogMode&&!t)return!1;var n=null,a="";if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions)return setDialogMode(0),!1;for(var i in n.sessions)if("kvm"==i&&null==n.sessions.multidesk)for(var s in a+="<u>Área de trabalho remota</u>",n.sessions.kvm)if(s.startsWith("user/")){var r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger" ></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.kvm[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.kvm[s])))+r)}else"busy"==s&&(a+=addHtmlValue2("O dispositivo esta ocupado",1==n.sessions.kvm[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.kvm[s]))));else if("multidesk"==i)for(var s in a+="<u>Área de trabalho remota</u>",n.sessions.multidesk){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.multidesk[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.multidesk[s])))+r)}else if("terminal"==i)for(var s in a+="<u>Terminal</u>",n.sessions.terminal){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.terminal[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.terminal[s])))+r)}else if("files"==i)for(var s in a+="<u>Arquivos</u>",n.sessions.files){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.files[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.files[s])))+r)}else if("tcp"==i)for(var s in a+="<u>Roteamento TCP</u>",n.sessions.tcp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.tcp[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.tcp[s])))+r)}else if("udp"==i)for(var s in a+="<u>Roteamento UDP</u>",n.sessions.udp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sessão" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==n.sessions.udp[s]?"1 sessão":nobreak(format("{0} sessões",n.sessions.udp[s])))+r)}return""!=a?(xxdialogTag="SESSIONS-"+n._id,setModalContent("xxAddAgent","Sessões - "+EscapeHtml(n.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0),!1}function endDeviceSession(e,t,o){var n=decodeURIComponent(o).split("/"),a=n[0]+"/"+n[1]+"/"+n[2],i=null;4==n.length&&n[3].startsWith("guest:")&&(i=atob(n[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:a,guestname:i,guestname:i}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:a,guestname:i,guestname:i,protocol:e})}function showDeviceMessages(e,t,o){if(o&&haltEvent(o),xxdialogMode&&!t)return!1;var n=null,a="<div style=max-height:200px;overflow-y:auto>",i=0;if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions||null==n.sessions.msg)return setDialogMode(0),!1;for(var s in n.sessions.msg){var r=s,l=5;"string"==typeof n.sessions.msg[s].msg&&(r=n.sessions.msg[s].msg),"number"==typeof n.sessions.msg[s].msgid&&null!=eventsMessageId[n.sessions.msg[s].msgid]&&(r=eventsMessageId[n.sessions.msg[s].msgid]),"number"==typeof n.sessions.msg[s].icon&&(l=n.sessions.msg[s].icon),(l<1||l>9)&&(l=5),a+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+l+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",i++}return a+="</div>",i>0&&(xxdialogTag="MESSAGES-"+n._id,setModalContent("xxAddAgent","Mensagens do Agente - "+EscapeHtml(n.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function toggleCollapseGroup(e,t,o){if(2==o){var n,a=document.getElementsByName("xxdevice2");if(0==a.length)return;for(var i=[],s=0;s<a.length;s++)a[s].attributes.colname.value.substring(7)==t&&i.push(a[s]);(n="none"==i[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<i.length;s++)i[s].style.display=n?"":"none"}else(n="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,n);n?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){"string"==typeof e&&(e=getNodeFromId(e));var t=GetNodeRights(e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){if(null==e||null==e.users||!Array.isArray(e.users)||0==e.users.length)return"";if(e.users.length>1)return'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} usuários",e.users.length))+"</span>";var t=e.users[0],o=t,n=t.indexOf("\\");return n>0&&(o=t.substring(n+1)),(o=EscapeHtml(o)).length>15&&(o=o.substring(0,14)+"&#8230;"),e.lusers&&e.lusers.length>0?addKeyLinkConditional(o,EscapeHtml(t)+" (Bloqueado)",e.lusers&&e.lusers.indexOf(t)>=0):'<span title="'+EscapeHtml(t)+'">'+o+"</span>"}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var t=0;for(var o in nodes){var n=nodes[o],a=nodes[o]._id;if(null==multiDesktop[a]&&(0==Object.keys(checkedNodeids).length||checkedNodeids[a])){var i=GetNodeRights(n);(8&i||256&i)&&1&n.conn&&1==n.v&&t++}}if(t>8){setModalContent("xxAddAgent","Conectar tudo",format("Tem certeza de que deseja se conectar a {0} dispositivos?",t));var s=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",s),Q("autoConnectDesktopCheckbox").checked=!1};return document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",s),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",s),connectAllKvmFunction(!0)})}}for(var o in nodes)1!=nodes[o].v||null!=multiDesktop[nodes[o]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[o]._id]||toggleKvmDevice(nodes[o]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Desconectado","Conectando ...","Configurando...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),!(268435456&features)&&xxcurrentView>0)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Configurações de área de trabalho remota",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var o=e._id,n=o.split("/")[2],a=multiDesktop[o];if(null==a){if(null==Q("kvmid_"+n))return;if(2==t){if(null==e.intelamt.user||""==e.intelamt.user)return;(a=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+n),authCookie)).shortid=n,a.onStateChanged=onMultiDesktopStateChange,a.m.bpp=1,a.m.useZRLE=!0,a.m.showmouse=!0,a.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},a.m.onScreenSizeChange=mdeskAdjust,a.Start(o,16994,"*","*",0),a.contype=2,multiDesktop[o]=a}else 1==t&&((a=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,a.m.mouseCursorActive(11==xxcurrentView),a.shortid=n,a.attemptWebRTC=attemptWebRTC,a.webrtcconfig=webrtcconfiguration,a.onStateChanged=onMultiDesktopStateChange,a.m.ImageType=multidesktopsettings.agentencoding,a.m.CompressionLevel=multidesktopsettings.quality,a.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(a.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(a.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(a.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(a.m.remoteKeyMap=multidesktopsettings.remotekeymap),a.m.onScreenSizeChange=mdeskAdjust,a.Start(o),a.contype=1,multiDesktop[o]=a)}else a.Stop(),delete multiDesktop[o]}function getMeshActions(e,t){if(!(4&t))return"";var o="";return 1==e.mtype&&(1&features||(o+=' <a href=# role="button" title="Adicione um novo computador Intel&reg; AMT localizado na rede local." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Adicionar local</a>",o+=' <a href=# role="button" title="Adicione um novo computador Intel&reg; AMT examinando a rede local." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Escaneamento de rede</a>"),e.amt&&e.amt.type>0&&(o+=' <a href=# role="button" title="Execute a ativação e configuração do Intel&reg; AMT." onclick=\'return showAmtSetup("'+e._id+"\")'>Configurar</a>")),2!=e.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(o+=' <a href=# role="button" title="Adicione um novo computador a este grupo de dispositivos instalando o agente mesh." onclick=\'return addAgentToMesh("'+e._id+"\")'>Adicionar Agente</a>",2&features||(o+=' <a href=# role="button" title="Convide alguém para instalar o agente mesh neste grupo de dispositivos." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Convidar</a>")),3==e.mtype&&(o+=' <a href=# role="button" title="Adicione o dispositivo localizado na rede local." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Adicionar Dispositivo</a>"),o}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],o=format('Adicione um dispositivo local ao grupo de dispositivos "{0}".',EscapeHtml(t.name))+"<br /><br />";o+=addHtmlFormFloating("Nome do dispositivo","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"),o+=addHtmlFormFloating("Nome do Host",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Igual ao nome do dispositivo" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />'),setModalContent("xxAddAgent","Adicionar dispositivo local",o+=addHtmlFormFloating("Tipo","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH / SCP / VNC)</option><option value=29>macOS (SSH / SCP / VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0)}function addLocalDeviceToMeshEx(e,t){var o=Q("dp1hostname").value;""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],o=format('Adicione um novo dispositivo Intel&reg; AMT ao grupo de dispositivos "{0}".',EscapeHtml(t.name))+"<br /><br />";return o+=addHtmlFormFloating("Nome do dispositivo",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),o+=addHtmlFormFloating("Nome do Host",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Igual ao nome do dispositivo" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),o+=addHtmlFormFloating("Nome do usuário",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="admin" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),o+=addHtmlFormFloating("Senha",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'),setModalContent("xxAddAgent","Adicionar dispositivo Intel&reg; AMT",o+=addHtmlFormFloating("Segurança",'<select id=dp1tls class="form-select"><option value=0>Sem segurança TLS</option><option value=1>Segurança TLS necessária</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus(),!1}function showAmtImport(e){if(!xxdialogMode){setModalContent("xxAddAgent","Intel&reg; AMT Device Import",'Create many Intel&reg; AMT device at once by importing a JSON file with the following format:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1)}}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,t){var o=new FileReader;o.onload=function(e){var o=null;try{o=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Intel&reg; AMT Device Import",format("Arquivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=o?meshserver.send({action:"importamtdevices",meshid:t,amtdevices:o}):(setModalContent("xxAddAgent","Intel&reg; AMT Device Import","Formato de arquivo JSON inválido."),showModal("xxAddAgentModal","idx_dlgOkButton"))},o.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){if(xxdialogMode)return!1;var t=serverinfo.name,o=meshes[e];(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);var n;domainUrl.substring(0,domainUrl.length-1);1==serverinfo.https?n="wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:n="ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl;var a=format('Adicione, ative e configure Intel&reg; AMT para agrupar "{0}" executando MeshCmd periodicamente como administrador no dispositivo remoto.',EscapeHtml(o.name))+"<br /><br />";return a+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+n+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(a+="<div style=margin-top:8px>Para ativação ACM, Intel&reg; AMT precisará ser definido para o seguinte FQDN confiável: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Configuração Intel&reg; AMT",a),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus(),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Ative Intel&reg; AMT no Modo de controle de administrador (ACM) usando uma drive USB formatada em FAT. Coloque setup.bin nele e inicialize um ou mais computadores com esta chave.</div><div style=margin-top:6px>Comece inserindo a senha antiga e a nova do MBEx.</div></table>";e+=addHtmlFormFloating("Senha Antiga",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Nova Senha*",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),e+=addHtmlFormFloating("Nova Senha*",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'),32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Use para ativação de LAN bare-metal.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 caracteres, 1 maiúsculas, 1 minúscula, 1 numérico, 1 não alfanumérico.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,o=Q("dp1password2").value,n=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(n=!1),t==o&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(n=!1),QE("idx_dlgOkButton",n)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){if(xxdialogMode)return!1;var t="Insira um intervalo de endereços IP para procurar dispositivos Intel&reg; AMT.<br /><br />";return t+=addHtmlValue("Intervalo de IP",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Varredura" onclick=addAmtScanToMeshButton()></input></tr></table>'),t+='<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>',t+='<input type=hidden id=amtScanMeshId value="'+e+'" />',xxdialogTag=e,setModalContent("xxAddAgent","Procure dispositivos Intel&reg; AMT",t+='<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Cancelar" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Selecionar tudo" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de amostra de intervalo de IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp(),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",Q("dp1range").value.split(".").length>3),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t=document.getElementsByClassName("DevScanCheckbox"),o=0;o<t.length;o++)if(t[o].checked){var n=t[o].getAttribute("tag"),a=amtScanResults[n],i=a.hostname;"host"==a.hosttype&&(i=capitalizeFirstLetter(i.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:i,hostname:a.hostname,amtusername:"",amtpassword:"",amttls:a.tls})}}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");t.length>1&&(e=t[t.length-1]),""!=(e=e.trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Verificando ...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,o=0;o<e.length;o++)e[o].checked&&t++;QE("idx_dlgOkButton2",t>0)}function checkEmail(e){var t=e.split("@"),o=2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2;if(1==o){var n=t[1].split(".");for(var a in n)0==n[a].length&&(o=!1)}return o}function inviteAgentToMesh(e){if(xxdialogMode)return!1;var t="",o=meshes[e];return 64&features&&(t+=addHtmlFormFloating("Tipo de Convite","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Convite de link</option><option value=1>Convite por email</option></select>")+"<hr />",t+="<div id=emailInviteDiv style=display:none>"+format('Convide alguém para instalar o agente mesh. Um e-mail será enviado com o link para a instalação do agente mesh para o grupo de dispositivos "{0}".',EscapeHtml(o.name))+"<br /><br />",t+=addHtmlFormFloating("Nome (opcional)",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'),t+=addHtmlFormFloating("E-mail",'<input id=agentInviteEmail placeholder="exemplo@email.com" class="form-control" onkeyup=validateAgentInvite() />'),t+=addHtmlFormFloating("Sistema operacional","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Enviar link de instalação</option><option value=0 selected>Qualquer suportado</option><option value=1>Somente Windows</option><option value=3>Apenas Apple macOS</option><option value=2>Apenas Linux</option><option value=5>MeshCentral Assistant</option></select>"),t+="<div id=d2agentexpirediv>",t+=addHtmlFormFloating("Expiração do link","<select id=agentInviteExpire class=form-select><option value=1>1 hora</option><option value=8>8 horas</option><option value=24>1 dia</option><option value=168>1 semana</option><option value=5040>1 mês</option><option value=0>Ilimitado</option></select>"),t+="</div>",t+="<div id=d2agentInstallTypeDiv2>",t+=addHtmlFormFloating("Tipo de Instalação","<select id=agentInviteType class=form-select><option value=0>Plano de fundo e interativo</option><option value=2>Plano de fundo apenas</option><option value=1>Apenas interativo</option></select>"),t+="</div>",t+=addHtmlFormFloating("Mensagem (opcional)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>'),t+="</div>"),t+="<div id=urlInviteDiv>"+format('Convide alguém para instalar o agente mesh, compartilhando um link de convite. Este link direciona o usuário às instruções de instalação para o grupo de dispositivos "{0}". O link é público e nenhuma conta para este servidor é necessária.',EscapeHtml(o.name))+"<br /><br />",t+=addHtmlFormFloating("Expiração do link","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 hora</option><option value=8>8 horas</option><option value=24>1 dia</option><option value=168>1 semana</option><option value=5040>1 mês</option><option value=0>Ilimitado</option></select>"),t+=addHtmlFormFloating("Agentes","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Todos agentes disponíveis</option><option value=1>MeshAgent Windows</option><option value=2>MeshAgent Linux</option><option value=4>MeshAgent MacOS</option><option value=8>MeshCentral Assistant</option><option value=16>Android MeshAgent</option></select>"),t+="<div id=d2agentInstallTypeDiv>",t+=addHtmlFormFloating("Tipo de Instalação","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Plano de fundo e interativo</option><option value=2>Plano de fundo apenas</option><option value=1>Apenas interativo</option></select>"),t+="</div>",xxdialogTag=e,setModalContent("xxAddAgent","Convidar",t+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Copiar link para a área de transferência" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),64&features?(Q("d2InviteType").focus(),d2ChangedInviteType()):(Q("d2inviteExpire").focus(),validateAgentInvite()),d2RequestInvitationLink(),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],o="",n="",a="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Instalador binário Linux / BSD / macOS</option><option value=2>Apple macOS</option>";2&features||(a+="<option value=6>Dispositivo móvel</option>"),a+="<option value=7>MeshCentral Assistant</option>",o+=addHtmlFormFloating("Sistema operacional",a+="<option value=3>Windows (Desinstalar)</option><option value=4>Linux / BSD (Desinstalar)</option><option value=8>Apple macOS (UnInstall)</option></select>");var i=serverinfo.name;(-1==i.indexOf(".")||2&features)&&(i=window.location.hostname);var s=domainUrl.substring(0,domainUrl.length-1),r="";r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port;var l=[6,5,10005,25,26,28,30,32,36,37,40,41,45,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",45:"RISC-V 64bit",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(var c in l)n+='<option value="'+l[c]+'">'+d[l[c]]+"</option>";o+='<div id="aginsSysTypeDiv">',o+=addHtmlFormFloating("Tipo de sistema",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+n+"</select>"),o+="</div>",o+='<div id="aginsTypeDiv">',o+=addHtmlFormFloating("Tipo de Instalação",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Plano de fundo e interativo</option><option value="2">Plano de fundo apenas</option><option value="1">Apenas interativo</option></select>'),o+='</div><div id="asinsTypeDiv">',o+=addHtmlFormFloating("Tipo de Instalação",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Aplicativo, conecte-se a pedido do usuário</option><option value="3">Aplicativo, sempre conectado</option><option value="0">Bandeja do sistema, conectar a pedido do usuário</option><option value="1">Bandeja do sistema, sempre conectado</option><option value="4">Bandeja do sistema, apenas monitor</option></select>'),o+="</div><hr>";var u=t.name;return u=u.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join(""),o+="<div id=agins_windows>"+format('Para adicionar um novo computador ao grupo de dispositivos "{0}", baixe o agente mesh e instale-o no computador para gerenciar. Este agente possui informações do servidor e do grupo de dispositivos incorporadas a ele.',EscapeHtml(t.name))+"<br /><br />",o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),debugmode>0&&(o+=addHtmlValue("Arquivo de configurações",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} configurações (.msh)",EscapeHtml(t.name))+"</a>")),o+="</div>",o+="<div id=agins_linux style=display:none>"+format('Para adicionar um computador a "{0}" execute o seguinte comando. Serão necessárias credenciais de root.',EscapeHtml(t.name))+"<br />",o+="<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>",o+='<div style=font-size:x-small;float:right>* Para BSD, execute antes "pkg install wget sudo bash" .</div><a style=text-decoration:none title="Copiar para área de transferência" onclick=copyAgentIdValue("agins_linux_area")>Copiar <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',o+="<div id=agins_osx style=display:none>"+format('Para adicionar um novo computador ao grupo de dispositivos "{0}", baixe o agente mesh e instale-o no computador para gerenciar. Este instalador de agente possui informações de servidor e grupo de dispositivos incorporadas a ele.',EscapeHtml(t.name))+"<br /><br />",o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64bit</a> <i class="fa-regular fa-clipboard" title="Copiar o URL do agente macOS para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64 bits)</a> <i class="fa-regular fa-clipboard" title="Copiar o URL do agente macOS para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <i class="fa-regular fa-clipboard" title="Copiar o URL do agente macOS para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),o+="</div>",o+='<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Para adicionar um dispositivo móvel ao grupo "{0}", baixe o aplicativo MeshAgent e escaneie este código QR.',EscapeHtml(t.name))+"</div>",o+="<table style=width:180px>",o+='<tr><td style=text-align:center><a title="Loja de aplicativos do Google"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>',o+='<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>',o+="</table>",o+=addHtmlValue("APK Android",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Copiar URL para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'),o+="</div>",o+="<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('O MeshCentral Assistant é uma ferramenta do Windows que os usuários podem usar para pedir ajuda. Use o link abaixo para baixar uma versão que se conectará ao grupo de dispositivos "{0}".',EscapeHtml(t.name))+"</div><div></div><br />",o+='<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant para Windows">Assistente para Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar URL para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',o+='</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>',o+="<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>O MeshCentral Assistant é uma ferramenta do Windows que os usuários podem usar para pedir ajuda. Use o link abaixo para baixar uma versão que irá monitorar o agente em segundo plano.</div><div></div><br />",o+='<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant para Windows">Assistente para Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar URL para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>',o+='</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>',o+='<div id=agins_windows_un style=display:none>Para remover um agente mesh, baixe o arquivo abaixo, execute-o e clique em "desinstalar".<br /><br />',o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+="</div>",o+="<div id=agins_linux_un style=display:none>Para remover um agente mesh, execute o seguinte comando. Serão necessárias credenciais de root.<br />",o+="<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>",o+='<a style=text-decoration:none title="Copiar para área de transferência" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>',o+='<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />',o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Copiar o URL do agente macOS para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]),o+="</div>",o+="<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />",o+=addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">Meshagent</a> <i class="fa-regular fa-clipboard" title="Copiar o URL do agente para a área de transferência" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),o+=addHtmlValue('Comando&nbsp;<i class="fa-regular fa-clipboard" title="Copiar o URL do agente para a área de transferência" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(2147483648&features?" --no-check-certificate":"")+' "https://'+i+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"]),setModalContent("xxAddAgent","Adicionar Agente Mesh",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),8192&features?(Q("agins_linux_area").value='wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='(wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+i+r+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(2147483648&features?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+i+r+domainUrl+'meshagents?script=1" --no-proxy'+(2147483648&features?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick(),!1}function setModalContent(e,t,o,n=null){var a=document.getElementById("xxAddAgentModalConf"),i=document.getElementById(e+"Title");if(a&&i){if(i.innerHTML=t,"number"==typeof o){for(var s=1;s<24;s++)QV("dialog"+s,s==o);xxdialogMode=s}else if("string"==typeof o){Q("dialog2").innerHTML=o;for(s=1;s<24;s++)QV("dialog"+s,2==s);xxdialogMode=2}if(n)switch(a.classList.remove("modal-sm","modal-lg","modal-xl"),n){case"small":a.classList.add("modal-sm");break;case"large":a.classList.add("modal-lg");break;case"extra-large":a.classList.add("modal-xl")}else a.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(e,t,o,n=null,a=null){if(null==xxModal){["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(e));var i=function(t){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(e).removeEventListener("hidden.bs.modal",i)};document.getElementById(e).addEventListener("hidden.bs.modal",i)}xxModal.show(),document.getElementById(t).onclick=function(){"function"==typeof o&&o?(xxdialogMode=0,!1!==o(n,a)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,o,n,a,i,s,r){Swal.fire({position:e,title:t,text:o,icon:n,confirmButtonText:a,timer:i,width:s,showConfirmButton:null!==a})}function copyAgentUrl(e,t){var o=serverinfo.name;(-1==o.indexOf(".")||2&features)&&(o=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);var n="https://"+o+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e;1==t&&(n+=Q("aginsType").value),n+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(n+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(n+="&ac="+Q("asinsType").value),copyTextToClip(n)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},debugmode>0&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",Q("asinsType").value>=2))}function validateDeviceToMesh(){QE("idx_dlgOkButton",Q("dp1devicename").value.length>0&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var o=Q("dp1username").value;""==o&&(o="admin");var n=Q("dp1hostname").value;""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,amtusername:o,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0!=deviceHeaderId?(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 nó":format("{0} nós",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0):deviceHeaderId=1}var powerStateStrings=["",'<span title="O dispositivo está ligado.">Ligado</span>','<span title="O dispositivo está em estado de suspensão (S1).">Hibernando</span>','<span title="O dispositivo está em estado de suspensão (S2).">Hibernando</span>','<span title="O dispositivo está em estado de hibernação (S3).">Sono profundo</span>','<span title="O dispositivo está em estado de hibernação (S4).">Hibernando</span>','<span title="O dispositivo está no estado desligado (S5).">Soft-Off</span>','<span title="O dispositivo foi detectado, mas o estado de energia não pôde ser obtido.">Presente</span>','<span title="O dispositivo está desligado">Desligado</span>'],powerStateStrings2=["","O dispositivo está ligado","O dispositivo está em estado de suspensão (S1)","O dispositivo está em estado de suspensão (S2)","O dispositivo está em estado de sono profundo (S3)","O dispositivo está hibernando (S4) ","O dispositivo está em estado soft-off (S5)","O dispositivo está presente, mas o estado de energia não pode ser determinado","O dispositivo está desligado"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return e.state>0&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(1&e.conn&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="Interruptor de energia pronto para o uso.">Trocar</span>'):t.push('<span title="A porta IP KVM está ativa e pronta pro uso.">IP-KVM</span>'):t.push('<span title="O agente Mesh está conectado e pronto para uso.">Agente</span>')),2&e.conn?t.push('<span title="Intel&reg; AMT CIRA está conectado e pronto para uso.">CIRA</span>'):4&e.conn&&t.push('<span title="Intel&reg; AMT é roteável.">AMT</span>'),8&e.conn&&t.push('<span title="O agente Mesh pode ser acessado usando outro agente como retransmissor.">Retransmissão</span>'),16&e.conn&&t.push('<span title="A conexão MQTT com o dispositivo está ativa.">MQTT</span>')),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Desconhecido"}function updateCollapseAllButton(){var e=Object.keys(CollapsedGroups).length>0;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,o=0;o<e.length;o++)e[o].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};var n=document.getElementsByName("xxdevice"+Q("viewselect").value);for(o=0;o<n.length;o++)(null==n[o].parentElement.attributes.style||n[o].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[n[o].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(e>0?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Selecione nenhum",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Selecionar tudo",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,e>=1)}function groupActionFunction(){var e=[],t=getCheckedDevices(),o=0;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Segurança da conta",'Não é possível acessar este recurso até que a autenticação de dois fatores seja ativada. Isso é necessário para segurança extra. Vá para a guia "Minha conta" e verifique a seção "Segurança da conta".'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(4194304&features)for(var n in t)if(16&getNodeFromId(t[n]).conn){e.push({v:103,name:"Enviar mensagem MQTT"});break}for(var n in e.push({v:105,name:"Exportar informações do dispositivo",s:!0}),t){var a=getNodeFromId(t[n]),i=GetNodeRights(a);1&i&&!(2&o)&&(o|=2,e.push({v:102,name:"Mover para o grupo de dispositivos"})),1&a.conn&&32768&i&&!(1&o)&&(o|=1,e.push({v:104,name:"Desinstalar agente"})),64&i&&!(8&o)&&(o|=8,e.push({v:100,name:"Acordar (Wake) Dispositivos"})),262144&i&&!(4&o)&&(o|=4,e.push({v:4,name:"Hibernar dispositivos"}),e.push({v:3,name:"Reiniciar dispositivos"}),e.push({v:2,name:"Desligar dispositivos"})),131072&i&&!(16&o)&&(o|=16,e.push({v:106,name:"Executar comandos"})),16384&i&&!(32&o)&&(o|=32,e.push({v:108,name:"Notificação de dispositivo"})),4&i&&!(64&o)&&(o|=64,e.push({v:107,name:"Editar etiquetas"})),8&i&&!(256&o)&&(o|=256,e.push({v:109,name:"Carregar de Arquivos"})),32768&i&&!(128&o)&&(o|=128,e.push({v:101,name:"Apagar dispositivos"})),null!=a.agent&&16&features2&&4294967295==i&&!(512&o)&&(o|=512,e.push({v:110,name:"Forçar atualização do agente"}),e.push({v:111,name:'Apagar "Core" do agente'}),e.push({v:112,name:'Carregar o "Core" Padrão do Servidor'}))}var s="";for(var n in e.sort(nameSort),e)s+="<option value="+e[n].v+(e[n].s?" selected":"")+">"+e[n].name+"</option>";var r="Selecione uma operação a ser executada em todos os dispositivos selecionados. As ações serão realizadas apenas com os direitos adequados.<br /><br />";setModalContent("xxAddAgent","Ação do Grupo",r+=addHtmlFormFloating("Operação",'<select id=d2groupop class="form-select">'+s+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(c=getCheckedDevices()).length)return;if(1==c.length)t+="Confirma a remoção do dispositivo selecionado?<br /><br />";else{t+=format("Confirma a remoção de {0} dispositivos selecionados?<br />",c.length);var o=0,n=0;for(var a in c){null!=(u=getNodeFromId(c[a])).conn&&u.conn>0?o++:n++}var i="";1==o?i+=format("1 dispositivo selecionado está online.<br />",o):o>1&&(i+=format("{0} dispositivos selecionados estão online.<br />",o)),1==n?i+=format("1 dispositivo selecionado está offline.<br />",n):n>1&&(i+=format("{0} dispositivos selecionados estão offline.<br />",n)),t+=""!=i?"<div style=padding:8px>"+i+"</div>":"<br />"}setModalContent("xxAddAgent","Apagar Dispositivos",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />confirme</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Execute comandos em dispositivos selecionados.",func:uncheckAllDevices});else if(107==e){t="Executar operação de etiquetas nos dispositivo em lote <br /><br />";t+=addHtmlFormFloating("Operação",'<select id=d2deviceop class="form-select"><option value=1>Adicionar Tags</option><option value=2>Definir etiquetas</option><option value=3>Remover etiquetas</option></select>'),t+=addHtmlFormFloating("Etiqueta",'<select id=dp10devicevalue multiple class="form-control" maxlength=4096>');var s=[];i="";for(var a in nodes)if(nodes[a].tags)for(var r in nodes[a].tags)-1==s.indexOf(nodes[a].tags[r])&&s.push(nodes[a].tags[r]);if(s.length>0)for(var a in s.sort(),s){EscapeHtml(s[a]);i+="<option>"+EscapeHtml(s[a])+"</option>"}setModalContent("xxAddAgent","Editar etiquetas do dispositivo",t+=i+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:"Etiqueta1, Etiqueta2, Etiqueta3",closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0}),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){t="<div style=margin-bottom:4px>Executar notificação de dispositivo em lote</div>";t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Notificação de brinde</option><option value=1>Caixa de mensagem</option><option value=3>Alert Box</option></select>',t+='<input id=dp2notifyTitle maxlength=256 placeholder="Título" style=width:100%;box-sizing:border-box;margin-bottom:4px />',t+="<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>",t+="<select style=width:100% id=d2notifyTimeout>",t+='<option disabled value="">Only Applicable to Message Box Notifications</option>',t+="<option value=2 selected>Show for 2 Minutes (Default)</option>",t+="<option value=10>Show for 10 minutes</option>",t+="<option value=30>Show for 30 minutes</option>",t+="<option value=60>Show for 60 minutes</option>",t+="<option value=0>Mostrar mensagem até ser dispensada pelo usuário</option>",setModalContent("xxAddAgent","Notificação de dispositivo",t+="</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var l=!1,d=!1,c=getCheckedDevices();for(var a in c){var u;(u=getNodeFromId(c[a])).agent&&(u.agent.id>0&&u.agent.id<5||34==u.agent.id?l=!0:d=!0)}t="Carregue os arquivos selecionados para todos os dispositivos selecionados<br /><br />";t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>",t+="<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+c.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />",t+='<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',l&&(t+=addHtmlFormFloating("Caminho do Windows",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),d&&(t+=addHtmlFormFloating("Caminho Linux",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),t+='<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />Criar pasta se não existir?</label><br />',setModalContent("xxAddAgent","Carregando Arquivo em Lote",t+='<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />Substituir se o arquivo existir?</label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e){setModalContent("xxAddAgent","Forçar atualização do agente",t="Forçar atualização do agente em dispositivos selecionados?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec())}else if(111==e){setModalContent("xxAddAgent",'Apagar "Core" do agente',t='Apagar o "Core" do agente nos dispositivos selecionados?<br /><br />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec())}else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent",'Carregar o "Core" Padrão do Servidor',t="Carregar core de servidor padrão em dispositivos selecionados?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,o=Q("d2notifyMsg").value,n=getCheckedDevices(),a=parseFloat(Q("d2notifyTimeout").value);if(0!=o.length)if(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(a)&&(a=2),1==e)for(var i=0;i<n.length;i++)meshserver.send({action:"msg",type:"messagebox",nodeid:n[i],title:t,msg:o,timeout:6e4*a});else if(2==e)meshserver.send({action:"toast",nodeids:n,title:t,msg:o});else if(3==e)for(i=0;i<n.length;i++)meshserver.send({action:"msg",type:"alertbox",nodeid:n[i],title:t,msg:o})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,o=[],n=$("#dp10devicevalue").select2("data");for(var a in n)o.push(n[a].text.trim());if(2==t)for(var a in e)meshserver.send({action:"changedevice",nodeid:e[a],tags:o.join(",")});else{var i=[];for(var a in o){var s=o[a].trim();s.length>0&&s.length<64&&-1==i.indexOf(s)&&i.push(s)}for(var a in e){var r=null,l=!1,d=getNodeFromId(e[a]);null!=d.tags&&(r=Clone(d.tags)),null==r&&(r=[]);for(var c=0;c<o.length;c++)if(1==t&&-1==r.indexOf(o[c])&&(r.push(o[c]),l=!0),3==t){var u=r.indexOf(o[c]);u>=0&&(r.splice(u,1),l=!0)}l&&meshserver.send({action:"changedevice",nodeid:e[a],tags:r.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e=getCheckedDevices(),t=!1;for(var o in e)null!=getNodeFromId(e[o]).intelamt&&(t=!0);var n="Baixe a lista de dispositivos com um dos formatos de arquivo abaixo.<br /><br />";n+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"),n+=addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>"),t&&(n+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Exportar informações do dispositivo",n+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Incluir detalhes do dispositivo</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var o="id,name,rname,host,icon,ip,osdesc,state,groupname,conn,pwr,av,update,firewall,bitlocker,avdetails,tags,lastbootuptime\r\n";for(var n in e){var a=getNodeFromId(e[n]);if(o+='"'+a._id.split(",").join("")+'","'+a.name.split(",").join("")+'","'+(a.rname?a.rname.split(",").join(""):"")+'","'+(a.host?a.host.split(",").join(""):"")+'","'+a.icon+'","'+(a.ip?a.ip:"")+'","'+(a.osdesc?a.osdesc.split(",").join(""):"")+'","'+a.state+'","'+meshes[a.meshid].name.split(",").join("")+'","'+(a.conn?a.conn:"")+'","'+(a.pwr?a.pwr:"")+'"',"object"==typeof a.wsc?o+=',"'+csvClean(a.wsc.antiVirus)+'","'+csvClean(a.wsc.autoUpdate)+'","'+csvClean(a.wsc.firewall)+'"':o+=",,,","object"==typeof a.volumes){var i="",s=!0;for(var r in a.volumes)void 0!==a.volumes[r].protectionStatus&&(s?s=!1:i+="|",i+=r+"/"+a.volumes[r].volumeStatus);o+=',"'+csvClean(i)+'"'}else o+=",";if("object"==typeof a.av){var l="",d=!0;for(var r in a.av)"string"==typeof a.av[r].product&&(d?d=!1:l+="|",l+=a.av[r].product+"/"+(a.av[r].enabled?"enabled":"disabled")+"/"+(a.av[r].updated?"updated":"notupdated"));o+=',"'+csvClean(l)+'"'}else o+=",";if("object"==typeof a.tags){var c="",u=!0;for(var r in a.tags)u?u=!1:c+="|",c+=a.tags[r];o+=',"'+csvClean(c)+'"'}else o+=",";"number"==typeof a.lastbootuptime&&(o+=',"'+a.lastbootuptime+'"'),o+="\r\n"}saveAs(stringToUtf8Blob(o),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e=getCheckedDevices(),t={webappversion:"0.9.0",computers:[]};for(var o in e){var n=getNodeFromId(e[o]);if(null!=n.intelamt){var a={name:n.name,host:n.host,user:n.intelamt.user,pass:"",tls:1==n.intelamt.tls?1:0,ver:n.intelamt.ver,pstate:n.intelamt.state};2==n.intelamt.state&&(a.pmode=1),n.intelamt.realm&&(a.digestrealm=n.intelamt.realm),n.intelamt.hash&&(a.tlscerthash=n.intelamt.hash),t.computers.push(a)}}saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var o=[];for(var n in e)o.push(getNodeFromId(e[n]));saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t=!1,o=!1,n=!1;for(var a in e.nodeids){var i=getNodeFromId(e.nodeids[a]);i.agent&&(24&~GetNodeRights(i)||(n=!0),i.agent.id>0&&i.agent.id<5?t=!0:o=!0)}if(1==t||1==o||1==n){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}if(e.selectedFile){var r=e.selectedFile.name.toLowerCase();console.log("filename",r),r.endsWith(".bat")&&(s.type=1),r.endsWith(".ps1")&&(s.type=2),r.endsWith(".sh")&&(s.type=3),r.endsWith(".agentconsole")&&(s.type=4)}var l="";e.title&&(l+=e.title+"<br />"),l+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==t&&(l+="<option value=1"+(1==s.type?" selected":"")+">Prompt de comando do Windows</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==o&&(l+="<option value=3"+(3==s.type?" selected":"")+">Shell de comando Linux / BSD / macOS</option>"),1==n&&(l+="<option value=4"+(4==s.type?" selected":"")+">Console do Agente</option>"),l+="</select>",l+="<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.runAs?" selected":"")+">Executar como agente</option><option value=1"+(1==s.runAs?" selected":"")+">Executar como usuário, agente se nenhum usuário</option><option value=2"+(2==s.runAs?" selected":"")+">Deve ser executado como usuário</option></select>",null==e.selectedFile&&(l+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.source?" selected":"")+">Commands from text box</option><option value=1"+(1==s.source?" selected":"")+">Commands from file</option>",8&userinfo.siteadmin&&(l+="<option value=2"+(2==s.source?" selected":"")+">Commands from file on server</option>"),l+="</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):"")+"</textarea>",l+='<div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin&&(l+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>')),xxdialogTag=e,setModalContent("xxAddAgent","Executar comandos",l),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles())),d2runCommandValidate()}}function d2runCommandValidate(){if(QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile){QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value);var e=!1;0==Q("d2cmdsource").value&&Q("d2runcmd").value.length>0&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)}else QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var o=3;try{o=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:o,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var n={action:"runcommands",nodeids:t.nodeids,type:o,runAsUser:parseInt(Q("d2cmduser").value)};if(t.selectedFile)(a=new FileReader).onload=function(e){n.cmds=e.target.result,meshserver.send(n),t.func&&t.func()},a.readAsText(t.selectedFile);else if(0==Q("d2cmdsource").value)n.cmds=Q("d2runcmd").value,meshserver.send(n),t.func&&t.func();else if(1==Q("d2cmdsource").value){var a;(a=new FileReader).onload=function(e){n.cmds=e.target.result,meshserver.send(n),t.func&&t.func()},a.readAsText(Q("d2runfileex").files[0])}else if(2==Q("d2cmdsource").value){var i=d3getFileSel();if(1!=i.length)return;n.cmdpath=d3filetreelocation.join("/")+"/"+i[0],meshserver.send(n),t.func&&t.func()}}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){var o=e.name.toLowerCase(),n=t.name.toLowerCase();return sortCollator.compare(o,n)}function meshSort(e,t){var o=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=o||0!=(o=sortCollator.compare(e.meshid,t.meshid))?o:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var o=e.pwr?e.pwr:0,n=t.pwr?t.pwr:0;return o>n?-1:o<n?1:o==n?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var o=e.lastconnect,n=t.lastconnect;return null==o&&(o=99999999999999),null==n&&(n=99999999999999),e.conn>0&&(o=99999999999998),t.conn>0&&(n=99999999999998),o==n?nameSort(e,t):o-n}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t=e.split(" y "),o=null;for(var n in t){var a=getDevicesThatMatchFilter(t[n]);if(null==o)o=a;else{var i=[];for(var s in a)o.indexOf(a[s])>=0&&i.push(a[s]);o=i}}return o}function parseSearchOrInput(e){var t=e.split(" o "),o=null;for(var n in t){var a=parseSearchAndInput(t[n]);if(null==o)o=a;else for(var i in a)o.indexOf(a[i]>=0)&&o.push(a[i])}return o}function getDevicesThatMatchFilter(e){var t=[],o=null,n=null,a=null,i=null,s=null,r=null,l=null,d=null,c=null,u=null;if(e.startsWith("usuário:".toLowerCase())?o=e.substring(8):e.startsWith("u:".toLowerCase())?o=e.substring(2):e.startsWith("ip:".toLowerCase())?n=e.substring(3):e.startsWith("grupo:".toLowerCase())?a=e.substring(6):e.startsWith("g:".toLowerCase())?a=e.substring(2):e.startsWith("Etiqueta:".toLowerCase())?i=e.substring(9):e.startsWith("t:".toLowerCase())?i=e.substring(2):e.startsWith("atag:".toLowerCase())?s=e.substring(5):e.startsWith("a:".toLowerCase())?s=e.substring(2):e.startsWith("os:".toLowerCase())?l=e.substring(3):e.startsWith("amt:".toLowerCase())?d=e.substring(4):e.startsWith("desc:".toLowerCase())?c=e.substring(5):e.startsWith("connectivity:".toLowerCase())?u=e.substring(13):e.startsWith("c:".toLowerCase())?u=e.substring(2):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var p in nodes)t.push(p);else if(null!=n)for(var p in nodes)null!=nodes[p].ip&&nodes[p].ip.toLowerCase().indexOf(n)>=0&&t.push(p);else if(null!=a)for(var p in nodes)meshes[nodes[p].meshid].name.toLowerCase().indexOf(a)>=0&&t.push(p);else if(null!=i){for(var p in nodes)if(null==nodes[p].tags&&""==i)t.push(p);else if(null!=nodes[p].tags)for(var m in nodes[p].tags)if(nodes[p].tags[m].toLowerCase().indexOf(i)>=0){t.push(p);break}}else if(null!=s)for(var p in nodes)(null!=nodes[p].agent&&null==nodes[p].agent.tag&&""==s||null!=nodes[p].agent&&null!=nodes[p].agent.tag&&nodes[p].agent.tag.toLowerCase().indexOf(s)>=0)&&t.push(p);else if(null!=o){for(var p in nodes)if(nodes[p].users&&nodes[p].users.length>0)for(var g in nodes[p].users)nodes[p].users[g].toLowerCase().indexOf(o)>=0&&t.push(p)}else if(null!=l)for(var p in nodes)null!=nodes[p].osdesc&&nodes[p].osdesc.toLowerCase().indexOf(l)>=0&&t.push(p);else if(null!=d)for(var p in nodes)null==nodes[p].intelamt||""!=d&&nodes[p].intelamt.state!=d||t.push(p);else if(null!=c)for(var p in nodes)null!=nodes[p].desc&&""!=nodes[p].desc&&(""==c||nodes[p].desc.toLowerCase().indexOf(c)>=0)&&t.push(p);else if(null!=r)for(var p in nodes)nodes[p].wsc&&(1==r&&"OK"==nodes[p].wsc.antiVirus&&"OK"==nodes[p].wsc.autoUpdate&&"OK"==nodes[p].wsc.firewall?t.push(p):(2!=r&&5!=r||"OK"==nodes[p].wsc.antiVirus)&&(3!=r&&5!=r||"OK"==nodes[p].wsc.autoUpdate)&&(4!=r&&5!=r||"OK"==nodes[p].wsc.firewall)||t.push(p));else if(null!=u){for(var p in nodes)if(nodes[p].conn&&(1&nodes[p].conn&&(4==nodes[p].mtype?("PDU"==nodes[p].porttype&&"switch"==u.toLowerCase()||"ipkvm"==u.toLowerCase())&&t.push(p):"agent"==u.toLowerCase()&&t.push(p)),(2&nodes[p].conn&&"cira"==u.toLowerCase()||4&nodes[p].conn&&"amt"==u.toLowerCase())&&t.push(p),8&nodes[p].conn&&"relay"==u.toLowerCase()&&t.push(p),16&nodes[p].conn&&"mqtt"==u.toLowerCase()&&t.push(p)),3==nodes[p].mtype){var v=meshes[nodes[p].meshid];(v&&v.relayid&&"relay"==u.toLowerCase()||v&&void 0===v.relayid&&"local"==u.toLowerCase())&&t.push(p)}}else if("*"==e)for(var p in nodes)1==stars[nodes[p]._id]&&t.push(p);else try{var h=e.split(/\s+/).join("|"),f=new RegExp(h);for(var p in nodes)32768&features2?268435456&features2?(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase()))&&t.push(p):268435456&features2?showRealNames?(null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):(f.test(nodes[p].name.toLowerCase())||f.test(meshes[nodes[p].meshid].name.toLowerCase()))&&t.push(p):showRealNames?null!=nodes[p].rnamel&&f.test(nodes[p].rnamel.toLowerCase())&&t.push(p):f.test(nodes[p].name.toLowerCase())&&t.push(p)}catch(e){for(var p in nodes)t.push(p)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim();putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e);var t=parseSearchOrInput(e);for(var o in nodes)nodes[o].v=t.indexOf(o)>=0;var n=Q("DevFilterSelect").value;if(1==n)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn||3==nodes[o].mtype||(nodes[o].v=!1);if(2==n)for(var o in nodes){(null==(a=nodes[o]).sessions||null==a.sessions.kvm&&null==a.sessions.terminal&&null==a.sessions.files&&null==a.sessions.tcp&&null==a.sessions.udp)&&(a.v=!1)}if(3==n)for(var o in nodes)1!=stars[nodes[o]._id]&&(nodes[o].v=!1);if(4==n)for(var o in nodes)null==nodes[o].intelamt&&(nodes[o].v=!1);if(5==n)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn&&(nodes[o].v=!1);if(6==n)for(var o in nodes){null!=(a=nodes[o]).sessions&&null!=a.sessions.help||(a.v=!1)}if(7==n)for(var o in nodes){null!=(a=nodes[o]).tags&&0!=a.tags.length||(a.v=!1)}if(8==n)for(var o in nodes){var a;null!=(a=nodes[o]).tags&&a.tags.length>0&&(a.v=!1)}}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(serverinfo.linuxshell&&currentNode.agent.id>4)return;var o=e.target.nextElementSibling;if(o)for(var n=o.children,a=currentNode.agent.id>4&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,i=0;i<n.length;i++)n[i].style.display=a?n[i].classList.contains(a)?"block":"none":n[i].classList.contains("lin")||n[i].classList.contains("ass")?"none":"block"}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,o=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,n=document.elementFromPoint(e.pageX-t,e.pageY-o);n&&null!=n&&null==n.attributes.cmenu;)n=n.parentElement;if(null==n)return!0;var a=n.attributes.cmenu.value;if("devsContentMenu"===a){contextelement=n;var i,s=document.getElementById("contextMenu");showContextMenuDiv(s,e.pageX,e.pageY);var r=getNodeFromId((i=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,i.length-18)),l=GetNodeRights(r),d=!!(16&l),c=4294967295==l||!(65536&l),u=4294967295==l||!(512&l),p=4294967295==l||!(1024&l);QV("cxdesktop",!!(1&r.conn)&&4!=r.mtype&&(1==r.mtype||null==r.agent||null==r.agent.caps||!!(1&r.agent.caps)||r.intelamt&&2==r.intelamt.state)&&(8&l||256&l)&&c),QV("cxterminal",!!(1&r.conn)&&4!=r.mtype&&(1==r.mtype||null==r.agent||null==r.agent.caps||!!(2&r.agent.caps)||r.intelamt&&2==r.intelamt.state)&&8&l&&u),QV("cxfiles",4!=r.mtype&&2==r.mtype&&(null==r.agent||null==r.agent.caps||!!(4&r.agent.caps))&&8&l&&p),QV("cxevents",null!=r.intelamt&&(2==r.intelamt.state||2&r.conn)&&8&l),QV("cxdetails",r.mtype<3),QV("cxwebvnc",(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)&&!(536870912&features)),QV("cxwebrdp",(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)&&!(1073741824&features)),QV("cxwebssh",512&features2&&(!!(1&r.conn)||3==r.mtype)&&r.agent&&!!(8&l)),QV("cxconsole",d&&2==r.mtype&&(null==r.agent||null==r.agent.caps||!!(8&r.agent.caps))&&8&l),QV("cxrdp",!1),(1&r.conn||3==r.mtype)&&r.agent&&8&l&&r.agent.id>0&&r.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(s=document.getElementById(a)))return!0;contextelement=n,showContextMenuDiv(s,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,o){var n=document.documentElement.getBoundingClientRect(),a=n.height,i=n.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,t>i/2?e.style.right=i-event.pageX+"px":e.style.left=event.pageX+"px",o>a/2?e.style.bottom=a-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var o;if(o=(o=1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0].attributes.onmouseup.value:contextelement.children[1].attributes.onmouseup.value).substring(12,o.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),e>0&&e<9){var n=[0,10,12,11,13,16,17,15,19][e];if(t&&1==t.shiftKey)safeNewWindow(window.location.origin+"?node="+o.split("/")[2]+"&viewmode="+n+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+o);else{gotoDevice(o,n);var a=meshes[currentNode.meshid];1&currentNode.conn&&2==a.mtype&&(11==n&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==n&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==n&&null==files&&connectFiles(null))}}if(10==e){for(var i=document.getElementsByClassName("DeviceCheckbox"),s=[],r=0;r<i.length;r++)!0===i[r].checked&&s.push(i[r].defaultValue.substring(6));for(var r in 0==s.length&&s.push(o),s)null!=stars[s[r]]&&(delete stars[s[r]],delete s[r]);var l=Object.keys(stars).length;for(var r in s)l<200&&null==stars[s[r]]&&(stars[s[r]]=1,l++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(o),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(o):12==e?p10rfb(o):13==e?p10ssh(o):14==e&&p10MCRouter(o,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),o=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var n=0;n<o.length;n++)o[n].attributes&&o[n].attributes.class.value.split(" ")[0]==t&&(o[n].checked=1==e);if(1==e)for(var n in nodes)nodes[n].meshid==t&&1==nodes[n].v&&(checkedNodeids[nodes[n]._id]=1);else if(2==e)for(var n in checkedNodeids){var a=getNodeFromId(n);null!=a&&a.meshid==t&&1==a.v&&delete checkedNodeids[n]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","Conexão RDP",'Porta de conexão remota RDP:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rdpport").value.length>0?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport)}}function cmsshportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","Conexão SSH",'Porta de conexão remota SSH:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10sshport").value.length>0?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport)}}function cmrfbportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","Conexão VNC",'Porta de conexão remota VNC:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10rfbport").value.length>0?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport)}}function cmhttpportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","Conexão HTTP",'Porta de conexão remota HTTP:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpport").value.length>0?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport)}}function cmhttpsportaction(e){if(!xxdialogMode){setModalContent("xxAddAgent","Conexão HTTPS",'Porta de conexão remota HTTPS:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=Q("d10httpsport").value.length>0?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport)}}function cmfilesaction(e){if(!xxdialogMode){var t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)];1==e?(setModalContent("xxAddAgent","Renomear",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Editor de Arquivo","Somente arquivos com menos de 200k podem ser editados."):3==e&&(setModalContent("xxAddAgent","Excluir","Apagar item?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t)))}}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes){if((n=nodes[t]).tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx(n.tags[o])]=!0}if(4==sort)for(var t in CollapsedGroups={},nodes){var n=nodes[t],a=meshes[n.meshid];if(a){if(CollapsedGroups["tag:"+encodeURIComponentEx(a.name)]=!0,n.tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx(a.name+" - "+n.tags[o])]=!0}else if(n.tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+n.tags[o])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(32768&features){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t=null;for(var o in nodes)try{var n=map_parseNodeLoc(nodes[o]),a=xxmap.markersSource.getFeatureById(nodes[o]._id);if(null==n||nodes[o].meshid!=e&&null!=e)a&&xxmap.markersSource.removeFeature(a);else{var i=n[0],s=n[1];n[2];null==t?t=[i,s,i,s,0]:(i<t[0]&&(t[0]=i),s<t[1]&&(t[1]=s),i>t[2]&&(t[2]=i),s>t[3]&&(t[3]=s)),null==a?(addFeature(nodes[o]),t[4]=1):(updateFeature(nodes[o],a),a.setStyle(markerStyle(nodes[o],n[2])))}}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[o]))}return t}}}function stringToIntHash(e){var t,o=0;for(t=0;t<e.length;t++)o=(o<<5)-o+e.charCodeAt(t),o|=0;return o}function map_parseNodeLoc(e){var t=null,o=0;return e.iploc&&(t=e.iploc,o=1),e.wifiloc&&(t=e.wifiloc,o=2),e.gpsloc&&(t=e.gpsloc,o=3),e.userloc&&(t=e.userloc,o=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==o?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,o]:[parseFloat(t[0]),parseFloat(t[1]),o])}function loadmap(){if(32768&features&&null!=xxmap)if(32768&features){QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){var o=t.getId();if(null!=o)gotoDevice(o,10);else gotoDevice(getCorrespondingFeature(t).getId(),10)}}),xxmap.map.on("pointermove",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t){xxmap.map.getTargetElement().style.cursor="pointer";var o=t.getGeometry().getCoordinates();if(map_cm_popup.setPosition(o),t.getId())QH("xmap-info-window",t.get("name"));else{var n=getCorrespondingFeature(t);QH("xmap-info-window",n.get("name"))}}else xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window","")});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var t=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(xxmap.contextmenu.clear(),t)if(t.getId())addContextMenuItems(t);else{var o=getCorrespondingFeature(t);o?addContextMenuItems(o):xxmap.contextmenu.extend(contextmenu_items)}else xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}else xxmap=null}function addFeature(e,t,o){var n=getModifiedFeature(e._id);if(n)xxmap.markersSource.addFeature(n);else{if(!t&&!o){var a=map_parseNodeLoc(e);t=a[0],o=a[1]}if(o>180&&(o=180-o,meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,o]})),t<90&&t>-90&&o<180&&o>-180){var i=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([o,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:o});i.setId(e._id),i.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(i)}}}function removeFeature(e){var t=xxmap.markersSource.getFeatureById(e._id);t&&xxmap.markersSource.removeFeature(t)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var o=map_parseNodeLoc(e);if(null!=o){var n=o[0],a=o[1];if(n!=t.get("lat")||a!=t.get("lon")){t.set("lat",n),t.set("lon",a);var i=ol.proj.transform([parseFloat(a),parseFloat(n)],"EPSG:4326","EPSG:3857");t.getGeometry().setCoordinates(i)}}e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t=e.getId();if(t&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),!getActiveInteractions(e))){var o=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10});xxmap.activeInteractions.push({featureid:t,feature:e,interaction:o}),xxmap.map.addInteraction(o)}}function saveMarkerloc(e){var t=e.getId();if(t){var o=getActiveInteractions(e);if(o){xxmap.map.removeInteraction(o),removeInteraction(t);var n=e.getGeometry().getCoordinates(),a=ol.proj.transform(n,"EPSG:3857","EPSG:4326");a[0]>180&&(a[0]=180-a[0]);var i=[a[1],a[0]];meshserver.send({action:"changedevice",nodeid:t,userloc:i})}}}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc&&(t=4));var o=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:o,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(e){getActiveInteractions(e)?(map_cm_saveMarker.data=e,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=e,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(e.a).userloc&&(map_cm_clearMarker.data=e,xxmap.contextmenu.push(map_cm_clearMarker)));map_cm_nodemenu_items.forEach(function(t){"Amplie a extensão"==t.text||"Diminuir o zoom até a extensão"==t.text?t.data=e:"-"!=t&&(t.data=e.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),o=0;o<xxmap.activeInteractions.length;o++)if(xxmap.activeInteractions[o].featureid==t)return xxmap.activeInteractions[o].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,o=0;o<xxmap.activeInteractions.length;o++)if(xxmap.activeInteractions[o].featureid===e){t=o;break}t>=0&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),o=0;o<xxmap.activeInteractions.length;o++){var n=xxmap.activeInteractions[o].feature,a=n.getGeometry().getCoordinates();if(a[0].toFixed(5)==t[0].toFixed(5)&&a[1].toFixed(5)==t[1].toFixed(5))return n}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);var o=updateMapMarkers();if(null!=o&&(t||1==o[4])){var n=(o[0]+o[2])/2,a=(o[1]+o[3])/2,i=Math.max(Math.abs(o[0]-o[2]),Math.abs(o[1]-o[3])),s=xxmap.map.getView();s.setCenter(ol.proj.transform([a,n],"EPSG:4326","EPSG:3857"));for(var r=360,l=-2;r>i;)l++,r/=2;s.setZoom(l)}}function placeNode(e){if(!xxdialogMode){var t='<div style=margin-bottom:6px><label for=selectnode-search>Procurar</label>&nbsp&nbsp<input type=text placeholder="Nome do dispositivo" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Nenhum dispositivo encontrado.</div>';for(var o in nodes)t+="<div class=noselect id="+nodes[o]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[o]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[o]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />',t+="<div class=j"+nodes[o].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[o].name+"</div></div>";setModalContent("xxAddAgent","Selecione um nó para colocar",t+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var o=document.getElementsByName("PlaceMapDeviceCheckbox");for(var n in o)if(o[n].checked){var a=getNodeFromId(o[n].id.substring(0,o[n].id.length-8));if(a){var i=xxmap.markersSource.getFeatureById(n),s=ol.proj.transform(t,"EPSG:3857","EPSG:4326"),r=[s[1],s[0]];if(i)i.getGeometry().setCoordinates(t),getActiveInteractions(i)?saveMarkerloc(i):meshserver.send({action:"changedevice",nodeid:a._id,userloc:r});else meshserver.send({action:"changedevice",nodeid:a._id,userloc:r})}}}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t=0;for(var o in nodes){var n=nodes[o].namel.indexOf(e)>=0||""==e||null!=nodes[o].rnamel&&nodes[o].rnamel.indexOf(e)>=0;n&&t++,QV(nodes[o]._id+"-rowid",n)}QV("noNodesMapPlace",0==t)}function selectNodeToPlace(e,t){if("PlaceMapDeviceCheckbox"!=e.target.name){var o=Q(t+"-checkid");o.checked=!o.checked}var n=document.getElementsByName("PlaceMapDeviceCheckbox"),a=0;for(var i in n)n[i].checked&&a++;QE("idx_dlgOkButton",a>0)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e=Q("mapSearchLocation").value.trim();if(e.length>0){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&formatSearchData(t.responseText)},t.open("GET","https://nominatim.openstreetmap.org/search?q="+e+"&format=json",!0),t.send()}}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),o=0,n='<div class="xmapItem">',a=0;a<t.length;a++)if(t[a].display_name&&t[a].boundingbox[0]&&t[a].boundingbox[1]&&t[a].boundingbox[2]&&t[a].boundingbox[3]){o++;n+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[a].display_name+"</div><div style=display:none>"+t[a].boundingbox[0]+"!#!"+t[a].boundingbox[1]+"!#!"+t[a].boundingbox[2]+"!#!"+t[a].boundingbox[3]+"</div></div>"}if(n+="</div>",1==o)zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]);else 0==o&&(n="<div style=width:200px>Nenhum local encontrado.<div>"),QV("xmapSearchResultsDlg",!0);QH("xmapSearchResults",n)}catch(e){}}function mapGotoSelectedLocation(e){var t=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(t[2]),parseFloat(t[0]),parseFloat(t[3]),parseFloat(t[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var o=xxmap.map.getView();o.setCenter(e),o.setZoom(t)}function zoomToFitExtent(){if(xxmap.markersSource.getFeatures().length>0){var e=xxmap.markersSource.getExtent();xxmap.map.getView().fit(e,xxmap.map.getSize())}}function zoomToExtent(e){var t=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(t,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Modificar a localização do nó",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Remover a localização do nó",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Salvar localização do nó",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Informação geral",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Área de Trabalho",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminal",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Amplie a extensão",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Diminuir o zoom até a extensão",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Atualizar",callback:function(){refreshMap(!0,!0)}},{text:"Zoom para ajustar a extensão",callback:function(){zoomToFitExtent()}},{text:"Centralize o mapa aqui",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Coloque o nó aqui",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,o,n){if(!n||3!=n.which&&2!=n.button){if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Segurança da conta",'Incapaz de acessar este recurso até que um endereço de e-mail seja verificado. Isso é necessário para recuperação de senha. Vá para a guia "Minha conta" para alterar e verificar um endereço de e-mail.'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Segurança da conta",'Não é possível acessar este recurso até que a autenticação de dois fatores seja ativada. Isso é necessário para segurança extra. Vá para a guia "Minha conta" e verifique a seção "Segurança da conta".'),void showModal("xxAddAgentModal","idx_dlgOkButton");if(!n||1!=n.shiftKey&&2!=n.which&&1!=n.button){var a=getNodeFromId(e);if(null!=a){null!=currentNode&&currentNode._id==a._id&&1&a.conn||deviceDetailsStatsClear();var i=meshes[a.meshid],s=GetNodeRights(a),r=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=a._id||1==o){if(currentNode=a,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery){var l=currentNode.sessions.battery,d="";"ac"==l.state&&(d="O dispositivo está conectado"),"dc"==l.state&&(d="O dispositivo é alimentado por bateria");var c="",u=-1;"number"==typeof l.level&&l.level>=0&&l.level<=100&&(c=l.level+"%",(u=Math.floor((l.level+10)/25)+1)>5&&(lvl=5),"ac"==l.state&&(100==l.level?u=11:u+=5)),u>0&&(Q("p10deviceBattery").title=null!=d?d+", "+c:c,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+u)}else QV("p10deviceBattery",!1);var p,m=EscapeHtml(a.name);0==m.length&&(m="<i>Nenhum</i>"),4&s&&(!i.flags||!(2&i.flags)||16&i.flags)&&(m='<span tabindex=0 title="Clique aqui para editar o nome do dispositivo no servidor" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+m+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),p=m,i&&(m+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(i.name)+"</span>"),QH("p10deviceName",m),QH("p11deviceName",m),QH("p12deviceName",m),QH("p13deviceName",m),QH("p14deviceName",m),QH("p15deviceName","Console -"+m),QH("p16deviceName",m),QH("p17deviceName",m),QH("p19deviceName",m);var g="<table style=width:100%>";8&args.hide&&(g+="<br />"+addDeviceAttribute("Nome",p)),i&&(g+=addDeviceAttribute('<span title="O nome do grupo de dispositivos ao qual este computador pertence.">Grupo</span>','<a href=# title="O nome do grupo de dispositivos ao qual este computador pertence" onclick=gotoMesh("'+a.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[a.meshid].name)+"</a>")),null!=a.rname&&a.name!=a.rname&&(g+=addDeviceAttribute('<span title="O nome deste computador conforme definido no sistema operacional">Nome do SO</span>','<span title="O nome deste computador conforme definido no sistema operacional">'+EscapeHtml(a.rname)+"</span>")),(1&features||4==a.mtype)&&3!=a.mtype||(g+=addDeviceAttribute("Nome do Host",addLinkConditional(a.host?EscapeHtml(a.host):"<i>Nenhum</i>","showEditNodeValueDialog(1)",4&s)));var v=a.desc?EscapeHtml(a.desc):"<i>Nenhum</i>";if(g+=addDeviceAttribute("Descrição",4&s?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+v+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':v),4==a.mtype&&(null!=a.portnum&&(g+=addDeviceAttribute("Número da Porta",a.portnum)),null!=a.porttype&&(g+=addDeviceAttribute("Tipo de Porta",a.porttype))),null!=a.agent&&null!=a.agent.id&&3==a.mtype)4==a.agent.id&&(g+=addDeviceAttribute("Tipo de dispositivo","Windows")),6==a.agent.id&&(g+=addDeviceAttribute("Tipo de dispositivo","Linux")),29==a.agent.id&&(g+=addDeviceAttribute("Tipo de dispositivo","Mac OS"));else if(null!=a.agent&&null!=a.agent.id&&null!=a.agent.ver){var h="";h=a.agent.id<=agentsStr.length?agentsStr[a.agent.id]:agentsStr[0],0!=a.agent.ver&&(h+=" v"+a.agent.ver),14==a.agent.id&&(h=a.agent.core),!1===a.agent.root&&1&a.conn&&(h+=", Restrito"),g+=addDeviceAttribute("Agente Mesh",h)}if(null!=a.intelamt){h="";var f={0:nobreak("Não ativado (pré)"),1:nobreak("Não ativado (In)"),2:nobreak("ativado")};if(null!=a.intelamt.ver&&null==a.intelamt.state?h+="<i>Estado Desconhecido</i>, v"+EscapeHtml(a.intelamt.ver):null==a.intelamt.ver&&2==a.intelamt.state?h+="<i>ativado</i>":null==a.intelamt.ver||null==a.intelamt.state?h+="<i>Versão e estado desconhecidos</i>":(h+=f[a.intelamt.state],2==a.intelamt.state&&a.intelamt.flags&&(2&a.intelamt.flags?h+=' <span title="Intel&reg; AMT está ativado no modo de controle do cliente">CCM</span>':4&a.intelamt.flags&&(h+=' <span title="Intel&reg; AMT é ativado no modo de controle de administrador">ACM</span>')),h+=", v"+EscapeHtml(a.intelamt.ver)),2==a.intelamt.state){1==a.intelamt.tls&&(h+=', <span title="Intel&reg; AMT está configurado com segurança de rede TLS">TLS</span>');var x=!1;if(null==a.intelamt.user||""==a.intelamt.user)4&s?(h+=', <i style=color:#FF0000;cursor:pointer title="Editar credenciais Intel&reg; AMT" onclick=editDeviceAmtSettings("'+a._id+'")>Sem credenciais</i>',x=!0):h+=", <i style=color:#FF0000>Sem credenciais</i>";else if(1&features2&&null!=a.intelamt.warn){var k=null;1&a.intelamt.warn&&(k="Credenciais inválidas"),8&a.intelamt.warn&&(k="Tentando credenciais"),null!=k&&(4&s?(h+=', <i style=color:#FF0000;cursor:pointer title="Editar credenciais Intel&reg; AMT" onclick=editDeviceAmtSettings("'+a._id+'")>'+k+"</i>",x=!0):h+=", <i style=color:#FF0000>"+k+"</i>")}4&s&&!(1&features2)&&(x=!0),h+=" ",x&&(h+='<img src=images/link4.png height=10 width=10 title="Editar credenciais Intel&reg; AMT" style=cursor:pointer onclick=editDeviceAmtSettings("'+a._id+'")>')}var b='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>';"number"==typeof a.intelamt.sku&&(8&a.intelamt.sku?b='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':16&a.intelamt.sku&&(b='<span title="Intel&reg; Standard Manageability">Intel&reg; SM<span>')),g+=addDeviceAttribute(b,h)}if(null!=a.agent&&null!=a.agent.tag)(y=EscapeHtml(a.agent.tag)).startsWith("mailto:")&&(y='<a href="'+EscapeHtml(y)+'">'+EscapeHtml(y.substring(7))+"</a>"),g+=addDeviceAttribute("Tags do Agente",y);else if(null!=a.intelamt&&null!=a.intelamt.tag){var y;(y=EscapeHtml(a.intelamt.tag)).startsWith("mailto:")&&(y='<a href="'+EscapeHtml(y)+'">'+EscapeHtml(y.substring(7))+"</a>"),g+=addDeviceAttribute("Etiqueta Intel&reg; AMT",y)}if(a.osdesc&&(g+=addDeviceAttribute("Sistema operacional",a.osdesc)),a.wsc){var w=[];null!=a.wsc.antiVirus&&("OK"==a.wsc.antiVirus?w.push("AV - <span style=color:green>OK</span>"):w.push("AV - <span style=color:red>Ruim</span>")),null!=a.wsc.autoUpdate&&("OK"==a.wsc.autoUpdate?w.push("Atualizar - <span style=color:green>OK</span>"):w.push("Atualizar - <span style=color:red>Ruim</span>")),null!=a.wsc.firewall&&("OK"==a.wsc.firewall?w.push("Firewall - <span style=color:green>OK</span>"):w.push("Firewall - <span style=color:red>Ruim</span>")),g+=addDeviceAttribute("Segurança do Windows",w.join(", "))}if(a.defender){w=[];null!=a.defender.RealTimeProtection&&(1==a.defender.RealTimeProtection?w.push("RealTimeProtection - <span style=color:green>On</span>"):w.push("RealTimeProtection - <span style=color:red>Desligado</span>")),null!=a.defender.TamperProtected&&(1==a.defender.TamperProtected?w.push("TamperProtection - <span style=color:green>On</span>"):w.push("TamperProtection - <span style=color:red>Desligado</span>")),w.length>0&&(g+=addDeviceAttribute("Windows Defender",w.join(", ")))}if(a.av&&a.av.length>0){w=[];for(var C in a.av)if(a.av[C].product){var M=EscapeHtml(a.av[C].product);!0!==a.av[C].enabled&&(M+=" - <span style=color:red>Desabilitado</span>"),!0!==a.av[C].updated&&(M+=" - <span style=color:red>Desatualizado</span>"),1==a.av[C].enabled&&1==a.av[C].updated&&(M+=" - <span style=color:green>OK</span>"),w.push(M)}g+=addDeviceAttribute("Antivírus",w.join("<br />"))}if(a.users&&a.users.length>0){var S=a.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Bloqueado",a.lusers&&a.lusers.indexOf(e)>=0)}).join(", ");g+=addDeviceAttribute(a.users.length>1?"Usuarios activos":"Usuario activo",S)}if(null!=a.agent&&14!=a.agent.id&&3!=a.mtype){var A=[],D=0;a.consent&&(D=a.consent),serverinfo.consent&&(D|=serverinfo.consent),64&D&&8&D?A.push("Prompt da área de trabalho + barra de ferramentas"):64&D?A.push("Barra de ferramentas da área de trabalho"):8&D?A.push("Desktop Prompt"):1&D&&A.push("Notificar área de trabalho"),16&D?A.push("Prompt de Terminal"):2&D&&A.push("Notificação de Terminal"),32&D?A.push("Arquivos Prompt"):4&D&&A.push("Arquivos de notificação"),7==D&&(A=["Notificar sempre"]),56&~D||(A=["Sempre Perguntar"]),""==(A=A.join(", "))&&(A="<i>Nenhum</i>"),g+=addDeviceAttribute("Consentimento do usuário",addLinkConditional(A,"p20editmeshconsent(3)",1&s))}var T=[];if(null!=userinfo.notify&&null!=userinfo.notify[a._id]){var E=userinfo.notify[a._id];if(2&E&&T.push("Conectar"),4&E&&T.push("Desconectar"),null!=a.intelamt&&8&E&&T.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var N=0;16&E&&N++,32&E&&N++,64&E&&N++,N>0&&T.push(format("Email ({0})",N))}if(null!=userinfo.msghandle&&33554432&features2){N=0;128&E&&N++,256&E&&N++,512&E&&N++,N>0&&T.push(format("Messaging ({0})",N))}}""==(T=T.join(", "))&&(T="<i>Nenhum</i>"),g+=addDeviceAttribute("Notificações",addLink(T,"p20editDeviceNotify()"));var I=a.conn;if(I&&I>1){var _=[];1&a.conn&&_.push('<span title="O agente Mesh está conectado e pronto para uso.">Agente Mesh</span>'),2&a.conn?_.push('<span title="Intel&reg; AMT CIRA está conectado e pronto para uso.">Intel&reg; AMT CIRA</span>'):4&a.conn&&_.push('<span title="Intel&reg; AMT está roteável e pronto para uso.">Intel&reg; AMT</span>'),8&a.conn&&_.push('<span title="O agente Mesh pode ser acessado usando outro agente como retransmissor.">Mesh Relay</span>'),16&a.conn&&_.push('<span title="A conexão MQTT com o dispositivo está ativa.">MQTT</span>'),g+=addDeviceAttribute("Conectividade",_.join(", "))}var V="<i>Nenhum</i>";if(null!=a.tags)for(var C in V="",a.tags)V+="<span class=tagSpan>"+EscapeHtml(a.tags[C])+"</span> ";if(g+=addDeviceAttribute("Etiqueta",4&s?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+V+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+V+"</span>"),null!=a.ssh||null!=a.rdp){w=[];4&s?(null!=a.ssh&&w.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==a.ssh?"SSH-Usuário+Pass":2==a.ssh?"SSH-Usuário+Chave+Pass":"SSH-Usuário+Chave")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=a.rdp&&w.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=a.ssh&&w.push(1==a.ssh?"SSH-Usuário+Pass":2==a.ssh?"SSH-Usuário+Chave+Pass":"SSH-Usuário+Chave"),null!=a.rdp&&w.push("RDP")),g+=addDeviceAttribute("Credenciais",w.join(", "))}var U=[];for(var C in meshes)meshes[C].relayid==a._id&&U.push('<a href=# onclick=gotoMesh("'+meshes[C]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[C].name)+"</a>");if(U.length>0&&(g+=addDeviceAttribute('<span title="Grupos de dispositivos este dispositivo é um relé para">Relé para</span>',U.join(","))),g+="</table><br />",262220&s&&a.mtype<3&&(null==a.agent||34!=a.agent.id)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Ações" title="Execute ações de energia no dispositivo" onclick=deviceActionFunction() />'),g+='<input type=button class="btn btn-primary btn-sm me-2" value="Notas" title="Ver notas sobre este dispositivo" onclick=showNotes('+!(128&s)+',"'+encodeURIComponentEx(a._id)+'") />',g+='<input type=button class="btn btn-primary btn-sm me-2" value="Log de Eventos" title="Escreva um evento para este dispositivo" onclick=writeDeviceEvent("'+encodeURIComponentEx(a._id)+'") />',2==a.mtype&&1&I&&131072&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Run" title="Execute comandos neste dispositivo." onclick=runDeviceCmd("'+encodeURIComponentEx(a._id)+'") />'),4!=a.mtype){if((8&s&&1&I&&16384&s||1==a.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Mensagem" title="Exibir uma mensagem de texto no dispositivo remoto" onclick=deviceMessageFunction() />'),(8&s&&1&I&&16384&s||1==a.pmt&&2&features2)&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Bate-papo" title="Abra a janela de bate-papo neste computador" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&I)for(var C in serverinfo.altmessenging){var R=serverinfo.altmessenging[C];null!=R.type&&"device"!=R.type||(g+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[C].name)+'" onclick=altDeviceChat(event,'+C+") />")}!(!1!==serverinfo.guestdevicesharing&&null!=a.agent&&3&a.agent.caps&&1&I)||524296&~s||4294967295!=s&&4096&s?QV("DeskGuestShareButton",!1):(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Compartilhar" title="Crie um link para compartilhar este dispositivo com um convidado" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0))}if(4==a.mtype&&1&I&&("PDU"==a.porttype?1==a.pwr?262144&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Desligar" title="Desligar" onclick=setIpPduState(0) />'):8==a.pwr&&64&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Ligar" title="Ligar" onclick=setIpPduState(1) />'):8&s&&(g+='<input type=button class="btn btn-primary btn-sm me-2" value="Controle remoto" title="Controle remoto" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(a._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var C in customui.devicebuttons)(null==customui.devicebuttons[C].showif||null!=i&&customui.devicebuttons[C].showif==i._id||customui.devicebuttons[C].showif==currentNode._id)&&(g+='<input id="cui:'+C+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[C].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",g),mainUpdate(256);var F=4294967295==s||!(65536&s),H=4294967295==s||!(512&s),B=4294967295==s||!(1024&s),O=4294967295==s||!(2048&s);if(g='<div class="p10html3right">',1&s&&4!=a.mtype&&(g+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+a._id+'"]) title="Mova este dispositivo para um grupo de dispositivos diferente">Alterar Grupo</a>'),32768&s&&(g+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+a._id+'") title="Remova este dispositivo">Apagar Dispositivo</a>'),g+='</div><div class="p10html3left">',a.agent&&3!=a.mtype&&1048576&s&&(g+='<a href=# onclick=p10showNodeNetInfoDialog("'+a._id+'") title="Mostrar informações de interface de rede do dispositivo">Interfaces</a>&nbsp;'),32768&features&&null!=xxmap&&(g+='<a href=# onclick=p10showNodeLocationDialog("'+a._id+'") title="Mostrar informações de localização de dispositivos">Localização</a>&nbsp;'),null==a.agent||14!=a.agent.id&&34!=a.agent.id){if(4294967295!=userinfo.siteadmin&&128&userinfo.siteadmin||H&&8&s&&null!=a.agent&&14!=a.agent.id&&(g+='<a href=# onclick=p10showMeshCmdDialog(1,"'+a._id+'") title="Roteador de tráfego usado para conectar a um dispositivo através deste servidor.">MeshCmd</a>&nbsp;'),!(0===args.xterm&&a.agent&&2&a.agent.caps&&8&s)||4294967295!=s&&512&s||(g+='<a href=# onclick=p10openxterm(event,"'+a._id+'") title="Abra o terminal XTerm">XTerm</a>&nbsp;'),(1&I||3==a.mtype)&&a.agent&&8&s&&(0!=webRelayPort&&(g+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+a._id+'",1,'+(a.httpport?a.httpport:80)+")>HTTP"+(a.httpport&&80!=a.httpport?"/"+a.httpport:"")+"</a>&nbsp;",g+='<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+a._id+'",2,'+(a.httpsport?a.httpsport:443)+")>HTTPS"+(a.httpsport&&443!=a.httpsport?"/"+a.httpsport:"")+"</a>&nbsp;"),a.agent.id>0&&a.agent.id<5&&"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(g+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+a._id+'",3) title="Requer a instalação do MeshCentral Router.">RDP'+(a.rdpport&&3389!=a.rdpport?"/"+a.rdpport:"")+"</a>&nbsp;")),a.agent.id>4&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",4,'+(a.sshport?a.sshport:22)+') title="Requer a instalação do MeshCentral Router.">SSH'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;"),"win32"==navigator.platform.toLowerCase()&&(null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(g+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",5,'+(a.sshport?a.sshport:22)+') title="Requer a instalação do MeshCentral Router.">SCP'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;"))),("win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks)))for(var C in serverinfo.devicemeshrouterlinks.extralinks){var P=serverinfo.devicemeshrouterlinks.extralinks[C],L='"'+P.protocol+'"';if(doesDeviceMatchFilterTags(a,P.filter)){if("number"==typeof P.protocol?L=P.protocol:"http"==P.protocol?L=1:"https"==P.protocol?L=2:"rdp"==P.protocol?L=3:"ssh"==P.protocol?L=4:"scp"==P.protocol?L=5:"mcrdesktop"==P.protocol?L=6:"mcrfiles"==P.protocol&&(L=7),(6==L||7==L)&&2!=a.mtype)continue;g+='<a href=# onclick=p10MCRouter("'+a._id+'",'+L+","+P.port+(P.ip?',"'+P.ip+'"':",null")+","+(P.localport?P.localport:0)+') title="Requer a instalação do MeshCentral Router.">'+P.name+"</a>&nbsp;"}}(1&I||3==a.mtype)&&a.agent&&8&s&&!(536870912&features)&&(g+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+a._id+'") title="Inicie a sessão VNC baseada na web para este dispositivo.">Web-VNC</a>&nbsp;'),(1&I||3==a.mtype)&&a.agent&&8&s&&!(1073741824&features)&&(g+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+a._id+'") title="Inicie a sessão RDP baseada na web para este dispositivo.">Web-RDP</a>&nbsp;'),512&features2&&(1&I||3==a.mtype)&&a.agent&&8&s&&(g+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+a._id+'") title="Inicie a sessão SSH baseada na web para este dispositivo.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(g+='<a href=# onclick=p10showMqttLoginDialog("'+a._id+'") title="Obtenha credenciais de login MQTT para este dispositivo.">Login MQTT</a>&nbsp;')}g+="</div><br>",3==a.mtype?(QH("p10html3",""),QH("p10html5",g)):(QH("p10html3",g),QH("p10html5",""));var z=PowerStateStr(a.state),G="";null!=a.agent&&!1===a.agent.root&&(G=', <span title="O agente está sendo executado em um dispositivo remoto com privilégios reduzidos.">Restrito</span>'),1&I&&(z.length>0&&(z+="<br/>"),4==a.mtype?"PDU"==a.porttype?z+='<span style=font-size:12px title="Porta do switch conectada">Porta do switch conectada</span>'+G:z+='<span style=font-size:12px title="Porta IP-KVM conectada">Porta IP-KVM conectada</span>'+G:z+='<span style=font-size:12px title="Agente conectado">Agente conectado</span>'+G),2&I?(z.length>0&&(z+="<br/>"),z+='<span style=font-size:12px title="Intel&reg; AMT conectado">Intel&reg; AMT conectado</span>'):4&I&&(z.length>0&&(z+="<br/>"),z+='<span style=font-size:12px title="Intel&reg; AMT detectado">Intel&reg; AMT detectado</span>'),16&I&&(z.length>0&&(z+="<br/>"),z+='<span style=font-size:12px title="MQTT conectado">Canal MQTT conectado</span>'),""==z&&a.lastconnect?z="<span style=font-size:12px>Visto pela última vez:<br />"+printDateTime(new Date(a.lastconnect))+"</span>":("PDU"==a.porttype||a.pwr>1&&7!=a.pwr)&&(z+="<br/>"+powerStateStrings[a.pwr]),QH("MainComputerState",z),Q("MainComputerImage").setAttribute("src","images/icons256-"+a.icon+"-1.png"),Q("MainComputerImage").className=a.conn&&0!=a.conn||3==a.mtype?"":"gray",3==a.mtype&&null!=a.agent&&a.agent.id>4&&512&features2&&(a.agent.caps=6),H&&setupTerminal(),B&&setupFiles();var q=!!(16&s);q?setupConsole():15==t&&(t=10),QV("MainDevDesktop",F&&(null==a.agent&&null!=a.intelamt&&("number"!=typeof a.intelamt.sku||!!(8&a.intelamt.sku))||null!=a.agent&&(null==a.agent.caps||!!(1&a.agent.caps)||a.intelamt&&2==a.intelamt.state)||3==a.mtype&&(3==a.agent.id||4==a.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==a.agent&&null!=a.intelamt||a.agent&&null==a.agent.caps||a.agent&&!!(2&a.agent.caps)||a.intelamt&&2==a.intelamt.state)&&8&s&&H),QV("MainDevFiles",null!=a.agent&&null!=a.agent.caps&&!!(4&a.agent.caps)&&8&s&&B),QV("MainDevInfo",a.mtype<3&&!!(1048576&s)),QV("MainDevAmt",null!=a.intelamt&&(2==a.intelamt.state||2&a.conn)&&8&s&&O),QV("MainDevConsole",q&&null!=a.agent&&null!=a.agent.caps&&!!(8&a.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=a.agent&&null!=a.agent.caps&&!!(16&a.agent.caps)),QH("p15coreName",null!=a.agent&&null!=a.agent.core?a.agent.core:""),null!=a.intelamt&&"number"==typeof a.intelamt.sku&&16&a.intelamt.sku?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT"));var W=Q("p14iframe").contentWindow.getCurrentMeshNode();null!=W&&W._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect();var j=!!(6&a.conn);if(Q("p14iframe").contentWindow.setConnectionState(j),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&xxcurrentView>=10&&xxcurrentView<20?currentNode.name+(i?" - "+i.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),r&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler){QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,o,n);var K=getstore("_curPluginPage",null);null!=K&&null!=Q("p19ph-"+K)&&pluginHandler.callPluginPage(K,Q("p19ph-"+K))}if(g="",7&s&&(g+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Adicionar usuário</button>',null!=usergroups)){var J=0,$=!1;for(var C in usergroups)null==usergroups[C].membershipType&&usergroups[C]._id.split("/")[1]==e.split("/")[1]&&(J++,null!=currentNode.links&&null!=currentNode.links[C]||($=!0));J>0&&$&&(g+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Adicionar Grupo de Usuários</a>')}g+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Autorizações de usuário</th><th scope=col style=text-align:left></th></tr>';var X=1;if(null!=currentNode.links){var Y=[];for(var C in currentNode.links)(C.startsWith("user/")||C.startsWith("ugrp/"))&&Y.push(C);for(var C in Y.sort(),Y){var Z="",ee="",te=Y[C],oe=currentNode.links[te].rights,ne=EscapeHtml(te.split("/")[2]),ae=(ee=makeUserDeviceRightsString(oe),!1);null!=currentNode.links[te].name&&(ne=EscapeHtml(currentNode.links[te].name)),te==userinfo._id&&(ne=EscapeHtml(userinfo.name)),null!=users&&null!=users[te]&&(ne=EscapeHtml(users[te].name)),null!=usergroups&&null!=usergroups[te]&&(ne=EscapeHtml(usergroups[te].name),ae=!0),2&s&&(ae?(Z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Remova os direitos do grupo de usuários para este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(Z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(te)+'")\' title="Remova os direitos do usuário para este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',ee='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(te)+'")>'+ee+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),null!=users&&(ne=ae?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+ne+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(te)+"\");haltEvent(event);'>"+ne+"</a>"),g+="<tr "+(++X%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(ae?"Grupo de usuários":"Usuário")+'" class=m'+(ae?4:2)+"></div><div>&nbsp;"+ne+"<div></div></div></td><td style=width:70%><div style=float:right>"+Z+"</div><div>"+ee+"</div></td></tr>"}}if(1==X&&(g+="<tr><td><div style=padding:6px>&nbsp;<i>Nenhum usuário com permissões especiais de dispositivo</i><div></div></div></td><td></td></tr>"),g+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&deviceShares.length>0){g+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Compartilhamento de dispositivo ativo</th><th scope=col style=text-align:left></th></tr>',X=1;for(C=0;C<deviceShares.length;C++){var ie=deviceShares[C];Z="";null!=ie.url&&(Z+='<a href="'+ie.url+'" rel="noreferrer noopener" target=_blank title="Link de compartilhamento de dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),Z+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(ie.publicid)+'","'+encodeURIComponentEx(ie.guestName)+'")\' title="Remover compartilhamento de dispositivo" class="fa-fw fa-solid fa-trash text-danger"></i>';var se="";ie.p<=7?se=["","Terminal","Área de Trabalho","Desktop + Terminal","Arquivos","Terminal + Arquivos","Desktop + Arquivos","Desktop + Terminal + Arquivos"][ie.p]:8==ie.p?se="HTTP/"+ie.port:16==ie.p&&(se="HTTPS/"+ie.port);var re=se;null!=ie.startTime&&null!=ie.expireTime&&(re=format("{0}, {1} a {2}",se,printFlexDateTime(new Date(ie.startTime)),printFlexDateTime(new Date(ie.expireTime)))),null!=ie.startTime&&null!=ie.duration&&(re=ie.duration<2?format("{0}, {1} até {2} minuto",se,printFlexDateTime(new Date(ie.startTime)),ie.duration):format("{0}, {1} até {2} minutos",se,printFlexDateTime(new Date(ie.startTime)),ie.duration)),1==ie.recurring&&(re+=", Recorrente diariamente"),2==ie.recurring&&(re+=", Recorrente semanalmente"),2&ie.p&&!0===ie.viewOnly&&(re+=", Ver apenas área de trabalho"),null!=ie.consent&&(0==ie.consent?re+=", Não Autorizado":(56&ie.consent&&(re+=", Solicitar Autorização"),64&ie.consent&&(re+=", Barra de ferramentas")));var le=EscapeHtml(ie.guestName);ie.publicid.startsWith("AS:node/")&&(le="<i>Auto compartilhamento de Agente</i>"),g+="<tr "+(++X%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+le+"<div></div></div></td><td style=width:70%><div style=float:right>"+Z+"</div><div>"+re+"</div></td></tr>"}g+="</tbody></table>"}QH("p10html4",g);var de="";if(!(268435456&features)&&xxcurrentView>=10&&xxcurrentView<=19&&null!=currentNode){for(var C in de="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)de+="&"+C+"="+urlargs[C];try{window.history.replaceState({},document.title,window.location.pathname+de)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),t||(t=10),go(t)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Operação de energia","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Operação de energia","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified?1:0;userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]);var o='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificação de Página Web</div>';return o+='<div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Conexões de dispositivos</label></div>',o+='<div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexões de dispositivos</label></div>',null!=currentNode.intelamt&&(t+=2,o+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Desktop Intel&reg; AMT e eventos seriais</label></div>'),1&t&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificação por e-mail</div>',o+='<div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Conexões de dispositivos</label></div>',o+='<div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexões de dispositivos</label></div>',o+='<div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',o+='<div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Conexões de dispositivos</label></div>',o+='<div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexões de dispositivos</label></div>',o+='<div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),setModalContent("xxAddAgent","Configurações de notificação",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editDeviceNotifyEx(e,t){var o=0;o+=Q("p20notifyIntelDeviceConnect").checked?2:0,o+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,2&t&&(o+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(o+=Q("p20enotifyIntelDeviceConnect").checked?16:0,o+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,o+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(o+=Q("p20emsgDeviceConnect").checked?128:0,o+=Q("p20emsgDeviceDisconnect").checked?256:0,o+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:o})}function makeUserDeviceRightsString(e){if(57592==e)return"Direitos completos do dispositivo";var t=[];if(8&e){var o=[];256&e&&o.push("Sem entrada"),512&e&&o.push("Sem Terminal"),1024&e&&o.push("Sem arquivos"),2048&e&&o.push("Sem AMT"),4096&e&&o.push("Entrada Limitada"),65536&e&&o.push("Sem área de trabalho"),524288&e&&!1!==serverinfo.guestdevicesharing&&o.push("Participação de Convidados"),o.length>0?t.push("Control ("+o.join(", ")+")"):t.push("Controle")}return 16&e&&t.push("Console"),32&e&&t.push("Arquivos do servidor"),64&e&&t.push("Despertar"),128&e&&t.push("Notas"),8192&e&&t.push("Limitar eventos"),16384&e&&t.push("Bate-papo"),32768&e&&t.push("Desinstalar"),131072&e&&t.push("Comandos"),262144&e&&t.push("Reiniciar / Desligar"),524288&e&&t.push("Compartilhamento"),1048576&e&&t.push("Detalhes"),2097152&e&&t.push("Retransmissão"),0==t.length?"Sem direitos":t.join(", ")}function makeDeviceGroupRightsString(e){if(4294967295==e)return"Direitos Completos";var t=[];if(1&e&&t.push("Editar Grupo"),2&e&&t.push("Gerenciar usuários"),4&e&&t.push("Gerenciar dispositivos"),8&e){var o=[];256&e&&o.push("Sem entrada"),512&e&&o.push("Sem Terminal"),1024&e&&o.push("Sem arquivos"),2048&e&&o.push("Sem AMT"),4096&e&&o.push("Entrada Limitada"),65536&e&&o.push("Sem área de trabalho"),524288&e&&!1!==serverinfo.guestdevicesharing&&o.push("Participação de Convidados"),o.length>0?t.push("Control ("+o.join(", ")+")"):t.push("Controle")}return 16&e&&t.push("Console"),32&e&&t.push("Arquivos do servidor"),64&e&&t.push("Despertar"),128&e&&t.push("Notas"),8192&e&&t.push("Limitar eventos"),16384&e&&t.push("Bate-papo"),32768&e&&t.push("Desinstalar"),131072&e&&t.push("Comandos"),262144&e&&t.push("Reiniciar / Desligar"),524288&e&&t.push("Compartilhamento"),1048576&e&&t.push("Detalhes"),2097152&e&&t.push("Retransmissão"),0==t.length?"Sem direitos":t.join(", ")}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Adicionar evento de dispositivo","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Isso adicionará uma entrada ao registro de eventos deste dispositivo. <span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){if(!xxdialogMode){null==t&&(t=encodeURIComponentEx("p"+userinfo._id));var o="<textarea id=d2devNotes ro="+e+" noteid="+t+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>';t.startsWith("node%2F%2F")&&(o+="<span style=font-size:10px>As notas de grupos de dispositivos podem ser visualizadas e alteradas por outros administradores de grupos de dispositivos.<span>"),"true"===showNotesPanel&&(o+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Notas",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)})}}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){if(!xxdialogMode){var t=decodeURIComponent(e).split("/")[2];safeNewWindow("/ipkvm.ashx/"+t+"/","ipkvm:"+t)}}function deviceChat(e){if(!xxdialogMode){var t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name;""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&2&features2&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)})}}function altDeviceChat(e,t){if(!xxdialogMode){var o=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),n=encodeURIComponentEx(userinfo._id.split("/")[2]),a=encodeURIComponentEx(userinfo._id.split("/").join("-")),i=n,s=a;null!=userinfo.realname&&(i=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-")));var r=o=o.split("{4}").join(n).split("{5}").join(a).split("{6}").join(i).split("{7}").join(s);"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(n).split("{5}").join(a).split("{6}").join(i).split("{7}").join(s)),""!=o&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:o}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560")}}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Abrir página no dispositivo",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&e.length>7||e.startsWith("https://")&&e.length>8)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Mensagem do Dispositivo","<div style=margin-bottom:4px>Exibe uma caixa de mensagem no dispositivo remoto.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostrar mensagem até ser dispensada pelo usuário</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus()}}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){if(null!=desktop&&3==desktop.State)if(desktop.m.getClipboard){var e=desktop.m.getClipboard();null!=e&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})}else meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2})}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Bloqueio de entrada remota",1==e?"Bloquear o mouse e o teclado do usuário remoto?":"Desbloquear o mouse e o teclado do usuário remoto?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){if(!xxdialogMode){xxdialogButtons=3,setModalContent("xxAddAgent","Notificação de dispositivo",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Notificação de brinde</option><option value=1>Caixa de mensagem</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Título" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostrar mensagem até ser dispensada pelo usuário</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus()}}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,o=Q("d2notifyMsg").value,n=parseFloat(Q("d2notifyTimeout").value);0!=o.length&&(""==t&&(t=decodeURIComponent("{{{extitle}}}")),""==t&&(t="MeshCentral"),isNaN(n)&&(n=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:o,timeout:6e4*n}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:o}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:o}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Bloquear Desktop","Bloquear a área de trabalho do usuário?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t="",o="Cria um link que permite a um convidado sem uma conta controlar remotamente este dispositivo por um tempo limitado.<br /><br />";o+=addHtmlFormFloating("Nome do convidado",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />');var n="<option value=2>Área de Trabalho</option>";4294967295!=e&&256&e&&(n="");var a="<option value=1>Terminal</option>";4294967295!=e&&512&e&&(a="");var i="<option value=4>Arquivos</option>";4294967295!=e&&1024&e&&(i="");var s="<option value=5>Desktop + Arquivos</option>";4294967295!=e&&1280&e&&(s="");var r="<option value=6>Terminal + Arquivos</option>";4294967295!=e&&1536&e&&(r="");var l="<option value=7>Desktop + Terminal + Arquivos</option>";4294967295!=e&&1792&e&&(l="");var d="";0!=webRelayPort&&(d="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=e&&8&e&&(d=""));t="";var c="";1&~currentNode.agent.caps||(t+=n+"<option value=3>Desktop, apenas visualização</option>"),2&~currentNode.agent.caps||(t+=a),4&~currentNode.agent.caps||(t+=i),5&~currentNode.agent.caps||(t+=s),6&~currentNode.agent.caps||(t+=r),7&~currentNode.agent.caps||(t+=l),o+=addHtmlFormFloating("Tipo",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(t+=d)+"</select>");var u={1:"1 minuto",5:"5 minutos",10:"10 minutos",15:"15 minutos",30:"30 minutos",45:"45 minutos",60:"60 minutos",120:"2 horas",240:"4 horas",480:"8 horas",720:"12 horas",960:"16 horas",1440:"24 horas",2880:"2 dias",5760:"4 dias",0:"Ilimitado"};for(var p in t="",u)(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(t+="<option value="+p+">"+u[p]+"</option>"),p>0&&p<=720&&(null==serverinfo.guestdevicesharingmaxtime||p>0&&p<=serverinfo.guestdevicesharingmaxtime)&&(c+="<option value="+p+">"+u[p]+"</option>");o+=addHtmlFormFloating("Validade",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>Começando agora</option><option value=1>Intervalo de tempo</option><option value=2>Diariamente</option><option value=3>Semanalmente</option></select>'),o+="<div id=d2modenow>",o+=addHtmlFormFloating("Tempo de expiração",'<select id=d2inviteExpire class="form-select">'+t+"</select>"),o+="</div><div id=d2moderange style=display:none>",o+=addHtmlFormFloating("Intervalo de tempo Iniciar",'<input id=d2timeRangeStartSelector class="flatpickr form-select" type="text" placeholder="Selecionar Data & Hora..." data-id="altinput">'),o+=addHtmlFormFloating("Final de tempo final",'<input id=d2timeRangeEndSelector class="flatpickr form-select" type="text" placeholder="Selecionar Data & Hora..." data-id="altinput">'),o+="</div><div id=d2moderecurring style=display:none>",o+=addHtmlFormFloating("Hora de início",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Selecionar Data & Hora..." data-id="altinput">'),o+=addHtmlFormFloating("Duração",'<select id=d2inviteDuration class="form-select">'+c+"</select>"),o+="</div>",1&currentNode.agent.caps&&(o+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Consentimento do usuário",'<select id=d2userConsent class="form-select"><option value=0>Notificar apenas<option value=1>Pedido de consentimento</option><option value=2>No Consent</option></select>')+"</div>"),o+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>",o+="<div id=d2httpsPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>",xxdialogButtons=3,setModalContent("xxAddAgent","Compartilhar dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showShareDeviceEx("",xxdialogTag)),showShareDeviceValidate();var m=new Date;m.setDate(m.getDate()+1);var g=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,o){v.set("minDate",t),v.selectedDates[0]&&v.selectedDates[0]<e[0]&&v.clear()}}),v=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,minDate:m,defaultDate:m,minuteIncrement:1,plugins:[new confirmDatePlugin({})]}),h=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:g,rangeEnd:v,start:h}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",Q("d2timeRange").value>=2);var e=!0;if(8==Q("d2shareType").value){var t=parseInt(Q("d2httpPort").value);(Q("d2httpPort").value!=t||t<1||t>65535)&&(e=!1)}if(9==Q("d2shareType").value){t=parseInt(Q("d2httpsPort").value);(Q("d2httpsPort").value!=t||t<1||t>65535)&&(e=!1)}0==Q("d2inviteName").value.trim().length&&(e=!1),QE("idx_dlgOkButton",e)}function showShareDeviceEx(e,t){var o=0,n=parseInt(Q("d2shareType").value),a=!1,i=0;8!=n?9!=n?(3==n&&(a=!0),1&(i=[0,1,2,2,4,6,5,7][n])&&(o|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=16),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(o=0)),2&i&&(o|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=8),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(o=0)),4&i&&(o|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=32),1&currentNode.agent.caps&&2==Q("d2userConsent").value&&(o=0)),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:i,expire:parseInt(Q("d2inviteExpire").value),consent:o,viewOnly:a}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:i,start:Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3),end:Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),consent:o,viewOnly:a}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:i,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:o,viewOnly:a})):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0})}function deviceActionFunction(){if(!xxdialogMode){var e=GetNodeRights(currentNode),t=0,o="Selecione uma operação para executar neste dispositivo.<br /><br />",n="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",a="";null!=currentNode.agent&&14==currentNode.agent.id?1&currentNode.conn&&8&e&&(t++,n+="<option value=400>Clarão</option>",n+="<option value=401>Vibrar</option>",a+="<div id=d2devicetimediv>"+addHtmlFormFloating("Tempo","<select id=d2devicetime class=form-select><option value=1000>1 segundo</option><option value=5000>5 segundos</option><option value=10000>10 segundos</option></select>")+"</div>"):(64&e&&(t++,n+="<option value=100>Acordar (Wake-up)</option>"),1&currentNode.conn&&131072&e&&(t++,n+="<option value=106>Executar comandos</option>"),0!=currentNode.conn&&262144&e&&(t++,n+="<option value=4>Hibernar</option><option value=3>Reiniciar</option><option value=2>Desligar</option>"),16&currentNode.conn&&(t++,n+="<option value=103>Enviar mensagem MQTT</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&262144&e&&(t++,n+="<option value=310>Reinicialização Intel&reg; AMT</option>",n+="<option value=308>Intel&reg; AMT Power off</option>",11!=xxcurrentView&&12!=xxcurrentView||(n+="<option value=312>Intel&reg; AMT Reset to BIOS</option>",n+="<option value=311>Intel&reg; AMT Power on to BIOS</option>",n+="<option value=315>Intel&reg; AMT Power on to PXE</option>",n+="<option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&6&currentNode.conn&&64&e&&(t++,n+="<option value=302>Intel&reg; AMT Power on</option>"),(11==xxcurrentView||12==xxcurrentView)&&getNodeAmtVersion(currentNode)>=15&&2==currentNode.intelamt.state&&6&currentNode.conn&&4294967295==e&&!(1024&features)&&(t++,n+="<option value=107>Recuperação Intel&reg; AMT One Click</option>"),1&currentNode.conn&&32768&e&&(t++,n+="<option value=104>Desinstalar agente</option>")),o+=addHtmlFormFloating("Operação",n+="</select>"),0==t&&(o="Nenhuma ação disponível atualmente para este dispositivo."),xxdialogButtons=0==t?2:3,xxdialogTag=o+a,setModalContent("xxAddAgent","Ação do dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),t>0&&deviceActionFunctionValidate()}}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t=!1,o=!1;if(currentNode.agent&&(currentNode.agent.id>0&&currentNode.agent.id<5?t=!0:o=!0),1==t||1==o){var n="Execute comandos em dispositivos selecionados.<br />";1==t&&(n+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px>",n+="<option value=1>Prompt de comando do Windows</option><option value=2>Windows PowerShell</option>",1==o&&(n+="<option value=3>Shell de comando Linux / BSD / macOS</option>"),n+="</select>"),n+="<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Executar como agente</option><option value=1>Executar como usuário, agente se nenhum usuário</option><option value=2>Deve ser executado como usuário</option></select>",setModalContent("xxAddAgent","Executar comandos",n+="<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus()}}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Recuperação Intel&reg; AMT One Click",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Operação de energia Intel&reg; AMT","Ligar o Intel&reg; AMT?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Operação de energia Intel&reg; AMT","Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Operação de energia Intel&reg; AMT","Realizar redefinição do Intel&reg; AMT?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(311==e)setModalContent("xxAddAgent","Operação de energia Intel&reg; AMT","Perform Intel&reg; AMT power on to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})});else{if(312!=e)return 400==e||401==e?(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}),!0):(meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0);setModalContent("xxAddAgent","Operação de energia Intel&reg; AMT","Perform Intel&reg; AMT reset to BIOS?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||xxcurrentView>19||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now();currentNode._id==powerTimelineNode&&(e=powerTimeline);var o=new Date;o.setHours(0,0,0,0);(o=new Date(o.getTime()-5184e5)).getTime();var n=[];if(null!=e&&e.length>1){n.push([0,e[1],e[0]]);for(var a=e[1],i=2;i<e.length;i+=2){var s=e[i],r=t;e.length>i+1&&(r=e[i+1]),n.push([a,a+r,s]),a+=r}}var l="",d=1,c=new Date,u=Q("column_l").offsetWidth-192;c.setHours(0,0,0,0);for(i=0;i<7;i++){var p="",m=c.getTime(),g=m+864e5;for(var v in n){var h=n[v];if(1==isTimeBlockInside(m,g,h[0],h[1])){var f=Math.max(m,h[0]),x=Math.min(Math.min(g,h[1]),t),k=Math.round((x-f)*u/864e5);if(k>0){var b=format("{0} de {1} a {2}.",powerStateStrings2[h[2]],printTime(new Date(f)),printTime(new Date(x)));p+='<div class="pwState '+powerColor(h[2])+'" title="'+b+'" style="width:'+k+'px;"></div>'}}}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(c)+"<div></div></div></td><td><div>"+p+"</div></td></tr>",++d,c=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)}var y="";try{y="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Dia</th><th scope=col>Status de energia de 7 dias<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+y+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Baixar eventos de energia" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,o,n){return o<e&&n>t||(o>e&&o<t||n>e&&n<t)}function addDeviceAttribute(e,t,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${o[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,o){if(!xxdialogMode){var n="",a=getNodeFromId(e),i=3;4&GetNodeRights(a)&&(n+=addHtmlFormFloating("Nome do usuário",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),n+=addHtmlFormFloating("Senha",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),1&features2||(n+=addHtmlFormFloating("Segurança",'<select id=dp10tls class="form-select"><option value=0>Sem segurança TLS</option><option value=1>Segurança TLS necessária</option></select>')),null!=a.intelamt.user&&""!=a.intelamt.user&&(i=7),setModalContent("xxAddAgent","Editar credenciais Intel&reg; AMT",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(i,{node:a,func:t,arg:o})),null!=a.intelamt.user&&""!=a.intelamt.user?Q("dp10username").value=a.intelamt.user:Q("dp10username").value="admin",1&features2||(Q("dp10tls").value=a.intelamt.tls),validateDeviceAmtSettings())}}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){if(2==e)meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}});else{var o=Q("dp10username").value;""==o&&(o="admin");var n=Q("dp10password").value;""==n&&(o="");var a={action:"changedevice",nodeid:t.node._id,intelamt:{user:o,pass:n}};1&features2||(a.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(a),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3)}}function p10showSendMqttMsgDialog(e){if(xxdialogMode)return!1;var t=addHtmlFormFloating("Tema",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />');return setModalContent("xxAddAgent","Enviar mensagem MQTT",t+=addHtmlFormFloating("Mensagem",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus(),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",Q("dp2topic").value.length>0&&Q("dp2msg").value.length>0)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){if(xxdialogMode)return!1;var t="";return t=e.length>1?format("Tem certeza de que deseja desinstalar os agentes {0} selecionados?",e.length):"Tem certeza de que deseja desinstalar o agente selecionado?",t+="<br /><br />",e.length>1?t+="Isso não removerá os dispositivos do servidor, mas os dispositivos não poderão mais se conectar ao servidor. Todo o acesso remoto aos dispositivos será perdido. Os dispositivos devem estar conectados para que este comando funcione.":t+="Isso não removerá este dispositivo do servidor, mas o dispositivo não será mais capaz de se conectar ao servidor. Todo o acesso remoto ao dispositivo será perdido. O dispositivo deve estar conectado para que este comando funcione.",setModalContent("xxAddAgent","Desinstalar agente",t+='<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />confirme</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog(),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(xxdialogMode)return!1;var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var o='<select id=p10newGroup class="form-select">',n=0,a=[];for(var i in meshes){var s=GetMeshRights(i);meshes[i]._id!=t&&4&s&&a.push(meshes[i])}for(var i in a.sort(nameSort),a)n++,o+="<option value='"+a[i]._id+"'>"+a[i].name+"</option>";if(o+="</select>",n>0){var r=1==e.length?"Selecione um novo grupo para este dispositivo<br /><br />":"Selecione um novo grupo para os dispositivos selecionados<br /><br />";setModalContent("xxAddAgent","Alterar Grupo",r+=addHtmlFormFloating("Novo Grupo de Dispositivos",o)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))}else setModalContent("xxAddAgent","Alterar Grupo","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton");return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){if(xxdialogMode)return!1;var t=format("Tem certeza que deseja excluir o nó {0}?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />confirme</label>';return xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Excluir Nó",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog(),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,o,n){var a=null,i=getNodeFromId(e);if(3==i.mtype){var s=meshes[i.meshid];s&&s.relayid&&(a=s.relayid,n=i.host)}var r=serverinfo.name;(-1==r.indexOf(".")||2&features)&&(r=window.location.hostname),""!=webRelayDns&&(r=webRelayDns);var l="https://"+r+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+o+"&appid="+t+"&c="+authRelayCookie;return null!=n&&(l+="&addr="+n),null!=a&&(l+="&relayid="+a),safeNewWindow(l,"WebRelay"),!1}function p10MCRouter(e,t,o,n,a){var i=getNodeFromId(e),s=meshes[i.meshid];return 3==t&&null==o&&(o=null!=i.rdpport?i.rdpport:3389),3==i.mtype&&s&&s.relayid&&(e=s.relayid,n=i.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:o,ip:n,tag:"MCRouter",protocol:t,localport:a,name:s?s.name:null}),!1}function p10rfb(e,t){var o=getNodeFromId(e),n=null,a=meshes[o.meshid];null==t&&(t=null!=o.rfbport?o.rfbport:5900),3==o.mtype&&a&&a.relayid&&(e=a.relayid,n=o.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:n,tag:"novnc",name:a?a.name:null})}function p10mstsc(e,t){var o=getNodeFromId(e),n=meshes[o.meshid];null==t&&(t=null!=o.rdpport?o.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:n?n.name:null})}function p10ssh(e,t){var o=getNodeFromId(e),n=meshes[o.meshid];null==t&&(t=null!=o.sshport?o.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:n?n.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;var e=function(t){var o=[],n=["iploc","wifiloc","gpsloc","userloc"],a=null;for(var i in n)if(null!=currentNode[n[i]]){var s=currentNode[n[i]].split(","),r=parseFloat(s[0]),l=parseFloat(s[1]);if(r<90&&r>-90&&l<180&&l>-180){var d=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([l,r]))});d.setStyle(markerStyle(currentNode,parseInt(i)+1)),o.push(d),null==a?a=[r,l,r,l,0]:(r<a[0]&&(a[0]=r),l<a[1]&&(a[1]=l),r>a[2]&&(a[2]=r),l>a[3]&&(a[3]=l))}}var c=new ol.source.Vector({features:o}),u=new ol.layer.Vector({source:c}),p=0,m=0,g=8;if(null!=a){m=(a[0]+a[2])/2,p=(a[1]+a[3])/2;var v=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3])),h=360;for(g=-2;h>v;)g++,h/=2}1==o.length&&(g=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),u],view:new ol.View({center:ol.proj.fromLonLat([p,m]),zoom:g})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",e)};document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",e);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Localização do dispositivo","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Interfaces de rede","<div id=d2netinfo>Carregando...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){if(!xxdialogMode){var e="<div>O MeshCentral Router é uma ferramenta do Windows para mapeamento de portas TCP. Você pode, por exemplo, RDP em um dispositivo remoto através deste servidor.</div><br />";e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>',e+='<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>';var t=serverinfo.name;(-1==t.indexOf(".")||2&features)&&(t=window.location.hostname);domainUrl.substring(0,domainUrl.length-1);e+='<br /><div class="alert alert-info">Execute o MeshCentral Router e clique em "instalar" para torná-lo inicializável a partir do navegador.</div>',e+='<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Inicie o MeshCentral Router" class="btn btn-primary btn-block" /></a>',setModalContent("xxAddAgent","MeshCentral Router",e+='<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")})}}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var o="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",n=getNodeFromId(t);if(null!=n)return[1,2,3,4,21,22].indexOf(n.agent.id)>=0?o+="&os=win":o+="&os=linux",urlargs.key&&(o+="&key="+urlargs.key),safeNewWindow(o,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){if(!xxdialogMode){0;var o="";0==e&&(o+="<div>MeshCmd é uma ferramenta de linha de comando que executa muitas operações diferentes. O arquivo de ação pode, opcionalmente, ser baixado e editado para fornecer informações e credenciais do servidor.<br /><br />"),1==e&&(o+='<div>Baixe "meshcmd" com um arquivo de ação para rotear o tráfego através deste servidor para este dispositivo. Certifique-se de editar meshaction.txt e adicionar a senha da sua conta ou fazer as alterações necessárias.<br /><br />'),o+=addHtmlFormFloating("Sistema operacional","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64 bits)</option><option value=5>Linux x86 (32 bits)</option><option value=16>macOS x86 (64 bits)</option><option value=29>macOS ARM (64 bits)</option><option value=25>Linux ARM, Raspberry Pi (32 bits)</option><option value=26>Linux ARM, Raspberry Pi (64 bits)</option></select>"),o+=addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(o+=addHtmlValue("Arquivo de ação",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(o+=addHtmlValue("Arquivo de ação",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Baixar MeshCmd",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick()}}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 executable)"),4==e&&(t="MeshCmd (Win x86-64 executable)"),43==e&&(t="MeshCmd (Win ARM-64 executable)"),5==e&&(t="MeshCmd (Linux x86, 32 bits)"),6==e&&(t="MeshCmd (Linux x86, 64 bits)"),16==e&&(t="MeshCmd (macOS, x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32 bits)"),26==e&&(t="MeshCmd (Linux ARM, 64 bits)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){if(!xxdialogMode&&4&GetNodeRights(currentNode)){setModalContent("xxAddAgent","Seleção de ícone",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0)}}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Editar Dispositivo","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Editar Dispositivo","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Nome do dispositivo","Nome do Host","Descrição","Etiqueta"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Etiqueta1, Etiqueta2, Etiqueta3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",o="",n=currentNode[showEditNodeValueDialog_modes2[e]];if(null==n&&(n=""),3==e){t="<select id=dp10devicevalue multiple maxlength="+showEditNodeValueDialog_modes4[e]+" class=form-control>";var a=[];for(var i in nodes)if(nodes[i].tags)for(var s in nodes[i].tags)-1==a.indexOf(nodes[i].tags[s])&&a.push(nodes[i].tags[s]);if(a.length>0)for(var i in a.sort(),a)o+=Array.isArray(n)&&-1!==n.indexOf(a[i])?"<option selected=selected>"+EscapeHtml(a[i])+"</option>":"<option>"+EscapeHtml(a[i])+"</option>";setModalContent("xxAddAgent","Edit Tags",t+=o+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Editar Dispositivo",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(n)&&(n=n.join(", ")),Q("dp10devicevalue").value=n;p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogEx(e,t){var o="",n={action:"changedevice",nodeid:currentNode._id};if(3==t){var a=$("#dp10devicevalue").select2("data");for(var i in a)o+=a[i].text.trim()+", ";n[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(o.slice(0,-2))}else n[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(n)}function p10editdevicevalueValidate(e,t){var o=e>1||Q("dp10devicevalue").value.length>0;QE("idx_dlgOkButton",o),null!=t&&1==o&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){if(desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktopNode=null,desktop=null),desktopNode!=currentNode||null==desktop){var e=multiDesktop[currentNode._id];if(null!=e){QH("DeskParent","");var t=e.m.CanvasId;t.setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},8192&features2&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]}else null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode;Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})}desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo,deskDisplayInfo(desktop.m,desktop.m.displays,desktop.m.selectedDisplay)),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0;null!=desktop&&(e=desktop.State);var t=GetNodeRights(currentNode),o=1==currentNode.agent?1:2;QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",!(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==o?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&!!(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&16&currentNode.intelamt.sku||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype));var n=!(8192&features2||null!=currentNode.agent&&14==currentNode.agent.id||4294967295!=t&&(!(8&t)||256&t||4096&t)),a=!!(1&currentNode.conn);QE("connectbutton1",a),QE("connectbutton1d",a),QE("connectbutton1r",a||3==currentNode.mtype),QE("connectbutton1rd",a||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport?currentNode.rdpport:3389)+"</a>"):QH("desktopCustomUpperRight","");var i=!!(6&currentNode.conn);QE("connectbutton1h",i),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",n&&currentNode.agent&&!!(6144&~features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&n),QE("DeskType",3==e),QV("DeskType",n),QE("DeskWD",3==e),QV("DeskWD",n),QV("deskkeys",n),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none";var s=desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard;QV("DeskClipboardOutButton",a&&n&&null!=desktop&&!(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=s||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&!(4096&features2)),QV("DeskClipboardInButton",a&&n&&null!=desktop&&!(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=s||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",!!(131072&t)&&a),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&!(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&!(1024&features2)),QV("DeskChatButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&a),QV("DeskNotifyButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&a),QV("DeskLockButton",!!(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&n&&3==e),QV("DeskToolsButton",currentNode.agent&&a),QE("DeskToolsButton",n),QV("DeskOpenWebButton",0==browserfullscreen&&n&&currentNode.agent&&a),QV("DeskBackgroundButton",n&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&a),QV("DeskControlSpan",n),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==a&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){null==autoConnectDesktopTimer?autoConnectDesktopTimer=setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),autoConnectDesktopTimer=null)}var agentConsoleMessages=["","Esperando que o usuário conceda acesso ...","Negado","Falha ao iniciar sessão de terminal remoto, {0} ({1})","Tempo esgotado","Dados de rede inválidos recebidos","Não foi possível capturar a tela","Falha na negociação do protocolo ({0})","NLA não suportado","SSL exigido pelo servidor","SSL não permitido pelo servidor","Certificado SSL não está no servidor","Sinalizações inconsistentes","Híbrido exigido pelo servidor","SSL com autenticação de usuário exigida pelo servidor"];function formatAgentConsoleMessage(e,t,o){for(null==o&&(o=[]);o.length<3;)o.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],o[0],o[1],o[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,o,n){if(!xxdialogMode)if(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop)if(desktopNode=currentNode,2==t){if(null==desktopNode.intelamt.user||""==desktopNode.intelamt.user)return void editDeviceAmtSettings(desktopNode._id,connectDesktop,2);(desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0!=e.length){var t=null;try{t=JSON.parse(e)}catch(e){}if(null!=t&&null!=t.action)if("restart"==t.action)webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}));else if("present"==t.action&&null==webRtcDesktop){webRtcDesktop={platform:t.platform};"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("DataChannel",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}else"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset)}else desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})))},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2}else null==t||1==t||3==t&&currentNode.agent.id>4&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=o&&(desktop.options.tsid=o),null!=n&&(desktop.options.consent=n),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,8192&features2&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:n}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport?currentNode.rdpport:3389,o),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()});else desktop.Stop(),webRtcDesktopReset(),desktopNode=desktop=null,null!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")}function askRdpCredentials(){if(!xxdialogMode){var e="<div>";1==currentNode.rdp?(e+=addHtmlFormFloating("Credenciais",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Use as credenciais do servidor</option><option value=2>Use novas credenciais</option></select>'),e+="<div id=d2cred style=display:none>"):e+="<div id=d2cred>",e+=addHtmlFormFloating("Domínio",'<input type=text id=d2domain class="form-control" maxlength=128 />'),e+=addHtmlFormFloating("Nome do usuário",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'),e+=addHtmlFormFloating("Senha",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),4194304&features2||(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Lembrar credenciais</label>')),e+="</div>",e+=MoreStart(),e+=addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'),e+=addHtmlFormFloating("Diretório de Trabalho",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'),setModalContent("xxAddAgent","Credenciais RDP",e+=MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx())}}function askRdpCredentialsValidate(){1!=currentNode.rdp||(QV("d2cred",2==Q("d2mode").value),1!=Q("d2mode").value)?QE("idx_dlgOkButton",""!=Q("d2user").value):QE("idx_dlgOkButton",!0)}function askRdpCredentialsEx(){var e=null,t=null;if(desktopsettings.rdpsize)if("browser"==desktopsettings.rdpsize)e=window.innerWidth,t=window.innerHeight;else if("screen"==desktopsettings.rdpsize)e=window.screen.width,t=window.screen.height;else if("canvas"==desktopsettings.rdpsize)e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;else{var o=desktopsettings.rdpsize.indexOf("x");o>=1&&(e=parseInt(desktopsettings.rdpsize.substring(0,o)),t=parseInt(desktopsettings.rdpsize.substring(o+1)))}else e=Q("DeskParent").offsetWidth,t=Q("DeskParent").offsetHeight;if(1==currentNode.rdp&&1==Q("d2mode").value)connectDesktop(null,4,{servercred:!0,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value});else{var n=!1;4194304&features2||(n=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:n,width:e,height:t,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value})}}function updateMetadata(e,t){var o="",n=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var a in e.metadata.users)n+=e.metadata.users[a];n>1&&(o="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} assistindo",n)+"</span>")}QH("deskmetadata",o),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=null;if(1==e&&(t=desktop),t&&t.metadata){var o="";if(t.metadata.startTime&&(o+=addHtmlValue4("Hora de início",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var n in t.metadata.users){var a=1==t.metadata.users[n]?"1 conexão":format("{0} conexões",t.metadata.users[n]);o+=addHtmlValue2(getUserName(n),a)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Informação da Sessão",o),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var o=t;3==o&&2==e.contype&&o++;var n=StatusStrs[o];switch(null!=desktop&&1==desktop.webRtcActive&&(n+=", WebRTC"),null!=desktop&&3==o&&4==desktop.contype&&(n+=", RDP"),QH("deskstatus",n),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Focar tudo",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:default:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,deskLastClipboardSent=null,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&desktop.latency.current>=0&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&terminal.latency.current>=0&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){if(!xxdialogMode){applyDesktopSettings(),updateDesktopButtons();var e=!1;("none"!=QS("td7meshkvm").display&&Q("td7meshkvm").className.indexOf("active")>0||"none"!=QS("td7rdpkvm").display&&Q("td7rdpkvm").className.indexOf("active")>0||"none"!=QS("td7amtkvm").display&&Q("td7amtkvm").className.indexOf("active")>0)&&(e=!0),0==e&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Configurações de área de trabalho remota",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged)}}function changeDesktopSettingsTab(e,t){var o,n,a;for(n=document.getElementsByClassName("tabcontent"),o=0;o<n.length;o++)n[o].style.display="none";for(a=document.getElementsByClassName("tablinks"),o=0;o<a.length;o++)a[o].className=a[o].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,putstore("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh())),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Focar tudo"),0!=desktop.State&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50))),4==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw))}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(var o in t)e+="<option value="+t[o]+">"+t[o]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,t.indexOf(parseInt(desktopsettings.quality))>=0&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(o=1;o<10;o++)5!=o&&(Q("d7rdp"+o).checked=!!(desktopsettings.rdpflags&1<<o-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);if(fullscreen=!fullscreen)QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("body")),browserfullscreen=!0);else{QC("body").remove("fulldesk");var o=args.hide;0==footerBar&&(o|=4);var n=(1&o?0:66)+(2&o?0:24)+(4&o?0:45)+(8&o?0:60);QS("deskarea3x").height="calc(100vh - "+(75+n)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+n)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+n)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+n)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)}deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Focar tudo","Foco Pequeno","Foco Maior"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,o=Q("Desk").height,n=Q("Desk").width;if(2==deskAspectRatio)QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden";else if(1==deskAspectRatio)QS("Desk")["margin-top"]="0px",QS("Desk").height=o+"px",QS("Desk").width=n+"px",QS("DeskParent").overflow="scroll";else{if(e/t>o/n){var a=o*t/n+"px";QS("Desk").height=a,QS("Desk").width="100%"}else{var i=n*e/o+"px";QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=i}QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden"}}function mdeskAdjust(e,t,o,n){if(e&&t&&o&&n){var a=Q("viewselect").value;if(3==a||5==a)if("Desk"!=n.id){if(5==a){var i=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];QS(n.id).width=(0!=e.State?t*i.y/o:i.x)+"px"}QS(n.id)["margin-top"]=null,QS(n.id)["margin-bottom"]=null}else deskAdjust()}}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){if(haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length){var t=e.dataTransfer.files[0],o=t.name.toLowerCase();if(o.endsWith(".bat")||o.endsWith(".ps1")||o.endsWith(".sh")||o.endsWith(".agentconsole"))d2runCommandDialog({nodeids:[currentNode._id],selectedFile:t});else if(o.endsWith(".txt")){var n=new FileReader;n.onload=function(e){showDeskType(e.target.result)},n.readAsText(t)}}}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);var t=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",t),QV("p11bigfail",!t)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e="",t=parseInt(Q("deskkeys").value);for(var o in""==t&&deskKeyboardShortcuts.length>0&&(t=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)e+="<option value="+deskKeyboardShortcuts[o]+(t==deskKeyboardShortcuts[o]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[o])+"</option>";QH("deskkeys",e)}var keyStrings={8:"BackSpace",9:"Tab",13:"Entrar",27:"Escape",32:"Space",44:"Captura de tela",45:"Inserir",46:"Del",36:"Home",35:"Fim",33:"Subir página",34:"Descer Página",37:"Esquerda",38:"Cima",39:"Direita",40:"Baixo",0:"Nenhum"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Shift"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),(e&=65535)>=112&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';for(var t in e+='<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Shift</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>',e+=" <select id=d2keySelect>",keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";e+="</select> <input type=button value=Adicionar onclick=addDeskCustomizeKey() /></div>",setModalContent("xxAddAgent","Personalização de atalhos de teclado",e+='<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e="";for(var t in deskKeyboardShortcuts){var o=keyShortcutTotext(deskKeyboardShortcuts[t]),n="";t!=deskKeyboardShortcuts.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[t]+")>"),0!=t&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[t]+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[t]+">"+o+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[t]+")>"+n+"</div>"}""==e&&(e="<i>Nenhum atalho de teclado definido</i>"),QH("d2shortcuts",e)}function deskCustomizeKeyDown(e){var t=deskKeyboardShortcuts.indexOf(e),o=deskKeyboardShortcuts[t+1];deskKeyboardShortcuts[t+1]=deskKeyboardShortcuts[t],deskKeyboardShortcuts[t]=o,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var t=deskKeyboardShortcuts.indexOf(e),o=deskKeyboardShortcuts[t];deskKeyboardShortcuts[t]=deskKeyboardShortcuts[t-1],deskKeyboardShortcuts[t-1]=o,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t=[];for(var o in deskKeyboardShortcuts)deskKeyboardShortcuts[o]!=e&&t.push(deskKeyboardShortcuts[o]);deskKeyboardShortcuts=t,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(var t in e)""!=e[t]&&deskKeyboardShortcuts.push(parseInt(e[t]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),e>0&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){if(!xxdialogMode){var e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>';e+=addHtmlFormFloating("Nome",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),e+=addHtmlFormFloating("Valor",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'),setModalContent("xxAddAgent","Personalização de Strings de Teclado",e+=addHtmlFormFloating("",'<input id=d2addbutton type=button value=Adicionar onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate()}}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e="";for(var t in deskKeyboardStrings){var o="";t!=deskKeyboardStrings.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+t+")>"),0!=t&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+t+")>"),e+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(t+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[t].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+t+")>"+o+"</div>",e+="<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[t].v)+"</div>",e+="</div>"}""==e&&(e="<i>Nenhuma string de teclado definida</i>"),QH("d2strings",e)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e="";for(var t in deskKeyboardStrings){e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(t)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[t].n)+"</div>"}""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu2",e)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406!=e){var t=(16711680&e)>>16,o=65535&e,n=[],a=[],i={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(n.push([65505,1]),a.push([65505,0])),2&t&&(n.push([65513,1]),a.push([65513,0])),8&t&&(n.push([65507,1]),a.push([65507,0])),16&t&&(n.push([65511,1]),a.push([65511,0])),i[o]&&(o=i[o]),o>=65&&o<=90&&(o+=32),0!=o&&(n.push([o,1]),a.push([o,0])),a.reverse();for(var s=0;s<a.length;s++)n.push(a[s]);desktop.m.sendkey(n)}else{1&t&&(n.push([desktop.m.KeyAction.DOWN,16]),a.push([desktop.m.KeyAction.UP,16])),2&t&&(n.push([desktop.m.KeyAction.EXDOWN,18]),a.push([desktop.m.KeyAction.EXUP,18])),8&t&&(n.push([desktop.m.KeyAction.EXDOWN,17]),a.push([desktop.m.KeyAction.EXUP,17])),16&t&&(n.push([desktop.m.KeyAction.EXDOWN,91]),a.push([desktop.m.KeyAction.EXUP,91])),0!=o&&(n.push([desktop.m.KeyAction.DOWN,o]),a.push([desktop.m.KeyAction.UP,o])),a.reverse();for(s=0;s<a.length;s++)n.push(a[s]);desktop.m.SendKeyMsgKC(n)}}else desktop.m.sendcad()}}function showDeskType(e){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskType").blur();var t="<div>Insira o texto e clique em OK para digitá-lo remotamente. Certifique-se de colocar o cursor remoto na posição correta antes de prosseguir.<div>";setModalContent("xxAddAgent","Entrada de teclado remoto",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus()}}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,o,n=[],a=!1;if("string"==typeof e?(t=e,o=e.toUpperCase()):(t=Q("d2typeText").value,o=Q("d2typeText").value.toUpperCase()),2==desktop.contype){for(var i in t){var s=t.charCodeAt(i);n.push([s,1],[s,0])}AmtDeskTypeContent=n,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var i in t){s=t.charCodeAt(i);var r=o.charCodeAt(i);s>=65&&s<=90||s>=97&&s<=122?(s==r&&0==a&&(n.push([desktop.m.KeyAction.DOWN,16]),a=!0),s!=r&&1==a&&(n.push([desktop.m.KeyAction.UP,16]),a=!1)):s>=48&&s<=57?1==a&&(n.push([desktop.m.KeyAction.UP,16]),a=!1):DeskTypeTranslate[s]?(1==a&&(n.push([desktop.m.KeyAction.UP,16]),a=!1),r=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==a&&(n.push([desktop.m.KeyAction.DOWN,16]),a=!0),r=DeskTypeShiftTranslate[s]),n.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==a&&(n.push([desktop.m.KeyAction.UP,16]),a=!1),desktop.m.SendKeyMsgKC(n)}}function showDeskClip(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){Q("DeskClip").blur();var e="";2048&features2||(e+='<input id=dlgClipGet type=button value="Obter área de transferência " style=width:160px onclick=showDeskClipGet()>'),4096&features2||(e+='<input id=dlgClipSet type=button value="Enviar área de transferência " style=width:160px onclick=showDeskClipSet()>'),e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>',e+='<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>',xxdialogTag="clipboard",setModalContent("xxAddAgent","Área de transferência remota",e+='<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>A área de transferência remota é válida por 60 segundos.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus()}}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&currentNode.agent.id>4&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){var t=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==t&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==t&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(deskTools.msg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){var t=[],o=null;try{o=JSON.parse(e.value)}catch(e){}if(null!=o){for(var n in o)t.push({p:parseInt(n),c:o[n].cmd,d:o[n].cmd.toLowerCase(),u:o[n].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var a="";for(var i in t)if(0!=t[i].p){var s=t[i].c;a+="<div onclick=showProcessDetails("+t[i].p+') class="deskToolsBar d-flex">',a+='<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[i].p)+"</div>",a+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(s)+'">'+s+"</div>",a+='<div class="ms-auto">'+(t[i].u?EscapeHtml(t[i].u):""),a+='<i class="ps-1 fa-solid fa-trash-can" role="button" title="Parar o processo" onclick=\'return stopProcess('+EscapeHtml(t[i].p)+',"'+EscapeHtml(t[i].c)+"\")'></i></div>",a+="</div>"}QH("DeskToolsProcesses",a)}}}else QH("DeskToolsProcesses","")}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Detalhes do processo, # {0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(deskTools.smsg=e,null!=e){if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],o=null;try{o=JSON.parse(e.value)}catch(e){}if(deskTools.services=o,null!=o){for(var n in o)o[n].status?t.push({p:capitalizeFirstLetter(o[n].status.state.toLowerCase()),d:o[n].displayName,i:n}):o[n].serviceType&&t.push({p:o[n].serviceType,d:o[n].name,i:n});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var a="";for(var n in t)if(0!=t[n].p){var i=t[n].d,s=t[n].p;"Stopped"==s?s="Parado":"Running"==s&&(s="Executando"),a+="<div onclick=showServiceWaitDialog("+t[n].i+") class=deskToolsBar>",a+="<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(s)+"</div>",a+='<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+i+'">'+EscapeHtml(i)+"</div>",a+="</div>"}QH("DeskToolsServices",a)}}}else QH("DeskToolsProcesses","")}function showServiceDetailsDialog(e){if(xxdialogMode&&-1!=xxdialogTag.indexOf("service_")){var t=xxdialogTag.replace("service_",""),o=e.value?JSON.parse(e.value):deskTools.services[t];if(e.value&&(o.displayName=deskTools.services[t].displayName),null!=o){var n="";if(o.name&&(n+=addHtmlValue("Nome",o.name)),o.displayName&&(n+=addHtmlValue("Nome em Exibição",o.displayName)),o.status){var a=capitalizeFirstLetter(o.status.state.toLowerCase());"Stopped"==a?a="Parado":"Running"==a&&(a="Executando"),o.status.state&&(n+=addHtmlValue("Estado",a)),o.status.pid&&(n+=addHtmlValue("PID",o.status.pid));var i=[];!0===o.status.isFileSystemDriver&&i.push("FileSystemDriver"),!0===o.status.isInteractive&&i.push("Interativo"),!0===o.status.isKernelDriver&&i.push("KernelDriver"),!0===o.status.isOwnProcess&&i.push("Tomar processo"),!0===o.status.isSharedProcess&&i.push("Processo compartilhado"),i.length>0&&(n+=addHtmlValue("Tipo",i.join(", ")))}if(o.startType&&(n+=addHtmlValue("Start Type",o.startType)),o.user&&(n+=addHtmlValue("Usuário",o.user)),o.installedBy&&(n+=addHtmlValue("Installed By",o.installedBy)),o.installedDate&&(n+=addHtmlValue("Installed Date",printDateTime(new Date(o.installedDate)))),o.failureActions){if(o.failureActions.resetPeriod){var s=(o.failureActions.resetPeriod<86400?0:o.failureActions.resetPeriod)/86400;n+=addHtmlValue("Restart Fail Count After ",s+" Day"+(1!=s?"s":""))}o.failureActions.actions&&(o.failureActions.actions[0]&&(n+=addHtmlValue("First Failure",o.failureActions.actions[0].type)),o.failureActions.actions[1]&&(n+=addHtmlValue("Second Failure",o.failureActions.actions[1].type)),o.failureActions.actions[2]&&(n+=addHtmlValue("Subsequent Failures",o.failureActions.actions[2].type)))}xxdialogTag="service_"+t,setModalContent("xxAddAgent","Detalhes do serviço",n+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Fechar" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Começar" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Parar" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Reiniciar" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function showServiceWaitDialog(e){if(xxdialogMode)return!1;var t=deskTools.services[e];return null!=t&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Detalhes do serviço","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){if(setDialogMode(0),0!=e){var o=deskTools.services[t];null!=o&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:o.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:o.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:o.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){if(null!=desktop)if(null==desktop.m.recordedData)Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording();else{Q("DeskRecordButtonImage").style.color="";var e=new Date,t="DesktopSession-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);saveAs(data2blob(desktop.m.StopRecording().join("")),t+".mcrec")}}function deskSaveImage(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){var e=new Date,t="Área de Trabalho-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2);Q("Desk").toBlob(function(e){saveAs(e,t+".png")})}}function deskDisplayInfo(e,t,o){var n=0,a="";for(var i in t){n++;var s=t[i],r=1;"All Displays"==s&&(s="Todos os monitores",r=2),s.startsWith("Display ")&&(s=format("Exibir {0}",s.substring(8)));var l="id=DeskMonitorSelectionX"+i+' title="'+EscapeHtml(s)+'" onclick=deskSetDisplay('+i+") role=button";a+=2==r?"<span "+l+' class="fa-layers fa-fw '+(o==i?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+l+' class="fa-fw fa-solid fa-desktop '+(o==i?"":" gray")+'"></i>',deskPreferedStickyDisplay==i&&o!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(i),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",a),QV("DeskMonitorSelectionSpan",n>1)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){var t=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=t<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){if(deskTools.resizing){var t=Q("DeskTools").getBoundingClientRect().right-e.clientX;t<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=t+"px")}});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){if(1==e.buttons){var t=Date.now();t-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY}}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked)&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),!0)}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Controle do processo",format('Parar o processo nº {0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminalNode=null,terminal=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state;3==terminalNode.mtype&&null!=terminalNode.agent&&terminalNode.agent.id>4&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&!(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Porta SSH {0}",terminalNode.sshport?terminalNode.sshport:22)+"</a>");var t=!!(1&terminalNode.conn)||3==terminalNode.mtype;QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t);var o=!!(6&terminalNode.conn);QE("connectbutton2h",o),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR + LF":"LF");var n=!(0===args.xterm||null!=terminal&&null==xterm);QV("termarea3xdiv",n),QV("Term",!n),QV("bsbutton",!n),QV("pastebutton",!n),QV("devListToolbarViewIcons2",n),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var o=t;3==o&&2==e.contype&&o++;var n=StatusStrs[o];switch(3==o&&(3==e.contype&&(n+=", SSH"),1==e.webRtcActive&&(n+=", WebRTC")),QH("termstatus",n),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){null==autoConnectTerminalTimer?autoConnectTerminalTimer=setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),autoConnectTerminalTimer=null)}function CreateRemoteTunnel(e,t){var o={protocol:1};return null!=t&&"number"==typeof t.protocol&&(o.protocol=t.protocol),o.onTunnelUpdate=e,o.xxStateChange=function(e){},o.ProcessBinaryData=function(e){o.onTunnelUpdate(e)},o.ProcessData=function(e){o.onTunnelUpdate(e)},o.terminalEmulation=1,o.fxEmulation=0,o.lineFeed="\r\n",o}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){var o="";e.askkeypass?o+=addHtmlFormFloating("Autenticação",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Chave Armazenada</option><option value=1>Usuario Contraseña</option><option value=2>Nombre de usuario y clave</option></select>'):o+=addHtmlFormFloating("Autenticação",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Usuario Contraseña</option><option value=2>Nombre de usuario y clave</option></select>'),o+="<div id=d2userauth style=display:none>",o+=addHtmlFormFloating("Nome do usuário",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),o+="</div>",o+="<div id=d2passauth style=display:none>",o+=addHtmlFormFloating("Senha",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(o+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Lembrar credenciais</label>')),o+="</div><div id=d2keyauth style=display:none>",o+=addHtmlValue("Archivo de clave",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>El archivo de clave debe estar en formato OpenSSH.</div>'),o+=addHtmlFormFloating("Contraseña clave",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),4194304&features2||(o+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Lembrar usuário e chave</label>'),o+=addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Lembrar senha</label>')),o+="</div>",e.askkeypass&&(o+="<div id=d2keyauth2 style=display:none>",o+=addHtmlFormFloating("Senha",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),o+="</div>"),setModalContent("xxAddAgent","Autenticação",o);var n=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),connectTerminal()};document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Erro de conexão",5e3);break;case"autherror":p12setConsoleMsg("Erro de autenticação",5e3);break;case"sessionerror":case"sessiontimeout":p12setConsoleMsg("Sessão expirada",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){if(QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2user").value.length>0&&Q("dp2pass").value.length>0);else if(3==Q("dp2authmethod").value)QE("idx_dlgOkButton",Q("dp2keypass2").value.length>0);else{if(QE("idx_dlgOkButton",!1),4194304&features2||QE("dp2keep2",Q("dp2keep1").checked),1==(Q("dp2user").value.length>0&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)){var t=new FileReader;t.onload=function(e){var t=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")>=0||e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")>=0&&e.target.result.indexOf("-----END RSA PRIVATE KEY-----")>=0;QE("idx_dlgOkButton",t),QS("d2badkey").color=t?"#000":"#F00"},t.readAsText(Q("dp2key").files[0])}}e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id&&dialogclose(1))}function sshConnectEx(e){if(0==e)null!=terminal&&connectTerminal();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else if(3==Q("dp2authmethod").value)terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var o=new FileReader,n=Q("dp2user").value,a=Q("dp2keypass").value;o.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:a,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},o.readAsText(Q("dp2key").files[0])}}}function xTermSendResize(){xtermResizeTimer=null,null!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,o){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var n={};1==Q("termSizeList").value?(n.cols=80,n.rows=25):2==Q("termSizeList").value&&(n.cols=100,n.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",n),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{n={protocol:null!=o&&"number"==typeof o.protocol?o.protocol:1};o&&o.requireLogin&&(n.requireLogin=!0),o&&o.consent&&(n.consent=o.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(n.cols=80,n.rows=25,n.xterm=!0):2==Q("termSizeList").value?(n.cols=100,n.rows=30,n.xterm=!0):3==Q("termSizeList").value&&(n.cols=Math.floor((Q("column_l").clientWidth-60)/10),n.rows=Math.floor((Q("column_l").clientHeight-120)/20),n.xterm=!0)),e&&1==e.shiftKey&&(currentNode.agent.id>4?1==n.protocol&&(n.protocol=7):1==n.protocol&&(n.protocol=6)),null!=serverinfo.linuxshell&&currentNode.agent.id>4&&("root"==serverinfo.linuxshell&&(n.protocol=1,delete n.requireLogin),"user"==serverinfo.linuxshell&&(n.protocol=8,delete n.requireLogin),"login"==serverinfo.linuxshell&&(n.protocol=1,n.requireLogin=!0)),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),n.cols=xterm.cols,n.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.options=n,n.requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=n,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=[1,2,3,4,21,22].indexOf(currentNode.agent.id)>=0?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["Terminal UTF8","ASCII estendido","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC + [OM)","Alternar (F10 = ESC + 0)","VT100 + (F10 = ESC + [OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR + LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Colar",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),filesNode=null,files=null);var e=!!(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",!(!(512&features2)||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id||8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&!(8388608&features2)),QV("p13Disconnect",0!=t);var o=StatusStrs[t];switch(3==t&&(2==files.contype&&(o+=", SFTP"),1==files.webRtcActive&&(o+=", WebRTC")),Q("p13Status").textContent=o,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var n=[];try{n=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var a=0;a<n.length;a++)n[a].n==currentNode._id&&(p13targetpath=n[a].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){null==autoConnectFilesTimer?autoConnectFilesTimer=setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),autoConnectFilesTimer=null)}function connectFiles(e,t,o){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:o},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(e){if(e.length>0&&123!=e.charCodeAt(0))p13gotDownloadBinaryData(e);else{try{e=JSON.parse(decode_utf8(e))}catch(t){try{e=JSON.parse(e)}catch(t){return void console.log("Unable to parse: "+e)}}if("download"!=e.action)if("findfile"!=e.action)if(null!=e.action&&e.action.startsWith("upload"))p13gotUploadData(e);else{switch(e.action){case"sshauth":return void sshTunnelAuthDialog(e,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Erro de autenticação",5e3);case"connectionerror":return void p13setConsoleMsg("Erro de conexão",5e3);case"sessionerror":case"sessiontimeout":return void p13setConsoleMsg("Sessão expirada",5e3)}if("dialogmessage"!=e.action)if("refresh"!=e.action){if(null!=e.path)if(null==e.dir)""!=p13targetpath&&p13folderup();else if(e.path=e.path.replace(/\//g,"\\"),null!=p13filetree&&e.path==p13filetree.path){var t=p13getCheckedNames();p13filetree=e,p13updateFiles(t)}else{for(var o=e.path.replace(/\//g,"\\"),n=p13targetpath.replace(/\//g,"\\");o.length>0&&"\\"==o[0];)o=o.substring(1);for(;n.length>0&&"\\"==n[0];)n=n.substring(1);(o==n||"\\"==e.path&&""==p13targetpath)&&(p13filetree=e,p13updateFiles())}}else p13folderup(9999);else null==e.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=e.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Operação de arquivo","<div style=margin:10px>"+EscapeHtml(e.file)+"</div><br /><progress value="+EscapeHtml(e.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Operação de arquivo","<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(e.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operação de arquivo","<div style=margin:10px>Unzipping file...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operação de arquivo","<div style=margin:10px>Compactando arquivos ...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)))}else xxdialogTag==e.reqid&&(null==e.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Nenhum arquivo encontrado</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(e.r)+"</div>"));else p13gotDownloadCommand(e)}}function p13sshConnectEx(e){if(0==e)null!=files&&connectFiles();else{var t=0;if(1==Q("dp2authmethod").value)4194304&features2||(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}));else if(3==Q("dp2authmethod").value)files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value}));else{4194304&features2||1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0);var o=new FileReader,n=Q("dp2user").value,a=Q("dp2keypass").value;o.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:a,key:e.target.result,keep:t}))},o.readAsText(Q("dp2key").files[0])}}}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);return e}function p13updateFiles(e){var t="",o="",n='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Raiz</a>';if(null!=p13filetree){var a=p13filetree.path.split("\\");for(var i in p13filetreelocation=[],a)""!=a[i]&&p13filetreelocation.push(a[i]);for(var i in p13filetreelocation)n+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(i)+1)+')">'+EscapeHtml(p13filetreelocation[i])+"</a>";var s=p13filetreelocation.join("/"),r=p13sort_files(p13filetree.dir);for(var i in r){var l,d=r[i],c=d.n;l=c.length>70?'<span title="'+EscapeHtml(c)+'">'+EscapeHtml(c.substring(0,70))+"...</span>":EscapeHtml(c);var u="";if(null!=d.d){var p=new Date(d.d);"number"==typeof d.d&&(p=new Date(1e3*d.d));u=printDateTime(p)+"&nbsp;"}var m="";if(null!=d.s){const e=["Bytes","KB","MB","GB","TB"],t=parseInt(Math.floor(Math.log(Math.abs(d.s))/Math.log(1024)),10),o=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex];m=0==Q("p13sizedropdown").value?0===d.s?"n/a":0===t?`${d.s} ${e[t]}`:`${(d.s/1024**t).toFixed(2)} ${e[t]}`:1==Q("p13sizedropdown").value?getFileSizeStr(d.s):`${(d.s/2**o.value).toFixed(2)} ${o.title}`}var g="";if(d.t<3){g="<div class=filelist file=999>",g+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+'\'>&nbsp;<span style=float:right title=""></span>',g+="<span><div class=fileIcon"+("REMOVABLE"==d.dt?5:"CDROM"==d.dt?6:d.t)+' onclick=p13folderset("'+encodeURIComponentEx(d.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(d.nx)+"\")'>",isWindowsNode(currentNode)&&d.dt&&currentNode.volumes&&currentNode.volumes[l.charAt(0).toUpperCase()]&&currentNode.volumes[l.charAt(0).toUpperCase()].name?g+=currentNode.volumes[l.charAt(0).toUpperCase()].name+" ("+l+")":g+=l,g+="</a></span></div>"}else{var v=l;d.s>0&&(v=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(s+"/"+c)+"','"+encodeURIComponentEx(c)+"',"+d.s+')">'+l+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(s+"/"+c)+'","'+encodeURIComponentEx(c)+'") style=cursor:pointer>'+l+"</a>"),g="<div id=fileEntry cmenu=filesContextMenu fileIndex="+i+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+d.nx+"'>&nbsp;<span class=fsize>"+u+"</span><span style=float:right>"+EscapeHtml(m)+"</span><span><div class=fileIcon"+d.t+"></div>"+v+"</span></div>"}d.t<3?t+=g:o+=g}if(QH("p13files",t+o),QH("p13currentpath",n),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e){var h=document.getElementsByName("fd");for(i=0;i<h.length;i++)e.indexOf(p13filetree.dir[h[i].value].n)>=0&&(h[i].checked=!0)}p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open File/Folder","Are you sure you want to open this file/folder on the remote devices desktop?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[o].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Go To Folder",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],o=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var n=0;n<t.length;n++)t[n].n==currentNode._id&&(o=n);for(o>=0&&t.splice(o,1),t.push({n:currentNode._id,p:e});t.length>40;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){if(!xxdialogMode){var e=addHtmlFormFloating("Filtro",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>');e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>',e+="<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Fechar style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>",setModalContent("xxAddAgent","Encontrar arquivos",e+="<input id=filefind_dlgOkButton type=submit value=Procurar style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus()}}function p13findfileDown(e){"Entrar"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",Q("d2findFilter").value.length>0)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){if(0!=Q("d2findFilter").value.length){var o=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=o?"\\":"/",a=p13filetreelocation.join(n)+n;o||(a=n+a),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:a,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1)}}function p13sort_filename(e,t){return e.ln>t.ln?1*p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?1*p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t=[],o=Q("p13sortdropdown").value;for(var n in e)e[n].nx=n,null==e[n].s&&(e[n].s=0),null==e[n].n&&(e[n].n=n),e[n].ln=e[n].n.toLowerCase(),t.push(e[n]);return p13sortorder=1,o>3&&(p13sortorder=-1,o-=3),1==o?t.sort(p13sort_filename):2==o?t.sort(p13sort_bysize):3==o&&t.sort(p13sort_timestamp),t}function p13setActions(){var e=null!=currentNode.agent&&14!=currentNode.agent.id;if(null==p13filetree)QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Selecionar tudo",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1);else{var t=p13getFileSelCount(),o=p13getFileCount(),n=p13getFileSelCount(!1),a=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id;QE("p13DeleteFileButton",t>0&&(p13filetreelocation.length>0||0==a)),QE("p13NewFolderButton",e&&(p13filetreelocation.length>0||0==a)),QE("p13UploadButton",p13filetreelocation.length>0||0==a||14==currentNode.agent.id),QE("p13RenameFileButton",e&&1==t&&(p13filetreelocation.length>0||0==a)),QE("p13ViewFileButton",e&&1==t&&1==n&&(p13filetreelocation.length>0||0==a)),QE("p13SelectAllButton",o>0),Q("p13SelectAllButton").value=t>0?"Selecione nenhum":"Selecionar tudo",QE("p13RefreshButton",!0),QE("p13FindButton",e&&(p13filetreelocation.length>0||0==a)),QE("p13CutButton",e&&t>0&&t==n&&(p13filetreelocation.length>0||0==a)),QE("p13CopyButton",e&&t>0&&t==n&&(p13filetreelocation.length>0||0==a)),QE("p13ZipButton",e&&t>0&&(p13filetreelocation.length>0||0==a)),QE("p13UnzipButton",e&&1==t&&1==n&&(p13filetreelocation.length>0||0==a)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",e&&(p13filetreelocation.length>0||0==a)&&null!=p13clipboard&&p13clipboard.length>0),QE("p13GoToFolderButton",e),QE("p13OpenButton",e&&1==t),QE("p13DownloadButton",t>0&&t==n&&(p13filetreelocation.length>0||0==a))}1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Porta SSH {0}",filesNode.sshport?filesNode.sshport:22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,o=document.getElementsByName("fd"),n=0;n<o.length;n++)!o[n].checked||0==e&&"3"!=o[n].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&"999"==t[o].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),o=0;o<t.length;o++)if(t[o].checked&&!p13filetree.dir[t[o].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Nova pasta","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=p13getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Exclusão recursiva</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Excluir",e>1?format("Excluir {0} itens selecionados?",e)+t:"Excluir o item selecionado?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&(e=p13filetree.dir[t[o].value].n);setModalContent("xxAddAgent","Renomear",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Carregar Arquivo",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",Q("p13uploadinput").files.length>0)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor de Arquivo","Somente arquivos com menos de 200k podem ser editados.");break}}function p13unzipFile(){for(var e,t,o=document.getElementsByName("fd"),n=0;n<o.length;n++)if(o[n].checked){var a=isWindowsNode(currentNode)?"\\":"/";e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(a)+a+p13filetree.dir[o[n].value].n.split(".zip")[0]+a,t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(a)+a+p13filetree.dir[o[n].value].n}setModalContent("xxAddAgent","Unzip To Folder",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:t})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);setModalContent("xxAddAgent","Nome do arquivo zip",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var o=0;o<t.length;o++)t[o].checked&&"3"==t[o].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[o].value].n);p13updateClipview()}function p13pasteFile(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format("Confirma a cópia de {0} entradas para este local?",p13clipboard.length):format("Confirmar cópia de 1 entrada para este local?"):p13clipboard.length>1?format("Confirma a movimentação de {0} entradas para este local?",p13clipboard.length):format("Confirma a mudança de 1 entrada para este local?")),setModalContent("xxAddAgent","Colar",e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&p13clipboard.length>0&&(e=0==p13clipboardCut?p13clipboard.length>1?format('Retendo {0} entradas para cópia, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Apagar</a>.',p13clipboard.length):format('Segurando 1 entrada para cópia, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Apagar</a>.'):p13clipboard.length>1?format('Retendo {0} entradas para mover, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Apagar</a>.',p13clipboard.length):format('Segurando 1 entrada para o movimento, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Apagar</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t=[];for(var o in e.dataTransfer.files)null!=e.dataTransfer.files[o].size&&0!=e.dataTransfer.files[o].size&&t.push(e.dataTransfer.files[o]);0!=t.length&&p13doUploadFiles(t)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);var t=null!=p13filetree;QV("p13bigok",t),QV("p13bigfail",!t)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,o,n){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:o,tsize:0,data:"",state:0,id:Math.random(),tag:n},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Fazer download do arquivo","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+o+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){if(gdownloadFile&&0!=gdownloadFile.state)if(e.length>4&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),1&ReadInt(e,0))if("viewer"==gdownloadFile.tag){setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large");var t=gdownloadFile.file;showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null}else saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0);else files.sendText({action:"download",sub:"ack",id:gdownloadFile.id})}function p13downloadButton(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){var o=p13filetree.dir[e[t].value],n="devicefile.ashx?c="+authCookie;n+="&m="+currentNode.meshid.split("/")[2],n+="&n="+currentNode._id.split("/")[2],downloadFile(n+="&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+o.n),encodeURIComponentEx(o.n))}}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Wrap: ON","Wrap: OFF"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Tamanho: 100%","Tamanho: 125%","Tamanho: 150%","Tamanho: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(Q("d4editorarea").value):encode_utf8(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Codificação: RAW","Codificação: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var o,n=Q("d4editorarea").value;n=0===d4EditLineBreakVal?n.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?n.replace(/\r\n|\n/g,"\r"):n.replace(/\r\n|\r/g,"\n"),p13uploadFileContinue(1,[{name:t,size:(o=1==d4EditEncodingVal?(new TextEncoder).encode(n):(new TextEncoder).encode(decode_utf8(n))).byteLength,type:"text/plain",xdata:o}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=currentNode.agent.id>0&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,o=[],n=0;for(var a in p13filetree.dir)t?o.push(p13filetree.dir[a].n.toLowerCase()):o.push(p13filetree.dir[a].n);for(a=0;a<e.length;a++)t?o.indexOf(e[a].name.toLowerCase())>=0&&n++:o.indexOf(e[a].name)>=0&&n++;0==n?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Carregar Arquivo",format(1==n?"O upload substituirá 1 arquivo. Continuar?":"O upload substituirá {0} arquivos. Continuar?",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Carregar Arquivo","<div id=p13dfileName>Conectando ...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}const byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var o=new FileReader;o.onerror=function(e){t(null)},o.onload=function(){window.crypto.subtle.digest("SHA-384",o.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},o.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var e=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(e.name)),Q("d2progressBar").max=e.size,Q("d2progressBar").value=0,null==e.xdata){uploadFile.xfile=e;var t=null;for(var o in p13filetree.dir)p13filetree.dir[o].n==e.name&&(t=p13filetree.dir[o]);null!=t&&t.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(o){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,tag:{h:o.toUpperCase(),s:t.s,skip:t.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=e.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:e.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":uploadFile.xdataPriming=8,p13uploadNextPart(!1);break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile():p13uploadFileTransferDone();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,o=uploadFile.xptr;if(o>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((i=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;i=t.byteLength}var n=new Uint8Array(t.slice(o,i));if(123==n[0]||0==n[0]){var a=new Uint8Array(i-o+1);a.set(n,1),files.send(a)}else files.send(n);uploadFile.xptr=i,Q("d2progressBar").value=i}}else if(uploadFile.xfile){if(null!=uploadFile.xreader)return;if(uploadFile.xptr>=uploadFile.xfile.size)return;var i;if((i=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;i=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e=uploadFile.xreader.result;if(delete uploadFile.xreader,null!=e){var t=new Uint8Array(e);if(123==t[0]||0==t[0]){var o=new Uint8Array(e.byteLength+1);o.set(t,1),files.send(o)}else files.send(t);uploadFile.xptr=i,Q("d2progressBar").value=i,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):uploadFile.xdataPriming>0&&(uploadFile.xdataPriming--,p13uploadNextPart(!0))}},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,i))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(var o in currentDeviceEvents){var n=currentDeviceEvents[o],a=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var i,s="fa-mobile-screen";if("user"==n.etype&&(s="fa-user"),"server"==n.etype&&(s="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var o in i=eventsMessageId[n.msgid],n.msgArgs){var r=n.msgArgs[o];"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9))))),i=i.split("{"+o+"}").join(r)}i=EscapeHtml(i).split("(R)").join("&reg;")}if(n.username){var l="";n.guestname&&(l=' / <span title="Esta é uma sessão de compartilhamento de convidados">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+l+" &rarr; "+i:EscapeHtml(n.username)+l+" &rarr; "+i}"relay"!=n.etype&&"relaylog"!=n.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenhum evento encontrado</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var o,n;for(var a in 1==t&&(o=currentDeviceEvents),2==t&&(o=events),3==t&&(o=currentUserEvents),o)if(o[a].h==e){n=o[a];break}if(n){var i="<div style=overflow-y:auto;max-height:300px>";for(var a in n)"h"!=a&&"_id"!=a&&"ids"!=a&&"domain"!=a&&null!=n[a]&&("object"==typeof n[a]?i+=addHtmlValue3(EscapeHtml(a),EscapeHtml(JSON.stringify(n[a]))):i+=addHtmlValue3(EscapeHtml(a),EscapeHtml(n[a])));setModalContent("xxAddAgent","Detalhes do evento",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"CPU",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Memória",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){"none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc()):deviceDetailsStatsClear()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;deviceDetailsStatsData.length>0&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var o=[],n=[];for(var a in deviceDetailsStatsData){var i=deviceDetailsStatsData[a];o.push({x:100-(i[0]-t),y:i[1]}),n.push({x:100-(i[0]-t),y:i[2]})}if(deviceDetailsConfig.data.datasets[0].data=o,deviceDetailsConfig.data.datasets[1].data=n,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&e.thermals.length>0){var s="&nbsp;";for(var a in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[a].InstanceName+'">'+parseFloat(e.thermals[a].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[a].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,o){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=e._id),null!=t&&(DeviceDetailsHardware=t),null!=o&&(DeviceDetailsNetwork=o),null==(t=DeviceDetailsHardware)&&(t={}),null==(o=DeviceDetailsNetwork)&&(o={});var n=[],a={},i="";if(e.rname&&(i+=addDetailItem("Nome",EscapeHtml(e.rname),a)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(i+=addDetailItem("Descrição",EscapeHtml(t.windows.osinfo.Description),a)),e.osdesc&&(i+=addDetailItem("Versão",EscapeHtml(e.osdesc),a)),t.windows&&t.windows.osinfo)if((p=t.windows.osinfo).OSArchitecture&&(p.OSArchitecture.startsWith("32")?i+=addDetailItem("Arquitetura","32 bits",a):p.OSArchitecture.startsWith("64")?i+=addDetailItem("Arquitetura","64 bits",a):i+=addDetailItem("Arquitetura",EscapeHtml(p.OSArchitecture),a)),p.LastBootUpTime){var s={year:parseInt(p.LastBootUpTime.substring(0,4)),month:parseInt(p.LastBootUpTime.substring(4,6))-1,day:parseInt(p.LastBootUpTime.substring(6,8)),hours:parseInt(p.LastBootUpTime.substring(8,10)),minutes:parseInt(p.LastBootUpTime.substring(10,12)),seconds:parseInt(p.LastBootUpTime.substring(12,14))};i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(s.year,s.month,s.day,s.hours,s.minutes,s.seconds)))}if(t.linux&&t.linux.LastBootUpTime){i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))}if(t.darwin&&t.darwin.LastBootUpTime){i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))}if(""!=i&&n.push({name:"Sistema operacional",html:i,img:"software64.png"}),e.agent){i="";if(null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver){var r="";r=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(r+=" v"+e.agent.ver),14==e.agent.id&&(r=e.agent.core),i+=addDetailItem("Agente Mesh",r)}if(1&e.conn?i+=addDetailItem("Última conexão do agente","Conectado agora"):e.lastconnect&&(i+=addDetailItem("Última conexão do agente",printDateTime(new Date(e.lastconnect)))),e.lastaddr){var l=e.lastaddr.split(":");l.length>2?i+=addDetailItem("Último endereço do agente",'<a href="https://iplocation.com/?ip='+l.slice(0,-1).join(":")+'" rel="noreferrer noopener" target="MeshIPLoopup">'+l.slice(0,-1).join(":")+"</a>"):isPrivateIP(e.lastaddr)?i+=addDetailItem("Último endereço do agente",l[0]):i+=addDetailItem("Último endereço do agente",'<a href="https://iplocation.com/?ip='+l[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+l[0]+"</a>")}if(null!=t.agentvers&&t.agentvers.compileTime){var d=Date.parse(t.agentvers.compileTime);i+=addDetailItem("Tempo de compilação",isNaN(d)?t.agentvers.compileTime:printDateTime(new Date(d)))}""!=i&&n.push({name:"Agente Mesh",html:i,img:"meshagent64.png"})}if(t.mobile){i="";t.mobile.brand&&t.mobile.model&&(i+=addDetailItem("Modelo",EscapeHtml(t.mobile.brand+", "+t.mobile.model),a)),t.mobile.device&&(i+=addDetailItem("Dispositivo",EscapeHtml(t.mobile.device),a)),t.mobile.bootloader&&(i+=addDetailItem("Bootloader",EscapeHtml(t.mobile.bootloader),a)),t.mobile.id&&(i+=addDetailItem("Identificador",EscapeHtml(t.mobile.id),a)),t.mobile.host&&(i+=addDetailItem("Nome do Host",EscapeHtml(t.mobile.host),a)),t.mobile.androidapi&&t.mobile.androidrelease&&(i+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),a)),""!=i&&n.push({name:"Dispositivo móvel",html:i,img:"mobile64.png"})}if(null!=o.netif){var c={};for(var u in o.netif){"string"==typeof(p=o.netif[u]).mac&&(null==c[p.mac]?(c[p.mac]=p,c[p.mac].ipv4layer=[{v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}]):c[p.mac].ipv4layer.push({v4addr:p.v4addr,v4mask:p.v4mask,v4gateway:p.v4gateway}))}i="";for(var u in i+='<table class="table table-hover" style=width:100%>',c){var p=c[u];for(var m in i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.name+(p.dnssuffix?", "+p.dnssuffix:""))+"</b></div>",p.desc&&(i+=addDetailItem("Descrição",EscapeHtml(p.desc).split("(R)").join("&reg;"))),p.mac&&(p.gatewaymac?i+=addDetailItem("Camada MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(p.mac),EscapeHtml(p.gatewaymac))):p.mac&&(i+=addDetailItem("Camada MAC",format("MAC: {0}",EscapeHtml(p.mac))))),p.ipv4layer){var g=p.ipv4layer[m];g.v4gateway&&g.v4mask?i+=addDetailItem("Camada IPv4",format("IP: {0}, Máscara: {1}, Gateway: {2}",EscapeHtml(g.v4addr),EscapeHtml(g.v4mask),EscapeHtml(g.v4gateway))):g.v4addr&&(i+=addDetailItem("Camada IPv4",format("IP: {0}",EscapeHtml(g.v4addr))))}i+="</div></td></tr>"}""!=(i+="</table>")&&n.push({name:"Networking",html:i,img:"networking64.png"})}if(null!=o.netif2){i="";for(var u in i+='<table class="table table-hover" style=width:100%>',o.netif2){p=o.netif2[u];if(!(0==Array.isArray(p)||p.length<1||null==p[0]||"string"==typeof p[0].mac&&p[0].mac.startsWith("00:00:00:00"))){i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var v="";null!=u&&(v+=u),null!=p[0].fqdn&&""!=p[0].fqdn&&(v+=", "+p[0].fqdn),v.length>0&&(i+="<div style=margin-bottom:3px><b>"+EscapeHtml(v)+"</b></div>"),p.desc&&(i+=addDetailItem("Descrição",EscapeHtml(p.desc).split("(R)").join("&reg;"))),"string"==typeof p[0].mac&&(p[0].gatewaymac?i+=addDetailItem("Camada MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(p[0].mac),EscapeHtml(p[0].gatewaymac))):i+=addDetailItem("Camada MAC",format("MAC: {0}",EscapeHtml(p[0].mac))));for(m=0;m<p.length;m++){var h=p[m],f=[];h.address&&f.push(format("IP: {0}",EscapeHtml(h.address))),h.netmask&&f.push(format("Máscara: {0}",EscapeHtml(h.netmask))),h.gateway&&f.push(format("Gateway: {0}",EscapeHtml(h.gateway))),f.length>0&&("IPv4"==h.family&&(i+=addDetailItem("Camada IPv4",f.join(","))),"IPv6"==h.family&&(i+=addDetailItem("Camada IPv6",f.join(","))))}i+="</div></td></tr>"}}t.network&&t.network.dns&&(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+=addDetailItem("<b>DNS Servers</b>",t.network.dns.join(",")),i+="</div></td></tr>"),""!=(i+="</table>")&&n.push({name:"Networking",html:i,img:"networking64.png"})}if(null!=e.intelamt){i="";i+=addDetailItem("Versão",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Desconhecido</i>",a);var x={0:nobreak("Não ativado"),1:nobreak("Pré-ativação"),2:nobreak("ativado")},k="";2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?k=", Modo de controle do cliente (CCM)":4&e.intelamt.flags&&(k=", Modo de controle de administrador (ACM)")),i+=addDetailItem("Estado de Provisionamento",(e.intelamt.state?x[e.intelamt.state]:"<i>Desconhecido</i>")+k,a),i+=addDetailItem("Segurança",1==e.intelamt.tls?"Protegido usando TLS":"TLS não está configurado",a),""!=(i+=addDetailItem("Credenciais de administrador",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&9&e.intelamt.warn?"Não conhecido":"Conhecido",a))&&("number"==typeof e.intelamt.sku&&16&e.intelamt.sku?n.push({name:"Capacidade de gerenciamento padrão Intel&reg; (Intel&reg; SM)",html:i,img:"amt64.png"}):n.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:i,img:"amt64.png"}))}if(t.identifiers){i="";var b=t.identifiers;if(b.bios_vendor&&(i+=addDetailItem("Fornecedor",EscapeHtml(b.bios_vendor),a)),b.bios_version&&(i+=addDetailItem("Versão",EscapeHtml(b.bios_version),a)),b.bios_serial&&(i+=addDetailItem("Serial",EscapeHtml(b.bios_serial),a)),b.bios_mode&&(i+=addDetailItem("Mode",EscapeHtml(b.bios_mode),a)),""!=i&&n.push({name:"BIOS",html:i,img:"chip64.png"}),i="",b.board_vendor&&(i+=addDetailItem("Fornecedor",EscapeHtml(b.board_vendor),a)),b.board_name&&(i+=addDetailItem("Nome",EscapeHtml(b.board_name),a)),b.board_serial&&""!=b.board_serial&&(i+=addDetailItem("Serial",EscapeHtml(b.board_serial),a)),b.board_version&&(i+=addDetailItem("Versão",EscapeHtml(b.board_version),a)),b.product_uuid&&(i+=addDetailItem("Identificador",EscapeHtml(b.product_uuid),a)),b.cpu_name&&(i+=addDetailItem("CPU",EscapeHtml(b.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a)),b.gpu_name)for(var u in b.gpu_name)i+=addDetailItem("GPU",EscapeHtml(b.gpu_name[u]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a);""!=i&&n.push({name:"Placa-mãe",html:i,img:"motherboard64.png"})}if(t.tpm){i="";var y=t.tpm;y.SpecVersion&&(i+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(y.SpecVersion)).toFixed(1),a)),y.ManufacturerId&&(i+=addDetailItem("ManufacturerId",EscapeHtml(y.ManufacturerId),a)),y.ManufacturerVersion&&(i+=addDetailItem("ManufacturerVersion",EscapeHtml(y.ManufacturerVersion),a)),null!=y.IsActivated&&(i+=addDetailItem("IsActivated",y.IsActivated?"Yes":"No",a)),null!=y.IsEnabled&&(i+=addDetailItem("IsEnabled",y.IsEnabled?"Yes":"No",a)),null!=y.IsOwned&&(i+=addDetailItem("IsOwned",y.IsOwned?"Yes":"No",a)),""!=i&&n.push({name:"TPM",html:i,img:"tpm64.png"})}if(t.windows&&t.windows.memory&&t.windows.memory.length>0){i="";for(var u in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),i+='<table class="table table-hover" style=width:100%>',t.windows.memory){p=t.windows.memory[u];i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.BankLabel?p.BankLabel:p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Capacity&&p.Speed?i+=addDetailItem("Capacidade / Velocidade",format("{0} Mb, {1} Mhz",p.Capacity/1024/1024,p.Speed),a):p.Capacity&&(i+=addDetailItem("Capacidade",format("{0} Mb",p.Capacity/1024/1024),a)),p.PartNumber&&(i+=addDetailItem("Part Number",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),i+="</div>"}""!=(i+="</table>")&&n.push({name:"Memória",html:i,img:"ram64.png"})}if(t.linux&&t.linux.memory&&t.linux.memory.Memory_Device.length>0){i="";for(var u in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),i+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device){(p=t.linux.memory.Memory_Device[u]).Size&&"No Module Installed"==p.Size||(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Locator?p.Locator:"Unknown")+"</b></div>",p.Size&&p.Speed?i+=addDetailItem("Capacidade / Velocidade",format("{0}, {1}",p.Size,p.Speed),a):p.Size&&(i+=addDetailItem("Capacidade",format("{0}",p.Size),a)),p.PartNumber&&(i+=addDetailItem("Part Number",EscapeHtml(p.Manufacturer&&"Undefined"!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),i+="</div>")}""!=(i+="</table>")&&n.push({name:"Memória",html:i,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&t.darwin.memory.length>0){i="";for(var u in i+='<table class="table table-hover" style=width:100%>',t.darwin.memory){(p=t.darwin.memory[u]).Size&&"No Module Installed"==p.Size||(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.DeviceLocator?p.DeviceLocator:"Unknown")+"</b></div>",p.Size&&p.Speed?i+=addDetailItem("Capacidade / Velocidade",format("{0}, {1}",p.Size,p.Speed),a):p.Size&&(i+=addDetailItem("Capacidade",format("{0}",p.Size),a)),p.PartNumber&&(i+=addDetailItem("Part Number",EscapeHtml(p.Manufacturer&&""!=p.Manufacturer?p.Manufacturer+", ":"")+EscapeHtml(p.PartNumber),a)),i+="</div>")}""!=(i+="</table>")&&n.push({name:"Memória",html:i,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){i="";for(var u in b.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),i+="<table style=width:100%>",b.storage_devices){if((p=b.storage_devices[u]).Size){if(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+EscapeHtml(p.Caption)+"</b></div>",p.Model&&p.Model!=p.Caption&&(i+=addDetailItem("Modelo",EscapeHtml(p.Model),a)),p.Size&&("string"==typeof p.Size&&parseInt(p.Size)==p.Size&&(p.Size=parseInt(p.Size)),"number"==typeof p.Size&&(i+=addDetailItem("Capacidade",format("{0} Mb",Math.floor(p.Size/1024/1024)),a)),"string"==typeof p.Size&&(i+=addDetailItem("Capacidade",EscapeHtml(p.Size),a))),t.windows&&t.windows.drives&&p.Model){const e=t.windows.drives.find(e=>e.Model===p.Model);e&&e.Status&&(i+=addDetailItem("Status",EscapeHtml(e.Status),a))}i+="</div>"}}""!=(i+="</table>")&&n.push({name:"Armazenar",html:i,img:"storage64.png"})}if(t.windows&&t.windows.volumes){i="";for(var u in t.windows.volumes){if(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+u+":"+(null==(p=t.windows.volumes[u]).name||""==p.name?"":" - "+EscapeHtml(p.name))+"</b></div>",p.size){var w=["Bytes","KB","MB","GB","TB"],C=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;i+=addDetailItem("Capacidade",EscapeHtml(C),a)}if(p.sizeremaining){w=["Bytes","KB","MB","GB","TB"],C=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.sizeremaining))/Math.log(1024)),10))?`${p.sizeremaining} ${w[m]}`:`${(p.sizeremaining/1024**m).toFixed(2)} ${w[m]}`;i+=addDetailItem("Capacity Remaining",EscapeHtml(C),a)}if(p.type)i+=addDetailItem("File System",(""!=(S=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?S+" / ":"")+("Unknown"==p.type?"Desconhecido":EscapeHtml(p.type)),a);if(p.protectionStatus||p.volumeStatus){var M=[];p.protectionStatus&&M.push("Habilitado "),p.volumeStatus&&"FullyDecrypted"==p.volumeStatus&&M.push("Fully Decrypted"),p.volumeStatus&&"EncryptionInProgress"==p.volumeStatus&&M.push("Encryption In Progress"),p.volumeStatus&&"FullyEncrypted"==p.volumeStatus&&M.push("Fully Encrypted"),M=M.join(" - "),p.recoveryPassword&&(M+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(u)+'","'+encodeURIComponentEx(p.identifier)+'","'+encodeURIComponentEx(p.recoveryPassword)+'")')),i+=addDetailItem("BitLocker",M,a)}i+="</div>"}""!=i&&n.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){i="";for(var u in t.linux.volumes){if(!(p=t.linux.volumes[u]).mount_point.startsWith("/var/lib/docker/overlay2")){if(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size){w=["KB","MB","GB","TB"],C=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.size))/Math.log(1024)),10))?`${p.size} ${w[m]}`:`${(p.size/1024**m).toFixed(2)} ${w[m]}`;i+=addDetailItem("Capacidade",EscapeHtml(C),a)}if(p.available){if(0==Math.abs(p.available))C="0 KB";else w=["KB","MB","GB","TB"],C=0===(m=parseInt(Math.floor(Math.log(Math.abs(p.available))/Math.log(1024)),10))?`${p.available} ${w[m]}`:`${(p.available/1024**m).toFixed(2)} ${w[m]}`;i+=addDetailItem("Capacity Remaining",EscapeHtml(C),a)}if(p.type)i+=addDetailItem("File System",(""!=(S=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?S+" / ":"")+("Unknown"==p.type?"Desconhecido":EscapeHtml(p.type)),a);i+="</div>"}}""!=i&&n.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){i="";for(var u in t.darwin.volumes){if(!(p=t.darwin.volumes[u]).mount_point.startsWith("/var/lib/docker/overlay2")){var S;if(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>",i+="<div style=margin-bottom:3px><b>"+p.mount_point+"</b></div>",p.size&&(i+=addDetailItem("Capacidade",EscapeHtml(p.size),a)),p.available&&(i+=addDetailItem("Capacity Remaining",EscapeHtml(p.available),a)),p.type)i+=addDetailItem("File System",(""!=(S=1==p.removable?"Removable":1==p.cdrom?"CD-ROM":"")?S+" / ":"")+("Unknown"==p.type?"Desconhecido":EscapeHtml(p.type)),a);i+="</div>"}}""!=i&&n.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage64.png"})}i="";for(var u in n)null==n[u].img?i+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+n[u].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+n[u].html+"</div>":(i+="<table style=width:100%><tr>",i+="<td style=width:64px;vertical-align:top><img src=images/details/"+n[u].img+" border=0 width=64 /></td>",i+="<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+n[u].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+n[u].html+"</div></td>",i+="</tr></table>");""==i?QH("p17info2","Nenhuma informação para este dispositivo."):QH("p17info2",i)}}function deviceDetailsShowBitlockerInfo(e,t,o){if(xxdialogMode)return!1;var n="<div><p>Identificador</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Desconhecido")+"</p>";n+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(o?decodeURIComponent(o):"Desconhecido")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker Information",n),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){if(e.ctrlKey||e.altKey)return!0;var t=0,o=Q("p15consoleText");if(e.key)if(13==e.keyCode&&0==consoleFocus)p15consoleSend(e),t=1;else if(8==e.keyCode&&0==consoleFocus){var n=o.value;o.value=n.substring(0,n.length-1),t=1}else if(27==e.keyCode)o.value="",t=1;else if(38==e.keyCode||40==e.keyCode){var a=consoleHistory.indexOf(o.value);38==e.keyCode&&consoleHistory.length-1>a?o.value=consoleHistory[a+1]:40==e.keyCode&&a>0?o.value=consoleHistory[a-1]:40==e.keyCode&&0==a&&(o.value=""),t=1}else 1===e.key.length&&(insertTextAtCursor(o,e.key),t=1);else 0!=e.charCode&&0==consoleFocus&&(o.value=o.value+String.fromCharCode(e.charCode),t=1);return t>0?haltEvent(e):void 0}function insertTextAtCursor(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t;else if(e.selectionStart||"0"==e.selectionStart){var o=e.selectionStart,n=e.selectionEnd;e.value=e.value.substring(0,o)+t+e.value.substring(n,e.value.length),e.setSelectionRange(n+1,n+1)}else e.value+=myValue}var consoleServerText="";function setupConsole(){if(115==xxcurrentView){var e="server"==consoleNode;consoleNode="server",QH("p15deviceName","Meu Console do Servidor"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)}else{e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid];if(16&GetNodeRights(currentNode)){null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight);1&consoleNode.conn||consoleNode.conn;var t=1&consoleNode.conn?"Agente está online":"Agente está offline";16&consoleNode.conn&&(t+=", O MQTT está online"),QH("p15statetext",t),QE("p15uploadCore",!!(1&consoleNode.conn)),QV("p15outputselecttd",!!(16&consoleNode.conn)||1==currentNode.pmt&&!!(4&features2)),QV("p15outputselect2",!!(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&!!(4&features2));var o=Q("p15outputselect").value;16&consoleNode.conn||2!=o||(o=1,Q("p15outputselect").value=1),1==currentNode.pmt&&4&features2||3!=o||(o=1,Q("p15outputselect").value=1);var n=!1;1&consoleNode.conn&&1==o&&(n=!0),16&consoleNode.conn&&2==o&&(n=!0),1==currentNode.pmt&&4&features2&&3==o&&(n=!0),QE("p15consoleText",n)}else QH("p15statetext","Acesso negado"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1);QV("devListToolbarViewIcons3",!!(1&consoleNode.conn))}}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){if(!e||13==e.keyCode){var t=Q("p15consoleText").value,o="<div style=color:green>&gt; "+EscapeHtml(t)+"<br/></div>";if(115==xxcurrentView?(consoleServerText+=o,meshserver.send({action:"serverconsole",value:t})):16&consoleNode.conn&&2==Q("p15outputselect").value?(o="<div style=color:orange>MQTT&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=o,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:t})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&4&features2?(o="<div style=color:violet>PUSH&gt; "+EscapeHtml(t)+"<br/></div>",consoleNode.consoleText+=o,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:t})):1&consoleNode.conn&&(consoleNode.consoleText+=o,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:t})),Q("p15agentConsoleText").innerHTML+=o,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",t.length>0){var n=consoleHistory.indexOf(t);n>=0&&consoleHistory.splice(n,1),consoleHistory.unshift(t),consoleHistory.splice(10)}}}function p15consoleReceive(e,t,o){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==o?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){if(!xxdialogMode)if(1==e.shiftKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"});else if(1==e.altKey)meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"});else if(1==e.ctrlKey)p15uploadCore2();else{setModalContent("xxAddAgent","Executar ação do agente",addHtmlFormFloating("Açao",'<select id=d3coreMode class="form-select me-2"><option value=1>Carregar o "Core" Padrão do Servidor</option><option value=2>Apagar "Core"</option><option value=3>Carregar um Arquivo de "Core"</option><option value=4>Desconectar Agente</option><option value=5>Forçar desconexão do Agente </option><option value=6>Carregar "Core" de Recuperação</option><option value=7>Carregar "Core" Mínimo</option><option value=8>Restart agent service</option><option value=9>Forçar atualização do agente</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)}}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value?meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"}):9==Q("d3coreMode").value&&meshserver.send({action:"updateAgents",nodeids:[consoleNode._id]})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent",'Carregar "Core" do Agente Mesh',""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){if(1==Q("d3uploadMode").value)Q("d3submit").click();else{var e=d3getFileSel();1==e.length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Logins anteriores","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){if(!xxdialogMode){var t=0==e?userinfo:currentUser;setModalContent("xxAddAgent","Gerenciar imagem da conta",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2);var o=Q("p2canvas").getContext("2d");null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random()));var n="";1==e&&(n="&id="+t._id.split("/")[2]);var a=new Image;a.onload=function(){o.clearRect(0,0,256,256),o.drawImage(a,0,0)},a.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+n:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1)}}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],t=new Image;t.onload=function(){var e=0,o=0,n=Math.min(t.width,t.height);t.width>n&&(e=(t.width-n)/2),t.height>n&&(o=(t.height-n)/2);var a=Q("p2canvas").getContext("2d");a.imageSmoothingEnabled=!0,a.webkitImageSmoothingEnabled=!0,a.mozImageSmoothingEnabled=!0,a.clearRect(0,0,256,256),a.drawImage(t,e,o,n,n,0,0,256,256),QE("idx_dlgOkButton",!0)},t.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){var e;!xxdialogMode&&33554432&features&&(null!=userinfo.phone?(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Número de telefone verificado</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>",setModalContent("xxAddAgent","Notificações por telefone",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remover número de telefone</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate()):(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>',e+="<td>Digite seu número de telefone compatível com SMS. Depois de verificado, o número pode ser usado para verificação de login e outras notificações.",xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notificações por telefone",e+='<br /><br /><div style=width:100%;text-align:center>Número de telefone: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate()))}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var o=0;o<e.length;o++){var n=e.charCodeAt(o);(n<48||n>57)&&32!=n&&45!=n&&46!=n&&(t=!1)}return t&&e.length>=10}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e;if(!xxdialogMode&&33554432&features2)if(null!=userinfo.msghandle)e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>',e+="<td style=text-align:center><div style=padding:6px>Verified handle</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>",setModalContent("xxAddAgent","Messaging Notifications",e+='<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remove messaging</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate();else{e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>',e+="<td>Enter your messaging service and handle. Once verified, this server can send you login verification and other notifications.<br /><br />";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>";1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate()}}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Tema":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nome do usuário";var t=Q("d2handleinput").value.length>0;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){if(0!=Q("d2handleinput").value.length)return QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}),!1}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){if(!xxdialogMode&&8388608&features){var e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified;setModalContent("xxAddAgent","Autenticação do email",'Quando ativado, em cada login, você terá a opção de receber um token de login para sua conta de e-mail para aumentar a segurança.<br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+(e?"checked":"")+"/>Ative a autenticação de dois fatores de e-mail.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})})}}function account_manageAuthDuo(){!xxdialogMode&&536870912&features2&&(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo Authentication",'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo Authentication",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&4096&features)return 1==userinfo.otpsecret?account_removeOtp():account_addOtp(),!1}function account_addOtp(){!xxdialogMode&&1!=userinfo.otpsecret&&4096&features&&(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","App autenticador","<div id=d2optinfo>Carregando...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){return meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value}),!1}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){!xxdialogMode&&1==userinfo.otpsecret&&4096&features&&(setModalContent("xxAddAgent","App autenticador","Confirma a remoção do login em 2 etapas do aplicativo autenticador?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return!!(4096&features)&&(count2factoraAuths()>0&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1)}function account_managePushAuthDev(){if(!xxdialogMode&&64&features2){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Dispositivo de autenticação","Confirma a remoção do dispositivo de autenticação push?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(var t in nodes){var o=nodes[t];null!=o.agent&&14==o.agent.id&&1==o.pmt&&4294967295==GetNodeRights(o)&&e.push(o)}if(0==e.length)setModalContent("xxAddAgent","Dispositivo de autenticação","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var n="Selecione um dispositivo para registrar para autenticação de notificação push. Depois de selecionado, o dispositivo solicitará confirmação.<br /><br />",a='<select id=d2devselect class="form-select">';for(var t in e)a+='<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>";setModalContent("xxAddAgent","Dispositivo de autenticação",n+=addHtmlFormFloating("Dispositivo",a+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),!(xxdialogMode||!(4096&features))&&(meshserver.send({action:"otp-hkey-get"}),!1)}function account_addhkey(e){if(3==e){var t="Digite o nome da chave a ser adicionada.<br /><br />";t+=addHtmlFormFloating("Nome da Chave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Minha chave" onkeyup=account_addhkeyValidate(event,2) />')}else if(2==e){t="Digite um nome de chave, selecione a caixa OTP e pressione o botão no YubiKey &trade;.<br /><br />";t+=addHtmlFormFloating("Nome da Chave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Minha chave" onkeyup=account_addhkeyValidate(event,1) />'),t+=addHtmlFormFloating("YubiKey &trade; OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')}setModalContent("xxAddAgent","Adicionar chave de segurança",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var o=Q("dp1keyname").value;if(""==o&&(o="MyKey"),2==t)meshserver.send({action:"otp-hkey-yubikey-add",name:o,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Adicionar chave de segurança","<br />Verificando ...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");else if(3==t)return meshserver.send({action:"webauthn-startregister",name:o}),!1}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"africâner",sq:"albanês",ar:"Árabe (padrão)","ar-dz":"Árabe (Argélia)","ar-bh":"Árabe (Bahrein)","ar-eg":"Árabe (Egito)","ar-iq":"Árabe (Iraque)","ar-jo":"Árabe (Jordânia)","ar-kw":"Árabe (Kuwait)","ar-lb":"Árabe (Líbano)","ar-ly":"Árabe (Líbia)","ar-ma":"Árabe (Marrocos)","ar-om":"Árabe (Omã)","ar-qa":"Árabe (Qatar)","ar-sa":"Árabe (Arábia Saudita)","ar-sy":"Árabe (Síria)","ar-tn":"Árabe (Tunísia)","ar-ae":"Árabe (EUA)","ar-ye":"Árabe (Iêmen)",an:"Aragonês",hy:"Armênio",as:"Assamês",ast:"Asturiano",az:"Azerbaijano",eu:"Basco",bg:"búlgaro",be:"Bielo-russo",bn:"bengali",bs:"Bósnio",br:"Bretão",my:"birmanês",ca:"catalão",ch:"Chamorro",ce:"Checheno",zh:"chinês","zh-hk":"Chinês (Hong Kong)","zh-cn":"Chinês (RPC)","zh-sg":"Chinês (Cingapura)","zh-tw":"Chinês (taiwan)",cv:"Chuvashe",co:"Corso",cr:"Cree",hr:"Croata",cs:"Tcheco",da:"dinamarquês",nl:"Holandês (padrão)","nl-be":"Holandês (belga)",en:"Inglês","en-au":"Inglês (Austrália)","en-bz":"Inglês (belize)","en-ca":"Inglês (Canadá)","en-ie":"Inglês (Irlanda)","en-jm":"Inglês (Jamaica)","en-nz":"Inglês (Nova Zelândia)","en-ph":"Inglês (Filipinas)","en-za":"Inglês (áfrica do sul)","en-tt":"Inglês (Trinidad e Tobago)","en-gb":"Inglês (Reino Unido)","en-us":"Inglês dos Estados Unidos)","en-zw":"Inglês (zimbabué)",eo:"Esperanto",et:"Estoniano",fo:"Das ilhas Faroé",fa:"Farsi (persa)",fj:"De Fiji",fi:"Finlandês",fr:"Francês (padrão)","fr-be":"Francês (Bélgica)","fr-ca":"Francês (Canadá)","fr-fr":"Francês França)","fr-lu":"Francês (Luxemburgo)","fr-mc":"Francês (Mônaco)","fr-ch":"Francês (Suíça)",fy:"Frísio",fur:"Friulian",gd:"Gaélico (escocês)","gd-ie":"Gaélico (irlandês)",gl:"Galaciano",ka:"Georgiano",de:"Alemão (padrão)","de-at":"Alemão (Áustria)","de-de":"Alemanha alemã)","de-li":"Alemão (Liechtenstein)","de-lu":"Alemão (Luxemburgo)","de-ch":"Alemão (Suíça)",el:"Grego",gu:"Gujurati",ht:"Haitiano",he:"Hebraico",hi:"hindi",hu:"Húngaro",is:"Islandês",id:"Indonésio",iu:"Inuktitut",ga:"irlandês",it:"Italiano (padrão)","it-ch":"Italiano (Suíça)",ja:"japonês",kn:"Canarim",ks:"Caxemira",kk:"Cazaque",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Coreano","ko-kp":"Coreano (Coréia do Norte)","ko-kr":"Coreano (Coreia do Sul)",la:"Latina",lv:"letão",lt:"Lituano",lb:"Luxemburguês",mk:"FYRO macedônio",ms:"Malaio",ml:"Malaiala",mt:"maltês",mi:"maori",mr:"Marati",mo:"Moldaviano",nv:"Navajo",ng:"Ndonga",ne:"Nepalês",no:"Norueguês",nb:"Norueguês (Bokmal)",nn:"Norueguês (Nynorsk)",oc:"Occitano",or:"Oriya",om:"Oromo","fa-ir":"Persa / Irã",pl:"polonês",pt:"Português","pt-br":"Português (Brasil)",pa:"Punjabi","pa-in":"Punjabi (Índia)","pa-pk":"Punjabi (Paquistão)",qu:"Quechua",rm:"Reto-Românico",ro:"Romena","ro-mo":"Romeno (Moldávia)",ru:"Russo","ru-mo":"Russo (Moldávia)",sz:"Sami (lapão)",sg:"Sango",sa:"Sânscrito",sc:"Da Sardenha",sd:"Sindi",si:"Cingalês",sr:"Sérvio",sk:"Eslovaco",sl:"Esloveno",so:"Somani",sb:"Sorábio",es:"Espanhol","es-ar":"Espanhol (argentina)","es-bo":"Espanhol (Bolívia)","es-cl":"Espanhol (Chile)","es-co":"Espanhol (Colômbia)","es-cr":"Espanhol (Costa Rica)","es-do":"Espanhol (República Dominicana)","es-ec":"Espanhol (Equador)","es-sv":"Espanhol (El Salvador)","es-gt":"Espanhol (Guatemala)","es-hn":"Espanhol (honduras)","es-mx":"Espanhol (México)","es-ni":"Espanhol (Nicarágua)","es-pa":"Espanhol (panamá)","es-py":"Espanhol (Paraguai)","es-pe":"Espanhol (Peru)","es-pr":"Espanhol (Porto Rico)","es-es":"Espanhol (Espanha)","es-uy":"Espanhol (Uruguai)","es-ve":"Espanhol (venezuela)",sx:"Sutu",sw:"Suaíli",sv:"Sueco","sv-fi":"Sueco (Finlândia)","sv-sv":"Sueco (Suécia)",ta:"Tâmil",tt:"Tártaro",te:"Teluga",th:"Tailandês",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turco",tk:"Turcomano",uk:"Ucraniano",hsb:"Sorábio superior",ur:"Urdu",ve:"Venda",vi:"Vietnamita",vo:"Volapuk",wa:"Valão",cy:"Galês",xh:"Xhosa",ji:"Iídiche",zu:"Zulu"},loclistex={"zh-chs":"Chinês simplificado)","zh-cht":"Chinês tradicional)"};function account_showLocalizationSettings(){if(xxdialogMode)return!1;var e=getstore("loctag",0),t="",o='<select id=d2locselect class="form-select"><option value="*">Valor do navegador do usuário</option>';for(var n in loclist)o+='<option value="'+n+'"'+(e==n?" selected":"")+">"+n+" - "+loclist[n]+"</option>";if(o+="</select>",serverinfo.languages&&serverinfo.languages.length>0){t+="Alterar o idioma exigirá uma atualização da página.<br /><br />";var a='<select id=d2langselect class="form-select"><option value="*">Valor do navegador do usuário</option>';for(var n in serverinfo.languages){var i=serverinfo.languages[n];a+='<option value="'+i+'"'+(userinfo.lang==i?" selected":"")+">"+i+" - "+(loclist[i]?loclist[i]:loclistex[i])+"</option>"}t+=addHtmlFormFloating("Idiomas",a+="</select>")}return t+=addHtmlFormFloating("Datas e Horários",o),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Ajude a traduzir o MeshCentral</a>'),setModalContent("xxAddAgent","Configurações de idioma",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx),!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),t=e?e.value:null;"*"==t&&null==userinfo.lang&&(t=userinfo.lang),t!=userinfo.lang&&meshserver.send({action:"changelang",lang:t});var o=getstore("loctag",0),n=Q("d2locselect").value;o!=n&&("*"!=n?args.locale=n:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e="",t="Crie um nome de usuário e senha temporários que podem ser usados ​​como login alternativo para sua conta. Isso é útil para permitir que ferramentas ou outros serviços acessem sua conta.<br /><br />",o={0:"Ilimitado",1:"1 minuto",5:"5 minutos",10:"10 minutos",15:"15 minutos",30:"30 minutos",45:"45 minutos",60:"60 minutos",120:"2 horas",240:"4 horas",480:"8 horas",720:"12 horas",960:"16 horas",1440:"24 horas",2880:"2 dias",5760:"4 dias",10080:"7 dias"};for(var n in o)e+="<option value="+n+">"+o[n]+"</option>";t+='<div class="form-floating mb-3">',t+='<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Nome do token" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>',t+="<label for=d2tokenName>Nome do token</label>",t+="</div>",setModalContent("xxAddAgent","Criar token de login",t+=addHtmlFormFloating("Tempo de expiração",'<select class="boxsize form-select" id=d2tokenExpire>'+e+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",Q("d2tokenName").value.length>0)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){if(xxdialogMode)return!1;setModalContent("xxAddAgent","Configurações de notificação",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Som de notificação</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Exibir nome do grupo de dispositivos</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexões de dispositivos</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexões de dispositivos</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Desktop Intel&reg; AMT e eventos seriais</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx);var e=getstore("notifications",0);return Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e,!1}function account_showAccountNotifySettingsEx(){var e=0;e+=Q("p2notifyPlayNotifySound").checked?1:0,e+=Q("p2notifyIntelDeviceConnect").checked?2:0,e+=Q("p2notifyIntelDeviceDisconnect").checked?4:0,e+=Q("p2notifyIntelAmtKvmActions").checked?8:0,putstore("notifications",e+=Q("p2notifyGroupName").checked?16:0)}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","verificação de e-mail","Clique em ok para enviar um e-mail de verificação para:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Aguarde alguns minutos para receber a verificação."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){if(xxdialogMode)return!1;return setModalContent("xxAddAgent","Mudança de endereço de email",'Altere o endereço de e-mail da sua conta aqui.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus(),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){if(xxdialogMode)return!1;var e="Para excluir esta conta, digite a senha da conta nas duas caixas abaixo e clique em ok.<br /><br />";return e+="<form method=post>",e+="<input type=hidden name=action value=deleteaccount />",e+='<input type=hidden name=authcookie value="'+authCookie+'" />',e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+='<label for="apassword1">Password</label>',e+="</div>",e+='<div class="form-floating mb-3">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>',e+="<label for=apassword2>Confirm Password</label>",e+="</div>",e+="</div>",setModalContent("xxAddAgent","Deletar conta",e+="</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus(),!1}function account_showChangePassword(){if(xxdialogMode)return!1;var e="Altere a senha da sua conta digitando a senha antiga e a nova senha duas vezes nas caixas abaixo.";if(e+="<br /><br />",e+='<div class="container">',e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword0>Old password</label>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword1>New password</label>",e+="<b><span id=dxPassWarn></span></b>",e+="</div>",e+='<div class="form-floating mb-2">',e+='<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apassword2>Confirm new password</label>",e+="</div>",65536&features&&(e+='<div class="form-floating mb-2">',e+='<input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>',e+="<label for=apasswordhint>Password hint</label>",e+="</div>"),e+="</div>",passRequirements){var t=[],o=0;for(var n in passRequirements)"reset"!=n&&"hint"!=n&&(t.push(n+":"+passRequirements[n]),o++);o>0&&(e+="<br /><span style=font-size:x-small>Requisitos:"+t.join(", ")+".</span>")}return setModalContent("xxAddAgent","Alterar senha",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword(),!1}function account_showChangePasswordEx(){if(Q("apassword1").value==Q("apassword2").value){var e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value};65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e)}}function account_showThemesSwitcher(){if(xxdialogMode)return!1;var e=getstore("theme")||"default",t=JSON.parse(getstore("lastThemes")||"[]"),o=new Set(t),n='<div class="form-group"><label for="theme-switcher">Selecione um tema:</label>';return n+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',t.length>0&&(n+='<optgroup label="Temas recentes"">',t.forEach(function(t){n+=`<option value="${t}"${t===e?" selected":""}>${t.charAt(0).toUpperCase()+t.slice(1)}</option>`}),n+="</optgroup>"),n+='<optgroup label="Todos os temas">',[{value:"default",label:"Padrão"},{value:"cerulean",label:"Cerulean"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Darkly"},{value:"flatly",label:"Flatly"},{value:"journal",label:"Journal"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(t){if(!o.has(t.value)){var a=t.value===e?" selected":"";n+=`<option value="${t.value}"${a}>${t.label}</option>`}}),n+="</optgroup>",setModalContent("xxAddAgent","Mudar tema",n+="</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function account_switchThemeEx(){const e=document.getElementById("theme-switcher").value,t="default"!=e?encodeURIComponent(e):encodeURIComponent("..");document.getElementById("theme-stylesheet").href=`styles/themes/${t}/bootstrap-min.css`,putstore("theme",e);var o=JSON.parse(getstore("lastThemes")||"[]");o.includes(e)?(o=o.filter(t=>t!==e)).unshift(e):(o.length>=4&&o.pop(),o.unshift(e)),putstore("lastThemes",JSON.stringify(o))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&64&userinfo.siteadmin)return setModalContent("xxAddAgent","Novo Grupo de Dispositivos","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)return setModalContent("xxAddAgent","Segurança da conta",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;if(262144&features&&0==count2factoraAuths())return setModalContent("xxAddAgent","Segurança da conta",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1;var e=[];if(!(2&features))for(var t in nodes){var o=nodes[t];2==o.mtype&&null!=o.agent&&4294967295==GetNodeRights(o)&&e.push(o)}var n="Crie um novo grupo de dispositivos usando as opções abaixo.<br /><br />",a="";if(n+=addHtmlFormFloating("Nome",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),1&features||(a+="<option value=3>Dispositivos locais, sem agente</option>"),!(2&features)&&e.length>0&&(a+="<option value=103>Nenhum dispositivo de agente retransmitido através do agente</option>"),65536&features2&&(1&features||(a+="<option value=4>IP-KVM / Dispositivo de força</option>"),!(2&features)&&e.length>0&&(a+="<option value=104>IP-KVM/dispositivo de energia retransmitido através do agente</option>")),n+=addHtmlFormFloating("Tipo","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Gerenciar usando um software agente</option><option value=1>Intel&reg; AMT apenas, sem agente</option>"+a+"</select>"),e.length>0){n+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var i=[];for(var t in e)i.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");n+=addHtmlFormFloating("Dispositivo de Retransmissão","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+i.join("")+"</select>"),n+="</div>"}return n+=addHtmlFormFloating("Descrição","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>"),n+="<div id=d2ipkvm style=display:none><hr />",n+=addHtmlFormFloating("Modelo","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Domínio Raritan KX III</option><option value=2>Interruptor de alimentação da Web 7</option></select>"),n+=addHtmlFormFloating("Nome do Host",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),n+=addHtmlFormFloating("Nome do usuário",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'),n+=addHtmlFormFloating("Senha",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />'),setModalContent("xxAddAgent","Novo Grupo de Dispositivos",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus(),!1}function account_validateMeshCreate(e,t){var o=parseInt(Q("dp2meshtype").value);1==t&&null!=e&&"Entrar"==e.key&&Q("dp2meshname").value.length>0&&Q("dp2meshtype").focus(),2==t&&null!=e&&"Entrar"==e.key&&Q("dp2meshdesc").focus();var n=Q("dp2meshname").value.length>0;QV("d2ipkvm",4==o||104==o);try{QV("d2devrelaydiv",o>100)}catch(e){}4==o&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(n=!1),QE("idx_dlgOkButton",n)}function account_createMeshEx(e,t){var o=parseInt(Q("dp2meshtype").value),n={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:o,desc:Q("dp2meshdesc").value};4!=o&&104!=o||(n.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),n.kvmhost=Q("dp2ipkvmhost").value,n.kvmuser=Q("dp2ipkvmuser").value,n.kvmpass=Q("dp2ipkvmpass").value),o>100&&(n.meshtype=o-100,n.relayid=Q("d2devrelay").value),meshserver.send(n)}function account_validateDeleteAccount(){QE("account_dlgOkButton",Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e="",t=Q("apassword0").value.length>0&&Q("apassword1").value.length>0&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;if(65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(t=!1),""!=Q("apassword1").value)if(null==passRequirements||""==passRequirements){var o=checkPasswordStrength(Q("apassword1").value);e=o>=80?"<span style=color:green>Forte<span>":o>=60?"<span style=color:blue>Bom<span>":"<span style=color:red>Fraco<span>"}else{0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(t=!1,e="<span style=color:red>Política<span>")}QH("dxPassWarn",e),QE("idx_dlgOkButton",t)}function checkPasswordStrength(e){var t=0,o={},n=0,a={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var i=0;i<e.length;i++)o[e[i]]=(o[e[i]]||0)+1,t+=5/o[e[i]];for(var s in a)n+=1==a[s]?1:0;return parseInt(t+10*(n-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var o=0,n=0,a=0,i=0,s=0;s<e.length;s++)/\d/.test(e[s])&&o++,/[a-z]/.test(e[s])&&n++,/[A-Z]/.test(e[s])&&a++,/\W/.test(e[s])&&i++;return!(t.numeric&&o<t.numeric)&&(!(t.lower&&n<t.lower)&&(!(t.upper&&a<t.upper)&&!(t.nonalpha&&i<t.nonalpha)))}function updateMeshes(){var e='<div class="row">',t=0,o=0,n=[];for(i in meshes)n.push(meshes[i]);for(i in n.sort(nameSort),n){t>1&&(e+="</tr><tr>",t=0),t++,o++;var a=GetMeshRights(n[i]),s="Direitos parciais";4294967295==a?s="Administrador Completo":0==a&&(s="Sem direitos"),e+='\n                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"\n                            onclick="gotoMesh(\''+n[i]._id+"')\"\n                            onkeypress=\"if (event.key=='Enter') gotoMesh('"+n[i]._id+'\')"\n                            style="cursor:pointer;">\n                        <div class="card mb-3">\n                            <div class="row g-0">\n                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">\n                                    <i class="mi me-1"></i>\n                                </div>\n                                <div class="col-10 mx-auto" tabindex="0">\n                                    <div class="card-body" style=padding:0;>\n                                        <h5 class="card-title e1">'+EscapeHtml(n[i].name)+'</h5>\n                                        <p class="card-text">'+s+'</p>\n                                        <div class="g2"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    '}e+="</div>",meshcount=o,QH("p2meshes",e),QV("p2noMeshFound",0==o)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&loginTokens.length>0){e+='<p><strong>Tokens de login ativo</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Novo</button></span></p>',e+='<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Nome</th><th scope=col style=text-align:left>Nome do usuário</th></tr>';for(var o=0;o<loginTokens.length;o++){var n=loginTokens[o],a="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(n.tokenUser)+'")\' title="Remover token de login" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',i="";0!=n.expire&&(i=EscapeHtml(format("Expira em {0}",printDateTime(new Date(n.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(n.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+i+a+"</div><div>"+EscapeHtml(n.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var o=null,n=0;n<loginTokens.length;n++)loginTokens[n].tokenUser==t&&(o=loginTokens[n]);if(null!=o){var a="Confirma a remoção deste token de login?<br /><br />";a+=addHtmlValue("Nome",EscapeHtml(o.name)),setModalContent("xxAddAgent","Remover o token de login",a+=addHtmlValue("Nome do usuário",EscapeHtml(o.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})})}}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e=miscState.googleDrive;if(e.state<3){var t='<img style=float:right src="images/googledrive-48.png" /><div>Configure este servidor para carregar backups automaticamente para o Google Drive. Comece criando e inserindo um ClientID e ClientSecret do Google Drive para sua conta.</div><br />';t+=addHtmlValue("Credenciais",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Google Drive Console</a>'),t+=addHtmlFormFloating("ID do Cliente",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'),setModalContent("xxAddAgent","Backup do Google Drive",t+=addHtmlFormFloating("Segredo do cliente",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)}else if(3==e.state){t='<img style=float:right src="images/googledrive-48.png" /><div>O backup do Google Drive está ativo no momento.</div>';setModalContent("xxAddAgent","Backup do Google Drive",t+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Remover configuração</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1)}}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",Q("gdclientid").value.length>0&&Q("gdclientsecret").value.length>0)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",Q("gdcode").value.length>0)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){if(xxdialogMode)return!1;var e="Restaure o servidor usando um backup, <span style=color:red>isso irá deletar os dados existentes do servidor.</span> Só faça isso se souber o que está fazendo.<br /><br />";return e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>',e+="<input type=hidden name=auth value="+authCookie+">",e+='<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>',setModalContent("xxAddAgent","Restaurar servidor",e+="</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore(),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","Versão MeshCentral","Carregando..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Desconhecido"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Desconhecido"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Errors","Carregando..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Nenhum</i>"),1&e&&(t='<span role=button tabindex=0 title="Clique aqui para editar o nome do grupo de dispositivos" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",t),QV("MeshSummary",4!=currentMesh.mtype);var o=format("Número desconhecido {0}",currentMesh.mtype);1==currentMesh.mtype&&(o="Intel&reg; AMT apenas, sem agente"),2==currentMesh.mtype&&(o="Gerenciar usando um software agente"),3==currentMesh.mtype&&(o=null==currentMesh.relayid?"Dispositivos locais, sem agente":"Nenhum dispositivo de agente retransmitido através do agente"),4==currentMesh.mtype&&(o=null==currentMesh.relayid?"Dispositivo IP-KVM ":"Dispositivo IP-KVM retransmitido através do agente",1==currentMesh.kvm.model&&(o+=", Raritan KX III"));var n="";if(8&args.hide&&(n+=addHtmlValue("Nome",t)),n+=addHtmlValue("Descrição",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Nenhum</i>","p20editmesh(2)",!!(1&e))),n+=addHtmlValue("Tipo",o),(3==currentMesh.mtype||4==currentMesh.mtype)&&null!=currentMesh.relayid){var a="<i>Desconhecido</i>",i=getNodeFromId(currentMesh.relayid);null!=i&&(a=EscapeHtml(i.name)+" ("+EscapeHtml(i.meshnamel)+")"),n+=addHtmlValue("Dispositivo de Retransmissão",addLinkConditional(a,"p20editmeshrelay()",!!(1&e)))}if(4==currentMesh.mtype&&(n+=addHtmlValue("Nome do Host",currentMesh.kvm.host),n+=addHtmlValue("Nome do usuário",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]){var s=users[currentMesh.creatorid];n+=addHtmlValue("Criador",'<a href=# onclick=gotoUser("'+encodeURIComponentEx(s._id)+'",false,null)>'+EscapeHtml(s.name)+"</a>")}else null!=currentMesh.creatorname&&(n+=addHtmlValue("Criador",EscapeHtml(currentMesh.creatorname)));if(null!=currentMesh.creation&&(n+=addHtmlValue("Tempo de Criação",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype){var r=[];currentMesh.flags&&(1&currentMesh.flags&&r.push("Remoção automática"),2&currentMesh.flags&&r.push(4==currentMesh.mtype?"Sincronizar Nome da Porta":"Sincronização de nome de host"),8&currentMesh.flags&&r.push("prefer --agentname"),16&currentMesh.flags&&r.push("allow override"),1==serverinfo.devGroupSessionRecording&&4&currentMesh.flags&&r.push("Sessões de registro")),"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&r.push("Remover inativo"),""==(r=r.join(", "))&&(r="<i>Nenhum</i>"),n+=addHtmlValue("Recursos",addLinkConditional(r,"p20editmeshfeatures()",1&e))}if(2==currentMesh.mtype){r=[];var l=0;currentMesh.consent&&(l=currentMesh.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?r.push("Prompt da área de trabalho + barra de ferramentas"):64&l?r.push("Barra de ferramentas da área de trabalho"):8&l?r.push("Desktop Prompt"):1&l&&r.push("Notificar área de trabalho"),16&l?r.push("Prompt de Terminal"):2&l&&r.push("Notificação de Terminal"),32&l?r.push("Arquivos Prompt"):4&l&&r.push("Arquivos de notificação"),7==l&&(r=["Notificar sempre"]),56&~l||(r=["Sempre Perguntar"]),""==(r=r.join(", "))&&(r="<i>Nenhum</i>"),n+=addHtmlValue("Consentimento do usuário",addLinkConditional(r,"p20editmeshconsent(1)",1&e))}if(!(3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&1024&userinfo.siteadmin)){var d=0,c=[];if(userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(d|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(d|=userinfo.notify[currentMesh._id]),2&d&&c.push("Conectar"),4&d&&c.push("Desconectar"),8&d&&c.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified){var u=0;16&d&&u++,32&d&&u++,64&d&&u++,u>0&&c.push(format("Email ({0})",u))}if(null!=userinfo.msghandle&&33554432&features2){u=0;128&d&&u++,256&d&&u++,512&d&&u++,u>0&&c.push(format("Messaging ({0})",u))}0==c.length&&c.push("<i>Nenhum</i>"),n+=addHtmlValue("Notificações",addLink(c.join(", "),"p20editMeshNotify()"))}if(16777216&features&&2==currentMesh.mtype){var p="<i>Nenhum</i>",m=!1;null!=currentMesh.invite&&(m=!0,p=currentMesh.invite.codes.join(", ")),n+=addHtmlValue("Códigos de convite",addLinkConditional(p,"p20editmeshInviteCode()",1&e||m))}if(currentMesh.mtype<3&&1&features2){var g="Sem política";currentMesh.amt&&(1==currentMesh.amt.type?g="Desativar":2==currentMesh.amt.type?(g="Modo de controle de cliente simples (CCM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):3==currentMesh.amt.type?(g="Modo de controle de administrador simples (ACM)",2==currentMesh.amt.cirasetup&&(g+=" + CIRA")):4==currentMesh.amt.type&&(g="Totalmente automatizado")),n+=addHtmlValue("Intel&reg; AMT",addLinkConditional(g,"p20editMeshAmt()",1&e))}if(1&e&&(n+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Notas title="Ver notas sobre este grupo de dispositivos" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),n+="<br style=clear:both><br>",2&e&&(n+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Adicionar usuários</button>',null!=usergroups)){var v=0,h=!1;for(var f in usergroups)null==usergroups[f].membershipType&&usergroups[f]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(v++,null!=currentMesh.links&&null!=currentMesh.links[f]||(h=!0));v>0&&h&&(n+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Adicionar Grupo de Usuários</button>')}1==currentMesh.mtype&&(1&e&&(n+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Import Intel&reg; AMT devices." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Import</button>'),null!=currentMesh.amt&&currentMesh.amt.type>0&&(n+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Execute a ativação e configuração do Intel&reg; AMT." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Configurar</button>')),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(n+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Adicione um novo computador a este grupo de dispositivos instalando o agente mesh."><i class="fa-solid fa-circle-plus"></i> Adicionar Agente</button>',n+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Convide alguém para instalar o agente mesh neste grupo de dispositivos."><i class="fa-solid fa-user-plus"></i> Convidar</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(n+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Adicione o dispositivo localizado na rede local."><i class="fa-solid fa-circle-plus"></i> Adicionar Dispositivo</button>'),!(currentMesh.amt&&currentMesh.amt.type>2)||4294967295!=userinfo.siteadmin&&4096&userinfo.siteadmin||(n+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Mude Intel AMT para Modo de controle de administrador (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),n+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Autorizações de usuário</th><th scope=col></th></tr>';var x=1,k=[];for(var f in currentMesh.links){var b=f.split("/")[2];currentMesh.links[f].name&&(b=currentMesh.links[f].name),f==userinfo._id&&(b=userinfo.name),null!=usergroups&&null!=usergroups[f]&&(b=usergroups[f].name),k.push({id:f,name:b,rights:currentMesh.links[f].rights})}for(var f in k.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),k){var y="",w=makeDeviceGroupRightsString(k[f].rights),C="fa-user";k[f].id!=userinfo._id&&(4294967295==e||2&e)&&(4294967295!=e&&4294967295==currentMesh.links[k[f].id].rights||(y="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(k[f].id)+'")\' title="Remova os direitos do usuário para este grupo de dispositivos"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),w='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(k[f].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(k[f].id)+"')\">"+w+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),k[f].id.startsWith("ugrp/")&&(C="fa-users");var M=EscapeHtml(decodeURIComponent(k[f].name));null!=usergroups&&k[f].id.startsWith("ugrp/")&&(M="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(k[f].id)+"\");haltEvent(event);'>"+M+"</a>"),null!=users&&k[f].id.startsWith("user/")&&(M="<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(k[f].id)+"\");haltEvent(event);'>"+M+"</a>"),n+="<tr style="+(x%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Usuário" class="fa-solid fa-fw '+C+'"></i>&nbsp;'+M+"<div></div></div></td><td style=width:70%><div style=float:right>"+y+"</div><div>"+w+"</div></td></tr>",++x}if(n+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&deviceShares.length>0){n+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Compartilhamento de dispositivo ativo</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>',x=1;for(f=0;f<deviceShares.length;f++){var S=deviceShares[f];y="";null!=S.url&&(y+='<a href="'+S.url+'" rel="noreferrer noopener" target=_blank title="Link de compartilhamento de dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),y+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(S.nodeid)+'","'+encodeURIComponentEx(S.publicid)+'","'+encodeURIComponentEx(S.guestName)+'")\' title="Remover compartilhamento de dispositivo" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>';var A="";S.p<=7?A=["","Terminal","Área de Trabalho","Desktop + Terminal","Arquivos","Terminal + Arquivos","Desktop + Arquivos","Desktop + Terminal + Arquivos"][S.p]:8==S.p?A="HTTP/"+S.port:16==S.p&&(A="HTTPS/"+S.port);var Q=A;null!=S.startTime&&null!=S.expireTime&&(Q=format("{0}, {1} a {2}",A,printFlexDateTime(new Date(S.startTime)),printFlexDateTime(new Date(S.expireTime)))),null!=S.startTime&&null!=S.duration&&(Q=S.duration<2?format("{0}, {1} até {2} minuto",A,printFlexDateTime(new Date(S.startTime)),S.duration):format("{0}, {1} até {2} minutos",A,printFlexDateTime(new Date(S.startTime)),S.duration)),1==S.recurring&&(Q+=", Recorrente diariamente"),2==S.recurring&&(Q+=", Recorrente semanalmente"),2&S.p&&!0===S.viewOnly&&(Q+=", Ver apenas área de trabalho"),null!=S.consent&&(0==S.consent?Q+=", Não Autorizado":(56&S.consent&&(Q+=", Solicitar Autorização"),64&S.consent&&(Q+=", Barra de ferramentas")));var D=EscapeHtml(S.guestName);if(S.publicid.startsWith("AS:node/")&&(D="<i>Auto compartilhamento de Agente</i>"),null!=(I=getNodeFromId(S.nodeid))){var T=I.conn>0?"":" gray";n+="<tr "+(++x%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+I._id+'",10);haltEvent(event);\' style=float:left class="j'+I.icon+T+'"></div>&nbsp;<a onclick=\'gotoDevice("'+I._id+"\",10);haltEvent(event);'>"+EscapeHtml(I.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+D+"<div></div></div></td><td style=width:70%><div style=float:right>"+y+"</div><div>"+Q+"</div></td></tr>"}}n+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));x=0,nodes.sort(deviceSort);var E="";1==currentMesh.mtype&&(E+='<a onclick=meshDownloadDeviceList()><img title="Baixar lista de dispositivos" src="images/link4.png" /></a>',1&features||(E+=' <a onclick=meshImportDeviceList()><img title="Importar lista de dispositivos" src="images/link6.png" /></a>'));var N='<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Dispositivos</th><th scope=col class="text-end">'+E+"</th></tr>";for(var f in nodes){var I;T=(I=nodes[f]).conn>0?"":" gray";currentMesh._id==I.meshid&&(N+="<tr><td style=width:30%><div onclick='gotoDevice(\""+I._id+'",10);haltEvent(event);\' style=float:left class="j'+I.icon+T+'"></div>&nbsp;<a onclick=\'gotoDevice("'+I._id+"\",10);haltEvent(event);'>"+EscapeHtml(I.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(I.pwr)+"&nbsp;</div><div>"+(I.osdesc?EscapeHtml(I.osdesc):"")+"</div></td></tr>",++x)}0==x&&(N+='<tr><td colspan="2"><i>Nenhum</i></td></tr>'),N+="</tbody></table>",4294967295==e&&(N+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Excluir Grupo</a></span></div>"),QH("p20info",n),QH("p20info2",N);var _="";if(!(268435456&features)&&xxcurrentView>=20&&xxcurrentView<=29&&null!=currentMesh){for(var f in _="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)_+="&"+f+"="+urlargs[f];try{window.history.replaceState({},document.title,window.location.pathname+_)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e={webappversion:"0.9.0",computers:[]};for(var t in nodes){var o=nodes[t];if(currentMesh._id==o.meshid&&null!=o.intelamt){var n={name:o.name,host:o.host,user:o.intelamt.user,pass:"",tls:1==o.intelamt.tls?1:0,ver:o.intelamt.ver,pstate:o.intelamt.state};2==o.intelamt.state&&(n.pmode=1),o.intelamt.realm&&(n.digestrealm=o.intelamt.realm),o.intelamt.hash&&(n.tlscerthash=o.intelamt.hash),e.computers.push(n)}}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(e,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){if(!xxdialogMode){setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT",'Importe uma lista de dispositivos locais Intel&reg; AMT no formato MeshCommander JSON.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1)}}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT",format("Arquivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var o=0;for(var n in t.computers){var a=t.computers[n];if("string"==typeof a.name&&"string"==typeof a.host&&"string"==typeof a.user&&"string"==typeof a.pass){var i={action:"addamtdevice",meshid:currentMesh._id,devicename:a.name,hostname:a.host,amtusername:a.user,amtpassword:a.pass,amttls:1==a.tls?1:0};"string"==typeof a.ver&&(i.ver=a.ver),"number"==typeof a.pstate&&(i.state=a.pstate),"string"==typeof a.digestrealm&&(i.realm=a.digestrealm),"string"==typeof a.tlscerthash&&(i.hash=a.tlscerthash),meshserver.send(i),o++}}0==o&&setModalContent("xxAddAgent","Importação de conta de usuário","Unable to import any device.")}else setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){if(!xxdialogMode){var e="",t="";1048576&features&&(t="<option value=3>Modo de controle de administrador simples (ACM)</option>"),e+=addHtmlFormFloating("Tipo",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Sem política</option><option value=1>Desativar</option><option value=2>Modo de controle de cliente simples (CCM)</option>'+t+"<option value=4>Totalmente automatizado</option></select>"),setModalContent("xxAddAgent","Política Intel&reg; AMT",e+="<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),1024&features||(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy()}}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t+=addHtmlFormFloating("Senha",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Randomizar senha</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Manter a senha existente</option>":"")+"<option value=2>Selecione uma nova senha</option></select>"),t+="<div id=dp20amtpassdiv style=display:none>",t+=addHtmlFormFloating("Nova Senha*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+=addHtmlFormFloating("Nova Senha*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'),t+="</div>",3==e&&(t+=addHtmlFormFloating("Modo CCM",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Não mude, mantenha CCM se configurado</option><option value=1>Desativar CCM se configurado</option><option value=2>Ative para CCM, se ACM falhar</option></select>')),t+="<div id=dp20amtbadpassdiv style=display:none>",t+=addHtmlFormFloating("Senha desconhecida",'<select id=dp20amtbadpass class="form-select"><option value=0>Fazer nada</option><option value=1>Se estiver no CCM, reative Intel&reg; AMT</option></select>'),t+="</div>",1024&features||(t+=addHtmlFormFloating("CIRA setup",'<select id=dp20amtcira class="form-select" title="Acesso remoto iniciado pelo cliente"><option value=0>Fazer nada</option><option value=1>Não conecte ao servidor</option><option value=2>Conecte-se ao servidor</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 caracteres, 1 maiúsculas, 1 minúscula, 1 numérico, 1 não alfanumérico.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Esta política não afetará os dispositivos com Intel&reg; AMT no modo ACM.</span>'));0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Quando esta política é selecionada, o Intel&reg; AMT não é gerenciado por este servidor. O Intel AMT ainda pode ser usado ativando-o e configurando-o manualmente.</div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Quando esta política é selecionada, qualquer Intel&reg; AMT no modo de controle do cliente (CCM) será desativado. Outros dispositivos terão o CIRA apagado e ainda podem ser gerenciados manualmente.</div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Esta é a política recomendada. A ativação e o gerenciamento da Intel&reg; AMT são totalmente automatizados e o servidor tentará fazer o melhor uso possível do gerenciamento de hardware.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e=!0,t=Q("dp20amtpolicy").value;if((2==t||3==t)&&2==Q("dp20amtpass").value){var o=Q("dp20amtpolicypass").value;e=o===Q("dp20amtpolicypass2").value&&passwordcheck(o)}QE("idx_dlgOkButton",e),2!=t&&3!=t||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==t||3==t)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==t||3==t&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},o=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(o=""),1==Q("dp20amtpass").value&&(o=null),2==Q("dp20amtpass").value&&(o=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:o,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):3==e?(t={type:e,password:o,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=1024&features?1:parseInt(Q("dp20amtcira").value):4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){if(xxdialogMode)return!1;var e=format("Tem certeza que deseja excluir o grupo {0}? Excluir o grupo de dispositivos também excluirá todas as informações sobre os dispositivos desse grupo.",EscapeHtml(currentMesh.name))+"<br /><br />";return setModalContent("xxAddAgent","Excluir Grupo",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />confirme</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog(),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(!(2&features))for(var t in nodes){var o=nodes[t];2==o.mtype&&null!=o.agent&&4294967295==GetNodeRights(o)&&e.push(o)}if(e.sort(nameSort),0==e.length)a="Nenhum dispositivo de relé disponível.",setModalContent("xxAddAgent","Editar Grupo de Dispositivos","Nenhum dispositivo de relé disponível."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var n=[];for(var t in e)n.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+" ("+EscapeHtml(e[t].meshnamel)+")</option>");var a=addHtmlFormFloating("Dispositivo de Retransmissão",'<select id=d2devrelay class="form-select">'+n.join("")+"</select>");setModalContent("xxAddAgent","Editar Grupo de Dispositivos",a),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){if(!xxdialogMode){setModalContent("xxAddAgent","Editar Grupo de Dispositivos",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Nome" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Nome</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Descrição"></textarea><label for=dp20meshdesc>Descrição</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),2==e?Q("dp20meshdesc").focus():Q("dp20meshname").focus()}}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",Q("dp20meshname").value.length>0),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){if(!xxdialogMode){var t="",o=0,n="";1==e&&(o=currentMesh.consent?currentMesh.consent:0,n="Editar consentimento do usuário do grupo de dispositivos"),2==e&&(o=currentUser.consent?currentUser.consent:0,n="Editar consentimento do usuário"),3==e&&(o=currentNode.consent?currentNode.consent:0,n="Editar consentimento do usuário do dispositivo"),4==e&&(o=currentUserGroup.consent?currentUserGroup.consent:0,n="Editar consentimento do usuário do grupo de usuários"),t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Área de Trabalho</b></div>',t+='<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&o?"checked":"")+">Notificar usuário</label></div>",t+='<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&o?"checked":"")+">Solicitar consentimento do usuário</label></div>",t+='<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&o?"checked":"")+">Mostrar barra de ferramentas de conexão</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminal</b></div>',t+='<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&o?"checked":"")+">Notificar usuário</label></div>",t+='<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&o?"checked":"")+">Solicitar consentimento do usuário</label></div>",t+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Arquivos</b></div>',t+='<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&o?"checked":"")+">Notificar usuário</label></div>",setModalContent("xxAddAgent",n,t+='<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&o?"checked":"")+">Solicitar consentimento do usuário</label></div>"),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent)))}}function p20editmeshconsentEx(e,t){var o=0;Q("d20flag1").checked&&(o+=1),Q("d20flag2").checked&&(o+=8),Q("d20flag3").checked&&(o+=2),Q("d20flag4").checked&&(o+=16),Q("d20flag5").checked&&(o+=4),Q("d20flag6").checked&&(o+=32),Q("d20flag7").checked&&(o+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:o}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:o}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:o}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:o})}function p20editmeshfeatures(){if(!xxdialogMode){var e=currentMesh.flags?currentMesh.flags:0,t="",o=0;"number"==typeof currentMesh.expireDevs&&currentMesh.expireDevs>0&&(o=currentMesh.expireDevs)>2e3&&(o=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Sessões gravadas</label><br></div>"),2!=currentMesh.mtype&&4!=currentMesh.mtype||(t+='<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Sincronizar nome do dispositivo do servidor com o nome da porta":"Sincronizar o nome do dispositivo do servidor com o nome do host")+"</label><br></div>",2==currentMesh.mtype&&(t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(8&e?"checked":"")+">Prefer value of --agentName</label><br></div>",t+='<div style="margin-left:12px"><label><input type=checkbox id=d20flag16 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(16&e?"checked":"")+">Allow to override server device name until next connection</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Remover dispositivo ao desconectar</label><br></div>"),t+='<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(o>0?"checked":"")+">Remover automaticamente dispositivos inativos</label><br></div>",t+='<div style=margin-left:20px id=d20expireDeviceDev>Dias inativos até a remoção <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==o?30:o)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Por padrão, os dispositivos inativos serão removidos após 1 dia.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Por padrão, os dispositivos inativos serão removidos após {0} dias.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Editar recursos do grupo de dispositivos",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate()}}function p20editmeshfeaturesValidate(){var e=0,t=!0;if(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),2==currentMesh.mtype){Q("d20flag2").checked&&(e+=2,"d20flag2"==event.currentTarget.id&&(Q("d20flag8").checked=!0,Q("d20flag16").checked=!0));for(const t of[8,16]){const o=Q("d20flag"+t);(o.checked=o.checked&&!(o.disabled=!(2&e)))&&(e+=t)}}QE("d20expireDevice",!(1&e));var o=!(1&e)&&Q("d20expireDevice").checked;if(QV("d20expireDeviceDev",o),o){var n=parseInt(Q("d20expireDeviceDays").value);(isNaN(n)||n<1||n>2e3||n!=Q("d20expireDeviceDays").value)&&(t=!1)}QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0;2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2),Q("d20flag8").checked&&(e+=8),Q("d20flag16").checked&&(e+=16)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4);var t=0;1&e||!Q("d20expireDevice").checked||(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(xxdialogMode)return!1;var o="";if(null==e||5==e)null==t&&(o+=null==e?"Permitir que os usuários gerenciem este grupo de dispositivos e dispositivos neste grupo.":"Permitir que os usuários gerenciem este dispositivo.",524288&features&&(o+=" Os usuários precisam fazer login neste servidor antes de serem adicionados a um grupo de dispositivos."),o+="<br /><br />"),o+="<div style='position:relative'>",o+=addHtmlFormFloating("Identificadores de usuário",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />'),o+="<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",o+="</div><br>";else if(1==e){var n="";if(null==t){var a=getOrderedList(meshes,"name");for(var i in a)null!=currentUser.links&&null!=currentUser.links[a[i]._id]||(n+="<option value="+encodeURIComponentEx(a[i]._id)+">"+EscapeHtml(a[i].name)+"</option>")}else n+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+n+"</select>")}else if(2==e){if(null==usergroups)return;n="";var s=getOrderedList(usergroups,"name");for(var i in s)currentMesh._id.split("/")[1]==s[i]._id.split("/")[1]&&(null!=currentMesh.links&&null!=currentMesh.links[s[i]._id]||(n+="<option value="+encodeURIComponentEx(s[i]._id)+">"+EscapeHtml(s[i].name)+"</option>"));o+=addHtmlFormFloating("Grupo de usuários",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+n+"</select>")}else if(6==e){if(null==usergroups)return;n="";if(null==t){s=getOrderedList(usergroups,"name");for(var i in s)null==s[i].membershipType&&currentNode._id.split("/")[1]==s[i]._id.split("/")[1]&&(null!=currentNode.links&&null!=currentNode.links[s[i]._id]||(n+="<option value="+encodeURIComponentEx(s[i]._id)+">"+EscapeHtml(s[i].name)+"</option>"))}else n+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";o+=addHtmlFormFloating("Grupo de usuários","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+n+"</select>")}else if(3==e){n="";t&&(t=decodeURIComponent(t));a=getOrderedList(meshes,"name");for(var i in a)null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[a[i]._id]||(n+="<option value="+encodeURIComponentEx(a[i]._id)+(t==a[i]._id?" selected":" ")+">"+EscapeHtml(a[i].name)+"</option>");o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+n+"</select>")}else if(4==e||7==e){n="";var r=null,l=null;null!=t&&null!=(l=getNodeFromId(decodeURIComponent(t)))&&(r=l.meshid);a=getOrderedList(meshes,"name");for(var i in a)null!=a[i].links[userinfo._id]&&7&a[i].links[userinfo._id].rights&&(null==r&&(r=a[i]._id),n+="<option value="+encodeURIComponentEx(a[i]._id)+(r==a[i]._id?" selected":" ")+">"+EscapeHtml(a[i].name)+"</option>");o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+n+"</select>"),n="";var d=getOrderedList(nodes,"name");for(var i in d)d[i].meshid==r&&(n+="<option value="+encodeURIComponentEx(d[i]._id)+(l==d[i]?" selected":" ")+">"+EscapeHtml(d[i].name)+"</option>");o+=addHtmlFormFloating("Dispositivo","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+n+"</select>")}else{var c=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(c=users[e].name),usergroups&&usergroups[e]&&(c=usergroups[e].name),userinfo._id==e&&(c=userinfo.name),e.startsWith("ugrp/")?o+=format("Permissões de grupo para {0}.",c)+"<br /><br />":o+=format("Permissões de grupo para o usuário {0}.",c)+"<br /><br />"}var u=-1,p=4!=e&&5!=e&&6!=e&&7!=e;if(o+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',p&&(o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Administrador Completo</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Editar Grupo de Dispositivos</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Gerenciar usuários do grupo de dispositivos</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Gerenciar computadores do grupo de dispositivos</label><br>'),o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Remote Control & Relay</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Somente Visualização Remota</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Apenas entrada limitada</label><br>',!1!==serverinfo.guestdevicesharing&&(o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Convidado</label><br>'),o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Sem acesso à área de trabalho</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Sem acesso ao terminal</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Sem acesso ao arquivo</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Sem Intel&reg; AMT</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Mesh Agent Console</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Arquivos do servidor</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Acordar (Wake) Dispositivos</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Editar notas do dispositivo</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Mostrar apenas os próprios eventos</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Converse e notifique</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Desinstalar Agente / Excluir Dispositivo</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Comandos Remotos</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Reiniciar / Desligar</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Detalhes do dispositivo</label><br>',o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Use as Relay</label><br>',o+="</div>",null==e)xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Adicionar usuários ao grupo de dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus();else if(1===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Adicionar permissões de grupo de dispositivos":"Editar permissões do grupo de dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(u=meshes[decodeURIComponent(t)].links[currentUser._id].rights),4294967295==u&&(Q("p20fulladmin").checked=!0,u=-1);else if(2===e)xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Adicionar Grupo de Usuários",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh));else if(3===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Adicionar Grupo de Dispositivos":"Editar Grupo de Dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),null!=t&&(u=currentUserGroup.links[decodeURIComponent(t)].rights),4294967295==u&&(Q("p20fulladmin").checked=!0,u=-1);else if(4===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Adicionar permissões de dispositivo":"Editar permissões do dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t);else if(7===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Adicionar permissões de dispositivo":"Editar permissões do dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(u=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1));else if(5===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Editar permissões do dispositivo do usuário":"Adicionar permissões de dispositivo de usuário",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],u=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus();else if(6===e)xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Editar permissões de dispositivo do grupo de usuários":"Adicionar permissões de dispositivo de grupo de usuários",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(u=currentNode.links[decodeURIComponent(t)].rights);else{e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Editar permissões do grupo de dispositivos",o)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Editar permissões do grupo de dispositivos do usuário",o)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)});GetMeshRights(currentMesh);4294967295==(u=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,u=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))}return-1!=u&&(p&&(1&u&&(Q("p20editmesh").checked=!0),2&u&&(Q("p20manageusers").checked=!0),4&u&&(Q("p20managecomputers").checked=!0)),8&u&&(Q("p20remotecontrol").checked=!0,65536&u&&(Q("p20nodesktop").checked=!0),256&u&&(Q("p20remoteview").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&u&&(Q("p20noterminal").checked=!0),1024&u&&(Q("p20nofiles").checked=!0),2048&u&&(Q("p20noamt").checked=!0),4096&u&&(Q("p20remotelimitedinput").checked=!0)),16&u&&(Q("p20meshagentconsole").checked=!0),32&u&&(Q("p20meshserverfiles").checked=!0),64&u&&(Q("p20wakedevices").checked=!0),128&u&&(Q("p20editnotes").checked=!0),8192&u&&(Q("p20limitevents").checked=!0),16384&u&&(Q("p20chatnotify").checked=!0),32768&u&&(Q("p20uninstall").checked=!0),131072&u&&(Q("p20commands").checked=!0),262144&u&&(Q("p20resetoff").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&u&&(Q("p20details").checked=!0),2097152&u&&(Q("p20relay").checked=!0)),p20validateAddMeshUserDialog(e),!1}function p20changeMeshAddMeshUserDialog(e){var t="",o=decodeURIComponent(Q("dp2meshid").value);for(var n in nodes)nodes[n].meshid==o&&(t+="<option value="+encodeURIComponentEx(nodes[n]._id)+">"+EscapeHtml(nodes[n].name)+"</option>");QH("dp2nodeid",t),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t=Q("dp20username").value.split(",");for(var o in t)t[o]=t[o].trim();return t[t.length-1]=e,Q("dp20username").value=t.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,o=!0;if(4===e){var n=0,a=decodeURIComponent(Q("dp2nodeid").value);""!=a&&null!=currentUser.links&&null!=currentUser.links[a]&&(n=currentUser.links[a].rights),Q("p20remotecontrol").checked=!!(8&n),Q("p20meshagentconsole").checked=!!(16&n),Q("p20meshserverfiles").checked=!!(32&n),Q("p20wakedevices").checked=!!(64&n),Q("p20editnotes").checked=!!(128&n),Q("p20remoteview").checked=!!(256&n),Q("p20noterminal").checked=!!(512&n),Q("p20nofiles").checked=!!(1024&n),Q("p20noamt").checked=!!(2048&n),Q("p20remotelimitedinput").checked=!!(4096&n),Q("p20limitevents").checked=!!(8192&n),Q("p20chatnotify").checked=!!(16384&n),Q("p20uninstall").checked=!!(32768&n),Q("p20nodesktop").checked=!!(65536&n),Q("p20commands").checked=!!(131072&n),Q("p20resetoff").checked=!!(262144&n),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!!(524288&n)),Q("p20details").checked=!!(1048576&n),Q("p20relay").checked=!!(2097152&n),o=""!=a}if(Q("dp20username")){var i=Q("dp20username").value.split(",");for(var s in i){var r=i[s]=i[s].trim();(0==r.length||r.indexOf('"')>=0)&&(o=!1)}var l=!1,d=!1;if(null!=users){var c=i[i.length-1].trim(),u=c.toLowerCase(),p=[];if(c.length>0){for(var s in users){var m=users[s]._id.split("/");if((null==currentMesh||currentMesh.domain==m[1])&&(null==currentNode||currentNode.domain==m[1])){if(m[2]===u){d=!0;break}if(users[s].name.toLowerCase().indexOf(u)>=0&&(p.push([users[s]._id,users[s].name]),p.length>=8))break}}if(0==d&&p.length>0){var g="";for(var s in p){var v=p[s][0],h=p[s][1];v.split("/")[2]==h.toLowerCase()?g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'>"+EscapeHtml(h)+"</div>":g+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(v.split("/")[2])+"\")'><div>"+EscapeHtml(h)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(v.split("/")[2])+"</div></div>"}QH("dp20usersuggest",g),l=!0}}}QV("dp20usersuggest",l)}QE("idx_dlgOkButton",o),null!=Q("p20fulladmin")?(t=!Q("p20fulladmin").checked,QE("p20editmesh",t),QE("p20manageusers",t),QE("p20managecomputers",t)):t=""!=a,QE("p20remotecontrol",t),QE("p20meshagentconsole",t),QE("p20meshserverfiles",t),QE("p20wakedevices",t),QE("p20editnotes",t),QE("p20limitevents",t),QE("p20remoteview",t&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",t&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",t&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",t&&Q("p20remotecontrol").checked),QE("p20noterminal",t&&Q("p20remotecontrol").checked),QE("p20nofiles",t&&Q("p20remotecontrol").checked),QE("p20noamt",t&&Q("p20remotecontrol").checked),QE("p20chatnotify",t),QE("p20uninstall",t),QE("p20commands",t),QE("p20resetoff",t),QE("p20details",t),QE("p20relay",t)}function p20showAddMeshUserDialogEx(e,t){var o=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?o=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(o+=1),1==Q("p20manageusers").checked&&(o+=2),1==Q("p20managecomputers").checked&&(o+=4)),1==Q("p20remotecontrol").checked&&(o+=8),1==Q("p20meshagentconsole").checked&&(o+=16),1==Q("p20meshserverfiles").checked&&(o+=32),1==Q("p20wakedevices").checked&&(o+=64),1==Q("p20editnotes").checked&&(o+=128),1==Q("p20remoteview").checked&&(o+=256),1==Q("p20nodesktop").checked&&(o+=65536),1==Q("p20noterminal").checked&&(o+=512),1==Q("p20nofiles").checked&&(o+=1024),1==Q("p20noamt").checked&&(o+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(o+=4096),1==Q("p20limitevents").checked&&(o+=8192),1==Q("p20chatnotify").checked&&(o+=16384),1==Q("p20uninstall").checked&&(o+=32768),1==Q("p20commands").checked&&(o+=131072),1==Q("p20resetoff").checked&&(o+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(o+=524288),1==Q("p20details").checked&&(o+=1048576),1==Q("p20relay").checked&&(o+=2097152)),8&o||(256&o&&(o-=256),512&o&&(o-=512),1024&o&&(o-=1024),2048&o&&(o-=2048),4096&o&&(o-=4096),65536&o&&(o-=65536)),1===t){var n=decodeURIComponent(Q("dp2groupid").value);null!=(i=meshes[n])&&meshserver.send({action:"addmeshuser",meshid:n,meshname:i.name,userids:[currentUser._id],meshadmin:o,remove:2==e})}else if(2===t){var a=decodeURIComponent(Q("dp2groupid").value);null!=(i=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:a,meshadmin:o,remove:2==e})}else if(3===t){var i;n=decodeURIComponent(Q("dp2groupid").value);null!=(i=meshes[n])&&meshserver.send({action:"addmeshuser",meshid:n,meshname:i.name,userids:[currentUserGroup._id],meshadmin:o,remove:2==e})}else if(4===t){null!=(c=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:c.name,userids:[currentUser._id],rights:o,remove:2==e})}else if(5===t){var s=Q("dp20username").value.split(","),r=[];for(var l in s)r.push(s[l].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:r,rights:o,remove:2==e})}else if(6===t){a=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[a],rights:o,remove:2==e})}else if(7===t){var d,c;null!=(c=getNodeFromId(d=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:d,nodename:c.name,userids:[currentUserGroup._id],rights:o,remove:2==e})}else if(null==t){s=Q("dp20username").value.split(","),r=[];for(var l in s)r.push(s[l].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:r,meshadmin:o,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:o,remove:2==e})}function p20viewuser(e){if(!xxdialogMode){var t=decodeURIComponent(e),o=GetMeshRights(currentMesh),n=GetMeshRights(currentMesh,t);if(userinfo._id!=t&&(4294967295==o||2&o&&4294967295!=n))p20showAddMeshUserDialog(e);else{var a=[];4294967295==n?a.push("Administrador Completo (todos os direitos)"):(1&n&&a.push("Editar Grupo de Dispositivos"),2&n&&a.push("Gerenciar usuários do grupo de dispositivos"),4&n&&a.push("Gerenciar computadores do grupo de dispositivos"),8&n&&a.push("Controle remoto"),16&n&&a.push("Console do Agente"),32&n&&a.push("Arquivos do servidor"),64&n&&a.push("Acordar (Wake) Dispositivos"),128&n&&a.push("Editar notas"),8&n&&256&n&&a.push("Somente Visualização Remota"),8&n&&65536&n&&a.push("Sem área de trabalho"),8&n&&512&n&&a.push("Sem Terminal"),8&n&&1024&n&&a.push("Sem arquivos"),8&n&&2048&n&&a.push("Sem Intel&reg; AMT"),8&n&&4096&n&&!(256&n)&&a.push("Entrada Limitada"),8192&n&&a.push("Somente eventos próprios"),16384&n&&a.push("Converse e notifique"),32768&n&&a.push("Desinstalar"),131072&n&&a.push("Comandos"),262144&n&&a.push("Reiniciar / Desligar"),524288&n&&a.push("Compartilhamento"),1048576&n&&a.push("Detalhes"),2097152&n&&a.push("Retransmissão")),0==a.length&&a.push("Sem direitos");var i=t.split("/")[2];users&&users[t]&&(i=users[t].name),userinfo._id==t&&(i=userinfo.name);var s=1,r=addHtmlValue("Nome do usuário",EscapeHtml(decodeURIComponent(i)));t.split("/")[2]!=i&&(r+=addHtmlValue("Identificador de Usuário",EscapeHtml(t.split("/")[2]))),r+=addHtmlValue("Permissões",a.join(",")),userinfo._id!=t&&(4294967295==o||2&o&&4294967295!=n)&&(s+=4),setModalContent("xxAddAgent","Usuário do grupo de dispositivos",r),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(s,t))}}}function p20viewuserEx(e,t){if(2==e){var o=t.split("/")[2];users&&users[t]&&(o=users[t].name),usergroups&&usergroups[t]&&(o=usergroups[t].name),userinfo._id==t&&(o=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Remover permissões de usuário",format('Confirma a remoção dos direitos do usuário "{0}"?',EscapeHtml(decodeURIComponent(o)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Remover permissões de grupo de usuários",format('Confirma a remoção dos direitos para o grupo de usuários "{0}"?',EscapeHtml(decodeURIComponent(o))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t))}}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),o=serverinfo.name;((-1==o.indexOf(".")||2&features)&&(o=window.location.hostname),1==serverinfo.https)?e="https://"+o+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):e="http://"+o+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:"");if(1&t){var n="Quando ativados, os códigos de convite podem ser usados ​​por qualquer pessoa para juntar dispositivos a este grupo de dispositivos usando o seguinte link público:<br /><br />";n+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",n+='<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Habilitar Códigos de Convite</label></div>',n+=addHtmlFormFloating("Códigos de convite",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'),n+=addHtmlFormFloating("Agentes",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Todos agentes disponíveis</option><option value=1>MeshAgent Windows</option><option value=2>MeshAgent Linux</option><option value=4>MeshAgent MacOS</option><option value=8>MeshCentral Assistant</option></select>'),n+="<div id=d2agentInstallTypeDiv>",n+=addHtmlFormFloating("Tipo de Instalação",'<select id=agentInviteType class="form-select"><option value=0>Plano de fundo e interativo</option><option value=2>Plano de fundo apenas</option><option value=1>Apenas interativo</option></select>'),setModalContent("xxAddAgent","Códigos de convite",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()}else{n="Os códigos de convite podem ser usados ​​por qualquer pessoa para juntar dispositivos a este grupo de dispositivos usando o seguinte link público:<br /><br />";n+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+e+'">'+e+"</a></div><br />",n+=addHtmlValue("Códigos de convite",currentMesh.invite.codes.join(", ")),setModalContent("xxAddAgent","Códigos de convite",n+=addHtmlValue("Tipo de Instalação",["Plano de fundo e interativo","Apenas interativo","Plano de fundo apenas"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p20editmeshInviteCodeValidate(){var e=!0,t=Q("agentInviteCode").value.split(",");for(var o in t)t[o]=t[o].trim(),""==t[o]&&(e=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||e),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e=Q("agentInviteCode").value.split(",");for(var t in e)e[t]=e[t].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:e,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){if(xxdialogMode)return!1;var e=0,t=16384&features2&&userinfo.emailVerified;userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]);var o='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificação de Página Web</div>';return o+='<div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexões de dispositivos</label></div>',o+='<div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexões de dispositivos</label></div>',currentMesh.mtype<3&&(o+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Desktop Intel&reg; AMT e eventos seriais</label></div>'),t&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificação por e-mail</div>',o+='<div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexões de dispositivos</label></div>',o+='<div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexões de dispositivos</label></div>',o+='<div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&33554432&features2&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div>',o+='<div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Conexões de dispositivos</label></div>',o+='<div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexões de dispositivos</label></div>',o+='<div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),setModalContent("xxAddAgent","Configurações de notificação",o),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&33554432&features2&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e),!1}function p20editMeshNotifyEx(e,t){var o=0;o+=Q("p20notifyIntelDeviceConnect").checked?2:0,o+=Q("p20notifyIntelDeviceDisconnect").checked?4:0,currentMesh.mtype<3&&(o+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(o+=Q("p20enotifyIntelDeviceConnect").checked?16:0,o+=Q("p20enotifyIntelDeviceDisconnect").checked?32:0,o+=Q("p20enotifyIntelDeviceHelp").checked?64:0),null!=userinfo.msghandle&&33554432&features2&&(o+=Q("p20emsgDeviceConnect").checked?128:0,o+=Q("p20emsgDeviceDisconnect").checked?256:0,o+=Q("p20emsgDeviceHelp").checked?512:0),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:o})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Não conectado","Agente","Intel&reg; AMT","Agente + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Antivírus não ativo","Sem atualização automática","Firewall não ativo","Múltiplos Problemas"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e=GetMeshRights(currentMesh),t=EscapeHtml(currentMesh.name);0==t.length&&(t="<i>Nenhum</i>"),1&e&&(t='<span tabindex=0 title="Clique aqui para editar o nome do grupo de dispositivos" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+t+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",t);var o={},n={},a=[0,0,0,0],i=[0,0,0,0,0],s=!1,r=!1,l=!1,d=!1;for(var c in nodes)if(nodes[c].meshid==currentMesh._id&&(nodes[c].agent&&(s=!0,null==o[nodes[c].agent.id]?o[nodes[c].agent.id]=1:o[nodes[c].agent.id]++),nodes[c].pwr&&(r=!0,null==n[nodes[c].pwr]?n[nodes[c].pwr]=1:n[nodes[c].pwr]++),0==nodes[c].conn?(l=!0,a[0]++):6&nodes[c].conn?(l=!0,1&nodes[c].conn?a[3]++:a[2]++):1&nodes[c].conn&&(l=!0,a[1]++),nodes[c].wsc)){d=!0;var u=0;"OK"==nodes[c].wsc.antiVirus&&u++,"OK"==nodes[c].wsc.autoUpdate&&u++,"OK"==nodes[c].wsc.firewall&&u++,3==u?i[0]++:u<2?i[4]++:"OK"!=nodes[c].wsc.antiVirus?i[1]++:"OK"!=nodes[c].wsc.autoUpdate?i[2]++:"OK"!=nodes[c].wsc.firewall&&i[3]++}var p=[],m=[],g=[],v=[],h=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(var c in o)p.push(o[c]),m.push(h[c]);for(var c in n)g.push(n[c]),v.push(powerStatetable[c]);window.meshPowerChart.config.data.datasets[0].data=g,window.meshPowerChart.config.data.labels=v,window.meshPowerChart.update(),currentMesh.mtype>=2&&(window.meshOsChart.config.data.datasets[0].data=p,window.meshOsChart.config.data.labels=m,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=a,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=i,window.meshSecurityChart.update();var f="",x=0;if(g.length>0){var k=[];for(var c in n)k.push([powerStatetable[c],n[c]]);for(var c in k.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Estados de energia</th></tr>',k)f+="<tr style="+(++x%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+k[c][1]+" <td> "+k[c][0]+"</tr>";f+="</tbody></table>"}if(p.length>0&&currentMesh.mtype>=2){x=0;var b=[];for(var c in o)b.push([h[c],o[c]]);for(var c in b.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Tipos de agente</th></tr>',b)f+="<tr style="+(++x%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[c][1]+"<td> "+b[c][0]+"</tr>";f+="</tbody></table>"}if(l){x=0;var y=[];for(c=0;c<4;c++)y.push([["Não conectado","Agente","Intel&reg; AMT","Agente + Intel&reg; AMT"][c],a[c]]);y.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Conectividade</th></tr>';for(c=0;c<4;c++)y[c][1]>0&&(f+="<tr style="+(++x%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+y[c][1]+"<td> "+y[c][0]+"</tr>");f+="</tbody></table>"}if(d){x=0;var w=[];for(c=0;c<4;c++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Antivírus não ativo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Sem atualização automática','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Firewall não ativo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Múltiplos Problemas'][c],i[c]]);w.sort(function(e,t){return-(e[1]-t[1])}),f+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Segurança</th></tr>';for(c=0;c<4;c++)w[c][1]>0&&(f+="<tr style="+(++x%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[c][1]+"<td> "+w[c][0]+"</tr>");f+="</tbody></table>"}""==f&&(f="<i>Nenhum dispositivo neste grupo de dispositivos.</i>"),QH("p21info",f);var C=(r?1:0)+(currentMesh.mtype>=2&&s?1:0)+(l?1:0)+(d?1:0);QS("meshPowerChartDiv").display=r?"inline-block":"none",QS("meshOsChartDiv").display=currentMesh.mtype>=2&&s?"inline-block":"none",QS("meshConnChartDiv").display=l?"inline-block":"none",QS("meshSecurityChartDiv").display=d?"inline-block":"none",QS("meshPowerChartDiv").width=C>3?"23%":"31%",QS("meshOsChartDiv").width=C>3?"23%":"31%",QS("meshConnChartDiv").width=C>3?"23%":"31%",QS("meshSecurityChartDiv").width=C>3?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",!(8&features)),!(8&features)){for(var e,t="",o="",n='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Raiz</a>',a="Root",i=filetree,s=1,r=[],l=filetreelinkpath,d=[],c=document.getElementsByName("fc"),u=0;u<c.length;u++)c[u].checked&&d.push(c[u].value);for(var u in filetreelinkpath="",filetreelocation){if(null==i.f||null==i.f[filetreelocation[u]])break;if(r.push(filetreelocation[u]),a+=" / "+filetreelocation[u],1==s){var p=filetreelocation[u].split("/");e=window.location.origin+domainUrl+p[0]+"files/"+p[2],filetreelinkpath+=filetreelocation[u]}else""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[u],s>2&&(e+="/"+filetreelocation[u]));i=i.f[filetreelocation[u]],n+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+s+')">'+EscapeHtml(null!=i.n?i.n:filetreelocation[u])+"</a>",s++}filetreelocation=r;var m=a.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(i.f);for(var u in g){var v,h=g[u],f=h.n;v=f.length>70?'<span title="'+EscapeHtml(f)+'">'+EscapeHtml(f.substring(0,70))+"...</span>":EscapeHtml(f);var x="";if(null!=h.d)x=printDateTime(new Date(h.d))+"&nbsp;";var k="";null!=h.s&&(k=getFileSizeStr(h.s));var b="";if(h.t<3||4==h.t){var y=1==h.t||4==h.t?p5getQuotabar(h):"";b='<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(f)+'">&nbsp;<span style=float:right title="">'+y+"</span><span><div class=fileIcon"+h.t+' onclick=p5folderset("'+encodeURIComponentEx(h.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(h.nx)+"\")'>"+v+"</a></span></div>"}else{var w=v,C="",M=urlargs.key?"&key="+urlargs.key:"";m&&(C='<i class="fa-regular fa-copy" style=cursor:pointer title="Exibir link público" onclick=\'return p5showPublicLink("'+e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+M+'")\'></i> <i class="fa-regular fa-copy" title="Copiar link para a área de transferência" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e+"/"+encodeURIComponentEx(h.nx)+"?download=1"+M)+'")></i>'),h.s>0&&(w=C+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+h.nx)+'")>'+v+"</a>"),b='<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+h.nx+'">&nbsp;<span class=fsize>'+x+"</span><span style=float:right>"+k+"</span><span><div class=fileIcon"+h.t+"></div>"+w+"</span></div>"}h.t<3?t+=b:o+=b}if(QH("p5rightOfButtons",p5getQuotabar(i)),QH("p5files",t+o),QH("p5currentpath",n),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),l==filetreelinkpath){c=document.getElementsByName("fc");for(u=0;u<c.length;u++)c[u].checked=d.indexOf(c[u].value)>=0}p5setActions()}}function getNiceSize(e){return e<=0?"Limite de armazenamento excedido":e<2048?format("{0} bytes restantes",e):e<2097152?format("{0} kilobytes restantes",Math.round(e/1024)):e<2147483648?format("{0} megabytes restantes",Math.round(e/1024/1024)):format("{0} gigabytes restantes",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Nenhum":e<2048?format("{0} b",e):e<2097152?format("{0} kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Nenhum":e<2048?format("{0} b",e):e<2097152?format("{0} kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;e.t>1&&4!=e.t;)e=e.parent;if(1!=e.t&&4!=e.t||null==e.maxbytes)return"";var t=Math.floor(e.s/1024),o=e.maxbytes-e.s;return'<span title="'+(e.c>1?format("{0} k em {1} arquivos. {2} k no máximo",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0} k em 1 arquivo. {1} k no máximo",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(o)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>"}function p5showPublicLink(e){return setModalContent("xxAddAgent","Link Público",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Copiar link para a área de transferência" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?1*sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?1*sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t=[],o=Q("p5sortdropdown").value;for(var n in e)e[n].nx=n,null==e[n].n&&(e[n].n=n),e[n].ln=e[n].n.toLowerCase(),t.push(e[n]);return sortorder=1,o>3&&(sortorder=-1,o-=3),1==o?t.sort(p5sort_filename):2==o?t.sort(p5sort_bysize):3==o&&t.sort(p5sort_timestamp),t}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),o=getFileSelCount(!1);QE("p5DeleteFileButton",e>0&&filetreelocation.length>0),QE("p5ViewFileButton",1==e&&1==o&&filetreelocation.length>0),QE("p5NewFolderButton",filetreelocation.length>0),QE("p5UploadButton",filetreelocation.length>0),QE("p5DownloadButton",e>0&&e==o&&filetreelocation.length>0),QE("p5RenameFileButton",1==e&&filetreelocation.length>0),QE("p5SelectAllButton",t>0),Q("p5SelectAllButton").value=e>0?"Selecione nenhum":"Selecionar tudo",QE("p5CutButton",o>0&&e==o),QE("p5CopyButton",o>0&&e==o),QE("p5PasteButton",null!=p5clipboard&&p5clipboard.length>0&&filetreelocation.length>0)}function getFileSelCount(e){for(var t=0,o=document.getElementsByName("fc"),n=0;n<o.length;n++)!o[n].checked||0==e&&"3"!=o[n].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&"999"==t[o].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t=0,o=0;for(var n in e.f)setupBackPointers(e.f[n]),e.f[n].parent=e,e.f[n].s&&(t+=e.f[n].s),e.f[n].c&&(o+=e.f[n].c),3==e.f[n].t&&o++;e.s=t,e.c=o}return e}function getFileSizeStr(e){return"number"!=typeof e&&(e=0),1==e?"1 byte":format("{0} bytes",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Nova pasta",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=getFileSelDirCount()>0?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Exclusão recursiva</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Excluir",e>1?format("Excluir {0} itens selecionados?",e)+t:"Excluir o item selecionado?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&(e=t[o].value);setModalContent("xxAddAgent","Renomear",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=function(){var e=/^[^\\/:\*\?"<>\|]+$/,t=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(n){return e.test(n)&&!t.test(n)&&!o.test(n)&&"."!=n[0]}}();function p5uploadFile(){setModalContent("xxAddAgent","Carregar Arquivo",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />Confirmar substituição?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t=filetree;for(var o in filetreelocation)null!=t.f&&null!=t.f[filetreelocation[o]]&&(t=t.f[filetreelocation[o]]);return t.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(var o in e)null!=e[o].size&&0!=e[o].size&&t.push(e[o]);var n=filetree,a=[],i=0;for(var o in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[o]]&&(n=n.f[filetreelocation[o]]);if(QE("idx_dlgOkButton",e.length>0),e.length>0){if(null!=n.f){for(var o in n.f)a.push(o);for(o=0;o<e.length;o++)a.indexOf(e[o].name)>=0&&i++}QV("p5confirmOverwriteSpan",i>0),i>0?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)if(e[t].checked){var o=p5GetFileInfo(e[t].value);if(null==o)return;return void(o.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:e[t].value,tag:"edit"}):messagebox("Editor de Arquivo","Somente arquivos com menos de 200k podem ser editados."))}}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var o=0;o<t.length;o++)t[o].checked&&"3"==t[o].attributes.file.value&&p5clipboard.push(t[o].value);p5updateClipview()}function p5pasteFile(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("Confirma {0} de {1} entrada {2} neste local?",0==p5clipboardCut?"copy":"move",p5clipboard.length,p5clipboard.length>1?"s":"")),setModalContent("xxAddAgent","Colar",e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&p5clipboard.length>0&&(e=format("Segurando {0} entrie {1} para {2}",p5clipboard.length,p5clipboard.length>1?"s":"",0==p5clipboardCut?"Copiar":"Mover")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Apagar</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(var o in e.dataTransfer.files)null!=e.dataTransfer.files[o].size&&0!=e.dataTransfer.files[o].size&&t.push(e.dataTransfer.files[o]);if(0!=t.length){var n=filetree,a=[],i=0;for(var o in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[o]]&&(n=n.f[filetreelocation[o]]);if(null!=n.f){for(var o in n.f)a.push(o);for(o=0;o<e.dataTransfer.files.length;o++)a.indexOf(e.dataTransfer.files[o].name)>=0&&i++}0==i?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Carregar Arquivo",format(1==i?"O upload substituirá 1 arquivo. Continuar?":"O upload substituirá {0} arquivos. Continuar?",i)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var o=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){o=1}if(0==o&&p5uploadFileEx(),setDialogMode(0),1==o){if(0==filetreelocation.length)return;for(var n=[],a=[],i=[],s=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(l>13e5)return void p5uploadFile();for(d=0;d<t.length;d++){var c=new FileReader,u=t[d];n.push(u.name),a.push(u.size),i.push(u.type),c.onload=function(e){s.push(e.target.result),0==--r&&(Q("p5fileDragName").value=n.join("*"),Q("p5fileDragSize").value=a.join("*"),Q("p5fileDragType").value=i.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},c.readAsDataURL(u)}}}var p5dragtimer=null;function p5fileDragOver(e){if(!xxdialogMode){haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null);var t=!0;0==filetreelocation.length&&(t=!1),QV("bigok",t),QV("bigfail",!t)}}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++){if(e[t].checked)downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}}var eventsMessageId={1:"Login da conta",2:"Logout da conta",3:"Idioma alterado de {1} para {2}",4:"Ingressou na sessão multiplex de desktop",5:"Sair da sessão multiplex da área de trabalho",6:"Sessão multiplex de desktop iniciada",7:"Sessão de gravação concluída, {0} segundo (s)",8:"Sessão multiplex de área de trabalho fechada, {0} segundo (s)",9:'Sessão de retransmissão encerrada "{0}" de {1} a {2}, {3} segundo (s)',10:'Sessão de terminal encerrada "{0}" de {1} a {2}, {3} segundo (s)',11:'Sessão de desktop encerrada "{0}" de {1} a {2}, {3} segundo (s)',12:'Sessão de gerenciamento de arquivo encerrada "{0}" de {1} a {2}, {3} segundo (s)',13:'Sessão de retransmissão iniciada "{0}" de {1} para {2}',14:'Sessão de terminal iniciada "{0}" de {1} a {2}',15:'Sessão de desktop iniciada "{0}" de {1} a {2}',16:'Sessão de gerenciamento de arquivo iniciada "{0}" de {1} a {2}',17:'Processando o comando do console: "{0}"',18:'Exibindo caixa de mensagem, título = "{0}", mensagem = "{1}"',19:"Matando processo {0}",20:"Abrindo: {0}",21:"Obtendo conteúdo da área de transferência, {0} byte (s)",22:"Configurando o conteúdo da área de transferência, {0} byte (s)",23:"Tentativa de ativação do modo Intel (R) AMT ACM",24:"Comandos em execução",25:"Executando ação de energia = {0}, forçado = {1}",26:'Exibindo mensagem do sistema, title = "{0}", mensagem = "{1}"',27:"Usuário local aceitou solicitação de terminal remoto",28:"Usuário local rejeitou solicitação de terminal remoto",29:"Conexão de área de trabalho remota fechada à força pelo usuário local",30:"Iniciando a área de trabalho remota após a aceitação do usuário local",31:"Barra de conexão de área de trabalho remota ativada / atualizada",32:"Falha na barra de conexão da área de trabalho remota ou não suportada",33:"Conexão de área de trabalho remota fechada à força pelo usuário local",34:"Falha ao iniciar a área de trabalho remota após rejeição do usuário local",35:"Área de trabalho remota iniciada com notificação do sistema",36:"Área de trabalho remota iniciada sem notificação",37:"Barra de conexão de área de trabalho remota ativada / atualizada",38:"Falha na barra de conexão da área de trabalho remota ou não suportada",39:"Conexão de área de trabalho remota fechada à força pelo usuário local",40:"Iniciando arquivos remotos após a aceitação do usuário local",41:"Falha ao iniciar arquivos remotos após rejeição do usuário local",42:"Arquivos remotos iniciados com notificação do sistema",43:"Arquivos remotos iniciados sem notificação",44:'Criar pasta: "{0}"',45:'Excluir: "{0}"',46:'Excluir recursivo: "{0}", {1} elemento (s) removido (s)',47:'Excluir: "{0}", {1} elemento (s) removido (s)',48:'Renomear: "{0}" para "{1}"',49:'Baixar: "{0}"',50:'Upload: "{0}"',51:'Copiar: "{0}" para "{1}"',52:'Mover: "{0}" para "{1}"',53:"Bloqueando o usuário remoto fora da área de trabalho",54:"Agente encerrou sessão com {0}% de compressão de agente para servidor. Enviado: {1}, compactado: {2}",55:"Grupo de dispositivos criado: {0}",56:"Grupo de dispositivos não excluído: {0}",57:"Dispositivo {0} adicionado ao grupo de dispositivos {1}",58:"O dispositivo solicitou a ativação do Intel (R) AMT ACM, FQDN: {0}",59:"Dispositivo alterado {0} do grupo {1}: {2}",60:"Direitos de dispositivo de usuário removidos para {0}",61:"Direitos de dispositivo do usuário alterados para {0}",62:"Usuário {0} removido do grupo de usuários {1}",63:"Conta removida",64:"Conta criada, o nome de usuário é {0}",65:"Conta criada, o e-mail é {0}",66:"Conta alterada: {0}",67:"Associação ao grupo de usuários alterada: {0}",68:"Grupo de usuários {0} adicionado ao grupo de dispositivos {1}",69:"Grupo de usuários criado: {0}",70:"Grupo de usuários {0} removido do grupo de dispositivos {1}",71:"Usuário adicionado {0} ao grupo de usuários {1}",72:"Usuário {0} removido do grupo de usuários {1}",73:"Notificação de grupo de dispositivos alterada",74:"Senha da conta alterada: {0}",75:"Credenciais de conta alteradas",76:"Grupo de dispositivos criado: {0}",77:"Grupo de dispositivos excluído: {0}",78:"Associação ao grupo de dispositivos alterada: {0}",79:"Grupo de usuários alterado: {0}",80:"Usuário adicionado {0} ao grupo de usuários {1}",81:"Direitos de dispositivo de usuário removidos para {0}",82:"Direitos de dispositivo do usuário alterados para {0}",83:"Usuário {0} removido do grupo de dispositivos {1}",84:"Dispositivo {0} adicionado ao grupo de dispositivos {1}",85:"Dispositivo movido {0} para o grupo {1}",86:"Direitos de dispositivo de usuário removidos para {0}",87:"Dispositivo removido {0} do grupo de dispositivos {1}",88:"Autenticação de dois fatores de e-mail habilitada",89:"Autenticação de dois fatores de e-mail desativada",90:"Aplicativo de autenticação adicionado",91:"Aplicativo de autenticação removido",92:"Novos códigos de backup 2FA gerados",93:"Códigos de backup 2FA apagados",94:"Chave de segurança removida",95:"Chave de segurança adicionada",96:"Número de telefone verificado do usuário {0}",97:"Número de telefone removido do usuário {0}",98:"Ajuda solicitada, usuário: {0}, detalhes: {1}",99:"Executar comandos como usuário",100:"Executar comandos como usuário, se possível",101:"Compartilhamento de dispositivo adicionado{0} de {1} a {2}",102:"Compartilhamento de dispositivo removido {0}",103:"Carregando {0} arquivo (s) em lote para a pasta {1}",104:'Download automatizado do arquivo de dump central do agente: "{0}"',105:'Upload: "{0}", Tamanho: {1}',106:'Download: "{0}", Tamanho: {1}',107:"Login da conta de {0}, {1}, {2}",108:"Tentativa de login do usuário com segundo fator incorreto de {0}, {1}, {2}",109:"Tentativa de login do usuário em conta bloqueada de {0}, {1}, {2}",110:"Tentativa de login de usuário inválida de {0}, {1}, {2}",111:"O dispositivo solicitou a ativação do Intel (R) AMT ACM TLS, FQDN: {0}",112:'Sessão do messenger encerrada "{0}" de {1} a {2}, {3} segundo (s)',113:"Dispositivo de autenticação de notificação push adicionado",114:"Dispositivo de autenticação de notificação push removido",115:"Token de login adicionado",116:"Token de login removido",117:"Esta é uma versão antiga do agente, considere atualizá-la.",118:"Este agente tem um mecanismo de validação de certificado desatualizado, considere atualizá-lo.",119:"Este agente está usando túneis inseguros, considere a atualização.",120:'Sessão de retransmissão local iniciada "{0}", protocolo {1} para {2}',121:'Sessão de retransmissão local encerrada "{0}", protocolo {1} a {2}, {3} segundo (s)',122:"Deixar a sessão de área de trabalho multiplex depois de {0} segundo(s)",123:'Deixar a sessão WEB-SSH "{1}" depois de {0} segundo(s)',124:'Deixar a sessão WEB-SFTP "{1}" depois de {0} segundo(s)',125:'Deixar a sessão WEB-RDP "{1}" depois de {0} segundo(s)',126:"Deixar a sessão WEB-VNC depois de {0} segundo(s)",127:"Nome de exibição da conta alterado para {0}",128:"Conta criada, o nome é {0}",129:"Remover nome de exibição da conta.",130:"Notificações de usuários alteradas",131:"Compartilhamento Ilimitado do dispositivo {0} adicionado.",132:"Ligar.",133:"Desligar.",134:"Sessão de área de trabalho do usuário {0} desconectada a força",135:"Sessão de terminal do usuário {0} desconectada a força",136:"Sessão de arquivos do usuário {0} desconectada a força",137:"Sessão de roteamento do usuário {0} desconectada a força",138:"Compartilhamento diário do dispositivo {0} adicionado.",139:"Compartilhamento Semanal do dispositivo {0} adicionado.",140:"Dispositivo alterado {0} do grupo {1}: {2}",141:"Mudar política Intel(r) AMT",142:"Grupo de dispositivo {0} foi alterado: {1}",143:'Entrou na sessão "{0}" multiplex de área de trabalho',144:'Deixar a sessão "{0}" de área de trabalho multiplex depois de {1} segundo(s)',145:'Sessão de área de trabalho multiplex "{0}" iniciada',146:'Gravação de sessão "{0}" finalizada, {1} segundo(s)',147:'Sessão "{0}" multiplex de área de trabalho fechada, {1} segundo(s)',148:'Sessão Web-SSH "{0}" iniciada',149:'Sessão Web-SFTP "{0}" iniciada',150:'Sessão Web-RDP "{0}" iniciada.',151:'Sessão Web-VNC "{0}" iniciada',152:'Não é mais um relé para "{0}".',153:'É um relé para "{0}".',154:"Account changed to sync with LDAP data.",155:"Denied user login from {0}, {1}, {2}",156:"Verified messaging account of user {0}",157:"Removed messaging account of user {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication",162:'Sessão de messenger iniciada "{0}" de {1} para {2}'},eventsShortMessageId={1:"Nome do grupo",2:"Descrição",3:"Flags",4:"Permitir",5:"Remoção automática",6:"Código de convite",7:"Dispositivo de retransmissão"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(var o in events){var n=events[o],a=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var i,s="fa-mobile-screen";if("ugrp"==n.etype&&(s="fa-users"),"user"==n.etype&&(s="fa-user"),"server"==n.etype&&(s="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{if(i=eventsMessageId[n.msgid],null!=n.msgArgs)for(var o in n.msgArgs){var r=n.msgArgs[o];if(Array.isArray(r)){var l=[];for(var d in r)"number"==typeof r[d]&&eventsShortMessageId[r[d]]?l.push(eventsShortMessageId[r[d]]):l.push(r[d]);r=l.join(",")}else"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9)))));i=i.split("{"+o+"}").join(r)}i=EscapeHtml(i).split("(R)").join("&reg;")}if(n.nodeid){var c=getNodeFromId(n.nodeid);if(null!=c){switch(c.icon){case 1:s="fa-computer";break;case 2:s="fa-laptop";break;case 8:s="fa-laptop-code"}i="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(c.name)+"</a> &rarr; "+i}}if(n.username){var u="";n.guestname&&(u=' / <span title="Esta é uma sessão de compartilhamento de convidados">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+u+" &rarr; "+i:EscapeHtml(n.username)+u+" &rarr; "+i}n.remoteaddr&&(i+=" ("+n.remoteaddr+")"),"relay"!=n.etype&&"relaylog"!=n.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenhum evento encontrado</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){if(!xxdialogMode){var e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>";e+=addHtmlFormFloating("Tipo de relatório",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Todos os eventos</option>'),e+=addHtmlFormFloating("Intervalo de tempo",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Todos disponíveis</option><option value=2>Um dia</option></select>'),e+="<div id=d2daySelector>"+addHtmlFormFloating("Dia do Relatório",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>",e+=addHtmlFormFloating("Grupo por",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Nenhum</option><option value=2>Grupo de Dispositivos</option><option value=3>Usuário</option>'),e+=addHtmlFormFloating("Formato",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>'),setModalContent("xxAddAgent","Baixar relatório",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus()}}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value;Q("d2reportGroupBy").value,Q("d2reportFormat").value;QV("d2daySelector",2==e);var o=!0;2==e&&""==t&&(o=!1),QE("idx_dlgOkButton",o)}function p3showDownloadEventsDialog(e){if(!xxdialogMode){var t="Baixe a lista de eventos com um dos formatos de arquivo abaixo.<br /><br />";t+=addHtmlValue("Formato CSV",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'),setModalContent("xxAddAgent","Exportação de lista de eventos",t+=addHtmlValue("Formato JSON",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p3downloadEventsDialogCSV(e){var t,o;for(var n in 1==e&&(o=currentDeviceEvents),2==e&&(o=events),3==e&&(o=currentUserEvents),t="utc, hora, tipo, ação, usuário, dispositivo, mensagem\r\n",o){var a="";if(o[n].nodeid){var i=getNodeFromId(o[n].nodeid);i&&i.name&&(a=i.name)}t+='"'+o[n].time+'","'+printDateTime(new Date(o[n].time))+'","'+o[n].etype+'","'+(null!=o[n].action?o[n].action:"")+'","'+(null!=o[n].username?o[n].username:"")+'","'+EscapeHtml(a)+'","'+(null!=o[n].msg?o[n].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,o=[];for(var n in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),3==e&&(t=currentUserEvents),t)o.push(events[n]);return saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",!(4&features)&&0==serverinfo.domainauth),null==users||4&features)QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],o=e,n=0;for(var a in users)t.push(users[a]);t.sort(nameSort);var i=Q("UserSearchInput").value.toLowerCase(),s=i;i.startsWith("email:")?(i=null,s=s.substring(6)):i.startsWith("name:")?(s=null,i=i.substring(5)):i.startsWith("e:")?(i=null,s=s.substring(2)):i.startsWith("n:")&&(s=null,i=i.substring(2));var r='<table class="table table-hover" cellpadding=0 cellspacing=0>',l=!0;r+="<th>Nome<th style=width:80px>Grupos de Dispositivos<th style=width:120px>"+nobreak("Último acesso")+"<th style=width:120px>Permissões";var d=[],c=document.getElementsByClassName("UserCheckbox");for(a=0;a<c.length;a++)c[a].checked&&d.push(c[a].value);for(var a in t){var u=t[a],p=null;null!=wssessions&&(p=wssessions[u._id]),null!=p&&(null!=i&&(""==i||u.name.toLowerCase().indexOf(i)>=0)||null!=s&&null!=u.email&&u.email.toLowerCase().indexOf(s)>=0)&&(o>0?(l&&(r+="<tr><td class=userTableHeader colspan=4>Usuários conectados",l=!1),r+=addUserHtml(u,p),o--):n++)}for(var a in l=!0,t){u=t[a],p=null;null!=wssessions&&(p=wssessions[u._id]),null==p&&(null!=i&&(""==i||u.name.toLowerCase().indexOf(i)>=0)||null!=s&&null!=u.email&&u.email.toLowerCase().indexOf(s)>=0)&&(o>0?(l&&(r+="<tr><td class=userTableHeader colspan=4>Usuários desconectados",l=!1),r+=addUserHtml(u,p),o--):n++)}r+="</table>",1==n?r+="<br />Mais 1 usuário não mostrado, use a caixa de pesquisa para procurar usuários ...<br />":n>1&&(r+="<br />"+format("{0} mais usuários não mostrados, use a caixa de pesquisa para procurar usuários ...",n)+"<br />"),o==e&&(r+="<br />Usuários não encontrados.<br />"),QH("p3users",r),c=document.getElementsByClassName("UserCheckbox");var m=encodeURIComponentEx(userinfo._id);for(a=0;a<c.length;a++)c[a].checked=d.indexOf(c[a].value)>=0&&c[a].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var o="",n=" gray",a="",i=e._id!=userinfo._id,s="",r="";null!=t?(n="",i&&(a='<span style=float:right;margin-top:1px;margin-right:4px title=Bate-papo><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",a+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 sessão":format("{0} sessões",t))):e.access?s+='<span title="'+format("Último acesso: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Último login: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),i&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(r+="Bloqueado,&nbsp;"),r+="<span title='Permissões do servidor'>";var l=4294966047&e.siteadmin;null==e.siteadmin||0==l?r+="Usuário":8==l?r+="Usuário + Arquivos":4294967295==e.siteadmin?r+="Administrador":r+=2&l?"Gerente":"Parcial",null!=e.siteadmin&&4294967295!=e.siteadmin&&1216&e.siteadmin&&(r+="*"),r+="</span>",i&&(r+="</a>");var d=0;if(e.links)for(var c in e.links)c.startsWith("mesh/")&&d++;var u=EscapeHtml(e.name),p="";if(1==serverinfo.emailcheck&&(p=1!=e.emailVerified?' <b style=color:red title="Email não está verificado">&#x2717;</b>':' <b style=color:green title="Email já é verificado">&#x2713</b>'),null!=e.email&&(2097152&features&&e.email.toLowerCase()==e.name.toLowerCase()?u+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Enviar e-mail para o usuário" style="margin-top:2px" /></a>'+p:u+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+p),null!=serverinfo.crossDomain){var m=e._id.split("/")[1];""!=m&&(u+=", <span style=color:#26F>"+m+"</span>")}return(e.otpsecret>0||e.otphkeys>0||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(u+=' <i class="fa-solid fa-key" title="Autenticação em 2 etapas habilitada" style="margin-top:2px"></i>'),null!=e.phone&&(u+=' <i class="fa-solid fa-mobile-screen" title="Número de telefone verificado" style="margin-top:2px"></i>'),null!=e.siteadmin&&32&e.siteadmin&&4294967295!=e.siteadmin&&(u+=' <img src="images/padlock12.png" height=12 width=8 title="Esta conta está bloqueada" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(u+=' <i class="fa-solid fa-comment fa-xs" title="Verified messaging account" style="margin-top:2px" />'),o+="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>",o+="<div>",o+='<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>',o+='<div class=baricon><i class="fa-fw fa-solid fa-user '+n+'"></i></div>',o+="<div>",o+="<div><span style=line-height:24px>"+u+"</span>"+a+"</div></div><td style=text-align:center>"+d+"<td style=text-align:center>"+s+"<td style=text-align:center>"+r}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;QE("UsersGroupActionButton",t>0),Q("UsersSelectAllButton").value=t>0?"Selecione nenhum":"Selecionar tudo"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),o=0,n=0;n<t.length;n++)!0===t[n].checked&&o++;for(n=0;n<t.length;n++)t[n].checked=0==o&&t[n].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;if(0!=t){var n="";serverinfo.emailcheck&&(n+="<option value=4>Validar email</option><option value=5>Invalidar e-mail</option>");var a="Selecione uma operação a ser executada em todos os usuários selecionados.<br /><br />";setModalContent("xxAddAgent","Ação do Grupo",a+=addHtmlFormFloating("Operação","<select id=d3groupop class=form-select><option value=1>Bloquear conta</option><option value=2>Desbloquear a conta</option>"+n+"<option value=3>Deletar conta</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx)}}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],o=0;o<e.length;o++)!0===e[o].checked&&t.push(decodeURIComponent(e[o].value));var n=Q("d3groupop").value;if(1==n)for(var o in t){32&(a=null==(i=users[t[o]]).siteadmin?0:i.siteadmin)||(a+=32,meshserver.send({action:"edituser",id:i._id,siteadmin:a}))}else if(2==n)for(var o in t){var a;32&(a=null==(i=users[t[o]]).siteadmin?0:i.siteadmin)&&(a-=32,meshserver.send({action:"edituser",id:i._id,siteadmin:a}))}else if(3==n){QE("idx_dlgOkButton",!1)}else if(4==n)for(var o in t){!0!==(i=users[t[o]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!0})}else if(5==n)for(var o in t){var i;!0===(i=users[t[o]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!1})}}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),o=[],n=0;n<t.length;n++)!0===t[n].checked&&o.push(decodeURIComponent(t[n].value));for(var n in o){var a=users[o[n]];meshserver.send({action:"deleteuser",userid:a._id,username:a.name})}}function userMouseHover(e,t){var o=e.children[0].children[0].children[1];o.children[1].classList.remove("g1s"),o.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(o.children[1].classList.add("g1s"),o.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var o=e.children[0].children[0];o.children[2].classList.remove("g1s"),o.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(o.children[2].classList.add("g1s"),o.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,o){if(!xxdialogMode){haltEvent(e);var n="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+o;return null!=authCookie&&""!=authCookie&&(n+="&auth="+authCookie),urlargs.key&&(n+="&key="+urlargs.key),safeNewWindow(n,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}}function altUserChat(e,t,o,n){if(!xxdialogMode){haltEvent(e);var a=serverinfo.altmessenging[n].url,i=decodeURIComponent(t),s=encodeURIComponentEx(i.split("/")[2]),r=encodeURIComponentEx(i.split("/").join("-")),l=s,d=r,c=users[i];return null!=c&&null!=c.realname&&(l=encodeURIComponentEx(c.realname.split(" ").join("")),d=encodeURIComponentEx(c.realname.split(" ").join("-"))),a=a.split("{0}").join(s).split("{1}").join(r).split("{2}").join(l).split("{3}").join(d),urlargs.key&&(a+="&key="+urlargs.key),safeNewWindow(a,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[n].name,msgid:11,url:a}),!1}}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","Enviar SMS","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",Q("d2smsText").value.length>0)}function showSendSMSEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Send Message","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){Q("d2smsText").value.length>0&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){if(!xxdialogMode){setModalContent("xxAddAgent","Enviar email",'<input id=d2emailSubject style=width:100% placeholder="Assunto"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate()}}function showSendEmailValidate(){QE("idx_dlgOkButton",Q("d2emailSubject").value.length>0&&Q("d2emailText").value.length>0)}function showSendEmailEx(e,t){Q("d2emailText").value.length>0&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode){haltEvent(e);return setModalContent("xxAddAgent",format("Notificar {0}",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Envie uma notificação de texto para este usuário.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Mostrar mensagem até ser dispensada pelo usuário</option><option value=10>Mostrar por 10 segundos</option><option value=60>Mostrar por 1 minuto</option><option value=300>Mostrar por 5 minutos</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){if(!xxdialogMode){null==userViewSettings&&(userViewSettings={});var e="";setModalContent("xxAddAgent","Visualização de usuários",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(userViewSettings.noViewLimit?"":" checked")+">Exibir apenas os primeiros 100 usuários</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx)}}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){if(!xxdialogMode){setModalContent("xxAddAgent","Importação de conta de usuário",'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx)}}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){const a=e.target.result.split("\n"),i=a[0].trim().split(","),s=[];for(let e=1;e<a.length;e++){const t=a[e].trim();if(""===t)continue;const o=t.split(",");let n=!1;for(let e=0;e<o.length;e++)if(""!==o[e].trim()){n=!0;break}if(!n)continue;const r={};for(let e=0;e<i.length;e++){const t=o[e].trim();""!==i[e].trim()&&""!==t&&(r[i[e]]="true"===t.toLowerCase()||t)}s.push(r)}if(null!=(t=s)&&Array.isArray(t)){var o=!0;for(var n in t)("string"!=typeof t[n].user||t[n].user.length<1||t[n].user.length>64)&&(o=!1),("string"!=typeof t[n].pass||t[n].pass.length<1||t[n].pass.length>256)&&(o=!1),0==checkPasswordRequirements(t[n].pass,passRequirements)&&(o=!1),null!=t[n].email&&("string"!=typeof t[n].email||t[n].email.length<1||t[n].email.length>128)&&(o=!1);0==o?setModalContent("xxAddAgent","Importação de conta de usuário","Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importação de conta de usuário","Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importação de conta de usuário",format("Arquivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){o=!0;for(var n in t)("string"!=typeof t[n].user||t[n].user.length<1||t[n].user.length>64)&&(o=!1),("string"!=typeof t[n].pass||t[n].pass.length<1||t[n].pass.length>256)&&(o=!1),0==checkPasswordRequirements(t[n].pass,passRequirements)&&(o=!1),null!=t[n].email&&("string"!=typeof t[n].email||t[n].email.length<1||t[n].email.length>128)&&(o=!1);0==o?setModalContent("xxAddAgent","Importação de conta de usuário","Formato de arquivo JSON inválido."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importação de conta de usuário","Formato de arquivo JSON inválido.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){if(!xxdialogMode){var e="Baixe a lista de usuários com um dos formatos de arquivo abaixo.<br /><br />";e+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"),setModalContent("xxAddAgent","Exportação de lista de usuários",e+=addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton")}}function p4downloadUserInfoCSV(){var e="id,nome,email,criação,lastlogin,grupos,authfactors,siteadmin,useradmin,bloqueado\r\n";for(var t in users){var o=!1,n=[];(users[t].otpsecret>0||users[t].otphkeys>0)&&(o=!0,users[t].otpsecret>0&&n.push("AuthApp"),users[t].otphkeys>0&&n.push("SecurityKey"),users[t].otpkeys>0&&n.push("BackupCodes")),e+='"'+users[t]._id+'","'+users[t].name+'","'+(users[t].email?users[t].email:"")+'","'+(users[t].creation?new Date(1e3*users[t].creation):"")+'","'+(users[t].login?new Date(1e3*users[t].login):"")+'","'+(users[t].groups?users[t].groups.join(","):"")+'","'+(o?n.join(","):"")+'"',e+=","+(4294967295==users[t].siteadmin?"1":"0"),e+=","+(2&users[t].siteadmin?"1":"0"),e+=","+(32&users[t].siteadmin?"1":"0"),e+="\r\n"}return saveAs(stringToUtf8Blob(e),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e=[];for(var t in users)e.push(users[t]);return saveAs(new Blob([JSON.stringify(e,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){if(!xxdialogMode){setModalContent("xxAddAgent","Mensagem da notificação",'<div style=margin-bottom:6px>Transmita uma mensagem para todos os usuários conectados.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Mostrar mensagem até ser dispensada pelo usuário</option><option value=10>Mostrar por 10 segundos</option><option value=60>Mostrar por 1 minuto</option><option value=300>Mostrar por 5 minutos</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus()}}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(var o in serverinfo.crossDomain)t+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Padrão":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";e+=addHtmlFormFloating("Domínio",t+="</select>")}if(2097152&features||(e+=addHtmlFormFloating("<span id=p4hname>Nome do usuário</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e+=addHtmlFormFloating("<span id=p4hemail>E-mail",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+="",e+=addHtmlFormFloating("<span id=p4hp1>Senha</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+=addHtmlFormFloating("<span id=p4hp2>Confirm Password</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'),e+='<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Randomize a senha.</label></div>',e+='<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Remova todos os eventos anteriores para este ID do usuário.</label></div>',e+='<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Força a redefinição da senha no próximo login.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />O email foi verificado.</label></div>',e+='<div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=E-mail verificado e redefinição de senha forçada necessária. />Envie um e-mail de convite.</label></div>'),passRequirements){var n=[],a=0;for(var o in passRequirements)"reset"!=o&&"hint"!=o&&(n.push(o+":"+passRequirements[o]),a++);a>0&&(e+="<div style=font-size:x-small;padding:6px>"+format("Requisitos: {0}.",n.join(", "))+"</div>")}setModalContent("xxAddAgent","Criar uma conta",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),2097152&features?Q("p4email").focus():Q("p4name").focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,o=Q("p4pass1").value.length>0&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements);2097152&features||(t=!Q("p4name")||Q("p4name").value.length>0&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=o||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=o||Q("p4randomPassword").checked?"black":"#7b241c";var n=t&e;0==Q("p4randomPassword").checked&&(n&=o),QE("idx_dlgOkButton",n)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:2097152&features?Q("p4email").value:Q("p4name").value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var o=users[t.toLowerCase()],n="";null!=o.groups&&(n=o.groups.join(", "));var a="Insira uma lista separada por vírgulas de nomes de domínios administrativos.<br /><br />";return setModalContent("xxAddAgent","Domínios Administrativos",a+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${n}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,o)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}}function p4validateUserGroups(){var e=Q("dp4usergroups").value,t=0,o=e.indexOf('"')+e.indexOf("/")+e.indexOf(">")+e.indexOf("<")+e.indexOf("'"),n=e.split(",");for(var a in n)0==n[a].trim().length&&t++;QE("idx_dlgOkButton",""==e||-5==o&&t<1)}function showUserGroupDialogEx(e,t){var o=Q("dp4usergroups").value.split(","),n=[];for(var a in o){var i=o[a].trim();i.length>0&&n.push(i)}meshserver.send({action:"edituser",id:t._id,groups:n})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var o=users[t];if(null!=o){var n=userinfo._id==o._id,a="";return a+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>Arquivos do servidor</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, em branco para o padrão</div><br><hr/>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Administrador Completo</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Backup do servidor</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Restauração do servidor</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Atualizações do servidor</label><br></div>',a+='<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Gerenciar usuários</label><br></div>',a+='<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Gerenciar grupos de usuários</label><br></div>',a+='<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Gerenciar gravações</label><br></div>',""!=(a+='<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Ver todos os eventos</label><br></div>')&&(a+="<hr/>"),a="<div><div id=d2AdminPermissions>"+a,a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Bloquear conta</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>Sem novos grupos de dispositivos</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>Não dispositivo novo</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Sem ferramentas (MeshCmd / Roteador)</label><br>',a+='<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Bloquear configurações de conta</label><br>',setModalContent("xxAddAgent","Permissões do servidor",a+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(n?0:1),o)}),o.siteadmin&&0!=o.siteadmin&&(Q("ua_fulladmin").checked=4294967295==o.siteadmin,Q("ua_serverbackup").checked=4294967295!=o.siteadmin&&!!(1&o.siteadmin),Q("ua_serverrestore").checked=4294967295!=o.siteadmin&&!!(4&o.siteadmin),Q("ua_fileaccess").checked=4294967295!=o.siteadmin&&!!(8&o.siteadmin),Q("ua_serverupdate").checked=4294967295!=o.siteadmin&&!!(16&o.siteadmin),Q("ua_lockedaccount").checked=4294967295!=o.siteadmin&&!!(32&o.siteadmin),Q("ua_nonewgroups").checked=4294967295!=o.siteadmin&&!!(64&o.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=o.siteadmin&&!!(128&o.siteadmin),Q("ua_locksettings").checked=4294967295!=o.siteadmin&&!!(1024&o.siteadmin),Q("ua_nonewdevices").checked=4294967295!=o.siteadmin&&!!(4096&o.siteadmin)),2&userinfo.siteadmin&&(Q("ua_manageusers").checked=4294967295!=o.siteadmin&&!!(2&o.siteadmin),QE("ua_manageusers",!n&&2&userinfo.siteadmin)),256&userinfo.siteadmin&&(Q("ua_manageusergroups").checked=4294967295!=o.siteadmin&&!!(256&o.siteadmin),QE("ua_manageusergroups",!n&&256&userinfo.siteadmin)),512&userinfo.siteadmin&&(Q("ua_managerecordings").checked=4294967295!=o.siteadmin&&!!(512&o.siteadmin),QE("ua_managerecordings",!n&&512&userinfo.siteadmin)),2048&userinfo.siteadmin&&(Q("ua_allevents").checked=4294967295!=o.siteadmin&&!!(2048&o.siteadmin),QE("ua_allevents",!n&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!n&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!n&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!n&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!n&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",!!(2&userinfo.siteadmin)),QV("d2MngGrp",!!(256&userinfo.siteadmin)),QV("d2MngRec",!!(512&userinfo.siteadmin)),QE("ua_lockedaccount",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewgroups",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nomeshcmd",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewdevices",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_locksettings",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),Q("ua_fileaccessquota").value=null!=o.quota?o.quota/1024:"",showUserAdminDialogValidate(),!1}}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var o=0,n=parseInt(Q("ua_fileaccessquota").value);1==Q("ua_fulladmin").checked?o=4294967295:(1==Q("ua_serverbackup").checked&&(o+=1),1==Q("ua_manageusers").checked&&(o+=2),1==Q("ua_serverrestore").checked&&(o+=4),1==Q("ua_fileaccess").checked&&(o+=8),1==Q("ua_serverupdate").checked&&(o+=16),1==Q("ua_lockedaccount").checked&&(o+=32),1==Q("ua_nonewgroups").checked&&(o+=64),1==Q("ua_nomeshcmd").checked&&(o+=128),1==Q("ua_manageusergroups").checked&&(o+=256),1==Q("ua_managerecordings").checked&&(o+=512),1==Q("ua_locksettings").checked&&(o+=1024),1==Q("ua_allevents").checked&&(o+=2048),1==Q("ua_nonewdevices").checked&&(o+=4096));var a={action:"edituser",id:t._id,siteadmin:o};0==isNaN(n)&&(a.quota=1024*n),meshserver.send(a)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",!!(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var o in usergroups)e.push(usergroups[o]);e.sort(nameSort);var n=[],a=document.getElementsByClassName("UserGroupCheckbox");for(o=0;o<a.length;o++)a[o].checked&&n.push(a[o].value);if(0==e.length)t+="<br />Nenhum grupo encontrado.<br />",QV("DuplicateUserGroupButton",!1);else{for(var o in t+='<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>',t+="<th>Nome<th style=width:80px>Usuários<th style=width:80px>Grupos de Dispositivos<th style=width:80px>Dispositivos",e)t+=addUserGroupHtml(e[o]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t),a=document.getElementsByClassName("UserGroupCheckbox");for(o=0;o<a.length;o++)a[o].checked=n.indexOf(a[o].value)>=0;p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,o=0,n=0;if(e.links)for(var a in e.links)a.startsWith("user/")&&t++,a.startsWith("mesh/")&&o++,a.startsWith("node/")&&n++;var i=EscapeHtml(e.name);if(null!=serverinfo.crossDomain){var s=e._id.split("/")[1];""!=s&&(i+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>")}var r="<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>";return r+="<div style=width:100%>",r+='<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>",r+='<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>',r+='<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>',r+='<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+i+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+o+"<td style=text-align:center>"+n}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;QE("UsersGroupsGroupActionButton",t>0),Q("UsersGroupsSelectAllButton").value=t>0?"Selecione nenhum":"Selecionar tudo"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),o=0,n=0;n<t.length;n++)!0===t[n].checked&&o++;for(n=0;n<t.length;n++)t[n].checked=0==o&&t[n].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;if(0!=t){var n="Selecione uma operação a ser executada em todos os usuários selecionados.<br /><br />";n+=addHtmlFormFloating("Operação","<select id=d50groupop class=form-select><option value=1>Excluir grupo</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Ação do Grupo",n),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx)}}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],o=0;o<e.length;o++)!0===e[o].checked&&t.push(decodeURIComponent(e[o].value));if(1==Q("d50groupop").value){setModalContent("xxAddAgent","Excluir grupos de usuários",'Confirma a exclusão do (s) grupo (s) de usuários selecionado (s)?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />confirme</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)}}}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),o=0;o<t.length;o++)!0===t[o].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[o].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",o="";if(2==e){if(usergroups)for(var n in usergroups)o+="<option value="+encodeURIComponentEx(n)+">"+EscapeHtml(usergroups[n].name)+"</option>";t+=addHtmlFormFloating("Grupo de usuários",'<select id=dp4groupid class="form-select">'+o+"</select>")}if(1==e&&serverinfo.crossDomain){o='<select id=p4domain class="form-select">';for(var n in serverinfo.crossDomain)o+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Padrão":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";t+=addHtmlFormFloating("Domínio",o+="</select>")}t+=addHtmlFormFloating("Nome","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"),t+=addHtmlFormFloating("Descrição",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Criar Grupo de Usuários":"Duplicar Grupo de Usuários",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",Q("p4name").value.length>0)}function showCreateUserGroupDialogEx(e,t){var o={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(o.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(o.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(o)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){var o=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null!=o){var n=EscapeHtml(o.name);0==n.length&&(n="<i>Nenhum</i>"),null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(n='<span role=button tabindex=0 title="Clique aqui para editar o nome do grupo de usuários" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+n+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",n);var a=0,i=0,s=0;if(o.links)for(var r in o.links)r.startsWith("user/")&&a++,r.startsWith("mesh/")&&i++,r.startsWith("node/")&&s++;var l=o.desc;l=null==l||""==l?"<i>Nenhum<i>":EscapeHtml(l);var d="<div style=min-height:80px><table style=width:100%>";if(8&args.hide&&(d+="<br />"+addDeviceAttribute("Nome",n)),null!=serverinfo.crossDomain||0!=debugmode){var c=o._id.split("/")[1];d+=addDeviceAttribute("Domínio",""!=c?EscapeHtml(c):"<i>Padrão</i>"),d+=addDeviceAttribute("Identificador de Grupo",EscapeHtml(o._id))}if(null!=currentUserGroup.membershipType&&(d+=addDeviceAttribute("Group Type",EscapeHtml(currentUserGroup.membershipType))),256&userinfo.siteadmin?d+=addDeviceAttribute("Descrição","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+l+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):d+=addDeviceAttribute("Descrição",l),1==serverinfo.userGroupsSessionRecording){var u=[];o.flags&&2&o.flags&&u.push("Sessões de registro"),""==(u=u.join(", "))&&(u="<i>Nenhum</i>"),d+=addDeviceAttribute("Recursos",addLink(u,"p51edituserGroupFeatures()"))}var p=[],m=0;o.consent&&(m=o.consent),serverinfo.consent&&(m|=serverinfo.consent),64&m&&8&m?p.push("Prompt da área de trabalho + barra de ferramentas"):64&m?p.push("Barra de ferramentas da área de trabalho"):8&m?p.push("Desktop Prompt"):1&m&&p.push("Notificar área de trabalho"),16&m?p.push("Prompt de Terminal"):2&m&&p.push("Notificação de Terminal"),32&m?p.push("Arquivos Prompt"):4&m&&p.push("Arquivos de notificação"),7==m&&(p=["Notificar sempre"]),56&~m||(p=["Sempre Perguntar"]),""==(p=p.join(", "))&&(p="<i>Nenhum</i>"),d+=addDeviceAttribute("Consentimento do usuário",addLinkConditional(p,"p20editmeshconsent(4)",!0)),d+=addDeviceAttribute("Usuários",a),d+=addDeviceAttribute("Grupos de Dispositivos",i),d+=addDeviceAttribute("Dispositivos",s),d+="</table></div><br />",256&userinfo.siteadmin&&(d+='<input type=button class="btn btn-primary btn-sm" value="Notificar Todos" title="Envie um aviso a todos os usuários deste grupo." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(o._id)+'") />'),QH("p51group",d),d="<br />",null==currentUserGroup.membershipType&&256&userinfo.siteadmin&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Adicionar usuários</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Membros do grupo</th><th scope=col></th></tr>';var g=1,v=[];for(var r in currentUserGroup.links)if(0!=r.startsWith("user/")){var h=r.split("/")[2];currentUserGroup.links[r].name&&(h=currentUserGroup.links[r].name),r==userinfo._id&&(h=userinfo.name),v.push({id:r,name:h,rights:currentUserGroup.links[r].rights})}for(var r in v.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),v){var f="";null==currentUserGroup.membershipType&&(f="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(v[r].id)+'")\' title="Remova os direitos do usuário para este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>');var x=EscapeHtml(decodeURIComponent(v[r].name));null!=users&&(x="<a href=# onclick='gotoUser(\""+encodeURIComponentEx(v[r].id)+"\");haltEvent(event);'>"+x+"</a>"),d+="<tr "+(g%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Usuário"></i>&nbsp;'+x+"</td><td><div style=float:right>"+f+"</div></td></tr>",++g}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Sem membros</i><div></div></div></td><td></td></tr>"),d+="</tbody></table><br />",g=1;var k=0,b=!1;for(var r in meshes)currentUserGroup._id.split("/")[1]==meshes[r]._id.split("/")[1]&&(k++,null!=currentUserGroup.links&&null!=currentUserGroup.links[r]||(b=!0));if(k>0&&b&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Adicionar Grupo de Dispositivos</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Grupos de dispositivos comuns</th><th scope=col></th></tr>',currentUserGroup.links){var y=[];for(var r in currentUserGroup.links)r.startsWith("mesh/")&&null!=meshes[r]&&y.push(meshes[r]);for(var r in y=getOrderedList(y,"name")){var w=0,C=y[r],M=(f="",makeDeviceGroupRightsString(currentUserGroup.links[C._id].rights));userinfo.links&&null!=userinfo.links[C._id]&&null!=userinfo.links[C._id].rights&&(w=userinfo.links[C._id].rights);var S="<i>Grupo de Dispositivos Desconhecido</i>";C&&(S="<a href=# onclick='gotoMesh(\""+C._id+"\");haltEvent(event);'>"+C.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(C._id)+'")\' title="Remova os direitos do grupo de usuários para este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',M='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(C._id)+'")>'+M+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+S+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+M+"</div></td></tr>"}}if(1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Nenhum grupo de dispositivos em comum</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",g=1,d+="<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(d+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Adicionar Dispositivo</button>'),d+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivos Comuns</th><th scope=col></th></tr>',currentUserGroup.links){var A=[];for(var r in currentUserGroup.links){if(r.startsWith("node/"))null!=(Q=getNodeFromId(r))&&A.push(Q)}for(var r in A=getOrderedList(A,"name")){var Q=A[r],D=(f="",M=makeUserDeviceRightsString(currentUserGroup.links[Q._id].rights),w=GetNodeRights(Q),"<i>Dispositivo desconhecido</i>");Q&&(D="<a href=# onclick='gotoDevice(\""+Q._id+"\");haltEvent(event);'>"+Q.name+"</a>"),2&w&&(f="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(Q._id)+'")\' title="Remova os direitos do grupo de usuários para este dispositivo" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',M='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(Q._id)+'")>'+M+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d+="<tr "+(++g%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+D+"<div></div></div></td><td style=width:70%><div style=float:right>"+f+"</div><div>"+M+"</div></td></tr>"}}1==g&&(d+="<tr><td><div style=padding:6px>&nbsp;<i>Nenhum dispositivo em comum</i><div></div></div></td><td></td></tr>"),d+="</tbody></table>",(null==currentUserGroup.membershipType||0==a)&&256&userinfo.siteadmin&&(d+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Excluir Grupo de Usuários</a></span></div>"),QH("p51group2",d),go(51);var T="";if(!(268435456&features)&&xxcurrentView>=51&&xxcurrentView<=59&&null!=currentUserGroup){for(var r in T="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)T+="&"+r+"="+urlargs[r];try{window.history.replaceState({},document.title,window.location.pathname+T)}catch(e){}}}else 51==xxcurrentView&&go(50)}}function p51edituserGroupFeatures(){if(!xxdialogMode){var e=currentUserGroup.flags?currentUserGroup.flags:0,t="";1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Sessões gravadas</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Editar recursos de Grupo de Usuários",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx)}}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){if(!xxdialogMode){var o=getNodeFromId(decodeURIComponent(t));null!=o&&(setModalContent("xxAddAgent","Remover permissões do dispositivo",format('Confirma a remoção dos direitos de acesso para o dispositivo "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,o._id)))}}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){if(!xxdialogMode){var o=meshes[decodeURIComponent(t)];null!=o&&(setModalContent("xxAddAgent","Remover permissões do grupo de dispositivos",format('Confirma a remoção dos direitos de acesso para o grupo de dispositivos "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,o._id)))}}function p51editgroup(e,t){if(!xxdialogMode){var o=addHtmlFormFloating("Nome",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>");o+=addHtmlFormFloating("Descrição",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Editar Grupo de Usuários",o),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),2==e?Q("dp51desc").focus():Q("dp51name").focus()}}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",Q("dp51name").value.length>0),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){if(xxdialogMode)return!1;var e=format("Excluir grupo de usuários {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />";return xxdialogButtons=3,setModalContent("xxAddAgent","Excluir Grupo de Usuários",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />confirme</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog(),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){if(2==e){var o=t.split("/")[2];users&&users[t]&&(o=users[t].name),userinfo._id==t&&(o=userinfo.name),setModalContent("xxAddAgent","Remover associação de usuário",format('Confirma a remoção da associação do usuário "{0}"?',EscapeHtml(decodeURIComponent(o)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t))}}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){if(xxdialogMode)return!1;var e="Permitir que os usuários gerenciem este grupo de dispositivos e dispositivos neste grupo.";return 524288&features&&(e+=" Os usuários precisam fazer login neste servidor antes de serem adicionados a um grupo de dispositivos."),e+="<br /><br /><div style='position:relative'>",e+=addHtmlFormFloating("Identificadores de usuário",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'),e+="<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>",setModalContent("xxAddAgent","Adicionar usuários ao grupo de usuários",e+="</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog(),!1}function p51setname(e){e=decodeURIComponent(e);var t=Q("dp51username").value.split(",");for(var o in t)t[o]=t[o].trim();return t[t.length-1]=e,Q("dp51username").value=t.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(var o in t){var n=t[o]=t[o].trim();(0==n.length||n.indexOf('"')>=0)&&(e=!1)}var a=!1,i=!1;if(null!=users){var s=t[t.length-1].trim(),r=s.toLowerCase(),l=[];if(s.length>0){for(var o in users){var d=users[o]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===r){i=!0;break}if(users[o].name.toLowerCase().indexOf(r)>=0&&currentUserGroup.domain==d[1]&&(l.push([users[o]._id,users[o].name]),l.length>=8))break}if(0==i&&l.length>0){var c="";for(var o in l){var u=l[o][0],p=l[o][1];u.split("/")[2]==p.toLowerCase()?c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(u.split("/")[2])+"</div></div>"}QH("dp51usersuggest",c),a=!0}}}QV("dp51usersuggest",a)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var o=Q("dp51username").value.split(","),n=[];for(var a in o)n.push(o[a].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:n})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,o){if((!xxdialogMode||t)&&(null==o||null==o.originalTarget||null==o.originalTarget.href)){var n=currentUser=users[decodeURIComponent(e)];if(null!=n){QH("p30userName",EscapeHtml(n.name)),QH("p31userName",EscapeHtml(n.name));var a=n._id==userinfo._id,i=0;null!=wssessions&&wssessions[n._id]&&(i=wssessions[n._id]),null!=n.flags&&1&n.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==n.accountImageRnd&&(n.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+n._id.split("/")[2]+"&rnd="+n.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==i&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1));var s=n._id.split("/")[2];s.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):s.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):s.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):s.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):s.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):s.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):s.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):s.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1);var r=[],l="";null!=n.siteadmin&&32&n.siteadmin&&4294967295!=n.siteadmin&&(l='<img src="images/padlock12.png" height=12 width=8 title="Esta conta está bloqueada" style="margin-top:2px" /> ',r.push("Conta bloqueada")),null!=n.siteadmin&&4294966047&n.siteadmin?8==n.siteadmin?r.push("Acessar arquivos do servidor"):4294967295==n.siteadmin?r.push("Administrador completo"):r.push("Direitos parciais"):r.push("Sem direitos do servidor"),null!=n.siteadmin&&4294967295!=n.siteadmin&&1216&n.siteadmin&&r.push("Restrições");var d="<div style=min-height:80px><table style=width:100%>";8&args.hide&&(d+="<br />"+addDeviceAttribute("Nome",n.name));var c=n.email?EscapeHtml(n.email):"<i>Não configurado</i>",u="",p=n.realname?EscapeHtml(n.realname):"<i>Não configurado</i>";if(serverinfo.emailcheck&&(u=1==n.emailVerified?'<b style=color:green;cursor:pointer title="Email já é verificado">&#x2713</b> ':'<b style=color:red;cursor:pointer title="Email não verificado">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode){var m=n._id.split("/")[1];d+=addDeviceAttribute("Domínio",""!=m?EscapeHtml(m):"<i>Padrão</i>"),d+=addDeviceAttribute("Identificador de Usuário",EscapeHtml(n._id))}else n.name.toLowerCase()!=n._id.split("/")[2]&&(d+=addDeviceAttribute("Identificador de Usuário",EscapeHtml(n._id.split("/")[2])));var g="";n.email&&(g=' <a href="mailto:'+EscapeHtml(n.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),4294967295!=n.siteadmin||4294967295==userinfo.siteadmin?(d+=addDeviceAttribute("E-mail",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(n._id)+'")>'+u+c+g+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),d+=addDeviceAttribute("Nome real",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(n._id)+'")>'+p+' <i class="fa-solid fa-pencil fa-xs"></i></span>')):(d+=addDeviceAttribute("E-mail",u+c+g),d+=addDeviceAttribute("Nome real",p)),(33554432&features||null!=n.phone)&&(d+=addDeviceAttribute("Número de telefone","<span role=button onclick=p30editPhone()>"+(n.phone?n.phone:"<i>Nenhum</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=n.msghandle)&&(d+=addDeviceAttribute("Messaging",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Messaging enabled" style="margin-top:2px"></i> '+(n.msghandle?n.msghandle:"<i>Nenhum</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'));var v=[];1==serverinfo.usersSessionRecording&&n.flags&&2&n.flags&&v.push("Sessões de registro"),n.removeRights&&(8&n.removeRights?v.push("Sem Controle Remoto"):(65536&n.removeRights?v.push("Sem área de trabalho"):256&n.removeRights&&v.push("Vista de escritorio solamente"),512&n.removeRights&&v.push("Sem Terminal"),1024&n.removeRights&&v.push("Sem arquivos")),16&n.removeRights&&v.push("Sem Console"),32768&n.removeRights&&v.push("Não desinstalar"),131072&n.removeRights&&v.push("Sem Comando Remoto"),64&n.removeRights&&v.push("Não acordar"),262144&n.removeRights&&v.push("Sem Resetar/Desligar")),""==(v=v.join(", "))&&(v="<i>Nenhum</i>"),d+=addDeviceAttribute("Recursos",addLink(v,"p20edituserfeatures()")),d+=addDeviceAttribute("Direitos do servidor","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(n._id)+"\")'>"+l+r.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),n.quota&&(d+=addDeviceAttribute("Cota do servidor",EscapeHtml(parseInt(n.quota)/1024)+" k")),d+=addDeviceAttribute("Criação",printDateTime(new Date(1e3*n.creation))),n.login&&(d+=addDeviceAttribute("Último Login",printDateTime(new Date(1e3*n.login)))),-1==n.passchange?d+=addDeviceAttribute("Senha","Será alterado no próximo login."):n.passchange&&(d+=addDeviceAttribute("Senha",format("Última alteração: {0}",printDateTime(new Date(1e3*n.passchange)))));var h=0,f="<i>Nenhum<i>";if(n.links){for(var x in n.links)x.startsWith("mesh/")&&h++;1==h?f="1 grupo":h>1&&(f=format("{0} grupos",h))}if(d+=addDeviceAttribute("Grupos de Dispositivos",f),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var k="<i>Nenhum</i>";if(n.groups)for(var x in k="",n.groups)k+='<span class="tagSpan">'+EscapeHtml(n.groups[x])+"</span>";d+=addDeviceAttribute("Domínios Administrativos",addLinkConditional(k,'showUserGroupDialog(event,"'+encodeURIComponentEx(n._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=n._id&&4294967295!=n.siteadmin))}var b=[],y=0;n.consent&&(y=n.consent),serverinfo.consent&&(y|=serverinfo.consent),64&y&&8&y?b.push("Prompt da área de trabalho + barra de ferramentas"):64&y?b.push("Barra de ferramentas da área de trabalho"):8&y?b.push("Desktop Prompt"):1&y&&b.push("Notificar área de trabalho"),16&y?b.push("Prompt de Terminal"):2&y&&b.push("Notificação de Terminal"),32&y?b.push("Arquivos Prompt"):4&y&&b.push("Arquivos de notificação"),7==y&&(b=["Notificar sempre"]),56&~y||(b=["Sempre Perguntar"]),""==(b=b.join(", "))&&(b="<i>Nenhum</i>"),d+=addDeviceAttribute("Consentimento do usuário",addLinkConditional(b,"p20editmeshconsent(2)",!0));var w=0;if(n.otpsecret>0||n.otphkeys>0||n.otpekey>0||n.otpduo>0){w=1;var C=[];n.otpsecret>0&&C.push("App de autenticação"),n.otphkeys>0&&C.push("Chave de segurança"),n.otpekey>0&&C.push("E-mail"),n.otpduo>0&&C.push("Duo"),n.otpkeys>0&&C.push("Códigos de backup"),n.otpdev>0&&C.push("Dispositivo push"),null!=n.phone&&67108864&features&&C.push("SMS"),null!=n.msghandle&&67108864&features2&&C.push("Messaging"),d+=addDeviceAttribute("Segurança",'<i class="fa-solid fa-key" title="Autenticação em 2 etapas habilitada" style="margin-top:2px"></i> '+C.join(", "))}if(d+="</table></div><br />",d+='<input type=button class="btn btn-primary btn-sm me-1" value="Notas" title="Ver notas sobre este usuário" onclick=showNotes(false,"'+encodeURIComponentEx(n._id)+'") />',n.phone&&33554432&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="SMS" title="Envie uma mensagem SMS para este usuário" onclick=showSendSMS("'+encodeURIComponentEx(n._id)+'") />'),n.msghandle&&33554432&features2&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Mensagem" title="Send a message to this user" onclick=showSendMessage("'+encodeURIComponentEx(n._id)+'") />'),"string"==typeof n.email&&!0===n.emailVerified&&64&features&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="E-mail" title="Envie uma mensagem de e-mail para este usuário" onclick=showSendEmail("'+encodeURIComponentEx(n._id)+'") />'),!a&&(i>0||8&features2&&n.webpush)&&(d+='<input type=button class="btn btn-primary btn-sm me-1" value="Notificar" title="Enviar notificação ao usuário" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(n._id)+'") />',d+='<input type=button class="btn btn-primary btn-sm me-1" value="Bate-papo" title="Bate-papo" onclick=userChat(event,"'+encodeURIComponentEx(n._id)+'","'+encodeURIComponentEx(n.name)+'") />',i>0&&null!=serverinfo&&null!=serverinfo.altmessenging))for(var x in serverinfo.altmessenging){var M=serverinfo.altmessenging[x];null!=M.type&&"user"!=M.type||(d+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(M.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(n._id)+'","'+encodeURIComponentEx(n.name)+'",'+x+") />")}QH("p30html",d),drawUserPermissions();var S=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=n.siteadmin||4294967295==userinfo.siteadmin;d="<div style=float:right;font-size:small>",S&&userinfo._id!=n._id&&(d+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Remover este usuário\">Deletar usuário</a>"),d+="</div><div style=font-size:small>",!S||524288&features||"~"==n._id.split("/")[2][0]||(d+="<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+w+')\' title="Alterar a senha deste usuário">Alterar senha</a>',d+=" <a href=# style=cursor:pointer onclick='return p30viewPreviousLogins()' title=\"Ver logins anteriores deste usuário\">Logins anteriores</a>"),d+="</div><br>",QH("p30html3",d),d="",1==i?d="1 sessão ativa":i>1&&(d=format("{0} sessões ativas",i)),QH("MainUserState",d),go(30),QH("p31events",""),refreshUsersEvents();var A="";if(!(268435456&features)&&xxcurrentView>=30&&xxcurrentView<=39&&null!=currentUser){for(var x in A="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)A+="&"+x+"="+urlargs[x];try{window.history.replaceState({},document.title,window.location.pathname+A)}catch(e){}}}else go(4)}}function p30editPhone(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>';e+="<td style=width:100%;text-align:center>Número de telefone compatível com SMS para este usuário.<br />Deixe em branco para nenhum.",e+='<br /><br /><div style=width:100%;text-align:center>Número de telefone: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone?currentUser.phone:"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notificações por telefone",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate()}}function p30editMessaging(){if(!xxdialogMode){var e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>';e+="<td style=width:100%>Messaging account for this user.";var t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Nenhum</option>";if(1&serverinfo.userMsgProviders&&(t+="<option value=1>Telegram</option>"),4&serverinfo.userMsgProviders&&(t+="<option value=4>Discord</option>"),8&serverinfo.userMsgProviders&&(t+="<option value=8>XMPP</option>"),16&serverinfo.userMsgProviders&&(t+="<option value=16>CallMeBot</option>"),32&serverinfo.userMsgProviders&&(t+="<option value=32>Pushover</option>"),64&serverinfo.userMsgProviders&&(t+="<option value=64>ntfy</option>"),128&serverinfo.userMsgProviders&&(t+="<option value=128>Zulip</option>"),256&serverinfo.userMsgProviders&&(t+="<option value=256>Slack</option>"),e+="<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>"),e+="<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\">",e+="</table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>',e+='<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl?serverinfo.userMsgNftyUrl:"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle){if(currentUser.msghandle.startsWith("telegram:")&&1&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&4&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&8&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&16&serverinfo.userMsgProviders){Q("d2serviceselect").value=16;var o=currentUser.msghandle.substring(10).split("|");"signal"==o[0]&&3==o.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(o[1])+"&apikey="+decodeURIComponent(o[2])),"whatsapp"==o[0]&&3==o.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(o[1])+"&apikey="+decodeURIComponent(o[2])),"facebook"==o[0]&&2==o.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(o[1]))}currentUser.msghandle.startsWith("pushover:")&&32&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&64&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&128&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:")&&256&serverinfo.userMsgProviders&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6))}p30editMessagingValidate()}}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Tema":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nome do usuário",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){if(!xxdialogMode){var e=currentUser.flags?currentUser.flags:0,t="",o=currentUser.removeRights?currentUser.removeRights:0;t="";1==serverinfo.usersSessionRecording&&(t+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Sessões gravadas</label><br></div>"),t+='<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&o?"checked":"")+">Sem Controle Remoto</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&o?"checked":"")+">Sem acesso à área de trabalho</label><br></div>",t+='<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&o?"checked":"")+">Somente Visualização Remota</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&o?"checked":"")+">Sem acesso ao terminal</label><br></div>",t+='<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&o?"checked":"")+">Sem acesso ao arquivo</label><br></div>",t+='<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&o?"checked":"")+">Sem Console do Agente</label><br></div>",t+='<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&o?"checked":"")+">Não desinstalar</label><br></div>",t+='<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&o?"checked":"")+">Sem Comando Remoto</label><br></div>",t+='<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&o?"checked":"")+">Não acordar</label><br></div>",setModalContent("xxAddAgent","Editar Recursos do Usuário",t+='<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&o?"checked":"")+">Sem Resetar/Desligar</label><br></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate()}}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags?currentUser.flags:0);1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2);var t=0;Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){if(xxdialogMode)return!1;return xxdialogButtons=3,setModalContent("xxAddAgent",format("Alterar o nome real para {0} ",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname?currentUser.realname:"",!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){if(xxdialogMode)return!1;var t="";return t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Status",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>Não verificado</option><option value=1>Verificado</option></select>')),setModalContent("xxAddAgent",format("Alterar e-mail para {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email?currentUser.email:"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail(),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@");t=0==e.length||2==t.length&&t[0].length>0&&t[1].split(".").length>1&&t[1].length>2&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0)),QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Logins anteriores","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t="";if(t+='<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>',t+='<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>',65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var o=[],n=0;for(var a in passRequirements)"reset"!=a&&"hint"!=a&&(o.push(a+":"+passRequirements[a]),n++);n>0&&(t+="<div style=font-size:x-small;padding:6px>"+format("Requisitos: {0}.",o.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Força a redefinição da senha no próximo login.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Remova toda a autenticação de segundo fator.</label></div>'),setModalContent("xxAddAgent",format("Alterar senha para {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var o=!1;if(1==t&&1==Q("p4twoFactorRemove").checked&&(o=!0),Q("p4pass1").value==Q("p4pass2").value){var n={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:o,resetNextLogin:Q("p4resetNextLogin").checked};65536&features&&(n.hint=Q("p4hint").value),meshserver.send(n)}}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Excluir usuário {0}",EscapeHtml(currentUser.name)),format("Confirma a exclusão do usuário {0}?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />confirme</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",o=0,n=!1;for(var a in meshes)meshes[a]._id.split("/")[1]==currentUser._id.split("/")[1]&&(o++,null!=currentUser.links&&null!=currentUser.links[a]||(n=!0));if(o>0&&n&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Adicionar Grupo de Dispositivos</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Grupos de dispositivos comuns</th><th scope=col></th></tr>',currentUser.links){var i=[];for(var a in currentUser.links)a.startsWith("mesh/")&&null!=meshes[a]&&i.push(meshes[a]);for(var a in i=getOrderedList(i,"name")){var s=0,r=i[a],l="",d=makeDeviceGroupRightsString(v=currentUser.links[r._id].rights);if(null!=r){userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(s=userinfo.links[r._id].rights);var c="<i>Grupo de Dispositivos Desconhecido</i>";r&&(c="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&2&s&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Remova os direitos do usuário para este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+c+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Nenhum grupo de dispositivos em comum</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",256&userinfo.siteadmin){var u=0,p=!1;for(var a in usergroups)null==usergroups[a].membershipType&&usergroups[a]._id.split("/")[1]==currentUser._id.split("/")[1]&&(u++,null!=currentUser.links&&null!=currentUser.links[a]||(p=!0));u>0&&p&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Adicionar Grupo de Usuários</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Membros do grupo de usuários</th><th scope=col></th></tr>',currentUser.links){var m=[];for(var a in currentUser.links)a.startsWith("ugrp/")&&null!=usergroups[a]&&m.push(usergroups[a]);for(var a in m=getOrderedList(m,"name")){var g=m[a],v=currentUser.links[m[a]._id].rights,h=(l="","<i>Grupo de usuários desconhecido</i>");null!=g&&(h=EscapeHtml(g.name),null!=usergroups&&(h="<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(m[a]._id)+"\");haltEvent(event);'>"+h+"</a>")),null==g.membershipType&&256&userinfo.siteadmin&&(l="<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(m[a]._id)+'")\' title="Remover associação de grupo de usuários" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>'),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Grupo de usuários" class=m4></div><div>&nbsp;'+h+"<div></div></div></td><td><div style=float:right>"+l+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Sem associações de grupos de usuários</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Adicionar Dispositivo</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivos Comuns</th><th scope=col></th></tr>',currentUser.links){var f=[];for(var a in currentUser.links){if(a.startsWith("node/"))null!=(x=getNodeFromId(a))&&f.push(x)}for(var a in f.sort(nameSort),f){var x=f[a];v=currentUser.links[x._id].rights,l="",s=GetNodeRights(x);userinfo.links&&null!=userinfo.links[a]&&null!=userinfo.links[a].rights&&(s=userinfo.links[a].rights);var k=x?EscapeHtml(x.name):"<i>Dispositivo desconhecido</i>";2&s&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(x._id)+'")\' title="Remova os direitos do usuário para este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(x._id)+'")>'+makeUserDeviceRightsString(v)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),k="<a href=# onclick='gotoDevice(\""+x._id+"\",10);haltEvent(event);'>"+k+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Dispositivo" class=si'+x.icon+"></div><div>&nbsp;"+k+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Nenhum dispositivo em comum</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,o,n){xxdialogMode||(setModalContent("xxAddAgent","Remover compartilhamento de dispositivo",format('Confirma a remoção do compartilhamento do dispositivo "{0}"?',decodeURIComponent(n))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(o)]))}function p30removeNodeFromUser(e,t){if(!xxdialogMode){var o=getNodeFromId(decodeURIComponent(t));setModalContent("xxAddAgent","Remover permissões do dispositivo",format('Confirma a remoção dos direitos de acesso para o dispositivo "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,o)}}function p30removeUserFromNode(e,t){if(!xxdialogMode){var o=null,n="";t=decodeURIComponent(t),xxdialogButtons=3,xxdialogTag=o,t.startsWith("user/")?(users&&null!=(o=users[t])&&(n=o.name),setModalContent("xxAddAgent","Remover permissões de usuário",n?format('Confirma a remoção dos direitos de acesso para o usuário "{0}"?',n):"Confirma a remoção dos direitos de acesso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,o){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})})):t.startsWith("ugrp/")&&(usergroups&&null!=(o=usergroups[t])&&(n=o.name),setModalContent("xxAddAgent","Remover permissões de grupo de usuários",n?format('Confirma a remoção dos direitos de acesso para o grupo de usuários "{0}"?',n):"Confirma a remoção dos direitos de acesso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,o){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[t],rights:0,remove:!0})}))}}function p30RemoveUserGroup(e,t){if(!xxdialogMode&&null!=usergroups){var o=decodeURIComponent(t),n=usergroups[o];setModalContent("xxAddAgent","Remover membros do grupo de usuários",format('Confirma a remoção da associação do grupo de usuários "{0}"?',null!=n?EscapeHtml(n.name):"<i>Desconhecido</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,o)})}}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e="";for(var t in usergroups)null==usergroups[t].membershipType&&usergroups[t]._id.split("/")[1]==currentUser._id.split("/")[1]&&(null!=currentUser.links&&null!=currentUser.links[t]||(e+="<option value="+encodeURIComponentEx(t)+">"+EscapeHtml(usergroups[t].name)+"</option>"));var o=addHtmlFormFloating("Grupo de usuários",'<select id=dp2groupid class="form-select">'+e+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","Adicionar inscrição",o),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){if(!xxdialogMode){var o=meshes[decodeURIComponent(t)];null!=o&&(setModalContent("xxAddAgent","Remover permissões do grupo de dispositivos",format('Confirma a remoção dos direitos de acesso para o grupo de dispositivos "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,o._id)}))}}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(var o in currentUserEvents){var n=currentUserEvents[o],a=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(a)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(a))+"</td></tr>");var i,s="fa-mobile-screen";if("user"==n.etype&&(s="fa-user"),"server"==n.etype&&(s="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var o in i=eventsMessageId[n.msgid],n.msgArgs){var r=n.msgArgs[o];"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9))))),i=i.split("{"+o+"}").join(r)}i=EscapeHtml(i).split("(R)").join("&reg;")}if(n.nodeid){var l=getNodeFromId(n.nodeid);null!=l&&(s="si"+l.icon,i="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(l.name)+"</a> &rarr; "+i)}if(n.username&&n.username!=currentUser.name){var d="";n.guestname&&(d=' / <span title="Esta é uma sessão de compartilhamento de convidados">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+d+" &rarr; "+i:EscapeHtml(n.guestname)+" &rarr; "+i}else n.guestname&&(i='<span title="Esta é uma sessão de compartilhamento de convidados">'+EscapeHtml(n.guestname)+"</span> &rarr; "+i);"relay"!=n.etype&&"relaylog"!=n.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(a)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenhum evento encontrado</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),o="",n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);if(null==p52recordings)o+="<div style=width:100%;text-align:center;margin-top:20px><i>Carregando...</i></div>";else if("number"==typeof p52recordings)o+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to read from the recordings folder.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to get recordings from the database.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>An unknown error occured.</i></div>";else if(0==p52recordings.length)o+="<div style=width:100%;text-align:center;margin-top:20px><i>Sem gravações.</i></div>";else{if(o+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>',o+="<th>Sessão</th><th style=width:110px>"+nobreak("Hora de início")+"</th><th style=width:110px>Duração</th><th style=width:110px>Tamanho</th></tr></thead><tbody>",null!=p52recordings){var a=null;for(var n in p52recordings){var i=p52recordings[n],s=printDate(new Date(i.startTime));s!=a&&(a=s,o+="<tr><td class=userTableHeader colspan=4>"+s),o+=addRecordingHtml(n,i)}}o+="</tbody></table>"}QH("p52recordings",o),t=document.getElementsByClassName("RecordingCheckbox");for(n=0;n<t.length;n++)t[n].checked=e.indexOf(t[n].value)>=0;p52updateInfo()}function addRecordingHtml(e,t){var o="";t.lengthTime&&(o=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60)));var n=printTime(new Date(t.startTime));t.sessionStart&&(n=printTime(new Date(t.sessionStart)));var a="";t.size&&(a=format("{0} kb",Math.round(t.size/1024)));var i="<i>Desconhecido</i>";t.name&&t.meshname&&(i=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name));if(null!=t.userids&&t.userids.length>0)if(t.userids.length>1)i+=" - "+format("{0} users",t.userids.length);else{var s=null;null!=users&&(s=users[t.userids[0]]),i+=null!=s?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])}1==t.protocol&&(i+=" - Sessão de Terminal"),2==t.protocol&&(i+=" - Sessão Desktop"),5==t.protocol&&(i+=" - Transferência de arquivo"),6==t.protocol&&(i+=" - Admin PowerShell"),8==t.protocol&&(i+=" - Shell do usuário"),9==t.protocol&&(i+=" - PowerShell do usuário"),100==t.protocol&&(i+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(i+=" - Redirecionamento Intel&reg; AMT"),200==t.protocol&&(i+=" - Messenger");var r="",l="fa-circle-xmark text-danger";1==t.present&&(l="fa-circle-check text-success",r='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',r+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>');var d="<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>";return d+="<div class=bar style=width:100%>",d+="<div></div>",d+='<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+l+'"></i></div>',d+='<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>',d+='<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+r+"<div style=font-size:16px>"+i+"</div></div></div><td style=text-align:center>"+n+"<td style=text-align:center>"+o+"<td style=text-align:center>"+a}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var o=p52recordings[t],n="";if(o.protocol){var a="Desconhecido";1==o.protocol&&(a="Terminal"),2==o.protocol&&(a="Área de Trabalho"),5==o.protocol&&(a="Arquivos"),6==o.protocol&&(a="Admin PowerShell"),8==o.protocol&&(a="Shell do usuário"),9==o.protocol&&(a="PowerShell do usuário"),100==o.protocol&&(a="Intel&reg; AMT WSMAN"),101==o.protocol&&(a="Redirecionamento Intel&reg; AMT"),200==o.protocol&&(a="Messenger"),n+=addHtmlValue4("Protocolo",a)}if(n+=addHtmlValue4("Status",1==o.present?"Presente no servidor":"Não está no servidor"),o.name&&(n+=addHtmlValue4("Nome do dispositivo",EscapeHtml(o.name))),o.meshname&&(n+=addHtmlValue4("Grupo de Dispositivos",EscapeHtml(o.meshname))),o.size&&(n+=addHtmlValue4("Tamanho",format("{0} bytes",o.size))),o.startTime&&(n+=addHtmlValue4("Hora de início",printTime(new Date(o.startTime)))),o.startTime&&o.lengthTime&&(n+=addHtmlValue4("Fim do tempo",printTime(new Date(o.startTime+1e3*o.lengthTime)))),o.lengthTime&&(n+=addHtmlValue4("Duração",pad2(Math.floor(o.lengthTime/3600))+":"+pad2(Math.floor(o.lengthTime%3600/60))+":"+pad2(Math.floor(o.lengthTime%60)))),1==o.multiplex&&(n+=addHtmlValue4("Multiplexador","Habilitado ")),o.userids)for(var t in o.userids)n+=addHtmlValue4("Usuário",o.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Detalhes de gravação",n),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),1==e?d3setActions():d3updatefiles()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e="",t="",o=filetree,n=1,a="",i=[],s=[],r=document.getElementsByName("fc"),l=0;l<r.length;l++)r[l].checked&&s.push(r[l].value);for(var l in d3filetreelinkpath="",d3filetreelocation){if(null==o.f||null==o.f[d3filetreelocation[l]])break;if(i.push(d3filetreelocation[l]),1==n){var d=d3filetreelocation[l].split("/");window.location.origin+domainUrl+d[0]+"files/"+d[2],d3filetreelocation[l]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=d[0]+"/"+d[2]}else""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[l],n>2&&"/"+d3filetreelocation[l]);a=(o=o.f[d3filetreelocation[l]]).n,n++}d3filetreelocation=i;var c=p5sort_files(o.f),u="";for(var l in d3fileoptions.filter&&(u=Q(d3fileoptions.filter).value),c){var p,m=c[l],g=m.n;if(3!=m.t||""==u||0!=m.nx.toLowerCase().endsWith(u)){p=g.length>70?'<span title="'+EscapeHtml(g)+'">'+EscapeHtml(g.substring(0,70))+"...</span>":EscapeHtml(g);var v="";null!=m.s&&(v=getFileSizeStr(m.s));var h="";if(3!=m.t){h='<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+m.t+' onclick=d3folderset("'+encodeURIComponentEx(m.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(m.nx)+"\")'>"+p+"</a></span></div>"}else{var f=p;h='<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+m.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(v)+"</span><span><div class=fileIcon"+m.t+"></div>"+f+"</span></div>"}m.t<3?e+=h:t+=h}}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,a),QH(d3fileoptions.files,e+t),QE(d3fileoptions.folderup,d3filetreelocation.length>0),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",Q("d3localFile").value.length>0):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",o=JSON.parse(getstore("_ReportSettings","{}")),n={1:"Sessões Remotas",2:"Uso de Trafego de Usuário",3:"Logins de usuários"};for(var a in 4294967295==userinfo.siteadmin&&(n[4]="Database Records"),n)e+="<option value="+a+(o.type==a?" selected":"")+">"+n[a]+"</option>";t+=addHtmlFormFloating("Tipo",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="<div id=d2GroupByDiv style=display:none>",e="";n={1:"Usuário",2:"Dispositivo",3:"Dia"};for(var a in n)e+="<option value="+a+(o.groupBy==a?" selected":"")+">"+n[a]+"</option>";t+=addHtmlFormFloating("Grupo por",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2GroupByDiv2 style=display:none>",e="";n={1:"Usuário",3:"Dia"};for(var a in n)e+="<option value="+a+(o.groupBy2==a?" selected":"")+">"+n[a]+"</option>";t+=addHtmlFormFloating("Grupo por",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==o.devGroup?" selected":"")+">Tudo</option>";var i=getOrderedList(meshes,"name");for(var a in i)e+="<option value="+encodeURIComponentEx(i[a]._id)+(o.devGroup==i[a]._id?" selected":"")+">"+EscapeHtml(i[a].name)+"</option>";t+=addHtmlFormFloating("Grupo de Dispositivos",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"),t+="</div>",t+="<div id=d2timeBackDiv style=display:none>",e="",null==o.timeRange&&(o.timeRange=1);n={1:"Último dia",7:"Últimos 7 dias",30:"Últimos 30 dias",0:"Intervalo de tempo"};for(var a in n)e+="<option value="+a+(o.timeRange==a?" selected":"")+">"+n[a]+"</option>";t+=addHtmlFormFloating("Tempo",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"),t+="</div>",t+="<div id=d2timeRangeDiv style=display:none>",t+=addHtmlFormFloating("Intervalo de tempo Iniciar",'<input id=d2timeRangeStartSelector class="flatpickr form-control" type="text" placeholder="Selecionar Data & Hora..." data-id="altinput">'),t+=addHtmlFormFloating("Final de tempo final",'<input id=d2timeRangeEndSelector class="flatpickr form-control" type="text" placeholder="Selecionar Data & Hora..." data-id="altinput">'),t+="</div>",t+="<div id=d2showTrafficDiv style=display:none>",t+=addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(o.showTraffic?"checked":"")+">Mostrar Tráfego</label><div>"),setModalContent("xxAddAgent","Gerar relatório",t+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>generateReportDialogEx("",xxdialogTag)),generateReportDialogValidate();var s=new Date;s.setDate(s.getDate()-7);var r=flatpickr("#d2timeRangeStartSelector",{enableTime:!0,maxDate:new Date,defaultDate:s,minuteIncrement:1,plugins:[new confirmDatePlugin({})],onChange:function(e,t,o){l.set("minDate",t),l.selectedDates[0]&&l.selectedDates[0]<e[0]&&l.clear()}}),l=flatpickr("#d2timeRangeEndSelector",{enableTime:!0,maxDate:new Date,defaultDate:new Date,minuteIncrement:1,plugins:[new confirmDatePlugin({})]});xxdialogTag={rangeStart:r,rangeEnd:l}}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var o,n;0==Q("d2timeRange").value?(n=Math.floor(t.rangeEnd.selectedDates[0].getTime()/1e3),o=Math.floor(t.rangeStart.selectedDates[0].getTime()/1e3)):(n=Math.floor(new Date/1e3),o=new Date,o=Math.floor(o.setDate(o.getDate()-Q("d2timeRange").value)/1e3));var a=null;try{a=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var i=decodeURIComponent(Q("d2groupId").value);0==i&&(i=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:i,showTraffic:Q("d2showTraffic").checked}));var s=parseInt(Q("d2groupBy").value);3==Q("d2reportType").value&&(s=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:s,start:o,end:n,tz:a,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:i,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Tempo",device:"Dispositivo",session:"Sessão",user:"Usuário",devgroup:"Grupo de Dispositivos",guest:"Convidado",length:"Comprimento",bytesin:"Entrada de Bytes",bytesout:"Saída de Bytes",os:"Sistema operacional",ip:"Endereço IP",browser:"Navegador",msg:"Mensagem",twofactor:"2ª Etapa"},o='<table class="table table-hover">',n=null,a=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),o+="<tr><td style=text-align:center;padding-top:32px>O relatório não retornou entradas.</tr></td>";else{for(var i in reportCSV='"Grupo"',o+="<tr>",e.columns){var s;s=null!=t[e.columns[i].title]?t[e.columns[i].title]:EscapeHtml(e.columns[i].title);var r="";e.columns[i].align?r+=";text-align:"+EscapeHtml(e.columns[i].align):r+=";text-align:left",0!=i||"datetime"!=e.columns[i].format&&"time"!=e.columns[i].format||(r+=";width:1%"),o+="<th style="+r+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var i in o+="</tr>",reportCSV+="\r\n",e.groups)for(var l in o+="<tr style=height:8px></tr>",o+="<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>',0!=i&&(o+=renderReportFormat(i,e.groupFormat)),o+="</b></td></tr>",e.groups[i].entries){var d=e.groups[i].entries[l];for(var c in o+="<tr>",reportCSV+=0!=i?'"'+csvClean(renderReportFormatCSV(i,e.groupFormat))+'"':'""',e.columns){r="";if(null!=e.columns[c].format&&(r="white-space:nowrap;"),e.columns[c].align&&(r="text-align:"+EscapeHtml(e.columns[c].align)),null!=d[e.columns[c].id]?(o+='<td style="'+r+'">'+renderReportFormat(d[e.columns[c].id],e.columns[c].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(d[e.columns[c].id],e.columns[c].format))+'"'):(o+="<td></td>",reportCSV+=","),null!=e.columns[c].sumBy){var u=d[e.columns[c].sumBy];!0===e.columns[c].sumBy&&(u=!0);var p=d[e.columns[c].id];n=e.columns[c].sumBy,null!=p&&(-1==a.indexOf(u)&&a.push(u),null==e.columns[c].subtotals&&(e.columns[c].subtotals={},e.columns[c].totals={}),null==e.columns[c].subtotals[u]?e.columns[c].subtotals[u]=p:e.columns[c].subtotals[u]+=p,null==e.columns[c].totals[u]?e.columns[c].totals[u]=p:e.columns[c].totals[u]+=p)}}o+="</tr>",reportCSV+="\r\n"}if(null!=n){var m=-1;if(!0===n)m=99999;else for(var i in e.columns)e.columns[i].id==n&&(m=i);if(m>=0){a.sort();var g=!0;for(var l in o+="<tr style=height:8px></tr>",a){for(var i in o+="<tr>",e.columns)if(i==m){r="";e.columns[c].align&&(r+=";text-align:"+EscapeHtml(e.columns[c].align)),g&&(r+=";border-top:1pt solid #777"),o+='<td style="color:#777'+r+'">'+renderReportFormat(a[l],e.columns[i].format)}else if(null!=e.columns[i].totals){r="";e.columns[c].align&&(r+=";text-align:"+EscapeHtml(e.columns[c].align)),g&&(r+=";border-top:1pt solid #777"),o+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[i].totals[a[l]],e.columns[i].format)}else o+="<td></td>";o+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}o+="</table>",QH("p60report",o)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Área de Trabalho":5==e?"Arquivos":6==e?"Admin PowerShell":8==e?"Shell do usuário":9==e?"PowerShell do usuário":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messenger":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Desconhecido ("+e+")";if("seconds"==t){var o=e%60,n=Math.floor(e/60)%60,a=Math.floor(e/3600);return zeroPad(a,2)+":"+zeroPad(n,2)+":"+zeroPad(o,2)}if("node"==t)return null!=(i=getNodeFromId(e))?"<div onclick='gotoDevice(\""+i._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+i.icon+'"></div>'+EscapeHtml(i.name):"<i>Desconhecido</i>";if("mesh"==t)return null!=(c=meshes[e])?"<div onclick='gotoMesh(\""+c._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(c.name):"<i>Desconhecido</i>";if("nodemesh"==t){var i,s=null,r=null,l=e.split("/"),d="<table><tr>";if(l.length>=3&&(s=l[0]+"/"+l[1]+"/"+l[2]),l.length>=6&&(r=l[3]+"/"+l[4]+"/"+l[5]),null!=r){var c;if(null==(c=meshes[r]))return"<i>Desconhecido</i>";d+="<td><div onclick='gotoMesh(\""+c._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(c.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(i=getNodeFromId(s))?"<i>Desconhecido</i>":(d+="<td><div onclick='gotoDevice(\""+i._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+i.icon+'"></div>'+EscapeHtml(i.name)+"</td>",d+="</tr></table>")}if("user"==t){var u=null;if(e==userinfo._id?u=userinfo:null!=users&&(u=users[e]),null!=u){var p=u.name;return null!=u.realname&&(p+=", "+u.realname),"<div onclick='gotoUser(\""+u._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(p)}return"<i>usuário desconhecido</i>"}if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Login realizado com sucesso';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>2ª etapa incorreta';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Conta bloqueada';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Tentativa de login inválida'}if("2fa"==t){if(""==e)return"Nenhum";if("backup"==e)return"Códigos de backup";if("fido"==e)return"Chave FIDO";if("sms"==e)return"Mensagem SMS";if("hwotp"==e)return"Hardware OTP";if("messenger"==e)return"Messenging";if("push"==e)return"Notificação de Push";if("otp"==e)return"One-Time Password (Senha de único acesso)";if("cookie"==e)return"Lembrar dispositivo";if("tokenlogin"==e)return"Token de Login";if("ipaddr"==e)return"Endereço IP";if("sso"==e)return"Single Sign-on (Login único)"}if("records"==t){var m={node:"Device record",mesh:"Device group record",user:"User records",sysinfo:"Device information records",iploc:"IP location information records",note:"Text notes records",ifinfo:"Network interface information records",cfile:"Configuration file records",lastconnect:"Last connection time records",power:"Device power transition records",events:"Event records",serverstats:"Server statistics records",ugrp:"User group records",deviceshare:"Device sharing records",logintoken:"Account login token records",smbios:"Device SMBIOS record",pmt:"Device Push Notification Record",meshcentral:"Device, users, groups and other records"};return null!=m[e]?m[e]:e}return EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Área de Trabalho":5==e?"Arquivos":6==e?"Admin PowerShell":8==e?"Shell do usuário":9==e?"PowerShell do usuário":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messenger":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Desconhecido ("+e+")";if("node"==t){var o=getNodeFromId(e);if(null!=o)return o.name}if("mesh"==t){var n=meshes[e];if(null!=n)return n.name}if("user"==t){var a=null;if(e==userinfo._id?a=userinfo:null!=users&&(a=users[e]),null!=a){var i=a.name;return null!=a.realname&&(i+=" - "+a.realname),i}return"usuário desconhecido"}if("msg"==t){if(107==e)return"Login realizado com sucesso";if(108==e)return"2ª etapa incorreta";if(109==e)return"Conta bloqueada";if(110==e)return"Tentativa de login inválida"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",e>0))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Atualmente não há notificações</div>";else for(var o in notifications){var n=notifications[o],a="",i=new Date(n.time),s=0;if(null!=n.title&&(a="<b>"+EscapeHtml(n.title)+"</b>: "),null!=n.nodeid){var r=getNodeFromId(n.nodeid);null!=r&&(s=r.icon,a=16&e?"<b>"+EscapeHtml(meshes[r.meshid].name)+" / "+EscapeHtml(r.name)+"</b>: ":"<b>"+EscapeHtml(r.name)+"</b>: ")}t+='<div title="'+format("Ocorreu em {0}",printDateTime(i))+'" id="notifyx'+n.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+n.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+n.id+')" class=unselectable title="Apagar esta notificação" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+n.id+')" style=margin:5px>'+a+EscapeHtml(n.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(i)+"</div></div>"}var l="";notifications.length>1&&(l='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Apagar tudo</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+l+"</div>")}function notificationSelected(e,t){var o=-1;for(var n in notifications)notifications[n].id==e&&(o=n);-1!=o&&(notificationSelectedEx(notifications[o],e),t&&notifications[o]&&(notifications[o].notification&&(notifications[o].notification.close(),delete notifications[o].notification),notificationDelete(e)))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,o=Q("notifyx"+e);if(null!=o){for(var n in notifications)notifications[n].id==e&&(t=n);if(-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),o.parentNode.removeChild(o),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),notifications.length>0&&0==t)){var a=notifications[0];QS("notifyx"+a.id)["border-top"]="1px solid transparent"}}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nova conta","Limite do servidor","Aviso de segurança","Configurações da conta","Grupo de Dispositivos","Códigos de convite"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Permissão negada","Nome de usuário Inválido","Senha inválida","E-mail inválido","Domínio inválido","Permissões de site inválidas","Usuário já existe","Não foi possível adicionar usuário neste modo","Exceção de validação","Limite da conta atingido.","Solicitação de bate-papo, clique aqui para aceitar.","Ocorreram {0} tentativas de login malsucedidas nesta conta desde o último login.","Falha ao alterar o endereço de e-mail, outra conta já usa: {0}.","Email enviado.","Usuário {0} não encontrado.","Usuários {0} não encontrados.","Erro, não foi possível alterar a senha usada anteriormente.","Erro, não foi possível alterar a senha comumente usada.","Erro, senha não alterada.","Senha alterada.","A senha atual não está correta.",'Erro, código de convite "{0}" já em uso.',"Gateway de SMS não habilitado","Sem direitos de gerenciamento de usuário","Mensagem SMS inválida","Nenhum número de telefone para este usuário","SMS succesfully sent.","Erro de SMS","Erro de SMS: {0}",'O domínio de e-mail "{0}" não é permitido. Somente ({1}) são permitidos',"Invalid message","Message succesfully sent.","Message error","Message error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t=getstore("notifications",0);1&t&&Q("chimes").play();var o=null;if(Notification&&"granted"==Notification.permission){var n=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n");if(e.nodeid){var a=getNodeFromId(e.nodeid);a&&(o=16&t?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[a.meshid].name+" - "+a.name,{tag:e.tag,body:n,icon:"/images/notify/icons128-"+a.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+a.name,{tag:e.tag,body:n,icon:"/images/notify/icons128-"+a.icon+".png"}))}else{null==e.icon&&(e.icon=0);var i=e.title;i=null==i?"":" - "+e.title,o=new Notification(decodeURIComponent("{{{extitle}}}")+i,{tag:e.tag,body:n,icon:"/images/notify/icons128-"+e.icon+".png"})}o.id=e.id,o.xtag=e.tag,o.url=e.url,o.nodeid=e.nodeid,o.username=e.username,o.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=o}if("number"==typeof e.maxtime&&e.maxtime>0){var s=function e(){notificationDelete(e.xid)};s.xid=e.id,setTimeout(s,1e3*e.maxtime)}}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usado","Gratuito"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usado","Gratuito"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t={ServerState:"Estatísticas do servidor",AgentErrorCounters:"Contadores de erros do agente",UnknownGroup:"Grupo Desconhecido",InvalidPKCSsignature:"Assinatura PKCS inválida",InvalidRSAsignature:"Assinatura RSA inválida",InvalidJSON:"JSON inválido",UnknownAction:"Ação Desconhecida",BadWebCertificate:"Certificado da Web inválido",BadSignature:"Assinatura inválida",MaxSessionsReached:"Máximo de sessões alcançadas",UnknownDeviceGroup:"Grupo de Dispositivos Desconhecido",InvalidDeviceGroupType:"Tipo de grupo de dispositivos inválido",DuplicateAgent:"Duplicar Agente",ConnectedIntelAMT:"Intel&reg; AMT conectado",ConnectedIntelAMTCira:"Intel&reg; AMT CIRA conectado",RelayErrors:"Erros de retransmissão",UserAccounts:"Contas de usuário",DeviceGroups:"Grupos de Dispositivos",AgentSessions:"Sessões de Agente",ConnectedUsers:"Usuários conectados",UsersSessions:"Sessões de usuários",RelaySessions:"Sessões de retransmissão",RelayCount:"Contador de Retransmissão"};if(setupGeneralServerStats(),"object"==typeof e.cpuavg){var o=Math.min(e.cpuavg[0],1);window.serverStatCpu.config.data.datasets[0].data=[o,1-o],QH("serverCpuChartText",'<div style=margin-bottom:5px>Carga da CPU</div><div><b title="Carga da CPU no último minuto">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="Carga da CPU nos últimos 5 minutos">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="Carga da CPU nos últimos 15 minutos">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()}"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memória disponivel</div><div><b>"+getNiceSize3(e.availablemem)+"</b> Livre, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memória</div><div><b>"+getNiceSize3(e.freemem)+"</b> Livre, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update());var n="<div style=width:100% cellpadding=0 cellspacing=0>";if("object"==typeof e.values)for(var a in e.values)for(var i in n+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(t[a]?t[a]:a)+"</div>",e.values[a])n+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(t[i]?t[i]:i)+"</span><span style=float:right>"+e.values[a][i]+"</span></td><td></td></tr></table></div>";n+="</div>",QH("serverStatsTable",n)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){if(null!=serverTimelineStats){var t=null;if(null!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t){serverTimelineStats.push(e);var o=Q("p40type").value;0==o?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am}),null!=e.conn.amc&&serverTimelineConfig.data.datasets[5].data.push({x:e.time,y:e.conn.amc})):1==o?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==o||4==o?updateServerTimelineStats():5==o&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours()}}}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}const trafficSeriesNames=["Agente","CIRA","AMT-OS","HTTP","Retransmissão","Terminal","Área de Trabalho","Arquivos","WebRDP","WebSSH","WebVNC","Multiplex de mesa"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e,t=Q("p40type").value,o=pastDate(Q("p40time").value),n=[],a=null,i=!1,s=!0;if(null!=Q("p40server").value&&(""==(a=decodeURIComponent(Q("p40server").value))&&(a=null),s=!1),serverTimelineConfig.options.scales.x.min=o,serverTimelineConfig.options.scales.y.stacked=3==t||4==t,0==t){serverTimelineConfig.options.scales.y.title.text="Contagem de conexão",e={labels:[pastDate(0),o],datasets:[{label:"Agentes",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Usuários",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Sessões de usuário",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Sessões de retransmissão",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0},{label:"Intel AMT CIRA",data:[],backgroundColor:"rgba(255, 155, 0, .1)",borderColor:"rgb(255, 155, 0)",fill:!0}]};for(var r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),s&&(a=serverTimelineStats[r].s,s=!1)),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==a&&(1==serverTimelineStats[r].first&&(e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[5].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),e.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),e.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),e.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),e.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am}),null!=serverTimelineStats[r].conn.amc&&e.datasets[5].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.amc})))}}else if(1==t){serverTimelineConfig.options.scales.y.title.text="Megabytes",e={labels:[pastDate(0),o],datasets:[{label:"Externo",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Pilha usada",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Pilha Total",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),s&&(a=serverTimelineStats[r].s,s=!1)),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==a&&(1==serverTimelineStats[r].first&&(e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),e.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),e.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),e.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==t||4==t){serverTimelineConfig.options.scales.y.title.text="Megabytes",e={labels:[pastDate(0),o],datasets:[]};var l=0;for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),s&&(a=serverTimelineStats[r].s,s=!1)),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==a&&serverTimelineStats[r].traffic&&(serverTimelineStats[r].traffic.AgentCtrlIn>0&&(l|=1),serverTimelineStats[r].traffic.CIRAIn>0&&(l|=2),serverTimelineStats[r].traffic.LMSIn>0&&(l|=4),serverTimelineStats[r].traffic.httpIn>0&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(serverTimelineStats[r].traffic.relayIn[0]>0&&(l|=16),serverTimelineStats[r].traffic.relayIn[1]>0&&(l|=32),serverTimelineStats[r].traffic.relayIn[2]>0&&(l|=64),serverTimelineStats[r].traffic.relayIn[5]>0&&(l|=128),serverTimelineStats[r].traffic.relayIn[10]>0&&(l|=256),serverTimelineStats[r].traffic.relayIn[11]>0&&(l|=512),serverTimelineStats[r].traffic.relayIn[12]>0&&(l|=1024)),serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in>0&&(l|=2048)));for(r=0;r<13;r++)l&1<<r&&e.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),s&&(a=serverTimelineStats[r].s,s=!1)),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==a)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var c=0;3==t?(1&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==t&&(1&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l&&e.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0}))}}else if(5==t){serverTimelineConfig.options.scales.y.title.text="Uso",e={labels:[pastDate(0),o],datasets:[{label:"CPU",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)if("object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]){if(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),s&&(a=serverTimelineStats[r].s,s=!1)),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s!=a)continue;1==serverTimelineStats[r].first&&e.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),e.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]})}}if(serverTimelineConfig.data=e,window.serverMainStats.update(),n.length>0){var u="";for(r=0;r<n.length;r++)u+='<option value="'+encodeURIComponentEx(n[r])+'"'+(a==n[r]?" selected":"")+">"+EscapeHtml(n[r])+"</option>";i&&(u+='<option value=""'+(null==a?" selected":"")+">Nulo</option>"),QH("p40server",u)}QV("p40server",n.length>0)}}function p40downloadEvents(){for(var e="time, conn.agent, conn.users, conn.usersessions, conn.relaysession, conn.intelamt, mem.external, mem.heapused, mem.heaptotal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am?serverTimelineStats[t].conn.am:"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e="",t=parseInt(Q("p41limitdropdown").value);for(var o in serverTrace.length>t&&serverTrace.splice(t),serverTrace){var n=[];for(var a in serverTrace[o].args)"object"==typeof serverTrace[o].args[a]?n.push(JSON.stringify(serverTrace[o].args[a])):n.push(serverTrace[o].args[a]);e+="<div class=traceEvent onclick=showTraceEvent("+o+")>"+EscapeHtml(new Date(serverTrace[o].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[o].source.toUpperCase())+"</b>: "+EscapeHtml(n.join(", "))+"</div>"}QH("p41events",e)}function showTraceEvent(e){var t=serverTrace[e],o="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?o+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":o+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Evento de rastreamento de servidor","<div class=selecttext style=max-height:300px;overflow-y:auto>"+o+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Servidor Principal</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(serverTraceSources.indexOf("cookie")>=0?"checked":"")+">Codificador de Cookie</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(serverTraceSources.indexOf("dispatch")>=0?"checked":"")+">Message Dispatcher</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(serverTraceSources.indexOf("main")>=0?"checked":"")+">Mensagens do servidor principal</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(serverTraceSources.indexOf("peer")>=0?"checked":"")+">Peering de servidor MeshCentral</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(serverTraceSources.indexOf("agent")>=0?"checked":"")+">Tráfego MeshAgent</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(serverTraceSources.indexOf("agentupdate")>=0?"checked":"")+">Atualização MeshAgent</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(serverTraceSources.indexOf("cert")>=0?"checked":"")+">Certificado de Servidor</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(serverTraceSources.indexOf("db")>=0?"checked":"")+">Banco de dados do servidor</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(serverTraceSources.indexOf("email")>=0?"checked":"")+">Tráfego de e-mail / SMS / push</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Servidor web</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(serverTraceSources.indexOf("web")>=0?"checked":"")+">Servidor web</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(serverTraceSources.indexOf("webrequest")>=0?"checked":"")+">Solicitações de servidor web</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(serverTraceSources.indexOf("relay")>=0?"checked":"")+">Web Socket Relay</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(serverTraceSources.indexOf("httpheaders")>=0?"checked":"")+">Cabeçalhos HTTP do servidor da web</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(serverTraceSources.indexOf("authlog")>=0?"checked":"")+">User Authentication Log</label></div>",e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>',e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(serverTraceSources.indexOf("amt")>=0?"checked":"")+">Gerente Intel AMT</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(serverTraceSources.indexOf("webrelay")>=0?"checked":"")+">Relé de conexão</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(serverTraceSources.indexOf("mps")>=0?"checked":"")+">Servidor CIRA</label></div>",e+='<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(serverTraceSources.indexOf("mpscmd")>=0?"checked":"")+">Comandos do servidor CIRA</label></div>",setModalContent("xxAddAgent","Rastreamento de servidor",e+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],o=1;o<22;o++)try{Q("p41c"+o).checked&&e.push(t[o-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e="hora, origem, mensagem\r\n";for(var t in serverTrace)e+='"'+new Date(serverTrace[t].time).toLocaleTimeString()+'","'+serverTrace[t].source+'","'+serverTrace[t].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(e),"servertrace.csv"),!1}function setupServiceWorker(){8&features2&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,o,n,a,i){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=n,xxdialogButtons=o,xxdialogTag=i,QV("id_dialogclose",2&o||8&o),QV("idx_dlgDeleteButton",4&o),QV("idx_dlgButtonBar",7&o),QV("idx_dlgMoreButtons",16&o),t&&QH("xxAddAgentTitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),a&&(2==e?QH("id_dialogOptions",a):QH("id_dialogMessage",a)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity();(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0!=backStack.length){var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||userinfo.otphkeys>0||userinfo.otpkeys>0||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Segurança da conta",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.');go(5)}"server"==t&&go(6)}else go(2)}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&e>2&&(e=2,setModalContent("xxAddAgent","Segurança da conta",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&!(2&userinfo.siteadmin)||4&features)&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var o=0;o<61;o++)QV("p"+o,o==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),!(268435456&features)&&xxcurrentView>0){var n="";for(var o in xxcurrentView>=10&&xxcurrentView<=19?null!=currentNode&&(n="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):xxcurrentView>=20&&xxcurrentView<=29?null!=currentMesh&&(n="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):xxcurrentView>=30&&xxcurrentView<=39?null!=currentUser&&(n="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):xxcurrentView>=51&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(n="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):xxcurrentView>1&&(n="?viewmode="+xxcurrentView),urlargs)n+=(""==n?"?":"&")+o+"="+urlargs[o];try{window.history.replaceState({},document.title,window.location.pathname+n)}catch(e){}}var a=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(var o in a)QC(a[o]).remove("fullselect"),QC(a[o]).remove("semiselect");var i=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(var o in i)QC(i[o]).remove("lbbuttonsel"),QC(i[o]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0;goBackStack.length>0&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&e>=10&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&e>=20&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(r)):4==e||e>=30&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||e>=40&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&e>=10?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",e>=10&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",e>=20&&e<30),QV("UserSubMenuSpan",e>=30&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e);var d={3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"};for(var o in d)QC(d[o]).remove("style3x"),QC(d[o]).remove("style3sel"),QC(d[o]).add(e==o?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&!(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&e>=10&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=[11,12].indexOf(e)>=0?"hidden":null}}else e>=10&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):e>=20&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):e>=30&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):e>=50&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(i=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(i))i[t].parentNode.removeChild(i[t]);var o={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},n={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},a=Q("p42tbl");installedPluginList.forEach(function(e){var t=[];if(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=o[e.status].text,e.statusColor=o[e.status].color,null==e.versionHistoryUrl&&t.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Verificando ...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]){var i=installedPluginList.version_info[e._id];i.hasUpdate?e.upgradeAvail='<a title="Visualizar registro de mudanças" rel="noreferrer noopener" target="_blank" href="'+i.changelogUrl+'">'+i.version+"</a>":(t.push("upgrade"),e.status?e.upgradeAvail="Atualizado":e.upgradeAvail='<a title="Visualizar registro de mudanças" rel="noreferrer noopener" target="_blank" href="'+i.changelogUrl+'">'+i.version+"</a>"),i.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Versão incompatível, atualize a instalação do MeshCentral primeiro\" style=\"cursor: pointer; color:red;\"> ! </span> ]",t.push("install"),t.push("upgrade"))}e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>';var s=Object.entries(n[e.status]);for(var r in s)-1===t.indexOf(s[r][0])&&(e.actions+='<option value="'+s[r][0]+'">'+s[r][1]+"</option>");e.actions+="</select>";var l="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",d=a.insertRow(-1);d.innerHTML=l,d.classList.add("p42tblRow"),d.setAttribute("data-id",e._id),d.setAttribute("id","pluginRow-"+e._id)})}else{var i=Q("p42tbl").querySelectorAll(".p42tblRow");for(var t in Object.values(i))i[t].parentNode.removeChild(i[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,o=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==o&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:o}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var o=null;for(var n in installedPluginList)installedPluginList[n]._id==t&&(o=installedPluginList[n]);setModalContent("xxAddAgent","Ação do plugin",format("Tem certeza de que deseja {0} o plug-in: {1}",e.value,o.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){if(t!=userinfo._id||null==userinfo.removeRights)return e;var o=0,n=0;return 8&userinfo.removeRights&&(n+=8),65536&userinfo.removeRights&&(o+=65536),256&userinfo.removeRights&&(o+=256),512&userinfo.removeRights&&(o+=512),1024&userinfo.removeRights&&(o+=1024),16&userinfo.removeRights&&(n+=16),32768&userinfo.removeRights&&(n+=32768),131072&userinfo.removeRights&&(n+=131072),64&userinfo.removeRights&&(n+=64),262144&userinfo.removeRights&&(n+=262144),4294967295!=e?(e|=o,e&=4294967295-n):(e=2015471,e|=o,e&=4294967295-n),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var o=0,n=e.links[t];if(null!=n){if(4294967295==n.rights)return removeUserRights(4294967295,t);o=n.rights}var a=null;if(t==userinfo._id?a=userinfo:null!=users&&(a=users[t]),null!=a)for(var i in a.links)if(i.startsWith("ugrp/")&&null!=(n=e.links[i])){if(4294967295==n.rights)return removeUserRights(4294967295,t);o|=n.rights}return removeUserRights(o,t)}function IsMeshViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&(e=meshes[e]),null==e||null==e.links)return!1;if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var o=null;if(t==userinfo._id?o=userinfo:null!=users&&(o=users[t]),null!=o)for(var n in o.links)if(n.startsWith("ugrp/")&&null!=e.links[n])return!0;return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var o=GetMeshRights(e.meshid,t);if(4294967295==o)return removeUserRights(o,t);if(null!=e.links&&null!=e.links[t]&&(o|=e.links[t].rights),null!=e.links&&null!=userinfo.links)for(var n in e.links)n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights&&(o|=e.links[n].rights);return removeUserRights(o,t)}function IsNodeViewable(e,t){if(null==e)return!1;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return!1;if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var o in e.links)if(o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights)return!0;return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t=e.length,o=-1,n="undefined"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),a=0,i=0,s=0;s!==t;){if(a=e.charCodeAt(s),s+=1,a>=55296&&a<=56319){if(s===t){n[o+=1]=239,n[o+=1]=191,n[o+=1]=189;break}if(!((i=e.charCodeAt(s))>=56320&&i<=57343)){n[o+=1]=239,n[o+=1]=191,n[o+=1]=189;continue}if(s+=1,(a=1024*(a-55296)+i-56320+65536)>65535){n[o+=1]=240|a>>>18,n[o+=1]=128|a>>>12&63,n[o+=1]=128|a>>>6&63,n[o+=1]=128|63&a;continue}}a<=127?n[o+=1]=0|a:a<=2047?(n[o+=1]=192|a>>>6,n[o+=1]=128|63&a):(n[o+=1]=224|a>>>12,n[o+=1]=128|a>>>6&63,n[o+=1]=128|63&a)}return"undefined"!=typeof Uint8Array?n.subarray(0,o+1):(n.length=o+1,n)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),o=atob(t),n=new Uint8Array(o.length),a=0;a<o.length;++a)n[a]=o.charCodeAt(a);return n}function joinPaths(){var e=[];for(var t in arguments){var o=arguments[t];if(null!=o&&""!=o){for(;o.endsWith("/")||o.endsWith("\\");)o=o.substring(0,o.length-1);for(;o.startsWith("/")||o.startsWith("\\");)o=o.substring(1);e.push(o)}}return e.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var o={};try{for(var n=0,a=localStorage.length;n<a;++n){var i=localStorage.key(n);"_"!=i[0]&&(o[i]=localStorage.getItem(i),"desktopsettings"!=i&&"stars"!=i&&"deskKeyShortcuts"!=i&&"deskStrings"!=i&&"cmdopt"!=i&&"string"==typeof o[i]&&o[i].length>64&&delete o[i])}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(o)})}}function stringToUtf8Blob(e){const t=(new TextEncoder).encode(e);var o=new Uint8Array(3+t.length);o[0]=239,o[1]=187,o[2]=191;for(var n=0;n<t.length;n++)o[n+3]=t[n];return new Blob([o],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){if(null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver)return 0;var t=e.intelamt.ver.split(".");return t.length<2?0:parseInt(t[0])+parseInt(t[1])/100}function getstore(e,t){try{if("undefined"==typeof localStorage)return t;var o=localStorage.getItem(e);return null==o||null==o?t:o}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,o){return o?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,o){return o?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,o){var n=document.createElement("option");n.text=t,n.value=o,Q(e).add(n)}function passwordcheck(e){return e.length>7&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr)&&(messagebox("Erro de chamada",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),!0)}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var o=TableStart();for(i in e)i&&e[i]&&(o+=TableEntry(i,e[i]));return o+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,o=[],n=0,a=e.options.length;n<a;n++)(t=e.options[n]).selected&&o.push(t.value);return o}function getInstance(e,t){for(var o in e)if(e[o].InstanceID==t)return e[o];return null}function getItem(e,t,o){for(var n in e)if(e[n][t]==o)return e[n];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<o.length;n++)(e=o[n].indexOf("="))>0&&(t[o[n].substring(0,e)]=o[n].substring(e+1,o[n].length));return t}function addHtmlValue(e,t,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${o[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,o=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${o[0]||"col-md-12"}">${t}<label class="${o[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(navigator.userAgent.indexOf("Chrome/")>0||navigator.userAgent.indexOf("Firefox/")>0||navigator.userAgent.indexOf("Opera/")>0||navigator.userAgent.indexOf("Safari/")>0)}function findOne(e,t){return null!=e&&null!=t&&t.some(function(t){return e.indexOf(t)>=0})}function copyTextToClip(e){var t=document.createElement("DIV");t.textContent=e,document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function copyTextToClip2(e){var t=document.createElement("DIV");t.textContent=decodeURIComponent(e),document.body.appendChild(t),function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}}(t),document.execCommand("copy"),t.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return printDate(new Date)==printDate(e)?printTime(e):printDateTime(e)}function addDetailItem(e,t,o,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${n[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,o){return void 0!==t[o]?t[o]:e})}function addTextLink(e,t,o){var n=t.toLowerCase().indexOf(e.toLowerCase());return-1==n?t:t.substring(0,n)+'<a href="'+o+'">'+e+"</a>"+t.substring(n+e.length)}function getOrderedList(e,t){var o=[];for(var n in e)o.push(e[n]);return o.sort(function(e,o){var n=e[t].toLowerCase(),a=o[t].toLowerCase();return n>a?1:n<a?-1:0}),o}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){var t="00"+e;return t.substr(t.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),o=t[0]+"/"+t[1]+"/"+t[2],n="";if(4==t.length&&t[3].startsWith("guest:")&&(n=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[o])return null!=users[o].realname?users[o].realname+n:users[o].name+n;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+n;if(e==userinfo._id)return userinfo.name+n;if(nodes)for(var a in nodes)if(nodes[a].links)for(var i in nodes[a].links)if(nodes[a].links[i].name&&i==e)return nodes[a].links[i].name+n;if(meshes)for(var a in meshes)if(meshes[a].links)for(var i in meshes[a].links)if(meshes[a].links[i].name&&i==e)return meshes[a].links[i].name+n;return t[2]+n}function round(e,t){var o=Math.pow(10,t||0);return Math.round(e*o)/o}function safeNewWindow(e,t){var o=window.open(e,t,"noopener,noreferrer");o&&(o.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)>=0}function downloadFile(e,t,o){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("rel","noreferrer noopener"),n.setAttribute("target","fileDownloadFrame"),n.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(n),n.click(),document.body.removeChild(n),o&&setDialogMode(0)}function dialogBoxDrag(){var e=Q("xxAddAgentModal"),t=0,o=0,n=0,a=0;function i(i){(i=i||window.event).preventDefault(),t=n-i.clientX,o=a-i.clientY,n=i.clientX,a=i.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-t+"px"}function s(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),n=e.clientX,a=e.clientY,document.onmouseup=s,document.onmousemove=i}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>